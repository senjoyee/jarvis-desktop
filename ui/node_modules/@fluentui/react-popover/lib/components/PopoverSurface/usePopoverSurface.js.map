{"version":3,"sources":["../src/components/PopoverSurface/usePopoverSurface.ts"],"sourcesContent":["'use client';\n\nimport * as React from 'react';\nimport { useMergedRefs, slot } from '@fluentui/react-utilities';\nimport { useModalAttributes } from '@fluentui/react-tabster';\nimport { usePopoverContext_unstable } from '../../popoverContext';\nimport type {\n  PopoverSurfaceProps,\n  PopoverSurfaceState,\n  PopoverSurfaceBaseProps,\n  PopoverSurfaceBaseState,\n} from './PopoverSurface.types';\n\n/**\n * Create the state required to render PopoverSurface.\n *\n * The returned state can be modified with hooks such as usePopoverSurfaceStyles_unstable,\n * before being passed to renderPopoverSurface_unstable.\n *\n * @param props - props from this instance of PopoverSurface\n * @param ref - reference to root HTMLDivElement of PopoverSurface\n */\nexport const usePopoverSurface_unstable = (\n  props: PopoverSurfaceProps,\n  ref: React.Ref<HTMLDivElement>,\n): PopoverSurfaceState => {\n  const size = usePopoverContext_unstable(context => context.size);\n  const appearance = usePopoverContext_unstable(context => context.appearance);\n  const state = usePopoverSurfaceBase_unstable(props, ref);\n\n  return {\n    appearance,\n    size,\n    ...state,\n  };\n};\n\n/**\n * Base hook that builds PopoverSurface state for behavior and structure only.\n *\n * @internal\n * @param props - User provided props to the PopoverSurface component.\n * @param ref - User provided ref to be passed to the PopoverSurface component.\n */\nexport const usePopoverSurfaceBase_unstable = (\n  props: PopoverSurfaceBaseProps,\n  ref: React.Ref<HTMLDivElement>,\n): PopoverSurfaceBaseState => {\n  const contentRef = usePopoverContext_unstable(context => context.contentRef);\n  const openOnHover = usePopoverContext_unstable(context => context.openOnHover);\n  const setOpen = usePopoverContext_unstable(context => context.setOpen);\n  const mountNode = usePopoverContext_unstable(context => context.mountNode);\n  const arrowRef = usePopoverContext_unstable(context => context.arrowRef);\n  const withArrow = usePopoverContext_unstable(context => context.withArrow);\n  const trapFocus = usePopoverContext_unstable(context => context.trapFocus);\n  const inertTrapFocus = usePopoverContext_unstable(context => context.inertTrapFocus);\n  const inline = usePopoverContext_unstable(context => context.inline);\n  const { modalAttributes } = useModalAttributes({\n    trapFocus,\n    legacyTrapFocus: !inertTrapFocus,\n    alwaysFocusable: !trapFocus,\n  });\n\n  const state: PopoverSurfaceBaseState = {\n    inline,\n    withArrow,\n    arrowRef,\n    mountNode,\n    components: {\n      root: 'div',\n    },\n    root: slot.always(\n      {\n        ref: useMergedRefs(ref, contentRef) as React.Ref<HTMLDivElement>,\n        role: trapFocus ? 'dialog' : 'group',\n        'aria-modal': trapFocus ? true : undefined,\n        ...modalAttributes,\n        ...props,\n      },\n      { elementType: 'div' },\n    ),\n  };\n\n  const {\n    onMouseEnter: onMouseEnterOriginal,\n    onMouseLeave: onMouseLeaveOriginal,\n    onKeyDown: onKeyDownOriginal,\n  } = state.root;\n  state.root.onMouseEnter = (e: React.MouseEvent<HTMLDivElement>) => {\n    if (openOnHover) {\n      setOpen(e, true);\n    }\n\n    onMouseEnterOriginal?.(e);\n  };\n\n  state.root.onMouseLeave = (e: React.MouseEvent<HTMLDivElement>) => {\n    if (openOnHover) {\n      setOpen(e, false);\n    }\n\n    onMouseLeaveOriginal?.(e);\n  };\n\n  state.root.onKeyDown = (e: React.KeyboardEvent<HTMLDivElement>) => {\n    // only close if the event happened inside the current popover\n    // If using a stack of inline popovers, the user should call `stopPropagation` to avoid dismissing the entire stack\n    if (e.key === 'Escape' && contentRef.current?.contains(e.target as HTMLDivElement)) {\n      e.preventDefault();\n      setOpen(e, false);\n    }\n\n    onKeyDownOriginal?.(e);\n  };\n\n  return state;\n};\n"],"names":["React","useMergedRefs","slot","useModalAttributes","usePopoverContext_unstable","usePopoverSurface_unstable","props","ref","size","context","appearance","state","usePopoverSurfaceBase_unstable","contentRef","openOnHover","setOpen","mountNode","arrowRef","withArrow","trapFocus","inertTrapFocus","inline","modalAttributes","legacyTrapFocus","alwaysFocusable","components","root","always","role","undefined","elementType","onMouseEnter","onMouseEnterOriginal","onMouseLeave","onMouseLeaveOriginal","onKeyDown","onKeyDownOriginal","e","key","current","contains","target","preventDefault"],"mappings":"AAAA;AAEA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,aAAa,EAAEC,IAAI,QAAQ,4BAA4B;AAChE,SAASC,kBAAkB,QAAQ,0BAA0B;AAC7D,SAASC,0BAA0B,QAAQ,uBAAuB;AAQlE;;;;;;;;CAQC,GACD,OAAO,MAAMC,6BAA6B,CACxCC,OACAC;IAEA,MAAMC,OAAOJ,2BAA2BK,CAAAA,UAAWA,QAAQD,IAAI;IAC/D,MAAME,aAAaN,2BAA2BK,CAAAA,UAAWA,QAAQC,UAAU;IAC3E,MAAMC,QAAQC,+BAA+BN,OAAOC;IAEpD,OAAO;QACLG;QACAF;QACA,GAAGG,KAAK;IACV;AACF,EAAE;AAEF;;;;;;CAMC,GACD,OAAO,MAAMC,iCAAiC,CAC5CN,OACAC;IAEA,MAAMM,aAAaT,2BAA2BK,CAAAA,UAAWA,QAAQI,UAAU;IAC3E,MAAMC,cAAcV,2BAA2BK,CAAAA,UAAWA,QAAQK,WAAW;IAC7E,MAAMC,UAAUX,2BAA2BK,CAAAA,UAAWA,QAAQM,OAAO;IACrE,MAAMC,YAAYZ,2BAA2BK,CAAAA,UAAWA,QAAQO,SAAS;IACzE,MAAMC,WAAWb,2BAA2BK,CAAAA,UAAWA,QAAQQ,QAAQ;IACvE,MAAMC,YAAYd,2BAA2BK,CAAAA,UAAWA,QAAQS,SAAS;IACzE,MAAMC,YAAYf,2BAA2BK,CAAAA,UAAWA,QAAQU,SAAS;IACzE,MAAMC,iBAAiBhB,2BAA2BK,CAAAA,UAAWA,QAAQW,cAAc;IACnF,MAAMC,SAASjB,2BAA2BK,CAAAA,UAAWA,QAAQY,MAAM;IACnE,MAAM,EAAEC,eAAe,EAAE,GAAGnB,mBAAmB;QAC7CgB;QACAI,iBAAiB,CAACH;QAClBI,iBAAiB,CAACL;IACpB;IAEA,MAAMR,QAAiC;QACrCU;QACAH;QACAD;QACAD;QACAS,YAAY;YACVC,MAAM;QACR;QACAA,MAAMxB,KAAKyB,MAAM,CACf;YACEpB,KAAKN,cAAcM,KAAKM;YACxBe,MAAMT,YAAY,WAAW;YAC7B,cAAcA,YAAY,OAAOU;YACjC,GAAGP,eAAe;YAClB,GAAGhB,KAAK;QACV,GACA;YAAEwB,aAAa;QAAM;IAEzB;IAEA,MAAM,EACJC,cAAcC,oBAAoB,EAClCC,cAAcC,oBAAoB,EAClCC,WAAWC,iBAAiB,EAC7B,GAAGzB,MAAMe,IAAI;IACdf,MAAMe,IAAI,CAACK,YAAY,GAAG,CAACM;QACzB,IAAIvB,aAAa;YACfC,QAAQsB,GAAG;QACb;QAEAL,iCAAAA,2CAAAA,qBAAuBK;IACzB;IAEA1B,MAAMe,IAAI,CAACO,YAAY,GAAG,CAACI;QACzB,IAAIvB,aAAa;YACfC,QAAQsB,GAAG;QACb;QAEAH,iCAAAA,2CAAAA,qBAAuBG;IACzB;IAEA1B,MAAMe,IAAI,CAACS,SAAS,GAAG,CAACE;YAGIxB;QAF1B,8DAA8D;QAC9D,mHAAmH;QACnH,IAAIwB,EAAEC,GAAG,KAAK,cAAYzB,sBAAAA,WAAW0B,OAAO,cAAlB1B,0CAAAA,oBAAoB2B,QAAQ,CAACH,EAAEI,MAAM,IAAqB;YAClFJ,EAAEK,cAAc;YAChB3B,QAAQsB,GAAG;QACb;QAEAD,8BAAAA,wCAAAA,kBAAoBC;IACtB;IAEA,OAAO1B;AACT,EAAE"}