{"version":3,"sources":["../src/choreography/Stagger/utils/stagger-calculations.ts"],"sourcesContent":["import type { StaggerProps } from '../stagger-types';\nimport { DEFAULT_ITEM_DELAY, DEFAULT_ITEM_DURATION } from './constants';\n\n/**\n * Calculate the total stagger duration â€” from the moment the stagger begins\n * until the final item's animation completes.\n *\n * Uses the formula:\n *   max(0, itemDelay * (itemCount - 1) + itemDuration)\n *\n * @param params.itemCount    Total number of items to stagger\n * @param params.itemDelay    Milliseconds between the start of each item (default: DEFAULT_ITEM_DELAY)\n * @param params.itemDuration Milliseconds each item's animation lasts (default: DEFAULT_ITEM_DURATION)\n * @returns                   Total duration in milliseconds (never negative)\n */\nexport function getStaggerTotalDuration({\n  itemCount,\n  itemDelay = DEFAULT_ITEM_DELAY,\n  itemDuration = DEFAULT_ITEM_DURATION,\n}: {\n  itemCount: number;\n} & Pick<StaggerProps, 'itemDelay' | 'itemDuration'>): number {\n  if (itemCount <= 0) {\n    return 0;\n  }\n  if (itemCount <= 1) {\n    return Math.max(0, itemDuration);\n  }\n  const staggerDuration = itemDelay * (itemCount - 1);\n  return Math.max(0, staggerDuration + itemDuration);\n}\n\nexport interface StaggerItemsVisibilityAtTimeParams\n  extends Pick<StaggerProps, 'itemDelay' | 'itemDuration' | 'reversed'> {\n  itemCount: number;\n  elapsed: number;\n  direction?: 'enter' | 'exit';\n}\n\n/**\n * Returns visibility flags plus timing metrics for a stagger sequence.\n */\nexport function staggerItemsVisibilityAtTime({\n  itemCount,\n  elapsed,\n  itemDelay = DEFAULT_ITEM_DELAY,\n  itemDuration = DEFAULT_ITEM_DURATION,\n  direction = 'enter',\n  reversed = false,\n}: StaggerItemsVisibilityAtTimeParams): {\n  itemsVisibility: boolean[];\n  totalDuration: number;\n} {\n  // If no items, return the empty state\n  if (itemCount <= 0) {\n    return { itemsVisibility: [], totalDuration: 0 };\n  }\n\n  const totalDuration = getStaggerTotalDuration({ itemCount, itemDelay, itemDuration });\n\n  // Calculate progression through the stagger sequence\n  let completedSteps: number;\n  if (itemDelay <= 0) {\n    // When itemDelay is 0 or negative, all steps complete immediately\n    completedSteps = itemCount;\n  } else {\n    // Both enter and exit should start their first item immediately, but handle t=0 differently\n    if (elapsed === 0) {\n      // At exactly t=0, for enter we want first item visible, for exit we want all items visible\n      completedSteps = direction === 'enter' ? 1 : 0;\n    } else {\n      // After t=0, both directions should progress at the same rate\n      const stepsFromElapsedTime = Math.floor(elapsed / itemDelay) + 1;\n      completedSteps = Math.min(itemCount, stepsFromElapsedTime);\n    }\n  }\n\n  const itemsVisibility = Array.from({ length: itemCount }, (_, idx) => {\n    // Calculate based on progression through the sequence (enter pattern)\n    const fromStart = idx < completedSteps;\n    const fromEnd = idx >= itemCount - completedSteps;\n\n    let itemVisible = reversed ? fromEnd : fromStart;\n\n    // For exit, invert the enter pattern\n    if (direction === 'exit') {\n      itemVisible = !itemVisible;\n    }\n\n    return itemVisible;\n  });\n\n  return { itemsVisibility, totalDuration };\n}\n"],"names":["getStaggerTotalDuration","staggerItemsVisibilityAtTime","itemCount","itemDelay","DEFAULT_ITEM_DELAY","itemDuration","DEFAULT_ITEM_DURATION","Math","max","staggerDuration","elapsed","direction","reversed","itemsVisibility","totalDuration","completedSteps","stepsFromElapsedTime","floor","min","Array","from","length","_","idx","fromStart","fromEnd","itemVisible"],"mappings":";;;;;;;;;;;IAegBA,uBAAuB;eAAvBA;;IA2BAC,4BAA4B;eAA5BA;;;2BAzC0C;AAcnD,SAASD,wBAAwB,EACtCE,SAAS,EACTC,YAAYC,6BAAkB,EAC9BC,eAAeC,gCAAqB,EAGc;IAClD,IAAIJ,aAAa,GAAG;QAClB,OAAO;IACT;IACA,IAAIA,aAAa,GAAG;QAClB,OAAOK,KAAKC,GAAG,CAAC,GAAGH;IACrB;IACA,MAAMI,kBAAkBN,YAAaD,CAAAA,YAAY,CAAA;IACjD,OAAOK,KAAKC,GAAG,CAAC,GAAGC,kBAAkBJ;AACvC;AAYO,SAASJ,6BAA6B,EAC3CC,SAAS,EACTQ,OAAO,EACPP,YAAYC,6BAAkB,EAC9BC,eAAeC,gCAAqB,EACpCK,YAAY,OAAO,EACnBC,WAAW,KAAK,EACmB;IAInC,sCAAsC;IACtC,IAAIV,aAAa,GAAG;QAClB,OAAO;YAAEW,iBAAiB,EAAE;YAAEC,eAAe;QAAE;IACjD;IAEA,MAAMA,gBAAgBd,wBAAwB;QAAEE;QAAWC;QAAWE;IAAa;IAEnF,qDAAqD;IACrD,IAAIU;IACJ,IAAIZ,aAAa,GAAG;QAClB,kEAAkE;QAClEY,iBAAiBb;IACnB,OAAO;QACL,4FAA4F;QAC5F,IAAIQ,YAAY,GAAG;YACjB,2FAA2F;YAC3FK,iBAAiBJ,cAAc,UAAU,IAAI;QAC/C,OAAO;YACL,8DAA8D;YAC9D,MAAMK,uBAAuBT,KAAKU,KAAK,CAACP,UAAUP,aAAa;YAC/DY,iBAAiBR,KAAKW,GAAG,CAAChB,WAAWc;QACvC;IACF;IAEA,MAAMH,kBAAkBM,MAAMC,IAAI,CAAC;QAAEC,QAAQnB;IAAU,GAAG,CAACoB,GAAGC;QAC5D,sEAAsE;QACtE,MAAMC,YAAYD,MAAMR;QACxB,MAAMU,UAAUF,OAAOrB,YAAYa;QAEnC,IAAIW,cAAcd,WAAWa,UAAUD;QAEvC,qCAAqC;QACrC,IAAIb,cAAc,QAAQ;YACxBe,cAAc,CAACA;QACjB;QAEA,OAAOA;IACT;IAEA,OAAO;QAAEb;QAAiBC;IAAc;AAC1C"}