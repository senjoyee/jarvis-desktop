{"version":3,"sources":["../src/choreography/Stagger/Stagger.tsx"],"sourcesContent":["'use client';\n\nimport * as React from 'react';\nimport { useStaggerItemsVisibility } from './useStaggerItemsVisibility';\nimport {\n  DEFAULT_ITEM_DURATION,\n  DEFAULT_ITEM_DELAY,\n  acceptsVisibleProp,\n  acceptsDelayProps,\n  getStaggerChildMapping,\n} from './utils';\nimport { StaggerOneWayProps, StaggerProps, type StaggerHideMode, type StaggerDelayMode } from './stagger-types';\n\n/**\n * Shared utility to detect optimal stagger modes based on children components.\n * Consolidates the auto-detection logic used by both StaggerMain and createStaggerDirection.\n */\nconst detectStaggerModes = (\n  children: React.ReactNode,\n  options: {\n    hideMode?: StaggerHideMode;\n    delayMode?: StaggerDelayMode;\n    fallbackHideMode?: StaggerHideMode;\n  },\n): { hideMode: StaggerHideMode; delayMode: StaggerDelayMode } => {\n  const { hideMode, delayMode, fallbackHideMode = 'visibilityStyle' } = options;\n\n  const childMapping = getStaggerChildMapping(children);\n  const elements = Object.values(childMapping).map(item => item.element);\n  const hasVisiblePropSupport = elements.every(child => acceptsVisibleProp(child));\n  const hasDelayPropSupport = elements.every(child => acceptsDelayProps(child));\n\n  return {\n    hideMode: hideMode ?? (hasVisiblePropSupport ? 'visibleProp' : fallbackHideMode),\n    delayMode: delayMode ?? (hasDelayPropSupport ? 'delayProp' : 'timing'),\n  };\n};\n\nconst StaggerOneWay: React.FC<StaggerOneWayProps> = ({\n  children,\n  direction,\n  itemDelay = DEFAULT_ITEM_DELAY,\n  itemDuration = DEFAULT_ITEM_DURATION,\n  reversed = false,\n  hideMode,\n  delayMode = 'timing',\n  onMotionFinish,\n}) => {\n  const childMapping = React.useMemo(() => getStaggerChildMapping(children), [children]);\n\n  // Always call hooks at the top level, regardless of delayMode\n  const { itemsVisibility } = useStaggerItemsVisibility({\n    childMapping,\n    itemDelay,\n    itemDuration,\n    direction,\n    reversed,\n    onMotionFinish,\n    hideMode,\n  });\n\n  // For delayProp mode, pass delay props directly to motion components\n  if (delayMode === 'delayProp') {\n    return (\n      <>\n        {Object.entries(childMapping).map(([key, { element, index }]) => {\n          const staggerIndex = reversed ? Object.keys(childMapping).length - 1 - index : index;\n          const delay = staggerIndex * itemDelay;\n\n          // Clone element with delay prop (for enter direction) or exitDelay prop (for exit direction)\n          const delayProp = direction === 'enter' ? { delay } : { exitDelay: delay };\n\n          // Only set visible prop if the component supports it\n          // Set visible based on direction: true for enter, false for exit\n          const visibleProp = acceptsVisibleProp(element) ? { visible: direction === 'enter' } : {};\n\n          return React.cloneElement(element, {\n            key,\n            ...visibleProp,\n            ...delayProp,\n          });\n        })}\n      </>\n    );\n  }\n\n  // For timing mode, use the existing timing-based implementation\n\n  return (\n    <>\n      {Object.entries(childMapping).map(([key, { element }]) => {\n        if (hideMode === 'visibleProp') {\n          // Use a generic record type for props to avoid `any` while still allowing unknown prop shapes.\n          return React.cloneElement(element, {\n            key,\n            visible: itemsVisibility[key],\n          } as Partial<Record<string, unknown>>);\n        } else if (hideMode === 'visibilityStyle') {\n          const childProps = element.props as Record<string, unknown> | undefined;\n          const style = {\n            ...(childProps?.style as Record<string, unknown> | undefined),\n            visibility: itemsVisibility[key] ? 'visible' : 'hidden',\n          };\n          return React.cloneElement(element, { key, style } as Partial<Record<string, unknown>>);\n        } else {\n          // unmount mode\n          return itemsVisibility[key] ? React.cloneElement(element, { key }) : null;\n        }\n      })}\n    </>\n  );\n};\n\n// Shared helper for StaggerIn and StaggerOut\nconst createStaggerDirection = (direction: 'enter' | 'exit') => {\n  const StaggerDirection: React.FC<Omit<StaggerProps, 'visible'>> = ({ hideMode, delayMode, children, ...props }) => {\n    // Auto-detect modes for better performance with motion components\n    const { hideMode: resolvedHideMode, delayMode: resolvedDelayMode } = detectStaggerModes(children, {\n      hideMode,\n      delayMode,\n      // One-way stagger falls back to visibilityStyle if it doesn't detect visibleProp support\n      fallbackHideMode: 'visibilityStyle',\n    });\n\n    return (\n      <StaggerOneWay\n        {...props}\n        children={children}\n        direction={direction}\n        hideMode={resolvedHideMode}\n        delayMode={resolvedDelayMode}\n      />\n    );\n  };\n\n  return StaggerDirection;\n};\n\nconst StaggerIn = createStaggerDirection('enter');\nconst StaggerOut = createStaggerDirection('exit');\n\n// Main Stagger component with auto-detection or explicit modes\nconst StaggerMain: React.FC<StaggerProps> = props => {\n  const { children, visible = false, hideMode, delayMode, ...rest } = props;\n\n  // Auto-detect modes for bidirectional stagger\n  const { hideMode: resolvedHideMode, delayMode: resolvedDelayMode } = detectStaggerModes(children, {\n    hideMode,\n    delayMode,\n    // Bidirectional stagger falls back to visibilityStyle if it doesn't detect visibleProp support\n    fallbackHideMode: 'visibilityStyle',\n  });\n\n  const direction = visible ? 'enter' : 'exit';\n\n  return (\n    <StaggerOneWay\n      {...rest}\n      children={children}\n      hideMode={resolvedHideMode}\n      delayMode={resolvedDelayMode}\n      direction={direction}\n    />\n  );\n};\n\n/**\n * Stagger is a component that manages the staggered entrance and exit of its children.\n * Children are animated in sequence with configurable timing between each item.\n * Stagger can be interactively toggled between entrance and exit animations using the `visible` prop.\n *\n * @param children - React elements to animate. Elements are cloned with animation props.\n * @param visible - Controls animation direction. When `true`, the group is animating \"enter\" (items shown);\n * when `false`, the group is animating \"exit\" (items hidden). Defaults to `false`.\n * @param itemDelay - Milliseconds between each item's animation start.\n * Defaults to the package's default delay (see `DEFAULT_ITEM_DELAY`).\n * @param itemDuration - Milliseconds each item's animation lasts. Only used with `delayMode=\"timing\"`.\n * Defaults to the package's default item duration (see `DEFAULT_ITEM_DURATION`).\n * @param reversed - Whether to reverse the stagger sequence (last item animates first). Defaults to `false`.\n * @param hideMode - How children's visibility/mounting is managed. Auto-detects if not specified.\n * @param delayMode - How staggering timing is implemented. Auto-detects if not specified.\n * @param onMotionFinish - Callback invoked when the staggered animation sequence completes.\n *\n * **Auto-detection behavior:**\n * - **hideMode**: Presence components use `'visibleProp'`, DOM elements use `'visibilityStyle'`\n * - **delayMode**: Components with delay support use `'delayProp'` (most performant), others use `'timing'`\n *\n * **hideMode options:**\n * - `'visibleProp'`: Children are presence components with `visible` prop (always rendered, visibility controlled via prop)\n * - `'visibilityStyle'`: Children remain in DOM with inline style visibility: hidden/visible (preserves layout space)\n * - `'unmount'`: Children are mounted/unmounted from DOM based on visibility\n *\n * **delayMode options:**\n * - `'timing'`: Manages visibility over time using JavaScript timing\n * - `'delayProp'`: Passes delay props to motion components to use native Web Animations API delays (most performant)\n *\n * **Static variants:**\n * - `<Stagger.In>` - One-way stagger for entrance animations only (auto-detects optimal modes)\n * - `<Stagger.Out>` - One-way stagger for exit animations only (auto-detects optimal modes)\n *\n * @example\n * ```tsx\n * import { Stagger, Fade, Scale, Rotate } from '@fluentui/react-motion-components-preview';\n *\n * // Auto-detects optimal modes for presence components (delayProp + visibleProp)\n * <Stagger visible={isVisible} itemDelay={150}>\n *   <Fade><div>Item 2</div></Fade>\n *   <Scale><div>Item 1</div></Scale>\n *   <Rotate><div>Item 3</div></Rotate>\n * </Stagger>\n *\n * // Auto-detects optimal modes for motion components (delayProp + unmount)\n * <Stagger.In itemDelay={100}>\n *   <Scale.In><div>Item 1</div></Scale.In>\n *   <Fade.In><div>Item 2</div></Fade.In>\n * </Stagger.In>\n *\n * // Auto-detects timing mode for DOM elements (timing + visibilityStyle)\n * <Stagger visible={isVisible} itemDelay={150} onMotionFinish={handleComplete}>\n *   <div>Item 1</div>\n *   <div>Item 2</div>\n *   <div>Item 3</div>\n * </Stagger>\n *\n * // Override auto-detection when needed\n * <Stagger visible={isVisible} delayMode=\"timing\" hideMode=\"unmount\">\n *   <CustomComponent>Item 1</CustomComponent>\n * </Stagger>\n * ```\n */\nexport const Stagger = Object.assign(StaggerMain, {\n  In: StaggerIn,\n  Out: StaggerOut,\n});\n"],"names":["Stagger","detectStaggerModes","children","options","hideMode","delayMode","fallbackHideMode","childMapping","getStaggerChildMapping","elements","Object","values","map","item","element","hasVisiblePropSupport","every","child","acceptsVisibleProp","hasDelayPropSupport","acceptsDelayProps","StaggerOneWay","direction","itemDelay","DEFAULT_ITEM_DELAY","itemDuration","DEFAULT_ITEM_DURATION","reversed","onMotionFinish","React","useMemo","itemsVisibility","useStaggerItemsVisibility","entries","key","index","staggerIndex","keys","length","delay","delayProp","exitDelay","visibleProp","visible","cloneElement","childProps","props","style","visibility","createStaggerDirection","StaggerDirection","resolvedHideMode","resolvedDelayMode","StaggerIn","StaggerOut","StaggerMain","rest","assign","In","Out"],"mappings":"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"}