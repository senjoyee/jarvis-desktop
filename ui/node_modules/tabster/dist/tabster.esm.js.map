{"version":3,"file":"tabster.esm.js","sources":["../src/Consts.ts","../src/Instance.ts","../src/Events.ts","../src/DOMAPI.ts","../src/Utils.ts","../src/AttributeHelpers.ts","../src/Root.ts","../src/Deloser.ts","../src/State/Subscribable.ts","../src/CrossOrigin.ts","../src/Focusable.ts","../src/Keys.ts","../src/State/FocusedElement.ts","../src/Groupper.ts","../src/State/KeyboardNavigation.ts","../src/Modalizer.ts","../src/Mover.ts","../src/MutationEvent.ts","../src/State/ObservedElement.ts","../src/Outline.ts","../src/Uncontrolled.ts","../src/Restorer.ts","../src/Shadowdomize/DOMFunctions.ts","../src/Shadowdomize/ShadowTreeWalker.ts","../src/Shadowdomize/ShadowMutationObserver.ts","../src/Shadowdomize/querySelector.ts","../src/Shadowdomize/index.ts","../src/Tabster.ts","../src/Types.ts","../src/EventsTypes.ts","../src/Deprecated.ts"],"sourcesContent":["/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nexport const TABSTER_ATTRIBUTE_NAME = \"data-tabster\" as const;\nexport const TABSTER_DUMMY_INPUT_ATTRIBUTE_NAME = \"data-tabster-dummy\" as const;\n\nexport const FOCUSABLE_SELECTOR = `:is(${[\n    \"a[href]\",\n    \"button\",\n    \"input\",\n    \"select\",\n    \"textarea\",\n    \"*[tabindex]\",\n    \"*[contenteditable]\",\n    \"details > summary\",\n    \"audio[controls]\",\n    \"video[controls]\",\n].join(\", \")}):not(:disabled)`;\n\nexport const AsyncFocusSources = {\n    EscapeGroupper: 1,\n    Restorer: 2,\n    Deloser: 3,\n} as const;\n\nexport const ObservedElementAccessibilities = {\n    Any: 0,\n    Accessible: 1,\n    Focusable: 2,\n} as const;\n\nexport const ObservedElementRequestStatuses = {\n    Waiting: 0,\n    Succeeded: 1,\n    Canceled: 2,\n    TimedOut: 3,\n} as const;\n\nexport const ObservedElementFailureReasons = {\n    CanceledFocusChange: 1,\n    TimeoutElementNotInDOM: 2,\n    TimeoutElementNotAccessible: 3,\n    TimeoutElementNotFocusable: 4,\n    TimeoutElementNotReady: 5,\n    SupersededByNewRequest: 6,\n    FocusCallFailed: 7,\n} as const;\n\nexport const RestoreFocusOrders = {\n    History: 0,\n    DeloserDefault: 1,\n    RootDefault: 2,\n    DeloserFirst: 3,\n    RootFirst: 4,\n} as const;\n\nexport const DeloserStrategies = {\n    /**\n     * If the focus is lost, the focus will be restored automatically using all available focus history.\n     * This is the default strategy.\n     */\n    Auto: 0,\n    /**\n     * If the focus is lost from this Deloser instance, the focus will not be restored automatically.\n     * The application might listen to the event and restore the focus manually.\n     * But if it is lost from another Deloser instance, the history of this Deloser could be used finding\n     * the element to focus.\n     */\n    Manual: 1,\n} as const;\n\nexport const Visibilities = {\n    Invisible: 0,\n    PartiallyVisible: 1,\n    Visible: 2,\n} as const;\n\nexport const RestorerTypes = {\n    Source: 0,\n    Target: 1,\n} as const;\n\nexport const MoverDirections = {\n    Both: 0, // Default, both left/up keys move to the previous, right/down move to the next.\n    Vertical: 1, // Only up/down arrows move to the next/previous.\n    Horizontal: 2, // Only left/right arrows move to the next/previous.\n    Grid: 3, // Two-dimentional movement depending on the visual placement.\n    GridLinear: 4, // Two-dimentional movement depending on the visual placement. Allows linear movement.\n} as const;\n\nexport const MoverKeys = {\n    ArrowUp: 1,\n    ArrowDown: 2,\n    ArrowLeft: 3,\n    ArrowRight: 4,\n    PageUp: 5,\n    PageDown: 6,\n    Home: 7,\n    End: 8,\n} as const;\n\nexport const GroupperTabbabilities = {\n    Unlimited: 0,\n    Limited: 1, // The tabbability is limited to the container and explicit Enter is needed to go inside.\n    LimitedTrapFocus: 2, // The focus is limited as above, plus trapped when inside.\n} as const;\n\nexport const GroupperMoveFocusActions = {\n    Enter: 1,\n    Escape: 2,\n} as const;\n\nexport const SysDummyInputsPositions = {\n    Auto: 0, // Tabster will place dummy inputs depending on the container tag name and on the default behaviour.\n    Inside: 1, // Tabster will always place dummy inputs inside the container.\n    Outside: 2, // Tabster will always place dummy inputs outside of the container.\n} as const;\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport * as Types from \"./Types\";\nimport { TABSTER_ATTRIBUTE_NAME } from \"./Consts\";\n\nexport function getTabsterOnElement(\n    tabster: Types.TabsterCore,\n    element: HTMLElement\n): Types.TabsterOnElement | undefined {\n    return tabster.storageEntry(element)?.tabster;\n}\n\nexport function updateTabsterByAttribute(\n    tabster: Types.TabsterCore,\n    element: HTMLElement,\n    dispose?: boolean\n): void {\n    const newAttrValue =\n        dispose || tabster._noop\n            ? undefined\n            : element.getAttribute(TABSTER_ATTRIBUTE_NAME);\n\n    let entry = tabster.storageEntry(element);\n    let newAttr: Types.TabsterAttributeOnElement | undefined;\n\n    if (newAttrValue) {\n        if (newAttrValue !== entry?.attr?.string) {\n            try {\n                const newValue = JSON.parse(\n                    newAttrValue\n                ) as Types.TabsterAttributeProps;\n\n                if (typeof newValue !== \"object\") {\n                    throw new Error(\n                        `Value is not a JSON object, got '${newAttrValue}'.`\n                    );\n                }\n\n                newAttr = {\n                    string: newAttrValue,\n                    object: newValue,\n                };\n            } catch (e) {\n                if (__DEV__) {\n                    console.error(\n                        `data-tabster attribute error: ${e}`,\n                        element\n                    );\n                }\n            }\n        } else {\n            return;\n        }\n    } else if (!entry) {\n        return;\n    }\n\n    if (!entry) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        entry = tabster.storageEntry(element, true)!;\n    }\n\n    if (!entry.tabster) {\n        entry.tabster = {};\n    }\n\n    const tabsterOnElement = entry.tabster || {};\n    const oldTabsterProps = entry.attr?.object || {};\n    const newTabsterProps = newAttr?.object || {};\n\n    for (const key of Object.keys(\n        oldTabsterProps\n    ) as (keyof Types.TabsterAttributeProps)[]) {\n        if (!newTabsterProps[key]) {\n            if (key === \"root\") {\n                const root = tabsterOnElement[key];\n\n                if (root) {\n                    tabster.root.onRoot(root, true);\n                }\n            }\n\n            switch (key) {\n                case \"deloser\":\n                case \"root\":\n                case \"groupper\":\n                case \"modalizer\":\n                case \"restorer\":\n                case \"mover\":\n                    // eslint-disable-next-line no-case-declarations\n                    const part = tabsterOnElement[key];\n                    if (part) {\n                        part.dispose();\n                        delete tabsterOnElement[key];\n                    }\n                    break;\n\n                case \"observed\":\n                    delete tabsterOnElement[key];\n                    if (tabster.observedElement) {\n                        tabster.observedElement.onObservedElementUpdate(\n                            element\n                        );\n                    }\n                    break;\n\n                case \"focusable\":\n                case \"outline\":\n                case \"uncontrolled\":\n                case \"sys\":\n                    delete tabsterOnElement[key];\n                    break;\n            }\n        }\n    }\n\n    for (const key of Object.keys(\n        newTabsterProps\n    ) as (keyof Types.TabsterAttributeProps)[]) {\n        const sys = newTabsterProps.sys;\n\n        switch (key) {\n            case \"deloser\":\n                if (tabsterOnElement.deloser) {\n                    tabsterOnElement.deloser.setProps(\n                        newTabsterProps.deloser as Types.DeloserProps\n                    );\n                } else {\n                    if (tabster.deloser) {\n                        tabsterOnElement.deloser =\n                            tabster.deloser.createDeloser(\n                                element,\n                                newTabsterProps.deloser as Types.DeloserProps\n                            );\n                    } else if (__DEV__) {\n                        console.error(\n                            \"Deloser API used before initialization, please call `getDeloser()`\"\n                        );\n                    }\n                }\n                break;\n\n            case \"root\":\n                if (tabsterOnElement.root) {\n                    tabsterOnElement.root.setProps(\n                        newTabsterProps.root as Types.RootProps\n                    );\n                } else {\n                    tabsterOnElement.root = tabster.root.createRoot(\n                        element,\n                        newTabsterProps.root as Types.RootProps,\n                        sys\n                    );\n                }\n                tabster.root.onRoot(tabsterOnElement.root);\n                break;\n\n            case \"modalizer\":\n                {\n                    let newModalizerProps: Types.ModalizerProps | undefined;\n                    const modalizerAPI = tabster.modalizer;\n\n                    if (tabsterOnElement.modalizer) {\n                        const props =\n                            newTabsterProps.modalizer as Types.ModalizerProps;\n                        const newModalizerId = props.id;\n                        if (\n                            newModalizerId &&\n                            oldTabsterProps?.modalizer?.id !== newModalizerId\n                        ) {\n                            // Modalizer id is changed, given the modalizers have complex logic and could be\n                            // composite, it is easier to recreate the Modalizer instance than to implement\n                            // the id update.\n                            tabsterOnElement.modalizer.dispose();\n                            newModalizerProps = props;\n                        } else {\n                            tabsterOnElement.modalizer.setProps(props);\n                        }\n                    } else {\n                        if (modalizerAPI) {\n                            newModalizerProps = newTabsterProps.modalizer;\n                        } else if (__DEV__) {\n                            console.error(\n                                \"Modalizer API used before initialization, please call `getModalizer()`\"\n                            );\n                        }\n                    }\n\n                    if (modalizerAPI && newModalizerProps) {\n                        tabsterOnElement.modalizer =\n                            modalizerAPI.createModalizer(\n                                element,\n                                newModalizerProps,\n                                sys\n                            );\n                    }\n                }\n\n                break;\n\n            case \"restorer\":\n                if (tabsterOnElement.restorer) {\n                    tabsterOnElement.restorer.setProps(\n                        newTabsterProps.restorer as Types.RestorerProps\n                    );\n                } else {\n                    if (tabster.restorer) {\n                        if (newTabsterProps.restorer) {\n                            tabsterOnElement.restorer =\n                                tabster.restorer.createRestorer(\n                                    element,\n                                    newTabsterProps.restorer\n                                );\n                        }\n                    } else if (__DEV__) {\n                        console.error(\n                            \"Restorer API used before initialization, please call `getRestorer()`\"\n                        );\n                    }\n                }\n\n                break;\n\n            case \"focusable\":\n                tabsterOnElement.focusable = newTabsterProps.focusable;\n                break;\n\n            case \"groupper\":\n                if (tabsterOnElement.groupper) {\n                    tabsterOnElement.groupper.setProps(\n                        newTabsterProps.groupper as Types.GroupperProps\n                    );\n                } else {\n                    if (tabster.groupper) {\n                        tabsterOnElement.groupper =\n                            tabster.groupper.createGroupper(\n                                element,\n                                newTabsterProps.groupper as Types.GroupperProps,\n                                sys\n                            );\n                    } else if (__DEV__) {\n                        console.error(\n                            \"Groupper API used before initialization, please call `getGroupper()`\"\n                        );\n                    }\n                }\n                break;\n\n            case \"mover\":\n                if (tabsterOnElement.mover) {\n                    tabsterOnElement.mover.setProps(\n                        newTabsterProps.mover as Types.MoverProps\n                    );\n                } else {\n                    if (tabster.mover) {\n                        tabsterOnElement.mover = tabster.mover.createMover(\n                            element,\n                            newTabsterProps.mover as Types.MoverProps,\n                            sys\n                        );\n                    } else if (__DEV__) {\n                        console.error(\n                            \"Mover API used before initialization, please call `getMover()`\"\n                        );\n                    }\n                }\n                break;\n\n            case \"observed\":\n                if (tabster.observedElement) {\n                    tabsterOnElement.observed = newTabsterProps.observed;\n                    tabster.observedElement.onObservedElementUpdate(element);\n                } else if (__DEV__) {\n                    console.error(\n                        \"ObservedElement API used before initialization, please call `getObservedElement()`\"\n                    );\n                }\n                break;\n\n            case \"uncontrolled\":\n                tabsterOnElement.uncontrolled = newTabsterProps.uncontrolled;\n                break;\n\n            case \"outline\":\n                if (tabster.outline) {\n                    tabsterOnElement.outline = newTabsterProps.outline;\n                } else if (__DEV__) {\n                    console.error(\n                        \"Outline API used before initialization, please call `getOutline()`\"\n                    );\n                }\n                break;\n\n            case \"sys\":\n                tabsterOnElement.sys = newTabsterProps.sys;\n                break;\n\n            default:\n                console.error(\n                    `Unknown key '${key}' in data-tabster attribute value.`\n                );\n        }\n    }\n\n    if (newAttr) {\n        entry.attr = newAttr;\n    } else {\n        if (Object.keys(tabsterOnElement).length === 0) {\n            delete entry.tabster;\n            delete entry.attr;\n        }\n        tabster.storageEntry(element, false);\n    }\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport * as Types from \"./Types\";\nimport * as EventsTypes from \"./EventsTypes\";\n\n/**\n * Events sent by Tabster.\n */\n\nexport const TabsterFocusInEventName = \"tabster:focusin\";\nexport const TabsterFocusOutEventName = \"tabster:focusout\";\n\n// Event is dispatched when Tabster wants to move focus as the result of\n// handling keyboard event. This allows to preventDefault() if you want to have\n// some custom logic.\nexport const TabsterMoveFocusEventName = \"tabster:movefocus\";\n\n/**\n * Events sent by Deloser.\n */\n\nexport const DeloserFocusLostEventName = \"tabster:deloser:focus-lost\";\n\n/**\n * Events to be sent to Deloser by the application.\n */\n\nexport const DeloserRestoreFocusEventName = \"tabster:deloser:restore-focus\";\n\n/**\n * Events sent by Modalizer.\n */\nexport const ModalizerActiveEventName = \"tabster:modalizer:active\";\nexport const ModalizerInactiveEventName = \"tabster:modalizer:inactive\";\nexport const ModalizerFocusInEventName = \"tabster:modalizer:focusin\";\nexport const ModalizerFocusOutEventName = \"tabster:modalizer:focusout\";\n\n/**\n * Events sent by Mover.\n */\nexport const MoverStateEventName = \"tabster:mover:state\";\n\n/**\n * Events to be sent to Mover by the application.\n */\n\n// Event that can be dispatched by the application to programmatically move\n// focus inside Mover.\nexport const MoverMoveFocusEventName = \"tabster:mover:movefocus\";\n// Event that can be dispatched by the application to forget or modify\n// memorized element in Mover with memorizeCurrent property.\nexport const MoverMemorizedElementEventName = \"tabster:mover:memorized-element\";\n\n/**\n * Events sent by Groupper.\n */\n\n/**\n * Events to be sent to Groupper by the application.\n */\n\n// Event that can be dispatched by the application to programmatically enter\n// or escape Groupper.\nexport const GroupperMoveFocusEventName = \"tabster:groupper:movefocus\";\n\n/**\n * Events sent by Restorer.\n */\n\nexport const RestorerRestoreFocusEventName = \"tabster:restorer:restore-focus\";\n\n/**\n * Events sent by Root.\n */\nexport const RootFocusEventName = \"tabster:root:focus\";\nexport const RootBlurEventName = \"tabster:root:blur\";\n\n// Node.js environments do not have CustomEvent and it is needed for the events to be\n// evaluated. It doesn't matter if it works or not in Node.js environment.\n// So, we just need to make sure that it doesn't throw undefined reference.\nconst CustomEvent_ =\n    typeof CustomEvent !== \"undefined\"\n        ? CustomEvent\n        : (function () {\n              /* no-op */\n          } as typeof CustomEvent);\n\nexport abstract class TabsterCustomEvent<D> extends CustomEvent_<D> {\n    /**\n     * @deprecated use `detail`.\n     */\n    details?: D;\n\n    constructor(type: string, detail?: D) {\n        super(type, {\n            bubbles: true,\n            cancelable: true,\n            composed: true,\n            detail,\n        });\n\n        this.details = detail;\n    }\n}\n\nexport class TabsterFocusInEvent extends TabsterCustomEvent<Types.FocusedElementDetail> {\n    constructor(detail: Types.FocusedElementDetail) {\n        super(TabsterFocusInEventName, detail);\n    }\n}\n\nexport class TabsterFocusOutEvent extends TabsterCustomEvent<Types.FocusedElementDetail> {\n    constructor(detail: Types.FocusedElementDetail) {\n        super(TabsterFocusOutEventName, detail);\n    }\n}\n\nexport class TabsterMoveFocusEvent extends TabsterCustomEvent<EventsTypes.TabsterMoveFocusEventDetail> {\n    constructor(detail: EventsTypes.TabsterMoveFocusEventDetail) {\n        super(TabsterMoveFocusEventName, detail);\n    }\n}\n\nexport class MoverStateEvent extends TabsterCustomEvent<Types.MoverElementState> {\n    constructor(detail: Types.MoverElementState) {\n        super(MoverStateEventName, detail);\n    }\n}\n\nexport class MoverMoveFocusEvent extends TabsterCustomEvent<EventsTypes.MoverMoveFocusEventDetail> {\n    constructor(detail: EventsTypes.MoverMoveFocusEventDetail) {\n        super(MoverMoveFocusEventName, detail);\n    }\n}\n\nexport class MoverMemorizedElementEvent extends TabsterCustomEvent<EventsTypes.MoverMemorizedElementEventDetail> {\n    constructor(detail: EventsTypes.MoverMemorizedElementEventDetail) {\n        super(MoverMemorizedElementEventName, detail);\n    }\n}\n\nexport class GroupperMoveFocusEvent extends TabsterCustomEvent<EventsTypes.GroupperMoveFocusEventDetail> {\n    constructor(detail: EventsTypes.GroupperMoveFocusEventDetail) {\n        super(GroupperMoveFocusEventName, detail);\n    }\n}\n\nexport class ModalizerActiveEvent extends TabsterCustomEvent<EventsTypes.ModalizerEventDetail> {\n    constructor(detail: EventsTypes.ModalizerEventDetail) {\n        super(ModalizerActiveEventName, detail);\n    }\n}\n\nexport class ModalizerInactiveEvent extends TabsterCustomEvent<EventsTypes.ModalizerEventDetail> {\n    constructor(detail: EventsTypes.ModalizerEventDetail) {\n        super(ModalizerInactiveEventName, detail);\n    }\n}\n\nexport class DeloserFocusLostEvent extends TabsterCustomEvent<Types.DeloserElementActions> {\n    constructor(detail: Types.DeloserElementActions) {\n        super(DeloserFocusLostEventName, detail);\n    }\n}\n\nexport class DeloserRestoreFocusEvent extends TabsterCustomEvent<undefined> {\n    constructor() {\n        super(DeloserRestoreFocusEventName);\n    }\n}\n\nexport class RestorerRestoreFocusEvent extends TabsterCustomEvent<undefined> {\n    constructor() {\n        super(RestorerRestoreFocusEventName);\n    }\n}\n\nexport class RootFocusEvent extends TabsterCustomEvent<EventsTypes.RootFocusEventDetail> {\n    constructor(detail: EventsTypes.RootFocusEventDetail) {\n        super(RootFocusEventName, detail);\n    }\n}\n\nexport class RootBlurEvent extends TabsterCustomEvent<EventsTypes.RootFocusEventDetail> {\n    constructor(detail: EventsTypes.RootFocusEventDetail) {\n        super(RootBlurEventName, detail);\n    }\n}\n\n// addEventListener() typings augmentation.\ndeclare global {\n    interface GlobalEventHandlersEventMap {\n        [TabsterFocusInEventName]: TabsterFocusInEvent;\n        [TabsterFocusOutEventName]: TabsterFocusOutEvent;\n        [TabsterMoveFocusEventName]: TabsterMoveFocusEvent;\n\n        [MoverStateEventName]: MoverStateEvent;\n        [MoverMoveFocusEventName]: MoverMoveFocusEvent;\n        [MoverMemorizedElementEventName]: MoverMemorizedElementEvent;\n\n        [GroupperMoveFocusEventName]: GroupperMoveFocusEvent;\n\n        [ModalizerActiveEventName]: ModalizerActiveEvent;\n        [ModalizerInactiveEventName]: ModalizerInactiveEvent;\n\n        [DeloserFocusLostEventName]: DeloserFocusLostEvent;\n        [DeloserRestoreFocusEventName]: DeloserRestoreFocusEvent;\n\n        [RestorerRestoreFocusEventName]: RestorerRestoreFocusEvent;\n\n        [RootFocusEventName]: RootFocusEvent;\n        [RootBlurEventName]: RootBlurEvent;\n    }\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { DOMAPI } from \"./Types\";\n\nconst _createMutationObserver = (callback: MutationCallback) =>\n    new MutationObserver(callback);\nconst _createTreeWalker = (\n    doc: Document,\n    root: Node,\n    whatToShow?: number,\n    filter?: NodeFilter | null\n) => doc.createTreeWalker(root, whatToShow, filter);\nconst _getParentNode = (node: Node | null | undefined) =>\n    node ? node.parentNode : null;\nconst _getParentElement = (element: HTMLElement) =>\n    element ? element.parentElement : null;\nconst _nodeContains = (\n    parent: Node | null | undefined,\n    child: Node | null | undefined\n) => !!(child && parent?.contains(child));\nconst _getActiveElement = (doc: Document) => doc.activeElement;\nconst _querySelector = (element: Element, selector: string) =>\n    element.querySelector(selector);\nconst _querySelectorAll = (element: ParentNode, selector: string) =>\n    Array.prototype.slice.call(element.querySelectorAll(selector), 0);\nconst _getElementById = (doc: Document, id: string): HTMLElement | null =>\n    doc.getElementById(id);\nconst _getFirstChild = (node: Node | null | undefined): ChildNode | null =>\n    node?.firstChild || null;\nconst _getLastChild = (node: Node | null | undefined): ChildNode | null =>\n    node?.lastChild || null;\nconst _getNextSibling = (node: Node | null | undefined): ChildNode | null =>\n    node?.nextSibling || null;\nconst _getPreviousSibling = (node: Node | null | undefined): ChildNode | null =>\n    node?.previousSibling || null;\nconst _getFirstElementChild = (\n    element: Element | null | undefined\n): Element | null => element?.firstElementChild || null;\nconst _getLastElementChild = (\n    element: Element | null | undefined\n): Element | null => element?.lastElementChild || null;\nconst _getNextElementSibling = (\n    element: Element | null | undefined\n): Element | null => element?.nextElementSibling || null;\nconst _getPreviousElementSibling = (\n    element: Element | null | undefined\n): Element | null => element?.previousElementSibling || null;\nconst _appendChild = (parent: Node, child: Node): Node =>\n    parent.appendChild(child);\nconst _insertBefore = (\n    parent: Node,\n    child: Node,\n    referenceChild: Node | null\n): Node => parent.insertBefore(child, referenceChild);\nconst _getSelection = (ref: Node): Selection | null =>\n    ref.ownerDocument?.getSelection() || null;\nconst _getElementsByName = (referenceElement: HTMLElement, name: string) =>\n    referenceElement.ownerDocument.getElementsByName(name);\n\nexport const dom: DOMAPI = {\n    createMutationObserver: _createMutationObserver,\n    createTreeWalker: _createTreeWalker,\n    getParentNode: _getParentNode,\n    getParentElement: _getParentElement,\n    nodeContains: _nodeContains,\n    getActiveElement: _getActiveElement,\n    querySelector: _querySelector,\n    querySelectorAll: _querySelectorAll,\n    getElementById: _getElementById,\n    getFirstChild: _getFirstChild,\n    getLastChild: _getLastChild,\n    getNextSibling: _getNextSibling,\n    getPreviousSibling: _getPreviousSibling,\n    getFirstElementChild: _getFirstElementChild,\n    getLastElementChild: _getLastElementChild,\n    getNextElementSibling: _getNextElementSibling,\n    getPreviousElementSibling: _getPreviousElementSibling,\n    appendChild: _appendChild,\n    insertBefore: _insertBefore,\n    getSelection: _getSelection,\n    getElementsByName: _getElementsByName,\n};\n\nexport function setDOMAPI(domapi: Partial<DOMAPI>) {\n    for (const key of Object.keys(domapi) as (keyof DOMAPI)[]) {\n        (dom[key] as (typeof domapi)[typeof key]) = domapi[key];\n    }\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { nativeFocus } from \"keyborg\";\n\nimport {\n    DummyInputObserver as DummyInputObserverInterface,\n    GetWindow,\n    RadioButtonGroup,\n    SysProps,\n    TabsterAttributeProps,\n    TabsterCore,\n    TabsterPart as TabsterPartInterface,\n    Visibility,\n    WeakHTMLElement as WeakHTMLElementInterface,\n} from \"./Types\";\nimport {\n    FOCUSABLE_SELECTOR,\n    SysDummyInputsPositions,\n    TABSTER_ATTRIBUTE_NAME,\n    TABSTER_DUMMY_INPUT_ATTRIBUTE_NAME,\n    Visibilities,\n} from \"./Consts\";\nimport { TabsterMoveFocusEvent } from \"./Events\";\nimport { dom } from \"./DOMAPI\";\n\ninterface HTMLElementWithBoundingRectCacheId extends HTMLElement {\n    __tabsterCacheId?: string;\n}\n\ninterface FocusedElementWithIgnoreFlag extends HTMLElement {\n    __shouldIgnoreFocus: boolean;\n}\n\nexport interface WindowWithUID extends Window {\n    __tabsterCrossOriginWindowUID?: string;\n}\n\nexport interface HTMLElementWithUID extends HTMLElement {\n    __tabsterElementUID?: string;\n}\n\ninterface HTMLElementWithDummyContainer extends HTMLElement {\n    __tabsterDummyContainer?: WeakHTMLElement;\n}\n\nexport interface TabsterDOMRect {\n    bottom: number;\n    left: number;\n    right: number;\n    top: number;\n}\n\nexport interface InstanceContext {\n    elementByUId: { [uid: string]: WeakHTMLElement<HTMLElementWithUID> };\n    basics: InternalBasics;\n    WeakRef?: WeakRefConstructor;\n    containerBoundingRectCache: {\n        [id: string]: {\n            rect: TabsterDOMRect;\n            element: HTMLElementWithBoundingRectCacheId;\n        };\n    };\n    lastContainerBoundingRectCacheId: number;\n    containerBoundingRectCacheTimer?: number;\n    fakeWeakRefs: TabsterWeakRef<unknown>[];\n    fakeWeakRefsTimer?: number;\n    fakeWeakRefsStarted: boolean;\n}\n\nlet _isBrokenIE11: boolean;\n\nconst _DOMRect =\n    typeof DOMRect !== \"undefined\"\n        ? DOMRect\n        : class {\n              readonly bottom: number;\n              readonly left: number;\n              readonly right: number;\n              readonly top: number;\n\n              constructor(\n                  x?: number,\n                  y?: number,\n                  width?: number,\n                  height?: number\n              ) {\n                  this.left = x || 0;\n                  this.top = y || 0;\n                  this.right = (x || 0) + (width || 0);\n                  this.bottom = (y || 0) + (height || 0);\n              }\n          };\n\nlet _uidCounter = 0;\n\ntry {\n    // IE11 only accepts `filter` argument as a function (not object with the `acceptNode`\n    // property as the docs define). Also `entityReferenceExpansion` argument is not\n    // optional. And it throws exception when the above arguments aren't there.\n    document.createTreeWalker(document, NodeFilter.SHOW_ELEMENT);\n    _isBrokenIE11 = false;\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n} catch (e) {\n    _isBrokenIE11 = true;\n}\n\nconst _updateDummyInputsTimeout = 100;\n\ninterface WindowWithUtilsConext extends Window {\n    __tabsterInstanceContext?: InstanceContext;\n    Promise: PromiseConstructor;\n    WeakRef: WeakRefConstructor;\n}\n\nexport function getInstanceContext(getWindow: GetWindow): InstanceContext {\n    const win = getWindow() as WindowWithUtilsConext;\n\n    let ctx = win.__tabsterInstanceContext;\n\n    if (!ctx) {\n        ctx = {\n            elementByUId: {},\n            basics: {\n                Promise: win.Promise || undefined,\n                WeakRef: win.WeakRef || undefined,\n            },\n            containerBoundingRectCache: {},\n            lastContainerBoundingRectCacheId: 0,\n            fakeWeakRefs: [],\n            fakeWeakRefsStarted: false,\n        };\n\n        win.__tabsterInstanceContext = ctx;\n    }\n\n    return ctx;\n}\n\nexport function disposeInstanceContext(win: Window): void {\n    const ctx = (win as WindowWithUtilsConext).__tabsterInstanceContext;\n\n    if (ctx) {\n        ctx.elementByUId = {};\n\n        delete ctx.WeakRef;\n\n        ctx.containerBoundingRectCache = {};\n\n        if (ctx.containerBoundingRectCacheTimer) {\n            win.clearTimeout(ctx.containerBoundingRectCacheTimer);\n        }\n\n        if (ctx.fakeWeakRefsTimer) {\n            win.clearTimeout(ctx.fakeWeakRefsTimer);\n        }\n\n        ctx.fakeWeakRefs = [];\n\n        delete (win as WindowWithUtilsConext).__tabsterInstanceContext;\n    }\n}\n\nexport function createWeakMap<K extends object, V>(win: Window): WeakMap<K, V> {\n    const ctx = (win as WindowWithUtilsConext).__tabsterInstanceContext;\n    return new (ctx?.basics.WeakMap || WeakMap)();\n}\n\nexport function hasSubFocusable(element: HTMLElement): boolean {\n    return !!element.querySelector(FOCUSABLE_SELECTOR);\n}\n\ninterface TabsterWeakRef<T> {\n    deref(): T | undefined;\n}\n\nclass FakeWeakRef<\n    T extends HTMLElement = HTMLElement,\n> implements TabsterWeakRef<T> {\n    private _target: T | undefined;\n\n    constructor(target: T) {\n        this._target = target;\n    }\n\n    deref(): T | undefined {\n        return this._target;\n    }\n\n    static cleanup(fwr: FakeWeakRef, forceRemove?: boolean): boolean {\n        if (!fwr._target) {\n            return true;\n        }\n\n        if (\n            forceRemove ||\n            !documentContains(fwr._target.ownerDocument, fwr._target)\n        ) {\n            delete fwr._target;\n            return true;\n        }\n\n        return false;\n    }\n}\n\nexport class WeakHTMLElement<\n    T extends HTMLElement = HTMLElement,\n    D = undefined,\n> implements WeakHTMLElementInterface<D> {\n    private _ref: TabsterWeakRef<T> | undefined;\n    private _data: D | undefined;\n\n    constructor(getWindow: GetWindow, element: T, data?: D) {\n        const context = getInstanceContext(getWindow);\n\n        let ref: TabsterWeakRef<T>;\n        if (context.WeakRef) {\n            ref = new context.WeakRef(element);\n        } else {\n            ref = new FakeWeakRef(element);\n            context.fakeWeakRefs.push(ref);\n        }\n\n        this._ref = ref;\n        this._data = data;\n    }\n\n    get(): T | undefined {\n        const ref = this._ref;\n        let element: T | undefined;\n\n        if (ref) {\n            element = ref.deref();\n\n            if (!element) {\n                delete this._ref;\n            }\n        }\n\n        return element;\n    }\n\n    getData(): D | undefined {\n        return this._data;\n    }\n}\n\nexport function cleanupFakeWeakRefs(\n    getWindow: GetWindow,\n    forceRemove?: boolean\n): void {\n    const context = getInstanceContext(getWindow);\n    context.fakeWeakRefs = context.fakeWeakRefs.filter(\n        (e) => !FakeWeakRef.cleanup(e as FakeWeakRef, forceRemove)\n    );\n}\n\nexport function startFakeWeakRefsCleanup(getWindow: GetWindow): void {\n    const context = getInstanceContext(getWindow);\n\n    if (!context.fakeWeakRefsStarted) {\n        context.fakeWeakRefsStarted = true;\n        context.WeakRef = getWeakRef(context);\n    }\n\n    if (!context.fakeWeakRefsTimer) {\n        context.fakeWeakRefsTimer = getWindow().setTimeout(\n            () => {\n                context.fakeWeakRefsTimer = undefined;\n                cleanupFakeWeakRefs(getWindow);\n                startFakeWeakRefsCleanup(getWindow);\n            },\n            2 * 60 * 1000\n        ); // 2 minutes.\n    }\n}\n\nexport function stopFakeWeakRefsCleanupAndClearStorage(\n    getWindow: GetWindow\n): void {\n    const context = getInstanceContext(getWindow);\n\n    context.fakeWeakRefsStarted = false;\n\n    if (context.fakeWeakRefsTimer) {\n        getWindow().clearTimeout(context.fakeWeakRefsTimer);\n        context.fakeWeakRefsTimer = undefined;\n        context.fakeWeakRefs = [];\n    }\n}\n\nexport function createElementTreeWalker(\n    doc: Document,\n    root: Node,\n    acceptNode: (node: Node) => number\n): TreeWalker | undefined {\n    // IE11 will throw an exception when the TreeWalker root is not an Element.\n    if (root.nodeType !== Node.ELEMENT_NODE) {\n        return undefined;\n    }\n\n    // TypeScript isn't aware of IE11 behaving badly.\n    const filter = (_isBrokenIE11\n        ? acceptNode\n        : ({ acceptNode } as NodeFilter)) as unknown as NodeFilter;\n\n    return dom.createTreeWalker(\n        doc,\n        root,\n        NodeFilter.SHOW_ELEMENT,\n        filter,\n        // @ts-ignore: We still don't want to completely break IE11, so, entityReferenceExpansion argument is not optional.\n        false /* Last argument is not optional for IE11! */\n    );\n}\n\nexport function getBoundingRect(\n    getWindow: GetWindow,\n    element: HTMLElementWithBoundingRectCacheId\n): TabsterDOMRect {\n    let cacheId = element.__tabsterCacheId;\n    const context = getInstanceContext(getWindow);\n    const cached = cacheId\n        ? context.containerBoundingRectCache[cacheId]\n        : undefined;\n\n    if (cached) {\n        return cached.rect;\n    }\n\n    const scrollingElement =\n        element.ownerDocument && element.ownerDocument.documentElement;\n\n    if (!scrollingElement) {\n        return new _DOMRect();\n    }\n\n    // A bounding rect of the top-level element contains the whole page regardless of the\n    // scrollbar. So, we improvise a little and limiting the final result...\n    let left = 0;\n    let top = 0;\n    let right = scrollingElement.clientWidth;\n    let bottom = scrollingElement.clientHeight;\n\n    if (element !== scrollingElement) {\n        const r = element.getBoundingClientRect();\n        left = Math.max(left, r.left);\n        top = Math.max(top, r.top);\n        right = Math.min(right, r.right);\n        bottom = Math.min(bottom, r.bottom);\n    }\n\n    const rect = new _DOMRect(\n        left < right ? left : -1,\n        top < bottom ? top : -1,\n        left < right ? right - left : 0,\n        top < bottom ? bottom - top : 0\n    );\n\n    if (!cacheId) {\n        cacheId = \"r-\" + ++context.lastContainerBoundingRectCacheId;\n        element.__tabsterCacheId = cacheId;\n    }\n\n    context.containerBoundingRectCache[cacheId] = {\n        rect,\n        element,\n    };\n\n    if (!context.containerBoundingRectCacheTimer) {\n        context.containerBoundingRectCacheTimer = window.setTimeout(() => {\n            context.containerBoundingRectCacheTimer = undefined;\n\n            for (const cId of Object.keys(context.containerBoundingRectCache)) {\n                delete context.containerBoundingRectCache[cId].element\n                    .__tabsterCacheId;\n            }\n\n            context.containerBoundingRectCache = {};\n        }, 50);\n    }\n\n    return rect;\n}\n\nexport function isElementVerticallyVisibleInContainer(\n    getWindow: GetWindow,\n    element: HTMLElement,\n    tolerance: number\n): boolean {\n    const container = getScrollableContainer(element);\n    if (!container) {\n        return false;\n    }\n\n    const containerRect = getBoundingRect(getWindow, container);\n    const elementRect = element.getBoundingClientRect();\n    const intersectionTolerance = elementRect.height * (1 - tolerance);\n    const topIntersection = Math.max(0, containerRect.top - elementRect.top);\n    const bottomIntersection = Math.max(\n        0,\n        elementRect.bottom - containerRect.bottom\n    );\n    const totalIntersection = topIntersection + bottomIntersection;\n\n    return (\n        totalIntersection === 0 || totalIntersection <= intersectionTolerance\n    );\n}\n\nexport function isElementVisibleInContainer(\n    getWindow: GetWindow,\n    element: HTMLElement,\n    gap = 0\n): Visibility {\n    const container = getScrollableContainer(element);\n\n    if (container) {\n        const containerRect = getBoundingRect(getWindow, container);\n        const elementRect = element.getBoundingClientRect();\n\n        if (\n            elementRect.left > containerRect.right ||\n            elementRect.top > containerRect.bottom ||\n            elementRect.bottom < containerRect.top ||\n            elementRect.right < containerRect.left\n        ) {\n            return Visibilities.Invisible;\n        }\n\n        if (\n            elementRect.top + gap >= containerRect.top &&\n            elementRect.top <= containerRect.bottom &&\n            elementRect.bottom >= containerRect.top &&\n            elementRect.bottom - gap <= containerRect.bottom &&\n            elementRect.left + gap >= containerRect.left &&\n            elementRect.left <= containerRect.right &&\n            elementRect.right >= containerRect.left &&\n            elementRect.right - gap <= containerRect.right\n        ) {\n            return Visibilities.Visible;\n        }\n\n        return Visibilities.PartiallyVisible;\n    }\n\n    return Visibilities.Invisible;\n}\n\nexport function scrollIntoView(\n    getWindow: GetWindow,\n    element: HTMLElement,\n    alignToTop: boolean\n): void {\n    // Built-in DOM's scrollIntoView() is cool, but when we have nested containers,\n    // it scrolls all of them, not just the deepest one. So, trying to work it around.\n    const container = getScrollableContainer(element);\n\n    if (container) {\n        const containerRect = getBoundingRect(getWindow, container);\n        const elementRect = element.getBoundingClientRect();\n\n        if (alignToTop) {\n            container.scrollTop += elementRect.top - containerRect.top;\n        } else {\n            container.scrollTop += elementRect.bottom - containerRect.bottom;\n        }\n    }\n}\n\nexport function getScrollableContainer(\n    element: HTMLElement\n): HTMLElement | null {\n    const doc = element.ownerDocument;\n\n    if (doc) {\n        for (\n            let el: HTMLElement | null = dom.getParentElement(element);\n            el;\n            el = dom.getParentElement(el)\n        ) {\n            if (\n                el.scrollWidth > el.clientWidth ||\n                el.scrollHeight > el.clientHeight\n            ) {\n                return el;\n            }\n        }\n\n        return doc.documentElement;\n    }\n\n    return null;\n}\n\nexport function makeFocusIgnored(element: HTMLElement): void {\n    (element as FocusedElementWithIgnoreFlag).__shouldIgnoreFocus = true;\n}\n\nexport function shouldIgnoreFocus(element: HTMLElement): boolean {\n    return !!(element as FocusedElementWithIgnoreFlag).__shouldIgnoreFocus;\n}\n\nexport function getUId(wnd: Window & { msCrypto?: Crypto }): string {\n    const rnd = new Uint32Array(4);\n\n    if (wnd.crypto && wnd.crypto.getRandomValues) {\n        wnd.crypto.getRandomValues(rnd);\n    } else if (wnd.msCrypto && wnd.msCrypto.getRandomValues) {\n        wnd.msCrypto.getRandomValues(rnd);\n    } else {\n        for (let i = 0; i < rnd.length; i++) {\n            rnd[i] = 0xffffffff * Math.random();\n        }\n    }\n\n    const srnd: string[] = [];\n\n    for (let i = 0; i < rnd.length; i++) {\n        srnd.push(rnd[i].toString(36));\n    }\n\n    srnd.push(\"|\");\n    srnd.push((++_uidCounter).toString(36));\n    srnd.push(\"|\");\n    srnd.push(Date.now().toString(36));\n\n    return srnd.join(\"\");\n}\n\nexport function getElementUId(\n    getWindow: GetWindow,\n    element: HTMLElementWithUID\n): string {\n    const context = getInstanceContext(getWindow);\n    let uid = element.__tabsterElementUID;\n\n    if (!uid) {\n        uid = element.__tabsterElementUID = getUId(getWindow());\n    }\n\n    if (\n        !context.elementByUId[uid] &&\n        documentContains(element.ownerDocument, element)\n    ) {\n        context.elementByUId[uid] = new WeakHTMLElement(getWindow, element);\n    }\n\n    return uid;\n}\n\nexport function getElementByUId(\n    context: InstanceContext,\n    uid: string\n): WeakHTMLElement<HTMLElementWithUID, undefined> | undefined {\n    return context.elementByUId[uid];\n}\n\nexport function getWindowUId(win: WindowWithUID): string {\n    let uid = win.__tabsterCrossOriginWindowUID;\n\n    if (!uid) {\n        uid = win.__tabsterCrossOriginWindowUID = getUId(win);\n    }\n\n    return uid;\n}\n\nexport function clearElementCache(\n    getWindow: GetWindow,\n    parent?: HTMLElement\n): void {\n    const context = getInstanceContext(getWindow);\n\n    for (const key of Object.keys(context.elementByUId)) {\n        const wel = context.elementByUId[key];\n        const el = wel && wel.get();\n\n        if (el && parent) {\n            if (!dom.nodeContains(parent, el)) {\n                continue;\n            }\n        }\n\n        delete context.elementByUId[key];\n    }\n}\n\n// IE11 doesn't have document.contains()...\nexport function documentContains(\n    doc: HTMLDocument | null | undefined,\n    element: HTMLElement\n): boolean {\n    return dom.nodeContains(doc?.body, element);\n}\n\nexport function matchesSelector(\n    element: HTMLElement,\n    selector: string\n): boolean {\n    interface HTMLElementWithMatches extends HTMLElement {\n        matchesSelector?: typeof HTMLElement.prototype.matches;\n        msMatchesSelector?: typeof HTMLElement.prototype.matches;\n    }\n\n    const matches =\n        element.matches ||\n        (element as HTMLElementWithMatches).matchesSelector ||\n        (element as HTMLElementWithMatches).msMatchesSelector ||\n        element.webkitMatchesSelector;\n\n    return matches && matches.call(element, selector);\n}\n\nexport function getPromise(getWindow: GetWindow): PromiseConstructor {\n    const context = getInstanceContext(getWindow);\n    if (context.basics.Promise) {\n        return context.basics.Promise;\n    }\n\n    throw new Error(\"No Promise defined.\");\n}\n\nexport function getWeakRef(\n    context: InstanceContext\n): WeakRefConstructor | undefined {\n    return context.basics.WeakRef;\n}\n\ninterface InternalBasics {\n    Promise?: PromiseConstructor;\n    WeakRef?: WeakRefConstructor;\n    WeakMap?: WeakMapConstructor;\n}\n\nexport function setBasics(win: Window, basics: InternalBasics): void {\n    const context = getInstanceContext(() => win);\n\n    let key: keyof InternalBasics;\n\n    key = \"Promise\";\n    if (key in basics) {\n        context.basics[key] = basics[key];\n    }\n\n    key = \"WeakRef\";\n    if (key in basics) {\n        context.basics[key] = basics[key];\n    }\n\n    key = \"WeakMap\";\n    if (key in basics) {\n        context.basics[key] = basics[key];\n    }\n}\n\nlet _lastTabsterPartId = 0;\n\nexport abstract class TabsterPart<\n    P,\n    D = undefined,\n> implements TabsterPartInterface<P> {\n    protected _tabster: TabsterCore;\n    protected _element: WeakHTMLElement<HTMLElement, D>;\n    protected _props: P;\n\n    readonly id: string;\n\n    constructor(tabster: TabsterCore, element: HTMLElement, props: P) {\n        const getWindow = tabster.getWindow;\n        this._tabster = tabster;\n        this._element = new WeakHTMLElement(getWindow, element);\n        this._props = { ...props };\n        this.id = \"i\" + ++_lastTabsterPartId;\n    }\n\n    getElement(): HTMLElement | undefined {\n        return this._element.get();\n    }\n\n    getProps(): P {\n        return this._props;\n    }\n\n    setProps(props: P): void {\n        this._props = { ...props };\n    }\n}\n\nexport interface DummyInputProps {\n    /** The input is created to be used only once and autoremoved when focused. */\n    isPhantom?: boolean;\n    /** Whether the input is before or after the content it is guarding.  */\n    isFirst: boolean;\n}\n\nexport type DummyInputFocusCallback = (\n    dummyInput: DummyInput,\n    isBackward: boolean,\n    relatedTarget: HTMLElement | null\n) => void;\n\n/**\n * Dummy HTML elements that are used as focus sentinels for the DOM enclosed within them\n */\nexport class DummyInput {\n    private _isPhantom: DummyInputProps[\"isPhantom\"];\n    private _fixedTarget?: WeakHTMLElement;\n    private _disposeTimer: number | undefined;\n    private _clearDisposeTimeout: (() => void) | undefined;\n\n    input: HTMLElement | undefined;\n    useDefaultAction?: boolean;\n    isFirst: DummyInputProps[\"isFirst\"];\n    isOutside: boolean;\n    /** Called when the input is focused */\n    onFocusIn?: DummyInputFocusCallback;\n    /** Called when the input is blurred */\n    onFocusOut?: DummyInputFocusCallback;\n\n    constructor(\n        getWindow: GetWindow,\n        isOutside: boolean,\n        props: DummyInputProps,\n        element?: WeakHTMLElement,\n        fixedTarget?: WeakHTMLElement\n    ) {\n        const win = getWindow();\n        const input = win.document.createElement(\"i\");\n\n        input.tabIndex = 0;\n        input.setAttribute(\"role\", \"none\");\n\n        input.setAttribute(TABSTER_DUMMY_INPUT_ATTRIBUTE_NAME, \"\");\n        input.setAttribute(\"aria-hidden\", \"true\");\n\n        const style = input.style;\n        style.position = \"fixed\";\n        style.width = style.height = \"1px\";\n        style.opacity = \"0.001\";\n        style.zIndex = \"-1\";\n        style.setProperty(\"content-visibility\", \"hidden\");\n\n        makeFocusIgnored(input);\n\n        this.input = input;\n        this.isFirst = props.isFirst;\n        this.isOutside = isOutside;\n        this._isPhantom = props.isPhantom ?? false;\n        this._fixedTarget = fixedTarget;\n\n        input.addEventListener(\"focusin\", this._focusIn);\n        input.addEventListener(\"focusout\", this._focusOut);\n\n        (input as HTMLElementWithDummyContainer).__tabsterDummyContainer =\n            element;\n\n        if (this._isPhantom) {\n            this._disposeTimer = win.setTimeout(() => {\n                delete this._disposeTimer;\n                this.dispose();\n            }, 0);\n\n            this._clearDisposeTimeout = () => {\n                if (this._disposeTimer) {\n                    win.clearTimeout(this._disposeTimer);\n                    delete this._disposeTimer;\n                }\n\n                delete this._clearDisposeTimeout;\n            };\n        }\n    }\n\n    dispose(): void {\n        if (this._clearDisposeTimeout) {\n            this._clearDisposeTimeout();\n        }\n\n        const input = this.input;\n\n        if (!input) {\n            return;\n        }\n\n        delete this._fixedTarget;\n        delete this.onFocusIn;\n        delete this.onFocusOut;\n        delete this.input;\n\n        input.removeEventListener(\"focusin\", this._focusIn);\n        input.removeEventListener(\"focusout\", this._focusOut);\n\n        delete (input as HTMLElementWithDummyContainer).__tabsterDummyContainer;\n\n        dom.getParentNode(input)?.removeChild(input);\n    }\n\n    setTopLeft(top: number, left: number): void {\n        const style = this.input?.style;\n\n        if (style) {\n            style.top = `${top}px`;\n            style.left = `${left}px`;\n        }\n    }\n\n    private _isBackward(\n        isIn: boolean,\n        current: HTMLElement,\n        previous: HTMLElement | null\n    ): boolean {\n        return isIn && !previous\n            ? !this.isFirst\n            : !!(\n                  previous &&\n                  current.compareDocumentPosition(previous) &\n                      Node.DOCUMENT_POSITION_FOLLOWING\n              );\n    }\n\n    private _focusIn = (e: FocusEvent): void => {\n        if (this._fixedTarget) {\n            const target = this._fixedTarget.get();\n\n            if (target) {\n                nativeFocus(target);\n            }\n\n            return;\n        }\n\n        const input = this.input;\n\n        if (this.onFocusIn && input) {\n            const relatedTarget = e.relatedTarget as HTMLElement | null;\n\n            this.onFocusIn(\n                this,\n                this._isBackward(true, input, relatedTarget),\n                relatedTarget\n            );\n        }\n    };\n\n    private _focusOut = (e: FocusEvent): void => {\n        if (this._fixedTarget) {\n            return;\n        }\n\n        this.useDefaultAction = false;\n\n        const input = this.input;\n\n        if (this.onFocusOut && input) {\n            const relatedTarget = e.relatedTarget as HTMLElement | null;\n\n            this.onFocusOut(\n                this,\n                this._isBackward(false, input, relatedTarget),\n                relatedTarget\n            );\n        }\n    };\n}\n\ninterface HTMLElementWithDummyInputs extends HTMLElement {\n    __tabsterDummy?: DummyInputManagerCore;\n}\n\nexport const DummyInputManagerPriorities = {\n    Root: 1,\n    Modalizer: 2,\n    Mover: 3,\n    Groupper: 4,\n} as const;\n\nexport class DummyInputManager {\n    private _instance?: DummyInputManagerCore;\n    private _onFocusIn?: DummyInputFocusCallback;\n    private _onFocusOut?: DummyInputFocusCallback;\n    protected _element: WeakHTMLElement;\n\n    constructor(\n        tabster: TabsterCore,\n        element: WeakHTMLElement,\n        priority: number,\n        sys: SysProps | undefined,\n        outsideByDefault?: boolean,\n        callForDefaultAction?: boolean\n    ) {\n        this._element = element;\n\n        this._instance = new DummyInputManagerCore(\n            tabster,\n            element,\n            this,\n            priority,\n            sys,\n            outsideByDefault,\n            callForDefaultAction\n        );\n    }\n\n    protected _setHandlers(\n        onFocusIn?: DummyInputFocusCallback,\n        onFocusOut?: DummyInputFocusCallback\n    ): void {\n        this._onFocusIn = onFocusIn;\n        this._onFocusOut = onFocusOut;\n    }\n\n    moveOut(backwards: boolean): void {\n        this._instance?.moveOut(backwards);\n    }\n\n    moveOutWithDefaultAction(\n        backwards: boolean,\n        relatedEvent: KeyboardEvent\n    ): void {\n        this._instance?.moveOutWithDefaultAction(backwards, relatedEvent);\n    }\n\n    getHandler(isIn: boolean): DummyInputFocusCallback | undefined {\n        return isIn ? this._onFocusIn : this._onFocusOut;\n    }\n\n    setTabbable(tabbable: boolean) {\n        this._instance?.setTabbable(this, tabbable);\n    }\n\n    dispose(): void {\n        if (this._instance) {\n            this._instance.dispose(this);\n            delete this._instance;\n        }\n\n        delete this._onFocusIn;\n        delete this._onFocusOut;\n    }\n\n    static moveWithPhantomDummy(\n        tabster: TabsterCore,\n        element: HTMLElement, // The target element to move to or out of.\n        moveOutOfElement: boolean, // Whether to move out of the element or into it.\n        isBackward: boolean, // Are we tabbing of shift-tabbing?\n        relatedEvent: KeyboardEvent // The event that triggered the move.\n    ): void {\n        // Phantom dummy is a hack to use browser's default action to move\n        // focus from a specific point in the application to the next/previous\n        // element. Default action is needed because next focusable element\n        // is not always available to focus directly (for example, next focusable\n        // is inside isolated iframe) or for uncontrolled areas we want to make\n        // sure that something that controls it takes care of the focusing.\n        // It works in a way that during the Tab key handling, we create a dummy\n        // input element, place it to the specific place in the DOM and focus it,\n        // then the default action of the Tab press will move focus from our dummy\n        // input. And we remove it from the DOM right after that.\n        const dummy: DummyInput = new DummyInput(tabster.getWindow, true, {\n            isPhantom: true,\n            isFirst: true,\n        });\n\n        const input = dummy.input;\n\n        if (input) {\n            let parent: HTMLElement | null;\n            let insertBefore: HTMLElement | null;\n\n            // Let's say we have a following DOM structure:\n            // <div>\n            //   <button>Button1</button>\n            //   <div id=\"uncontrolled\" data-tabster={uncontrolled: {}}>\n            //     <button>Button2</button>\n            //     <button>Button3</button>\n            //   </div>\n            //   <button>Button4</button>\n            // </div>\n            //\n            // We pass the \"uncontrolled\" div as the element to move to or out of.\n            //\n            // When we pass moveOutOfElement=true and isBackward=false,\n            // the phantom dummy input will be inserted before Button4.\n            //\n            // When we pass moveOutOfElement=true and isBackward=true, there are\n            // two cases. If the uncontrolled element is focusable (has tabindex=0),\n            // the phantom dummy input will be inserted after Button1. If the\n            // uncontrolled element is not focusable, the phantom dummy input will be\n            // inserted before Button2.\n            //\n            // When we pass moveOutOfElement=false and isBackward=false, the\n            // phantom dummy input will be inserted after Button1.\n            //\n            // When we pass moveOutOfElement=false and isBackward=true, the phantom\n            // dummy input will be inserted before Button4.\n            //\n            // And we have a corner case for <body> and we make sure that the inserted\n            // dummy is inserted properly when there are existing permanent dummies.\n\n            if (element.tagName === \"BODY\") {\n                // We cannot insert elements outside of BODY.\n                parent = element;\n                insertBefore =\n                    (moveOutOfElement && isBackward) ||\n                    (!moveOutOfElement && !isBackward)\n                        ? (dom.getFirstElementChild(\n                              element\n                          ) as HTMLElement | null)\n                        : null;\n            } else {\n                if (\n                    moveOutOfElement &&\n                    (!isBackward ||\n                        (isBackward &&\n                            !tabster.focusable.isFocusable(\n                                element,\n                                false,\n                                true,\n                                true\n                            )))\n                ) {\n                    parent = element;\n                    insertBefore = isBackward\n                        ? (element.firstElementChild as HTMLElement | null)\n                        : null;\n                } else {\n                    parent = dom.getParentElement(element);\n                    insertBefore =\n                        (moveOutOfElement && isBackward) ||\n                        (!moveOutOfElement && !isBackward)\n                            ? element\n                            : (dom.getNextElementSibling(\n                                  element\n                              ) as HTMLElement | null);\n                }\n\n                let potentialDummy: HTMLElement | null;\n                let dummyFor: HTMLElement | null;\n\n                do {\n                    // This is a safety pillow for the cases when someone, combines\n                    // groupper with uncontrolled on the same node. Which is technically\n                    // not correct, but moving into the container element via its dummy\n                    // input would produce a correct behaviour in uncontrolled mode.\n                    potentialDummy = (\n                        (moveOutOfElement && isBackward) ||\n                        (!moveOutOfElement && !isBackward)\n                            ? dom.getPreviousElementSibling(insertBefore)\n                            : insertBefore\n                    ) as HTMLElement | null;\n\n                    dummyFor = getDummyInputContainer(potentialDummy);\n\n                    if (dummyFor === element) {\n                        insertBefore =\n                            (moveOutOfElement && isBackward) ||\n                            (!moveOutOfElement && !isBackward)\n                                ? potentialDummy\n                                : (dom.getNextElementSibling(\n                                      potentialDummy\n                                  ) as HTMLElement | null);\n                    } else {\n                        dummyFor = null;\n                    }\n                } while (dummyFor);\n            }\n\n            if (\n                parent?.dispatchEvent(\n                    new TabsterMoveFocusEvent({\n                        by: \"root\",\n                        owner: parent,\n                        next: null,\n                        relatedEvent,\n                    })\n                )\n            ) {\n                dom.insertBefore(parent, input, insertBefore);\n                nativeFocus(input);\n            }\n        }\n    }\n\n    static addPhantomDummyWithTarget(\n        tabster: TabsterCore,\n        sourceElement: HTMLElement,\n        isBackward: boolean,\n        targetElement: HTMLElement\n    ): void {\n        const dummy: DummyInput = new DummyInput(\n            tabster.getWindow,\n            true,\n            {\n                isPhantom: true,\n                isFirst: true,\n            },\n            undefined,\n            new WeakHTMLElement(tabster.getWindow, targetElement)\n        );\n\n        const input = dummy.input;\n\n        if (input) {\n            let dummyParent: HTMLElement | null;\n            let insertBefore: HTMLElement | null;\n\n            if (hasSubFocusable(sourceElement) && !isBackward) {\n                dummyParent = sourceElement;\n                insertBefore = dom.getFirstElementChild(\n                    sourceElement\n                ) as HTMLElement | null;\n            } else {\n                dummyParent = dom.getParentElement(sourceElement);\n                insertBefore = isBackward\n                    ? sourceElement\n                    : (dom.getNextElementSibling(\n                          sourceElement\n                      ) as HTMLElement | null);\n            }\n\n            if (dummyParent) {\n                dom.insertBefore(dummyParent, input, insertBefore);\n            }\n        }\n    }\n}\n\ninterface DummyInputWrapper {\n    manager: DummyInputManager;\n    priority: number;\n    tabbable: boolean;\n}\n\nfunction setDummyInputDebugValue(\n    dummy: DummyInput,\n    wrappers: DummyInputWrapper[]\n): void {\n    const what: Record<number, string> = {\n        1: \"Root\",\n        2: \"Modalizer\",\n        3: \"Mover\",\n        4: \"Groupper\",\n    };\n\n    dummy.input?.setAttribute(\n        TABSTER_DUMMY_INPUT_ATTRIBUTE_NAME,\n        [\n            `isFirst=${dummy.isFirst}`,\n            `isOutside=${dummy.isOutside}`,\n            ...wrappers.map(\n                (w) => `(${what[w.priority]}, tabbable=${w.tabbable})`\n            ),\n        ].join(\", \")\n    );\n}\n\nexport class DummyInputObserver implements DummyInputObserverInterface {\n    private _win?: GetWindow;\n    private _updateQueue: Set<\n        (\n            scrollTopLeftCache: Map<\n                HTMLElement,\n                { scrollTop: number; scrollLeft: number } | null\n            >\n        ) => () => void\n    > = new Set();\n    private _updateTimer?: number;\n    private _lastUpdateQueueTime = 0;\n    private _changedParents: WeakSet<Node> = new WeakSet();\n    private _updateDummyInputsTimer?: number;\n    private _dummyElements: WeakHTMLElement<HTMLElement>[] = [];\n    private _dummyCallbacks: WeakMap<HTMLElement, () => void> = new WeakMap();\n    domChanged?(parent: HTMLElement): void;\n\n    constructor(win: GetWindow) {\n        this._win = win;\n    }\n\n    add(dummy: HTMLElement, callback: () => void): void {\n        if (!this._dummyCallbacks.has(dummy) && this._win) {\n            this._dummyElements.push(new WeakHTMLElement(this._win, dummy));\n            this._dummyCallbacks.set(dummy, callback);\n            this.domChanged = this._domChanged;\n        }\n    }\n\n    remove(dummy: HTMLElement): void {\n        this._dummyElements = this._dummyElements.filter((ref) => {\n            const element = ref.get();\n            return element && element !== dummy;\n        });\n\n        this._dummyCallbacks.delete(dummy);\n\n        if (this._dummyElements.length === 0) {\n            delete this.domChanged;\n        }\n    }\n\n    dispose(): void {\n        const win = this._win?.();\n\n        if (this._updateTimer) {\n            win?.clearTimeout(this._updateTimer);\n            delete this._updateTimer;\n        }\n\n        if (this._updateDummyInputsTimer) {\n            win?.clearTimeout(this._updateDummyInputsTimer);\n            delete this._updateDummyInputsTimer;\n        }\n\n        this._changedParents = new WeakSet();\n        this._dummyCallbacks = new WeakMap();\n        this._dummyElements = [];\n        this._updateQueue.clear();\n\n        delete this.domChanged;\n        delete this._win;\n    }\n\n    private _domChanged = (parent: HTMLElement): void => {\n        if (this._changedParents.has(parent)) {\n            return;\n        }\n\n        this._changedParents.add(parent);\n\n        if (this._updateDummyInputsTimer) {\n            return;\n        }\n\n        this._updateDummyInputsTimer = this._win?.().setTimeout(() => {\n            delete this._updateDummyInputsTimer;\n\n            for (const ref of this._dummyElements) {\n                const dummyElement = ref.get();\n\n                if (dummyElement) {\n                    const callback = this._dummyCallbacks.get(dummyElement);\n\n                    if (callback) {\n                        const dummyParent = dom.getParentNode(dummyElement);\n\n                        if (\n                            !dummyParent ||\n                            this._changedParents.has(dummyParent)\n                        ) {\n                            callback();\n                        }\n                    }\n                }\n            }\n\n            this._changedParents = new WeakSet();\n        }, _updateDummyInputsTimeout);\n    };\n\n    updatePositions(\n        compute: (\n            scrollTopLeftCache: Map<\n                HTMLElement,\n                { scrollTop: number; scrollLeft: number } | null\n            >\n        ) => () => void\n    ): void {\n        if (!this._win) {\n            // As this is a public method, we make sure that it has no effect when\n            // called after dispose().\n            return;\n        }\n\n        this._updateQueue.add(compute);\n\n        this._lastUpdateQueueTime = Date.now();\n\n        this._scheduledUpdatePositions();\n    }\n\n    private _scheduledUpdatePositions(): void {\n        if (this._updateTimer) {\n            return;\n        }\n\n        this._updateTimer = this._win?.().setTimeout(() => {\n            delete this._updateTimer;\n\n            // updatePositions() might be called quite a lot during the scrolling.\n            // So, instead of clearing the timeout and scheduling a new one, we\n            // check if enough time has passed since the last updatePositions() call\n            // and only schedule a new one if not.\n            // At maximum, we will update dummy inputs positions\n            // _updateDummyInputsTimeout * 2 after the last updatePositions() call.\n            if (\n                this._lastUpdateQueueTime + _updateDummyInputsTimeout <=\n                Date.now()\n            ) {\n                // A cache for current bulk of updates to reduce getComputedStyle() calls.\n                const scrollTopLeftCache = new Map<\n                    HTMLElement,\n                    { scrollTop: number; scrollLeft: number } | null\n                >();\n\n                const setTopLeftCallbacks: (() => void)[] = [];\n\n                for (const compute of this._updateQueue) {\n                    setTopLeftCallbacks.push(compute(scrollTopLeftCache));\n                }\n\n                this._updateQueue.clear();\n\n                // We're splitting the computation of offsets and setting them to avoid extra\n                // reflows.\n                for (const setTopLeft of setTopLeftCallbacks) {\n                    setTopLeft();\n                }\n\n                // Explicitly clear to not hold references till the next garbage collection.\n                scrollTopLeftCache.clear();\n            } else {\n                this._scheduledUpdatePositions();\n            }\n        }, _updateDummyInputsTimeout);\n    }\n}\n\n/**\n * Parent class that encapsulates the behaviour of dummy inputs (focus sentinels)\n */\nclass DummyInputManagerCore {\n    private _tabster: TabsterCore;\n    private _addTimer: number | undefined;\n    private _getWindow: GetWindow;\n    private _wrappers: DummyInputWrapper[] = [];\n    private _element: WeakHTMLElement | undefined;\n    private _isOutside = false;\n    private _firstDummy: DummyInput | undefined;\n    private _lastDummy: DummyInput | undefined;\n    private _transformElements: Set<HTMLElement> = new Set();\n    private _callForDefaultAction: boolean | undefined;\n\n    constructor(\n        tabster: TabsterCore,\n        element: WeakHTMLElement,\n        manager: DummyInputManager,\n        priority: number,\n        sys: SysProps | undefined,\n        outsideByDefault?: boolean,\n        callForDefaultAction?: boolean\n    ) {\n        const el = element.get() as HTMLElementWithDummyInputs;\n\n        if (!el) {\n            throw new Error(\"No element\");\n        }\n\n        this._tabster = tabster;\n        this._getWindow = tabster.getWindow;\n        this._callForDefaultAction = callForDefaultAction;\n\n        const instance = el.__tabsterDummy;\n\n        (instance || this)._wrappers.push({\n            manager,\n            priority,\n            tabbable: true,\n        });\n\n        if (instance) {\n            if (__DEV__) {\n                this._firstDummy &&\n                    setDummyInputDebugValue(\n                        this._firstDummy,\n                        instance._wrappers\n                    );\n                this._lastDummy &&\n                    setDummyInputDebugValue(\n                        this._lastDummy,\n                        instance._wrappers\n                    );\n            }\n\n            return instance;\n        }\n\n        el.__tabsterDummy = this;\n\n        // Some elements allow only specific types of direct descendants and we need to\n        // put our dummy inputs inside or outside of the element accordingly.\n        const forcedDummyPosition = sys?.dummyInputsPosition;\n        const tagName = el.tagName;\n        this._isOutside = !forcedDummyPosition\n            ? (outsideByDefault ||\n                  tagName === \"UL\" ||\n                  tagName === \"OL\" ||\n                  tagName === \"TABLE\") &&\n              !(tagName === \"LI\" || tagName === \"TD\" || tagName === \"TH\")\n            : forcedDummyPosition === SysDummyInputsPositions.Outside;\n\n        this._firstDummy = new DummyInput(\n            this._getWindow,\n            this._isOutside,\n            {\n                isFirst: true,\n            },\n            element\n        );\n\n        this._lastDummy = new DummyInput(\n            this._getWindow,\n            this._isOutside,\n            {\n                isFirst: false,\n            },\n            element\n        );\n\n        // We will be checking dummy input parents to see if their child list have changed.\n        // So, it is enough to have just one of the inputs observed, because\n        // both dummy inputs always have the same parent.\n        const dummyElement = this._firstDummy.input;\n        dummyElement &&\n            tabster._dummyObserver.add(dummyElement, this._addDummyInputs);\n\n        this._firstDummy.onFocusIn = this._onFocusIn;\n        this._firstDummy.onFocusOut = this._onFocusOut;\n        this._lastDummy.onFocusIn = this._onFocusIn;\n        this._lastDummy.onFocusOut = this._onFocusOut;\n\n        this._element = element;\n        this._addDummyInputs();\n    }\n\n    dispose(manager: DummyInputManager, force?: boolean): void {\n        const wrappers = (this._wrappers = this._wrappers.filter(\n            (w) => w.manager !== manager && !force\n        ));\n\n        if (__DEV__) {\n            this._firstDummy &&\n                setDummyInputDebugValue(this._firstDummy, wrappers);\n            this._lastDummy &&\n                setDummyInputDebugValue(this._lastDummy, wrappers);\n        }\n\n        if (wrappers.length === 0) {\n            delete (this._element?.get() as HTMLElementWithDummyInputs)\n                .__tabsterDummy;\n\n            for (const el of this._transformElements) {\n                el.removeEventListener(\"scroll\", this._addTransformOffsets);\n            }\n            this._transformElements.clear();\n\n            const win = this._getWindow();\n\n            if (this._addTimer) {\n                win.clearTimeout(this._addTimer);\n                delete this._addTimer;\n            }\n\n            const dummyElement = this._firstDummy?.input;\n            dummyElement && this._tabster._dummyObserver.remove(dummyElement);\n\n            this._firstDummy?.dispose();\n            this._lastDummy?.dispose();\n        }\n    }\n\n    private _onFocus(\n        isIn: boolean,\n        dummyInput: DummyInput,\n        isBackward: boolean,\n        relatedTarget: HTMLElement | null\n    ): void {\n        const wrapper = this._getCurrent();\n\n        if (\n            wrapper &&\n            (!dummyInput.useDefaultAction || this._callForDefaultAction)\n        ) {\n            wrapper.manager.getHandler(isIn)?.(\n                dummyInput,\n                isBackward,\n                relatedTarget\n            );\n        }\n    }\n\n    private _onFocusIn = (\n        dummyInput: DummyInput,\n        isBackward: boolean,\n        relatedTarget: HTMLElement | null\n    ): void => {\n        this._onFocus(true, dummyInput, isBackward, relatedTarget);\n    };\n\n    private _onFocusOut = (\n        dummyInput: DummyInput,\n        isBackward: boolean,\n        relatedTarget: HTMLElement | null\n    ): void => {\n        this._onFocus(false, dummyInput, isBackward, relatedTarget);\n    };\n\n    moveOut = (backwards: boolean): void => {\n        const first = this._firstDummy;\n        const last = this._lastDummy;\n\n        if (first && last) {\n            // For the sake of performance optimization, the dummy input\n            // position in the DOM updates asynchronously from the DOM change.\n            // Calling _ensurePosition() to make sure the position is correct.\n            this._ensurePosition();\n\n            const firstInput = first.input;\n            const lastInput = last.input;\n            const element = this._element?.get();\n\n            if (firstInput && lastInput && element) {\n                let toFocus: HTMLElement | undefined;\n\n                if (backwards) {\n                    firstInput.tabIndex = 0;\n                    toFocus = firstInput;\n                } else {\n                    lastInput.tabIndex = 0;\n                    toFocus = lastInput;\n                }\n\n                if (toFocus) {\n                    nativeFocus(toFocus);\n                }\n            }\n        }\n    };\n\n    /**\n     * Prepares to move focus out of the given element by focusing\n     * one of the dummy inputs and setting the `useDefaultAction` flag\n     * @param backwards focus moving to an element behind the given element\n     */\n    moveOutWithDefaultAction = (\n        backwards: boolean,\n        relatedEvent: KeyboardEvent\n    ): void => {\n        const first = this._firstDummy;\n        const last = this._lastDummy;\n\n        if (first && last) {\n            // For the sake of performance optimization, the dummy input\n            // position in the DOM updates asynchronously from the DOM change.\n            // Calling _ensurePosition() to make sure the position is correct.\n            this._ensurePosition();\n\n            const firstInput = first.input;\n            const lastInput = last.input;\n            const element = this._element?.get();\n\n            if (firstInput && lastInput && element) {\n                let toFocus: HTMLElement | undefined;\n\n                if (backwards) {\n                    if (\n                        !first.isOutside &&\n                        this._tabster.focusable.isFocusable(\n                            element,\n                            true,\n                            true,\n                            true\n                        )\n                    ) {\n                        toFocus = element;\n                    } else {\n                        first.useDefaultAction = true;\n                        firstInput.tabIndex = 0;\n                        toFocus = firstInput;\n                    }\n                } else {\n                    last.useDefaultAction = true;\n                    lastInput.tabIndex = 0;\n                    toFocus = lastInput;\n                }\n\n                if (\n                    toFocus &&\n                    element.dispatchEvent(\n                        new TabsterMoveFocusEvent({\n                            by: \"root\",\n                            owner: element,\n                            next: null,\n                            relatedEvent,\n                        })\n                    )\n                ) {\n                    nativeFocus(toFocus);\n                }\n            }\n        }\n    };\n\n    setTabbable = (manager: DummyInputManager, tabbable: boolean) => {\n        for (const w of this._wrappers) {\n            if (w.manager === manager) {\n                w.tabbable = tabbable;\n                break;\n            }\n        }\n\n        const wrapper = this._getCurrent();\n\n        if (wrapper) {\n            const tabIndex = wrapper.tabbable ? 0 : -1;\n\n            let input = this._firstDummy?.input;\n\n            if (input) {\n                input.tabIndex = tabIndex;\n            }\n\n            input = this._lastDummy?.input;\n\n            if (input) {\n                input.tabIndex = tabIndex;\n            }\n        }\n\n        if (__DEV__) {\n            this._firstDummy &&\n                setDummyInputDebugValue(this._firstDummy, this._wrappers);\n            this._lastDummy &&\n                setDummyInputDebugValue(this._lastDummy, this._wrappers);\n        }\n    };\n\n    private _getCurrent(): DummyInputWrapper | undefined {\n        this._wrappers.sort((a, b) => {\n            if (a.tabbable !== b.tabbable) {\n                return a.tabbable ? -1 : 1;\n            }\n\n            return a.priority - b.priority;\n        });\n\n        return this._wrappers[0];\n    }\n\n    /**\n     * Adds dummy inputs as the first and last child of the given element\n     * Called each time the children under the element is mutated\n     */\n    private _addDummyInputs = () => {\n        if (this._addTimer) {\n            return;\n        }\n\n        this._addTimer = this._getWindow().setTimeout(() => {\n            delete this._addTimer;\n\n            this._ensurePosition();\n\n            if (__DEV__) {\n                this._firstDummy &&\n                    setDummyInputDebugValue(this._firstDummy, this._wrappers);\n                this._lastDummy &&\n                    setDummyInputDebugValue(this._lastDummy, this._wrappers);\n            }\n\n            this._addTransformOffsets();\n        }, 0);\n    };\n\n    private _ensurePosition(): void {\n        const element = this._element?.get();\n        const firstDummyInput = this._firstDummy?.input;\n        const lastDummyInput = this._lastDummy?.input;\n\n        if (!element || !firstDummyInput || !lastDummyInput) {\n            return;\n        }\n\n        if (this._isOutside) {\n            const elementParent = dom.getParentNode(element);\n\n            if (elementParent) {\n                const nextSibling = dom.getNextSibling(element);\n\n                if (nextSibling !== lastDummyInput) {\n                    dom.insertBefore(\n                        elementParent,\n                        lastDummyInput,\n                        nextSibling\n                    );\n                }\n\n                if (\n                    dom.getPreviousElementSibling(element) !== firstDummyInput\n                ) {\n                    dom.insertBefore(elementParent, firstDummyInput, element);\n                }\n            }\n        } else {\n            if (dom.getLastElementChild(element) !== lastDummyInput) {\n                dom.appendChild(element, lastDummyInput);\n            }\n\n            const firstElementChild = dom.getFirstElementChild(element);\n\n            if (\n                firstElementChild &&\n                firstElementChild !== firstDummyInput &&\n                firstElementChild.parentNode\n            ) {\n                dom.insertBefore(\n                    firstElementChild.parentNode,\n                    firstDummyInput,\n                    firstElementChild\n                );\n            }\n        }\n    }\n\n    private _addTransformOffsets = (): void => {\n        this._tabster._dummyObserver.updatePositions(\n            this._computeTransformOffsets\n        );\n    };\n\n    private _computeTransformOffsets = (\n        scrollTopLeftCache: Map<\n            HTMLElement,\n            { scrollTop: number; scrollLeft: number } | null\n        >\n    ): (() => void) => {\n        const from = this._firstDummy?.input || this._lastDummy?.input;\n        const transformElements = this._transformElements;\n        const newTransformElements: typeof transformElements = new Set();\n        let scrollTop = 0;\n        let scrollLeft = 0;\n\n        const win = this._getWindow();\n\n        for (\n            let element: HTMLElement | undefined | null = from;\n            element && element.nodeType === Node.ELEMENT_NODE;\n            element = dom.getParentElement(element)\n        ) {\n            let scrollTopLeft = scrollTopLeftCache.get(element);\n\n            // getComputedStyle() and element.scrollLeft/Top() cause style recalculation,\n            // so we cache the result across all elements in the current bulk.\n            if (scrollTopLeft === undefined) {\n                const transform = win.getComputedStyle(element).transform;\n\n                if (transform && transform !== \"none\") {\n                    scrollTopLeft = {\n                        scrollTop: element.scrollTop,\n                        scrollLeft: element.scrollLeft,\n                    };\n                }\n\n                scrollTopLeftCache.set(element, scrollTopLeft || null);\n            }\n\n            if (scrollTopLeft) {\n                newTransformElements.add(element);\n\n                if (!transformElements.has(element)) {\n                    element.addEventListener(\n                        \"scroll\",\n                        this._addTransformOffsets\n                    );\n                }\n\n                scrollTop += scrollTopLeft.scrollTop;\n                scrollLeft += scrollTopLeft.scrollLeft;\n            }\n        }\n\n        for (const el of transformElements) {\n            if (!newTransformElements.has(el)) {\n                el.removeEventListener(\"scroll\", this._addTransformOffsets);\n            }\n        }\n\n        this._transformElements = newTransformElements;\n\n        return () => {\n            this._firstDummy?.setTopLeft(scrollTop, scrollLeft);\n            this._lastDummy?.setTopLeft(scrollTop, scrollLeft);\n        };\n    };\n}\n\nexport function getLastChild(container: HTMLElement): HTMLElement | undefined {\n    let lastChild: HTMLElement | null = null;\n\n    for (\n        let i = dom.getLastElementChild(container);\n        i;\n        i = dom.getLastElementChild(i)\n    ) {\n        lastChild = i as HTMLElement;\n    }\n\n    return lastChild || undefined;\n}\n\nexport function getAdjacentElement(\n    from: HTMLElement,\n    prev?: boolean\n): HTMLElement | undefined {\n    let cur: HTMLElement | null = from;\n    let adjacent: HTMLElement | null = null;\n\n    while (cur && !adjacent) {\n        adjacent = (\n            prev\n                ? dom.getPreviousElementSibling(cur)\n                : dom.getNextElementSibling(cur)\n        ) as HTMLElement | null;\n        cur = dom.getParentElement(cur);\n    }\n\n    return adjacent || undefined;\n}\n\nexport function augmentAttribute(\n    tabster: TabsterCore,\n    element: HTMLElement,\n    name: string,\n    value?: string | null // Restore original value when undefined.\n): boolean {\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const entry = tabster.storageEntry(element, true)!;\n    let ret = false;\n\n    if (!entry.aug) {\n        if (value === undefined) {\n            return ret;\n        }\n\n        entry.aug = {};\n    }\n\n    if (value === undefined) {\n        if (name in entry.aug) {\n            const origVal = entry.aug[name];\n\n            delete entry.aug[name];\n\n            if (origVal === null) {\n                element.removeAttribute(name);\n            } else {\n                element.setAttribute(name, origVal);\n            }\n\n            ret = true;\n        }\n    } else {\n        let origValue: string | null | undefined;\n\n        if (!(name in entry.aug)) {\n            origValue = element.getAttribute(name);\n        }\n\n        if (origValue !== undefined && origValue !== value) {\n            entry.aug[name] = origValue;\n\n            if (value === null) {\n                element.removeAttribute(name);\n            } else {\n                element.setAttribute(name, value);\n            }\n\n            ret = true;\n        }\n    }\n\n    if (value === undefined && Object.keys(entry.aug).length === 0) {\n        delete entry.aug;\n        tabster.storageEntry(element, false);\n    }\n\n    return ret;\n}\n\nexport function getTabsterAttributeOnElement(\n    element: HTMLElement\n): TabsterAttributeProps | null {\n    if (!element.hasAttribute(TABSTER_ATTRIBUTE_NAME)) {\n        return null;\n    }\n\n    // We already checked the presence with `hasAttribute`\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const rawAttribute = element.getAttribute(TABSTER_ATTRIBUTE_NAME)!;\n    let tabsterAttribute: TabsterAttributeProps;\n    try {\n        tabsterAttribute = JSON.parse(rawAttribute);\n    } catch {\n        console.error(\"Tabster: failed to parse attribute\", rawAttribute);\n        tabsterAttribute = {};\n    }\n\n    return tabsterAttribute;\n}\n\nexport function isDisplayNone(element: HTMLElement): boolean {\n    const elementDocument = element.ownerDocument;\n    const computedStyle =\n        elementDocument.defaultView?.getComputedStyle(element);\n\n    // offsetParent is null for elements with display:none, display:fixed and for <body>.\n    if (\n        element.offsetParent === null &&\n        elementDocument.body !== element &&\n        computedStyle?.position !== \"fixed\"\n    ) {\n        return true;\n    }\n\n    // For our purposes of looking for focusable elements, visibility:hidden has the same\n    // effect as display:none.\n    if (computedStyle?.visibility === \"hidden\") {\n        return true;\n    }\n\n    // if an element has display: fixed, we need to check if it is also hidden with CSS,\n    // or within a parent hidden with CSS\n    if (computedStyle?.position === \"fixed\") {\n        if (computedStyle.display === \"none\") {\n            return true;\n        }\n\n        if (\n            element.parentElement?.offsetParent === null &&\n            elementDocument.body !== element.parentElement\n        ) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nexport function isRadio(element: HTMLElement): boolean {\n    return (\n        element.tagName === \"INPUT\" &&\n        !!(element as HTMLInputElement).name &&\n        (element as HTMLInputElement).type === \"radio\"\n    );\n}\n\nexport function getRadioButtonGroup(\n    element: HTMLElement\n): RadioButtonGroup | undefined {\n    if (!isRadio(element)) {\n        return;\n    }\n\n    const name = (element as HTMLInputElement).name;\n    let radioButtons = Array.from(dom.getElementsByName(element, name));\n    let checked: HTMLInputElement | undefined;\n\n    radioButtons = radioButtons.filter((el) => {\n        if (isRadio(el)) {\n            if ((el as HTMLInputElement).checked) {\n                checked = el as HTMLInputElement;\n            }\n            return true;\n        }\n        return false;\n    });\n\n    return {\n        name,\n        buttons: new Set(radioButtons as HTMLInputElement[]),\n        checked,\n    };\n}\n\n/**\n * If the passed element is Tabster dummy input, returns the container element this dummy input belongs to.\n * @param element Element to check for being dummy input.\n * @returns Dummy input container element (if the passed element is a dummy input) or null.\n */\nexport function getDummyInputContainer(\n    element: HTMLElement | null | undefined\n): HTMLElement | null {\n    return (\n        (\n            element as HTMLElementWithDummyContainer | null | undefined\n        )?.__tabsterDummyContainer?.get() || null\n    );\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport * as Types from \"./Types\";\nimport { TABSTER_ATTRIBUTE_NAME } from \"./Consts\";\n\nexport function getTabsterAttribute(\n    props: Types.TabsterAttributeProps\n): Types.TabsterDOMAttribute;\nexport function getTabsterAttribute(\n    props: Types.TabsterAttributeProps,\n    plain: true\n): string;\nexport function getTabsterAttribute(\n    props: Types.TabsterAttributeProps,\n    plain?: true\n): Types.TabsterDOMAttribute | string {\n    const attr = JSON.stringify(props);\n\n    if (plain === true) {\n        return attr;\n    }\n\n    return {\n        [TABSTER_ATTRIBUTE_NAME]: attr,\n    };\n}\n\n/**\n * Updates Tabster props object with new props.\n * @param element an element to set data-tabster attribute on.\n * @param props current Tabster props to update.\n * @param newProps new Tabster props to add.\n *  When the value of a property in newProps is undefined, the property\n *  will be removed from the attribute.\n */\nexport function mergeTabsterProps(\n    props: Types.TabsterAttributeProps,\n    newProps: Types.TabsterAttributeProps\n): void {\n    for (const key of Object.keys(\n        newProps\n    ) as (keyof Types.TabsterAttributeProps)[]) {\n        const value = newProps[key];\n\n        if (value) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            props[key] = value as any;\n        } else {\n            delete props[key];\n        }\n    }\n}\n\n/**\n * Sets or updates Tabster attribute of the element.\n * @param element an element to set data-tabster attribute on.\n * @param newProps new Tabster props to set.\n * @param update if true, newProps will be merged with the existing props.\n *  When true and the value of a property in newProps is undefined, the property\n *  will be removed from the attribute.\n */\nexport function setTabsterAttribute(\n    element: HTMLElement,\n    newProps: Types.TabsterAttributeProps,\n    update?: boolean\n): void {\n    let props: Types.TabsterAttributeProps | undefined;\n\n    if (update) {\n        const attr = element.getAttribute(TABSTER_ATTRIBUTE_NAME);\n\n        if (attr) {\n            try {\n                props = JSON.parse(attr);\n            } catch (e) {\n                if (__DEV__) {\n                    console.error(\n                        `data-tabster attribute error: ${e}`,\n                        element\n                    );\n                }\n            }\n        }\n    }\n\n    if (!props) {\n        props = {};\n    }\n\n    mergeTabsterProps(props, newProps);\n\n    if (Object.keys(props).length > 0) {\n        element.setAttribute(\n            TABSTER_ATTRIBUTE_NAME,\n            getTabsterAttribute(props, true)\n        );\n    } else {\n        element.removeAttribute(TABSTER_ATTRIBUTE_NAME);\n    }\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { KEYBORG_FOCUSIN, KEYBORG_FOCUSOUT, nativeFocus } from \"keyborg\";\nimport { getTabsterOnElement, updateTabsterByAttribute } from \"./Instance\";\nimport * as Types from \"./Types\";\nimport { RootFocusEvent, RootBlurEvent } from \"./Events\";\nimport {\n    DummyInput,\n    DummyInputManager,\n    DummyInputManagerPriorities,\n    getElementUId,\n    TabsterPart,\n    WeakHTMLElement,\n} from \"./Utils\";\nimport { setTabsterAttribute } from \"./AttributeHelpers\";\n\nexport interface WindowWithTabsterInstance extends Window {\n    __tabsterInstance?: Types.TabsterCore;\n}\n\nfunction _setInformativeStyle(\n    weakElement: WeakHTMLElement,\n    remove: boolean,\n    id?: string\n) {\n    if (__DEV__) {\n        const element = weakElement.get();\n\n        if (element) {\n            if (remove) {\n                element.style.removeProperty(\"--tabster-root\");\n            } else {\n                element.style.setProperty(\"--tabster-root\", id + \",\");\n            }\n        }\n    }\n}\n\nclass RootDummyManager extends DummyInputManager {\n    private _tabster: Types.TabsterCore;\n    private _setFocused: (focused: boolean) => void;\n\n    constructor(\n        tabster: Types.TabsterCore,\n        element: WeakHTMLElement,\n        setFocused: (focused: boolean) => void,\n        sys: Types.SysProps | undefined\n    ) {\n        super(\n            tabster,\n            element,\n            DummyInputManagerPriorities.Root,\n            sys,\n            undefined,\n            true\n        );\n\n        this._setHandlers(this._onDummyInputFocus);\n\n        this._tabster = tabster;\n        this._setFocused = setFocused;\n    }\n\n    private _onDummyInputFocus = (dummyInput: DummyInput): void => {\n        if (dummyInput.useDefaultAction) {\n            // When we've reached the last focusable element, we want to let the browser\n            // to move the focus outside of the page. In order to do that we're synchronously\n            // calling focus() of the dummy input from the Tab key handler and allowing\n            // the default action to move the focus out.\n            this._setFocused(false);\n        } else {\n            // The only way a dummy input gets focused is during the keyboard navigation.\n            this._tabster.keyboardNavigation.setNavigatingWithKeyboard(true);\n\n            const element = this._element.get();\n\n            if (element) {\n                this._setFocused(true);\n\n                const toFocus =\n                    this._tabster.focusedElement.getFirstOrLastTabbable(\n                        dummyInput.isFirst,\n                        { container: element, ignoreAccessibility: true }\n                    );\n\n                if (toFocus) {\n                    nativeFocus(toFocus);\n                    return;\n                }\n            }\n\n            dummyInput.input?.blur();\n        }\n    };\n}\n\nexport class Root\n    extends TabsterPart<Types.RootProps, undefined>\n    implements Types.Root\n{\n    readonly uid: string;\n\n    private _dummyManager?: RootDummyManager;\n    private _sys?: Types.SysProps;\n    private _isFocused = false;\n    private _setFocusedTimer: number | undefined;\n    private _onDispose: (root: Root) => void;\n\n    constructor(\n        tabster: Types.TabsterCore,\n        element: HTMLElement,\n        onDispose: (root: Root) => void,\n        props: Types.RootProps,\n        sys: Types.SysProps | undefined\n    ) {\n        super(tabster, element, props);\n\n        this._onDispose = onDispose;\n\n        const win = tabster.getWindow;\n        this.uid = getElementUId(win, element);\n\n        this._sys = sys;\n\n        if (tabster.controlTab || tabster.rootDummyInputs) {\n            this.addDummyInputs();\n        }\n\n        const w = win();\n        const doc = w.document;\n\n        doc.addEventListener(KEYBORG_FOCUSIN, this._onFocusIn);\n        doc.addEventListener(KEYBORG_FOCUSOUT, this._onFocusOut);\n\n        this._add();\n    }\n\n    addDummyInputs(): void {\n        if (!this._dummyManager) {\n            this._dummyManager = new RootDummyManager(\n                this._tabster,\n                this._element,\n                this._setFocused,\n                this._sys\n            );\n        }\n    }\n\n    dispose(): void {\n        this._onDispose(this);\n\n        const win = this._tabster.getWindow();\n        const doc = win.document;\n\n        doc.removeEventListener(KEYBORG_FOCUSIN, this._onFocusIn);\n        doc.removeEventListener(KEYBORG_FOCUSOUT, this._onFocusOut);\n\n        if (this._setFocusedTimer) {\n            win.clearTimeout(this._setFocusedTimer);\n            delete this._setFocusedTimer;\n        }\n\n        this._dummyManager?.dispose();\n        this._remove();\n    }\n\n    moveOutWithDefaultAction(isBackward: boolean, relatedEvent: KeyboardEvent) {\n        const dummyManager = this._dummyManager;\n\n        if (dummyManager) {\n            dummyManager.moveOutWithDefaultAction(isBackward, relatedEvent);\n        } else {\n            const el = this.getElement();\n\n            if (el) {\n                RootDummyManager.moveWithPhantomDummy(\n                    this._tabster,\n                    el,\n                    true,\n                    isBackward,\n                    relatedEvent\n                );\n            }\n        }\n    }\n\n    private _setFocused = (hasFocused: boolean): void => {\n        if (this._setFocusedTimer) {\n            this._tabster.getWindow().clearTimeout(this._setFocusedTimer);\n            delete this._setFocusedTimer;\n        }\n\n        if (this._isFocused === hasFocused) {\n            return;\n        }\n\n        const element = this._element.get();\n\n        if (element) {\n            if (hasFocused) {\n                this._isFocused = true;\n                this._dummyManager?.setTabbable(false);\n                element.dispatchEvent(new RootFocusEvent({ element }));\n            } else {\n                this._setFocusedTimer = this._tabster\n                    .getWindow()\n                    .setTimeout(() => {\n                        delete this._setFocusedTimer;\n\n                        this._isFocused = false;\n                        this._dummyManager?.setTabbable(true);\n                        element.dispatchEvent(new RootBlurEvent({ element }));\n                    }, 0);\n            }\n        }\n    };\n\n    private _onFocusIn = (event: FocusEvent) => {\n        const getParent = this._tabster.getParent;\n        const rootElement = this._element.get();\n        let curElement = event.composedPath()[0] as HTMLElement | null;\n\n        do {\n            if (curElement === rootElement) {\n                this._setFocused(true);\n                return;\n            }\n\n            curElement =\n                curElement && (getParent(curElement) as HTMLElement | null);\n        } while (curElement);\n    };\n\n    private _onFocusOut = () => {\n        this._setFocused(false);\n    };\n\n    private _add(): void {\n        if (__DEV__) {\n            _setInformativeStyle(this._element, false, this.uid);\n        }\n    }\n\n    private _remove(): void {\n        if (__DEV__) {\n            _setInformativeStyle(this._element, true);\n        }\n    }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction validateRootProps(props: Types.RootProps): void {\n    // TODO: Implement validation.\n}\n\nexport class RootAPI implements Types.RootAPI {\n    private _tabster: Types.TabsterCore;\n    private _win: Types.GetWindow;\n    private _autoRoot: Types.RootProps | undefined;\n    private _autoRootWaiting = false;\n    private _roots: Record<string, Types.Root> = {};\n    private _forceDummy = false;\n    rootById: { [id: string]: Types.Root } = {};\n\n    constructor(tabster: Types.TabsterCore, autoRoot?: Types.RootProps) {\n        this._tabster = tabster;\n        this._win = tabster.getWindow;\n        this._autoRoot = autoRoot;\n\n        tabster.queueInit(() => {\n            if (this._autoRoot) {\n                this._autoRootCreate();\n            }\n        });\n    }\n\n    private _autoRootCreate = (): Types.Root | undefined => {\n        const doc = this._win().document;\n        const body = doc.body;\n\n        if (body) {\n            this._autoRootUnwait(doc);\n\n            const props = this._autoRoot;\n\n            if (props) {\n                setTabsterAttribute(body, { root: props }, true);\n                updateTabsterByAttribute(this._tabster, body);\n                return getTabsterOnElement(this._tabster, body)?.root;\n            }\n        } else if (!this._autoRootWaiting) {\n            this._autoRootWaiting = true;\n            doc.addEventListener(\"readystatechange\", this._autoRootCreate);\n        }\n\n        return undefined;\n    };\n\n    private _autoRootUnwait(doc: Document): void {\n        doc.removeEventListener(\"readystatechange\", this._autoRootCreate);\n        this._autoRootWaiting = false;\n    }\n\n    dispose(): void {\n        const win = this._win();\n\n        this._autoRootUnwait(win.document);\n        delete this._autoRoot;\n\n        Object.keys(this._roots).forEach((rootId) => {\n            if (this._roots[rootId]) {\n                this._roots[rootId].dispose();\n                delete this._roots[rootId];\n            }\n        });\n\n        this.rootById = {};\n    }\n\n    createRoot(\n        element: HTMLElement,\n        props: Types.RootProps,\n        sys: Types.SysProps | undefined\n    ): Types.Root {\n        if (__DEV__) {\n            validateRootProps(props);\n        }\n\n        const newRoot = new Root(\n            this._tabster,\n            element,\n            this._onRootDispose,\n            props,\n            sys\n        ) as Types.Root;\n\n        this._roots[newRoot.id] = newRoot;\n\n        if (this._forceDummy) {\n            newRoot.addDummyInputs();\n        }\n\n        return newRoot;\n    }\n\n    addDummyInputs(): void {\n        this._forceDummy = true;\n\n        const roots = this._roots;\n\n        for (const id of Object.keys(roots)) {\n            roots[id].addDummyInputs();\n        }\n    }\n\n    static getRootByUId(\n        getWindow: Types.GetWindow,\n        id: string\n    ): Types.Root | undefined {\n        const tabster = (getWindow() as WindowWithTabsterInstance)\n            .__tabsterInstance;\n        return tabster && (tabster.root as RootAPI).rootById[id];\n    }\n\n    /**\n     * Fetches the tabster context for an element walking up its ancestors\n     *\n     * @param tabster Tabster instance\n     * @param element The element the tabster context should represent\n     * @param options Additional options\n     * @returns undefined if the element is not a child of a tabster root, otherwise all applicable tabster behaviours and configurations\n     */\n    static getTabsterContext(\n        tabster: Types.TabsterCore,\n        element: Node,\n        options: Types.GetTabsterContextOptions = {}\n    ): Types.TabsterContext | undefined {\n        if (!element.ownerDocument) {\n            return undefined;\n        }\n\n        const { checkRtl, referenceElement } = options;\n\n        const getParent = tabster.getParent;\n\n        // Normally, the initialization starts on the next tick after the tabster\n        // instance creation. However, if the application starts using it before\n        // the next tick, we need to make sure the initialization is done.\n        tabster.drainInitQueue();\n\n        let root: Types.Root | undefined;\n        let modalizer: Types.Modalizer | undefined;\n        let groupper: Types.Groupper | undefined;\n        let mover: Types.Mover | undefined;\n        let excludedFromMover = false;\n        let groupperBeforeMover: boolean | undefined;\n        let modalizerInGroupper: Types.Groupper | undefined;\n        let dirRightToLeft: boolean | undefined;\n        let uncontrolled: HTMLElement | null | undefined;\n        let curElement: Node | null = referenceElement || element;\n        const ignoreKeydown: Types.FocusableProps[\"ignoreKeydown\"] = {};\n\n        while (curElement && (!root || checkRtl)) {\n            const tabsterOnElement = getTabsterOnElement(\n                tabster,\n                curElement as HTMLElement\n            );\n\n            if (checkRtl && dirRightToLeft === undefined) {\n                const dir = (curElement as HTMLElement).dir;\n\n                if (dir) {\n                    dirRightToLeft = dir.toLowerCase() === \"rtl\";\n                }\n            }\n\n            if (!tabsterOnElement) {\n                curElement = getParent(curElement);\n                continue;\n            }\n\n            const tagName = (curElement as HTMLElement).tagName;\n\n            if (\n                (tabsterOnElement.uncontrolled ||\n                    tagName === \"IFRAME\" ||\n                    tagName === \"WEBVIEW\") &&\n                tabster.focusable.isVisible(curElement as HTMLElement)\n            ) {\n                uncontrolled = curElement as HTMLElement;\n            }\n\n            if (\n                !mover &&\n                tabsterOnElement.focusable?.excludeFromMover &&\n                !groupper\n            ) {\n                excludedFromMover = true;\n            }\n\n            const curModalizer = tabsterOnElement.modalizer;\n            const curGroupper = tabsterOnElement.groupper;\n            const curMover = tabsterOnElement.mover;\n\n            if (!modalizer && curModalizer) {\n                modalizer = curModalizer;\n            }\n\n            if (!groupper && curGroupper && (!modalizer || curModalizer)) {\n                if (modalizer) {\n                    // Modalizer dominates the groupper when they are on the same node and the groupper is active.\n                    if (\n                        !curGroupper.isActive() &&\n                        curGroupper.getProps().tabbability &&\n                        modalizer.userId !== tabster.modalizer?.activeId\n                    ) {\n                        modalizer = undefined;\n                        groupper = curGroupper;\n                    }\n\n                    modalizerInGroupper = curGroupper;\n                } else {\n                    groupper = curGroupper;\n                }\n            }\n\n            if (\n                !mover &&\n                curMover &&\n                (!modalizer || curModalizer) &&\n                (!curGroupper || curElement !== element) &&\n                curElement.contains(element) // Mover makes sense only for really inside elements, not for virutal out of the DOM order children.\n            ) {\n                mover = curMover;\n                groupperBeforeMover = !!groupper && groupper !== curGroupper;\n            }\n\n            if (tabsterOnElement.root) {\n                root = tabsterOnElement.root;\n            }\n\n            if (tabsterOnElement.focusable?.ignoreKeydown) {\n                Object.assign(\n                    ignoreKeydown,\n                    tabsterOnElement.focusable.ignoreKeydown\n                );\n            }\n\n            curElement = getParent(curElement);\n        }\n\n        // No root element could be found, try to get an auto root\n        if (!root) {\n            const rootAPI = tabster.root as RootAPI;\n            const autoRoot = rootAPI._autoRoot;\n\n            if (autoRoot) {\n                if (element.ownerDocument?.body) {\n                    root = rootAPI._autoRootCreate();\n                }\n            }\n        }\n\n        if (groupper && !mover) {\n            groupperBeforeMover = true;\n        }\n\n        if (__DEV__ && !root) {\n            if (modalizer || groupper || mover) {\n                console.error(\n                    \"Tabster Root is required for Mover, Groupper and Modalizer to work.\"\n                );\n            }\n        }\n\n        const shouldIgnoreKeydown = (event: KeyboardEvent) =>\n            !!ignoreKeydown[\n                event.key as keyof Types.FocusableProps[\"ignoreKeydown\"]\n            ];\n\n        return root\n            ? {\n                  root,\n                  modalizer,\n                  groupper,\n                  mover,\n                  groupperBeforeMover,\n                  modalizerInGroupper,\n                  rtl: checkRtl ? !!dirRightToLeft : undefined,\n                  uncontrolled,\n                  excludedFromMover,\n                  ignoreKeydown: shouldIgnoreKeydown,\n              }\n            : undefined;\n    }\n\n    static getRoot(\n        tabster: Types.TabsterCore,\n        element: HTMLElement\n    ): Types.Root | undefined {\n        const getParent = tabster.getParent;\n\n        for (\n            let el = element as HTMLElement | null;\n            el;\n            el = getParent(el) as HTMLElement | null\n        ) {\n            const root = getTabsterOnElement(tabster, el)?.root;\n\n            if (root) {\n                return root;\n            }\n        }\n\n        return undefined;\n    }\n\n    onRoot(root: Types.Root, removed?: boolean): void {\n        if (removed) {\n            delete this.rootById[root.uid];\n        } else {\n            this.rootById[root.uid] = root;\n        }\n    }\n\n    private _onRootDispose = (root: Root) => {\n        delete this._roots[root.id];\n    };\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { getTabsterOnElement } from \"./Instance\";\nimport { RootAPI } from \"./Root\";\nimport * as Types from \"./Types\";\nimport { DeloserStrategies, RestoreFocusOrders } from \"./Consts\";\nimport {\n    DeloserFocusLostEvent,\n    DeloserRestoreFocusEvent,\n    DeloserRestoreFocusEventName,\n    TabsterMoveFocusEvent,\n} from \"./Events\";\nimport {\n    documentContains,\n    getElementUId,\n    getPromise,\n    isDisplayNone,\n    TabsterPart,\n    WeakHTMLElement,\n} from \"./Utils\";\nimport { dom } from \"./DOMAPI\";\n\nconst _containerHistoryLength = 10;\n\nexport abstract class DeloserItemBase<C> {\n    abstract resetFocus(): Promise<boolean>;\n    abstract belongsTo(deloser: C): boolean;\n}\n\nexport class DeloserItem extends DeloserItemBase<Types.Deloser> {\n    readonly uid: string;\n    private _tabster: Types.TabsterCore;\n    private _deloser: Types.Deloser;\n\n    constructor(tabster: Types.TabsterCore, deloser: Types.Deloser) {\n        super();\n        this.uid = deloser.uid;\n        this._tabster = tabster;\n        this._deloser = deloser;\n    }\n\n    belongsTo(deloser: Types.Deloser): boolean {\n        return deloser === this._deloser;\n    }\n\n    unshift(element: HTMLElement): void {\n        this._deloser.unshift(element);\n    }\n\n    async focusAvailable(): Promise<boolean | null> {\n        const available = this._deloser.findAvailable();\n        const deloserElement = this._deloser.getElement();\n\n        if (available && deloserElement) {\n            if (\n                !deloserElement.dispatchEvent(\n                    new TabsterMoveFocusEvent({\n                        by: \"deloser\",\n                        owner: deloserElement,\n                        next: available,\n                    })\n                )\n            ) {\n                // Default action is prevented, don't look further.\n                return null;\n            }\n\n            return this._tabster.focusedElement.focus(available);\n        }\n\n        return false;\n    }\n\n    async resetFocus(): Promise<boolean> {\n        const getWindow = this._tabster.getWindow;\n        return getPromise(getWindow).resolve(this._deloser.resetFocus());\n    }\n}\n\nexport abstract class DeloserHistoryByRootBase<\n    I,\n    D extends DeloserItemBase<I>,\n> {\n    protected _tabster: Types.TabsterCore;\n    protected _history: D[] = [];\n    readonly rootUId: string;\n\n    constructor(tabster: Types.TabsterCore, rootUId: string) {\n        this._tabster = tabster;\n        this.rootUId = rootUId;\n    }\n\n    getLength(): number {\n        return this._history.length;\n    }\n\n    removeDeloser(deloser: I): void {\n        this._history = this._history.filter((c) => !c.belongsTo(deloser));\n    }\n\n    hasDeloser(deloser: I): boolean {\n        return this._history.some((d) => d.belongsTo(deloser));\n    }\n\n    abstract focusAvailable(from: I | null): Promise<boolean | null>;\n    abstract resetFocus(from: I | null): Promise<boolean>;\n}\n\nclass DeloserHistoryByRoot extends DeloserHistoryByRootBase<\n    Types.Deloser,\n    DeloserItem\n> {\n    unshiftToDeloser(deloser: Types.Deloser, element: HTMLElement): void {\n        let item: DeloserItem | undefined;\n\n        for (let i = 0; i < this._history.length; i++) {\n            if (this._history[i].belongsTo(deloser)) {\n                item = this._history[i];\n                this._history.splice(i, 1);\n                break;\n            }\n        }\n\n        if (!item) {\n            item = new DeloserItem(this._tabster, deloser);\n        }\n\n        item.unshift(element);\n\n        this._history.unshift(item);\n\n        this._history.splice(\n            _containerHistoryLength,\n            this._history.length - _containerHistoryLength\n        );\n    }\n\n    async focusAvailable(from: Types.Deloser | null): Promise<boolean | null> {\n        let skip = !!from;\n\n        for (const i of this._history) {\n            if (from && i.belongsTo(from)) {\n                skip = false;\n            }\n\n            if (!skip) {\n                const result = await i.focusAvailable();\n\n                // Result is null when the default action is prevented by the application\n                // and we don't need to look further.\n                if (result || result === null) {\n                    return result;\n                }\n            }\n        }\n\n        return false;\n    }\n\n    async resetFocus(from: Types.Deloser | null): Promise<boolean> {\n        let skip = !!from;\n        const resetQueue: { [id: string]: DeloserItem } = {};\n\n        for (const i of this._history) {\n            if (from && i.belongsTo(from)) {\n                skip = false;\n            }\n\n            if (!skip && !resetQueue[i.uid]) {\n                resetQueue[i.uid] = i;\n            }\n        }\n\n        // Nothing is found, at least try to reset.\n        for (const id of Object.keys(resetQueue)) {\n            if (await resetQueue[id].resetFocus()) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n}\n\nexport class DeloserHistory {\n    private _tabster: Types.TabsterCore;\n    private _history: DeloserHistoryByRootBase<\n        unknown,\n        DeloserItemBase<unknown>\n    >[] = [];\n\n    constructor(tabster: Types.TabsterCore) {\n        this._tabster = tabster;\n    }\n\n    dispose(): void {\n        this._history = [];\n    }\n\n    process(element: HTMLElement): Types.Deloser | undefined {\n        const ctx = RootAPI.getTabsterContext(this._tabster, element);\n        const rootUId = ctx && ctx.root.uid;\n        const deloser = DeloserAPI.getDeloser(this._tabster, element);\n\n        if (!rootUId || !deloser) {\n            return undefined;\n        }\n\n        const historyByRoot = this.make(\n            rootUId,\n            () => new DeloserHistoryByRoot(this._tabster, rootUId)\n        );\n\n        if (!ctx || !ctx.modalizer || ctx.modalizer?.isActive()) {\n            historyByRoot.unshiftToDeloser(deloser, element);\n        }\n\n        return deloser;\n    }\n\n    make<\n        I,\n        D extends DeloserItemBase<I>,\n        C extends DeloserHistoryByRootBase<I, D>,\n    >(rootUId: string, createInstance: () => C): C {\n        let historyByRoot: C | undefined;\n\n        for (let i = 0; i < this._history.length; i++) {\n            const hbr = this._history[i] as C;\n\n            if (hbr.rootUId === rootUId) {\n                historyByRoot = hbr;\n                this._history.splice(i, 1);\n                break;\n            }\n        }\n\n        if (!historyByRoot) {\n            historyByRoot = createInstance();\n        }\n\n        this._history.unshift(historyByRoot);\n\n        this._history.splice(\n            _containerHistoryLength,\n            this._history.length - _containerHistoryLength\n        );\n\n        return historyByRoot;\n    }\n\n    removeDeloser(deloser: Types.Deloser): void {\n        this._history.forEach((i) => {\n            i.removeDeloser(deloser);\n        });\n\n        this._history = this._history.filter((i) => i.getLength() > 0);\n    }\n\n    async focusAvailable(from: Types.Deloser | null): Promise<boolean | null> {\n        let skip = !!from;\n\n        for (const h of this._history) {\n            if (from && h.hasDeloser(from)) {\n                skip = false;\n            }\n\n            if (!skip) {\n                const result = await h.focusAvailable(from);\n\n                // Result is null when the default action is prevented by the application\n                // and we don't need to look further.\n                if (result || result === null) {\n                    return result;\n                }\n            }\n        }\n\n        return false;\n    }\n\n    async resetFocus(from: Types.Deloser | null): Promise<boolean> {\n        let skip = !!from;\n\n        for (const h of this._history) {\n            if (from && h.hasDeloser(from)) {\n                skip = false;\n            }\n\n            if (!skip && (await h.resetFocus(from))) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n}\n\nfunction _setInformativeStyle(\n    weakElement: WeakHTMLElement,\n    remove: boolean,\n    isActive?: boolean,\n    snapshotIndex?: number\n): void {\n    if (__DEV__) {\n        const element = weakElement.get();\n\n        if (element) {\n            if (remove) {\n                element.style.removeProperty(\"--tabster-deloser\");\n            } else {\n                element.style.setProperty(\n                    \"--tabster-deloser\",\n                    (isActive ? \"active\" : \"inactive\") +\n                        \",\" +\n                        (\"snapshot-\" + snapshotIndex)\n                );\n            }\n        }\n    }\n}\n\nfunction buildElementSelector(\n    element: HTMLElement,\n    withClass?: boolean,\n    withIndex?: boolean\n): string {\n    const selector: string[] = [];\n    const escapeRegExp = /(:|\\.|\\[|\\]|,|=|@)/g;\n    const escapeReplaceValue = \"\\\\$1\";\n\n    const elementId = element.getAttribute(\"id\");\n\n    if (elementId) {\n        selector.push(\n            \"#\" + elementId.replace(escapeRegExp, escapeReplaceValue)\n        );\n    }\n\n    if (withClass !== false && element.className) {\n        element.className.split(\" \").forEach((cls) => {\n            cls = cls.trim();\n\n            if (cls) {\n                selector.push(\n                    \".\" + cls.replace(escapeRegExp, escapeReplaceValue)\n                );\n            }\n        });\n    }\n\n    let index = 0;\n    let el: Element | null;\n\n    if (withIndex !== false && selector.length === 0) {\n        el = element;\n        while (el) {\n            index++;\n            el = el.previousElementSibling;\n        }\n        selector.unshift(\":nth-child(\" + index + \")\");\n    }\n\n    selector.unshift(element.tagName.toLowerCase());\n\n    return selector.join(\"\");\n}\n\nfunction buildSelector(element: HTMLElement): string | undefined {\n    if (!documentContains(element.ownerDocument, element)) {\n        return undefined;\n    }\n\n    const selector: string[] = [buildElementSelector(element)];\n\n    let node = dom.getParentNode(element);\n\n    while (node && node.nodeType !== Node.DOCUMENT_FRAGMENT_NODE) {\n        // Stop at the shadow root as cross shadow selectors won't work.\n        if (node.nodeType === Node.ELEMENT_NODE) {\n            const isBody = (node as HTMLElement).tagName === \"BODY\";\n\n            selector.unshift(\n                buildElementSelector(node as HTMLElement, false, !isBody)\n            );\n\n            if (isBody) {\n                break;\n            }\n        }\n\n        node = dom.getParentNode(node);\n    }\n\n    return selector.join(\" \");\n}\n\nexport class Deloser\n    extends TabsterPart<Types.DeloserProps>\n    implements Types.Deloser\n{\n    readonly uid: string;\n    readonly strategy: Types.DeloserStrategy;\n    private _isActive = false;\n    private _history: WeakHTMLElement<HTMLElement, string>[][] = [[]];\n    private _snapshotIndex = 0;\n    private _onDispose: (deloser: Deloser) => void;\n\n    constructor(\n        tabster: Types.TabsterCore,\n        element: HTMLElement,\n        onDispose: (deloser: Deloser) => void,\n        props: Types.DeloserProps\n    ) {\n        super(tabster, element, props);\n\n        this.uid = getElementUId(tabster.getWindow, element);\n        this.strategy = props.strategy || DeloserStrategies.Auto;\n        this._onDispose = onDispose;\n\n        if (__DEV__) {\n            _setInformativeStyle(\n                this._element,\n                false,\n                this._isActive,\n                this._snapshotIndex\n            );\n        }\n    }\n\n    dispose(): void {\n        this._remove();\n\n        this._onDispose(this);\n\n        this._isActive = false;\n        this._snapshotIndex = 0;\n\n        this._props = {};\n        this._history = [];\n    }\n\n    isActive = (): boolean => {\n        return this._isActive;\n    };\n\n    setActive(active: boolean): void {\n        this._isActive = active;\n\n        if (__DEV__) {\n            _setInformativeStyle(\n                this._element,\n                false,\n                this._isActive,\n                this._snapshotIndex\n            );\n        }\n    }\n\n    getActions(): Types.DeloserElementActions {\n        return {\n            focusDefault: this.focusDefault,\n            focusFirst: this.focusFirst,\n            resetFocus: this.resetFocus,\n            clearHistory: this.clearHistory,\n            setSnapshot: this.setSnapshot,\n            isActive: this.isActive,\n        };\n    }\n\n    setSnapshot = (index: number): void => {\n        this._snapshotIndex = index;\n\n        if (this._history.length > index + 1) {\n            this._history.splice(index + 1, this._history.length - index - 1);\n        }\n\n        if (!this._history[index]) {\n            this._history[index] = [];\n        }\n\n        if (__DEV__) {\n            _setInformativeStyle(\n                this._element,\n                false,\n                this._isActive,\n                this._snapshotIndex\n            );\n        }\n    };\n\n    focusFirst = (): boolean => {\n        const e = this._element.get();\n        return !!e && this._tabster.focusedElement.focusFirst({ container: e });\n    };\n\n    unshift(element: HTMLElement): void {\n        let cur = this._history[this._snapshotIndex];\n\n        cur = this._history[this._snapshotIndex] = cur.filter((we) => {\n            const e = we.get();\n            return e && e !== element;\n        });\n\n        cur.unshift(\n            new WeakHTMLElement(\n                this._tabster.getWindow,\n                element,\n                buildSelector(element)\n            )\n        );\n\n        while (cur.length > _containerHistoryLength) {\n            cur.pop();\n        }\n    }\n\n    focusDefault = (): boolean => {\n        const e = this._element.get();\n        return !!e && this._tabster.focusedElement.focusDefault(e);\n    };\n\n    resetFocus = (): boolean => {\n        const e = this._element.get();\n        return !!e && this._tabster.focusedElement.resetFocus(e);\n    };\n\n    findAvailable(): HTMLElement | null {\n        const element = this._element.get();\n\n        if (!element || !this._tabster.focusable.isVisible(element)) {\n            return null;\n        }\n\n        let restoreFocusOrder = this._props.restoreFocusOrder;\n        let available: HTMLElement | null = null;\n\n        const ctx = RootAPI.getTabsterContext(this._tabster, element);\n\n        if (!ctx) {\n            return null;\n        }\n\n        const root = ctx.root;\n        const rootElement = root.getElement();\n\n        if (!rootElement) {\n            return null;\n        }\n\n        if (restoreFocusOrder === undefined) {\n            restoreFocusOrder = root.getProps().restoreFocusOrder;\n        }\n\n        if (restoreFocusOrder === RestoreFocusOrders.RootDefault) {\n            available = this._tabster.focusable.findDefault({\n                container: rootElement,\n            });\n        }\n\n        if (!available && restoreFocusOrder === RestoreFocusOrders.RootFirst) {\n            available = this._findFirst(rootElement);\n        }\n\n        if (available) {\n            return available;\n        }\n\n        const availableInHistory = this._findInHistory();\n\n        if (\n            availableInHistory &&\n            restoreFocusOrder === RestoreFocusOrders.History\n        ) {\n            return availableInHistory;\n        }\n\n        const availableDefault = this._tabster.focusable.findDefault({\n            container: element,\n        });\n\n        if (\n            availableDefault &&\n            restoreFocusOrder === RestoreFocusOrders.DeloserDefault\n        ) {\n            return availableDefault;\n        }\n\n        const availableFirst = this._findFirst(element);\n\n        if (\n            availableFirst &&\n            restoreFocusOrder === RestoreFocusOrders.DeloserFirst\n        ) {\n            return availableFirst;\n        }\n\n        return availableDefault || availableInHistory || availableFirst || null;\n    }\n\n    clearHistory = (preserveExisting?: boolean): void => {\n        const element = this._element.get();\n\n        if (!element) {\n            this._history[this._snapshotIndex] = [];\n\n            return;\n        }\n\n        this._history[this._snapshotIndex] = this._history[\n            this._snapshotIndex\n        ].filter((we) => {\n            const e = we.get();\n            return e && preserveExisting ? dom.nodeContains(element, e) : false;\n        });\n    };\n\n    customFocusLostHandler(element: HTMLElement): boolean {\n        return element.dispatchEvent(\n            new DeloserFocusLostEvent(this.getActions())\n        );\n    }\n\n    private _findInHistory(): HTMLElement | null {\n        const cur = this._history[this._snapshotIndex].slice(0);\n\n        this.clearHistory(true);\n\n        for (let i = 0; i < cur.length; i++) {\n            const we = cur[i];\n            const e = we.get();\n            const element = this._element.get();\n\n            if (e && element && dom.nodeContains(element, e)) {\n                if (this._tabster.focusable.isFocusable(e)) {\n                    return e;\n                }\n            } else if (!this._props.noSelectorCheck) {\n                // Element is not in the DOM, try to locate the node by it's\n                // selector. This might return not exactly the right node,\n                // but it would be easily fixable by having more detailed selectors.\n                const selector = we.getData();\n\n                if (selector && element) {\n                    let els: Element[];\n\n                    try {\n                        els = dom.querySelectorAll(\n                            element.ownerDocument,\n                            selector\n                        );\n                        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                    } catch (e) {\n                        if (__DEV__) {\n                            // This should never happen, unless there is some bug in buildElementSelector().\n                            console.error(\n                                `Failed to querySelectorAll('${selector}')`\n                            );\n                        }\n                        continue;\n                    }\n\n                    for (let i = 0; i < els.length; i++) {\n                        const el = els[i] as HTMLElement;\n\n                        if (el && this._tabster.focusable.isFocusable(el)) {\n                            return el;\n                        }\n                    }\n                }\n            }\n        }\n\n        return null;\n    }\n\n    private _findFirst(element: HTMLElement): HTMLElement | null {\n        if (this._tabster.keyboardNavigation.isNavigatingWithKeyboard()) {\n            const first = this._tabster.focusable.findFirst({\n                container: element,\n                useActiveModalizer: true,\n            });\n\n            if (first) {\n                return first;\n            }\n        }\n\n        return null;\n    }\n\n    private _remove(): void {\n        if (__DEV__) {\n            _setInformativeStyle(this._element, true);\n        }\n    }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction validateDeloserProps(props: Types.DeloserProps): void {\n    // TODO: Implement validation.\n}\n\nexport class DeloserAPI implements Types.DeloserAPI {\n    private _tabster: Types.TabsterCore;\n    private _win: Types.GetWindow;\n    /**\n     * Tracks if focus is inside a deloser\n     */\n    private _inDeloser = false;\n    private _curDeloser: Types.Deloser | undefined;\n    private _history: DeloserHistory;\n    private _restoreFocusTimer: number | undefined;\n    private _isRestoringFocus = false;\n    private _isPaused = false;\n    private _autoDeloser: Types.DeloserProps | undefined;\n    private _autoDeloserInstance: Deloser | undefined;\n\n    constructor(\n        tabster: Types.TabsterCore,\n        props?: { autoDeloser: Types.DeloserProps }\n    ) {\n        this._tabster = tabster;\n        this._win = tabster.getWindow;\n        this._history = new DeloserHistory(tabster);\n\n        tabster.queueInit(() => {\n            this._tabster.focusedElement.subscribe(this._onFocus);\n            const doc = this._win().document;\n\n            doc.addEventListener(\n                DeloserRestoreFocusEventName,\n                this._onRestoreFocus\n            );\n\n            const activeElement = dom.getActiveElement(doc);\n\n            if (activeElement && activeElement !== doc.body) {\n                // Adding currently focused element to the deloser history.\n                this._onFocus(activeElement as HTMLElement);\n            }\n        });\n\n        const autoDeloser = props?.autoDeloser;\n        if (autoDeloser) {\n            this._autoDeloser = autoDeloser;\n        }\n    }\n\n    dispose(): void {\n        const win = this._win();\n\n        if (this._restoreFocusTimer) {\n            win.clearTimeout(this._restoreFocusTimer);\n            this._restoreFocusTimer = undefined;\n        }\n\n        if (this._autoDeloserInstance) {\n            this._autoDeloserInstance.dispose();\n            delete this._autoDeloserInstance;\n            delete this._autoDeloser;\n        }\n\n        this._tabster.focusedElement.unsubscribe(this._onFocus);\n\n        win.document.removeEventListener(\n            DeloserRestoreFocusEventName,\n            this._onRestoreFocus\n        );\n\n        this._history.dispose();\n\n        delete this._curDeloser;\n    }\n\n    createDeloser(\n        element: HTMLElement,\n        props: Types.DeloserProps\n    ): Types.Deloser {\n        if (__DEV__) {\n            validateDeloserProps(props);\n        }\n\n        const deloser = new Deloser(\n            this._tabster,\n            element,\n            this._onDeloserDispose,\n            props\n        );\n\n        if (\n            dom.nodeContains(\n                element,\n                this._tabster.focusedElement.getFocusedElement() ?? null\n            )\n        ) {\n            this._activate(deloser);\n        }\n\n        return deloser;\n    }\n\n    getActions(element: HTMLElement): Types.DeloserElementActions | undefined {\n        for (\n            let e: HTMLElement | null = element;\n            e;\n            e = dom.getParentElement(e)\n        ) {\n            const tabsterOnElement = getTabsterOnElement(this._tabster, e);\n\n            if (tabsterOnElement && tabsterOnElement.deloser) {\n                return tabsterOnElement.deloser.getActions();\n            }\n        }\n\n        return undefined;\n    }\n\n    pause(): void {\n        this._isPaused = true;\n\n        if (this._restoreFocusTimer) {\n            this._win().clearTimeout(this._restoreFocusTimer);\n            this._restoreFocusTimer = undefined;\n        }\n    }\n\n    resume(restore?: boolean): void {\n        this._isPaused = false;\n\n        if (restore) {\n            this._scheduleRestoreFocus();\n        }\n    }\n\n    private _onRestoreFocus = (event: DeloserRestoreFocusEvent): void => {\n        const target = event.composedPath()[0] as\n            | HTMLElement\n            | null\n            | undefined;\n\n        if (target) {\n            const available = DeloserAPI.getDeloser(\n                this._tabster,\n                target\n            )?.findAvailable();\n\n            if (available) {\n                this._tabster.focusedElement.focus(available);\n            }\n\n            event.stopImmediatePropagation();\n        }\n    };\n\n    private _onFocus = (e: HTMLElement | undefined): void => {\n        if (this._restoreFocusTimer) {\n            this._win().clearTimeout(this._restoreFocusTimer);\n            this._restoreFocusTimer = undefined;\n        }\n\n        if (!e) {\n            this._scheduleRestoreFocus();\n\n            return;\n        }\n\n        const deloser = this._history.process(e);\n\n        if (deloser) {\n            this._activate(deloser);\n        } else {\n            this._deactivate();\n        }\n    };\n\n    /**\n     * Activates and sets the current deloser\n     */\n    private _activate(deloser: Types.Deloser) {\n        const curDeloser = this._curDeloser;\n        if (curDeloser !== deloser) {\n            this._inDeloser = true;\n            curDeloser?.setActive(false);\n            deloser.setActive(true);\n            this._curDeloser = deloser;\n        }\n    }\n\n    /**\n     * Called when focus should no longer be in a deloser\n     */\n    private _deactivate() {\n        this._inDeloser = false;\n        this._curDeloser?.setActive(false);\n        this._curDeloser = undefined;\n    }\n\n    private _scheduleRestoreFocus(force?: boolean): void {\n        if (this._isPaused || this._isRestoringFocus) {\n            return;\n        }\n\n        const restoreFocus = async () => {\n            this._restoreFocusTimer = undefined;\n            const lastFocused =\n                this._tabster.focusedElement.getLastFocusedElement();\n\n            if (\n                !force &&\n                (this._isRestoringFocus ||\n                    !this._inDeloser ||\n                    (lastFocused && !isDisplayNone(lastFocused)))\n            ) {\n                return;\n            }\n\n            const curDeloser = this._curDeloser;\n            let isManual = false;\n\n            if (curDeloser) {\n                if (\n                    lastFocused &&\n                    curDeloser.customFocusLostHandler(lastFocused)\n                ) {\n                    return;\n                }\n\n                if (curDeloser.strategy === DeloserStrategies.Manual) {\n                    isManual = true;\n                } else {\n                    const curDeloserElement = curDeloser.getElement();\n                    const el = curDeloser.findAvailable();\n\n                    if (\n                        el &&\n                        (!curDeloserElement?.dispatchEvent(\n                            new TabsterMoveFocusEvent({\n                                by: \"deloser\",\n                                owner: curDeloserElement,\n                                next: el,\n                            })\n                        ) ||\n                            this._tabster.focusedElement.focus(el))\n                    ) {\n                        return;\n                    }\n                }\n            }\n\n            this._deactivate();\n\n            if (isManual) {\n                return;\n            }\n\n            this._isRestoringFocus = true;\n\n            // focusAvailable returns null when the default action is prevented by the application, false\n            // when nothing was focused and true when something was focused.\n            if ((await this._history.focusAvailable(null)) === false) {\n                await this._history.resetFocus(null);\n            }\n\n            this._isRestoringFocus = false;\n        };\n\n        if (force) {\n            restoreFocus();\n        } else {\n            this._restoreFocusTimer = this._win().setTimeout(restoreFocus, 100);\n        }\n    }\n\n    static getDeloser(\n        tabster: Types.TabsterCore,\n        element: HTMLElement\n    ): Types.Deloser | undefined {\n        let root: Types.Root | undefined;\n\n        for (\n            let e: HTMLElement | null = element;\n            e;\n            e = dom.getParentElement(e)\n        ) {\n            const tabsterOnElement = getTabsterOnElement(tabster, e);\n\n            if (tabsterOnElement) {\n                if (!root) {\n                    root = tabsterOnElement.root;\n                }\n\n                const deloser = tabsterOnElement.deloser;\n\n                if (deloser) {\n                    return deloser;\n                }\n            }\n        }\n\n        const deloserAPI = tabster.deloser && (tabster.deloser as DeloserAPI);\n\n        if (deloserAPI) {\n            if (deloserAPI._autoDeloserInstance) {\n                return deloserAPI._autoDeloserInstance;\n            }\n\n            const autoDeloserProps = deloserAPI._autoDeloser;\n\n            if (root && !deloserAPI._autoDeloserInstance && autoDeloserProps) {\n                const body = element.ownerDocument?.body;\n\n                if (body) {\n                    deloserAPI._autoDeloserInstance = new Deloser(\n                        tabster,\n                        body,\n                        (tabster.deloser as DeloserAPI)._onDeloserDispose,\n                        autoDeloserProps\n                    );\n                }\n            }\n\n            return deloserAPI._autoDeloserInstance;\n        }\n\n        return undefined;\n    }\n\n    private _onDeloserDispose = (deloser: Deloser) => {\n        this._history.removeDeloser(deloser);\n\n        if (deloser.isActive()) {\n            this._scheduleRestoreFocus();\n        }\n    };\n\n    static getHistory(instance: Types.DeloserAPI): DeloserHistory {\n        return (instance as DeloserAPI)._history;\n    }\n\n    static forceRestoreFocus(instance: Types.DeloserAPI): void {\n        (instance as DeloserAPI)._scheduleRestoreFocus(true);\n    }\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport * as Types from \"../Types\";\n\nexport abstract class Subscribable<\n    A,\n    B = undefined,\n> implements Types.Subscribable<A, B> {\n    protected _val: A | undefined;\n    private _callbacks: Types.SubscribableCallback<A, B>[] = [];\n\n    dispose(): void {\n        this._callbacks = [];\n        delete this._val;\n    }\n\n    subscribe(callback: Types.SubscribableCallback<A, B>): void {\n        const callbacks = this._callbacks;\n        const index = callbacks.indexOf(callback);\n\n        if (index < 0) {\n            callbacks.push(callback);\n        }\n    }\n\n    subscribeFirst(callback: Types.SubscribableCallback<A, B>): void {\n        const callbacks = this._callbacks;\n        const index = callbacks.indexOf(callback);\n\n        if (index >= 0) {\n            callbacks.splice(index, 1);\n        }\n\n        callbacks.unshift(callback);\n    }\n\n    unsubscribe(callback: Types.SubscribableCallback<A, B>): void {\n        const index = this._callbacks.indexOf(callback);\n\n        if (index >= 0) {\n            this._callbacks.splice(index, 1);\n        }\n    }\n\n    protected setVal(val: A, detail: B): void {\n        if (this._val === val) {\n            return;\n        }\n\n        this._val = val;\n\n        this._callCallbacks(val, detail);\n    }\n\n    protected getVal(): A | undefined {\n        return this._val;\n    }\n\n    protected trigger(val: A, detail: B): void {\n        this._callCallbacks(val, detail);\n    }\n\n    private _callCallbacks(val: A, detail: B): void {\n        this._callbacks.forEach((callback) => callback(val, detail));\n    }\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport {\n    DeloserAPI,\n    DeloserHistoryByRootBase,\n    DeloserItemBase,\n} from \"./Deloser\";\nimport { getTabsterOnElement } from \"./Instance\";\nimport { RootAPI } from \"./Root\";\nimport { Subscribable } from \"./State/Subscribable\";\nimport * as Types from \"./Types\";\nimport { ObservedElementAccessibilities } from \"./Consts\";\nimport {\n    getElementUId,\n    getInstanceContext,\n    getPromise,\n    getUId,\n    getWindowUId,\n    HTMLElementWithUID,\n} from \"./Utils\";\nimport { dom } from \"./DOMAPI\";\n\nconst _transactionTimeout = 1500;\nconst _pingTimeout = 3000;\n\nconst _targetIdUp = \"up\";\n\nconst CrossOriginTransactionTypes: Types.CrossOriginTransactionTypes = {\n    Bootstrap: 1,\n    FocusElement: 2,\n    State: 3,\n    GetElement: 4,\n    RestoreFocusInDeloser: 5,\n    Ping: 6,\n};\n\ninterface CrossOriginInstanceContext {\n    ignoreKeyboardNavigationStateUpdate: boolean;\n    focusOwner?: string;\n    focusOwnerTimestamp?: number;\n    deloserByUId: { [uid: string]: Types.Deloser };\n    origOutlineSetup?: (props?: Partial<Types.OutlineProps>) => void;\n}\n\ninterface KnownTargets {\n    [id: string]: {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        send: (payload: Types.CrossOriginTransactionData<any, any>) => void;\n        last?: number;\n    };\n}\n\nclass CrossOriginDeloserItem extends DeloserItemBase<CrossOriginDeloser> {\n    private _deloser: CrossOriginDeloser;\n    private _transactions: CrossOriginTransactions;\n\n    constructor(\n        tabster: Types.TabsterCore,\n        deloser: CrossOriginDeloser,\n        trasactions: CrossOriginTransactions\n    ) {\n        super();\n        this._deloser = deloser;\n        this._transactions = trasactions;\n    }\n\n    belongsTo(deloser: CrossOriginDeloser): boolean {\n        return deloser.deloserUId === this._deloser.deloserUId;\n    }\n\n    async focusAvailable(): Promise<boolean | null> {\n        const data: RestoreFocusInDeloserTransactionData = {\n            ...this._deloser,\n            reset: false,\n        };\n\n        return this._transactions\n            .beginTransaction(RestoreFocusInDeloserTransaction, data)\n            .then((value) => !!value);\n    }\n\n    async resetFocus(): Promise<boolean> {\n        const data: RestoreFocusInDeloserTransactionData = {\n            ...this._deloser,\n            reset: true,\n        };\n\n        return this._transactions\n            .beginTransaction(RestoreFocusInDeloserTransaction, data)\n            .then((value) => !!value);\n    }\n}\n\nclass CrossOriginDeloserHistoryByRoot extends DeloserHistoryByRootBase<\n    CrossOriginDeloser,\n    CrossOriginDeloserItem\n> {\n    private _transactions: CrossOriginTransactions;\n\n    constructor(\n        tabster: Types.TabsterCore,\n        rootUId: string,\n        transactions: CrossOriginTransactions\n    ) {\n        super(tabster, rootUId);\n        this._transactions = transactions;\n    }\n\n    unshift(deloser: CrossOriginDeloser): void {\n        let item: CrossOriginDeloserItem | undefined;\n\n        for (let i = 0; i < this._history.length; i++) {\n            if (this._history[i].belongsTo(deloser)) {\n                item = this._history[i];\n                this._history.splice(i, 1);\n                break;\n            }\n        }\n\n        if (!item) {\n            item = new CrossOriginDeloserItem(\n                this._tabster,\n                deloser,\n                this._transactions\n            );\n        }\n\n        this._history.unshift(item);\n\n        this._history.splice(10, this._history.length - 10);\n    }\n\n    async focusAvailable(): Promise<boolean | null> {\n        for (const i of this._history) {\n            if (await i.focusAvailable()) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    async resetFocus(): Promise<boolean> {\n        for (const i of this._history) {\n            if (await i.resetFocus()) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n}\n\nabstract class CrossOriginTransaction<I, O> {\n    abstract type: Types.CrossOriginTransactionType;\n    readonly id: string;\n    readonly beginData: I;\n    readonly timeout?: number;\n    protected tabster: Types.TabsterCore;\n    protected endData: O | undefined;\n    protected owner: Types.GetWindow;\n    protected ownerId: string;\n    protected sendUp: Types.CrossOriginTransactionSend | undefined;\n    private _promise: Promise<O>;\n    protected _resolve: ((endData?: O | PromiseLike<O>) => void) | undefined;\n    private _reject: ((reason: string) => void) | undefined;\n    private _knownTargets: KnownTargets;\n    private _sentTo: Types.CrossOriginSentTo;\n    protected targetId: string | undefined;\n    private _inProgress: { [id: string]: boolean } = {};\n    private _isDone = false;\n    private _isSelfResponding = false;\n    private _sentCount = 0;\n\n    constructor(\n        tabster: Types.TabsterCore,\n        getOwner: Types.GetWindow,\n        knownTargets: KnownTargets,\n        value: I,\n        timeout?: number,\n        sentTo?: Types.CrossOriginSentTo,\n        targetId?: string,\n        sendUp?: Types.CrossOriginTransactionSend\n    ) {\n        this.tabster = tabster;\n        this.owner = getOwner;\n        this.ownerId = getWindowUId(getOwner());\n        this.id = getUId(getOwner());\n        this.beginData = value;\n        this._knownTargets = knownTargets;\n        this._sentTo = sentTo || { [this.ownerId]: true };\n        this.targetId = targetId;\n        this.sendUp = sendUp;\n        this.timeout = timeout;\n        this._promise = new (getPromise(getOwner))<O>((resolve, reject) => {\n            this._resolve = resolve;\n            this._reject = reject;\n        });\n    }\n\n    protected getTargets(knownTargets: KnownTargets): KnownTargets | null {\n        return this.targetId === _targetIdUp\n            ? this.sendUp\n                ? { [_targetIdUp]: { send: this.sendUp } }\n                : null\n            : this.targetId\n              ? knownTargets[this.targetId]\n                  ? {\n                        [this.targetId]: {\n                            send: knownTargets[this.targetId].send,\n                        },\n                    }\n                  : null\n              : Object.keys(knownTargets).length === 0 && this.sendUp\n                ? { [_targetIdUp]: { send: this.sendUp } }\n                : Object.keys(knownTargets).length > 0\n                  ? knownTargets\n                  : null;\n    }\n\n    begin(\n        selfResponse?: (\n            data: Types.CrossOriginTransactionData<I, O>\n        ) => Promise<O | undefined>\n    ): Promise<O | undefined> {\n        const targets = this.getTargets(this._knownTargets);\n        const sentTo: Types.CrossOriginSentTo = { ...this._sentTo };\n\n        if (targets) {\n            for (const id of Object.keys(targets)) {\n                sentTo[id] = true;\n            }\n        }\n\n        const data: Types.CrossOriginTransactionData<I, O> = {\n            transaction: this.id,\n            type: this.type,\n            isResponse: false,\n            timestamp: Date.now(),\n            owner: this.ownerId,\n            sentto: sentTo,\n            timeout: this.timeout,\n            beginData: this.beginData,\n        };\n\n        if (this.targetId) {\n            data.target = this.targetId;\n        }\n\n        if (selfResponse) {\n            this._isSelfResponding = true;\n\n            selfResponse(data).then((value) => {\n                this._isSelfResponding = false;\n\n                if (value !== undefined) {\n                    if (!this.endData) {\n                        this.endData = value;\n                    }\n                }\n\n                if (this.endData || this._sentCount === 0) {\n                    this.end();\n                }\n            });\n        }\n\n        if (targets) {\n            for (const id of Object.keys(targets)) {\n                if (!(id in this._sentTo)) {\n                    this._send(targets[id].send, id, data);\n                }\n            }\n        }\n\n        if (this._sentCount === 0 && !this._isSelfResponding) {\n            this.end();\n        }\n\n        return this._promise;\n    }\n\n    private _send(\n        send: (data: Types.CrossOriginTransactionData<I, O>) => void,\n        targetId: string,\n        data: Types.CrossOriginTransactionData<I, O>\n    ) {\n        if (this._inProgress[targetId] === undefined) {\n            this._inProgress[targetId] = true;\n            this._sentCount++;\n            send(data);\n        }\n    }\n\n    end(error?: string): void {\n        if (this._isDone) {\n            return;\n        }\n\n        this._isDone = true;\n\n        if (this.endData === undefined && error) {\n            if (this._reject) {\n                this._reject(error);\n            }\n        } else if (this._resolve) {\n            this._resolve(this.endData);\n        }\n    }\n\n    onResponse(data: Types.CrossOriginTransactionData<I, O>): void {\n        const endData = data.endData;\n\n        if (endData !== undefined && !this.endData) {\n            this.endData = endData;\n        }\n\n        const inProgressId =\n            data.target === _targetIdUp ? _targetIdUp : data.owner;\n\n        if (this._inProgress[inProgressId]) {\n            this._inProgress[inProgressId] = false;\n            this._sentCount--;\n\n            if (\n                this.endData ||\n                (this._sentCount === 0 && !this._isSelfResponding)\n            ) {\n                this.end();\n            }\n        }\n    }\n}\n\ninterface CrossOriginTransactionClass<I, O> {\n    new (\n        tabster: Types.TabsterCore,\n        getOwner: Types.GetWindow,\n        knownTargets: KnownTargets,\n        value: I,\n        timeout?: number,\n        sentTo?: Types.CrossOriginSentTo,\n        targetId?: string,\n        sendUp?: Types.CrossOriginTransactionSend\n    ): CrossOriginTransaction<I, O>;\n    shouldForward?(\n        tabster: Types.TabsterCore,\n        data: Types.CrossOriginTransactionData<I, O>,\n        getOwner: Types.GetWindow,\n        ownerId: string\n    ): boolean;\n    makeResponse(\n        tabster: Types.TabsterCore,\n        data: Types.CrossOriginTransactionData<I, O>,\n        getOwner: Types.GetWindow,\n        ownerId: string,\n        transactions: CrossOriginTransactions,\n        forwardResult: Promise<O | undefined>,\n        isSelfResponse?: boolean\n    ): Promise<O>;\n    shouldSelfRespond?(\n        tabster: Types.TabsterCore,\n        data: I,\n        getOwner: Types.GetWindow,\n        ownerId: string\n    ): boolean;\n}\n\ninterface BootstrapTransactionContents {\n    isNavigatingWithKeyboard: boolean;\n}\n\nclass BootstrapTransaction extends CrossOriginTransaction<\n    undefined,\n    BootstrapTransactionContents\n> {\n    type = CrossOriginTransactionTypes.Bootstrap;\n\n    static shouldForward() {\n        return false;\n    }\n\n    static async makeResponse(\n        tabster: Types.TabsterCore\n    ): Promise<BootstrapTransactionContents> {\n        return {\n            isNavigatingWithKeyboard:\n                tabster.keyboardNavigation.isNavigatingWithKeyboard(),\n        };\n    }\n}\n\ninterface CrossOriginElementDataIn {\n    uid?: string;\n    id?: string;\n    rootId?: string;\n    ownerId?: string;\n    observedName?: string;\n    /**\n     * Optionally wait if the element is accessible or focusable before returning it\n     */\n    accessibility?: Types.ObservedElementAccessibility;\n}\n\ninterface FocusElementData extends CrossOriginElementDataIn {\n    noFocusedProgrammaticallyFlag?: boolean;\n    noAccessibleCheck?: boolean;\n}\n\nclass FocusElementTransaction extends CrossOriginTransaction<\n    FocusElementData,\n    boolean\n> {\n    type = CrossOriginTransactionTypes.FocusElement;\n\n    static shouldSelfRespond() {\n        return true;\n    }\n\n    static shouldForward(\n        tabster: Types.TabsterCore,\n        data: Types.CrossOriginTransactionData<FocusElementData, boolean>,\n        getOwner: Types.GetWindow\n    ): boolean {\n        const el = GetElementTransaction.findElement(\n            tabster,\n            getOwner,\n            data.beginData\n        );\n        return !el || !tabster.focusable.isFocusable(el);\n    }\n\n    static async makeResponse(\n        tabster: Types.TabsterCore,\n        data: Types.CrossOriginTransactionData<FocusElementData, boolean>,\n        getOwner: Types.GetWindow,\n        ownerId: string,\n        transactions: CrossOriginTransactions,\n        forwardResult: Promise<boolean | undefined>\n    ): Promise<boolean> {\n        const el = GetElementTransaction.findElement(\n            tabster,\n            getOwner,\n            data.beginData\n        );\n        return (\n            (!!el && tabster.focusedElement.focus(el, true)) ||\n            !!(await forwardResult)\n        );\n    }\n}\n\nconst CrossOriginStates: {\n    Focused: 1;\n    Blurred: 2;\n    Observed: 3;\n    DeadWindow: 4;\n    KeyboardNavigation: 5;\n    Outline: 6;\n} = {\n    Focused: 1,\n    Blurred: 2,\n    Observed: 3,\n    DeadWindow: 4,\n    KeyboardNavigation: 5,\n    Outline: 6,\n};\ntype CrossOriginState =\n    (typeof CrossOriginStates)[keyof typeof CrossOriginStates];\n\ninterface CrossOriginElementDataOut {\n    ownerUId: string;\n    uid?: string;\n    id?: string;\n    rootUId?: string;\n    deloserUId?: string;\n    observedName?: string;\n    observedDetails?: string;\n}\n\ninterface CrossOriginStateData extends CrossOriginElementDataOut {\n    state: CrossOriginState;\n    isFocusedProgrammatically?: boolean;\n    force?: boolean;\n    isNavigatingWithKeyboard?: boolean;\n    outline?: Partial<Types.OutlineProps>;\n}\n\nclass StateTransaction extends CrossOriginTransaction<\n    CrossOriginStateData,\n    true\n> {\n    type = CrossOriginTransactionTypes.State;\n\n    static shouldSelfRespond(\n        tabster: Types.TabsterCore,\n        data: CrossOriginStateData\n    ): boolean {\n        return (\n            data.state !== CrossOriginStates.DeadWindow &&\n            data.state !== CrossOriginStates.KeyboardNavigation\n        );\n    }\n\n    static async makeResponse(\n        tabster: Types.TabsterCore,\n        data: Types.CrossOriginTransactionData<CrossOriginStateData, true>,\n        getOwner: Types.GetWindow,\n        ownerId: string,\n        transactions: CrossOriginTransactions,\n        forwardResult: Promise<true | undefined>,\n        isSelfResponse?: boolean\n    ): Promise<true> {\n        const timestamp = data.timestamp;\n        const beginData = data.beginData;\n\n        if (timestamp && beginData) {\n            switch (beginData.state) {\n                case CrossOriginStates.Focused:\n                    return StateTransaction._makeFocusedResponse(\n                        tabster,\n                        timestamp,\n                        beginData,\n                        transactions,\n                        isSelfResponse\n                    );\n                case CrossOriginStates.Blurred:\n                    return StateTransaction._makeBlurredResponse(\n                        tabster,\n                        timestamp,\n                        beginData,\n                        transactions.ctx\n                    );\n                case CrossOriginStates.Observed:\n                    return StateTransaction._makeObservedResponse(\n                        tabster,\n                        beginData\n                    );\n                case CrossOriginStates.DeadWindow:\n                    return StateTransaction._makeDeadWindowResponse(\n                        tabster,\n                        beginData,\n                        transactions,\n                        forwardResult\n                    );\n                case CrossOriginStates.KeyboardNavigation:\n                    return StateTransaction._makeKeyboardNavigationResponse(\n                        tabster,\n                        transactions.ctx,\n                        beginData.isNavigatingWithKeyboard\n                    );\n                case CrossOriginStates.Outline:\n                    return StateTransaction._makeOutlineResponse(\n                        tabster,\n                        transactions.ctx,\n                        beginData.outline\n                    );\n            }\n        }\n\n        return true;\n    }\n\n    static createElement(\n        tabster: Types.TabsterCore,\n        beginData: CrossOriginElementDataOut\n    ): CrossOriginElement | null {\n        return beginData.uid\n            ? new CrossOriginElement(\n                  tabster,\n                  beginData.uid,\n                  beginData.ownerUId,\n                  beginData.id,\n                  beginData.rootUId,\n                  beginData.observedName,\n                  beginData.observedDetails\n              )\n            : null;\n    }\n\n    private static async _makeFocusedResponse(\n        tabster: Types.TabsterCore,\n        timestamp: number,\n        beginData: CrossOriginStateData,\n        transactions: CrossOriginTransactions,\n        isSelfResponse?: boolean\n    ): Promise<true> {\n        const element = StateTransaction.createElement(tabster, beginData);\n\n        if (beginData && beginData.ownerUId && element) {\n            transactions.ctx.focusOwner = beginData.ownerUId;\n            transactions.ctx.focusOwnerTimestamp = timestamp;\n\n            if (!isSelfResponse && beginData.rootUId && beginData.deloserUId) {\n                const deloserAPI = tabster.deloser;\n\n                if (deloserAPI) {\n                    const history = DeloserAPI.getHistory(deloserAPI);\n\n                    const deloser: CrossOriginDeloser = {\n                        ownerUId: beginData.ownerUId,\n                        deloserUId: beginData.deloserUId,\n                        rootUId: beginData.rootUId,\n                    };\n\n                    const historyItem = history.make(\n                        beginData.rootUId,\n                        () =>\n                            new CrossOriginDeloserHistoryByRoot(\n                                tabster,\n                                deloser.rootUId,\n                                transactions\n                            )\n                    );\n\n                    historyItem.unshift(deloser);\n                }\n            }\n\n            CrossOriginFocusedElementState.setVal(\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                tabster.crossOrigin!.focusedElement,\n                element,\n                {\n                    isFocusedProgrammatically:\n                        beginData.isFocusedProgrammatically,\n                }\n            );\n        }\n\n        return true;\n    }\n\n    private static async _makeBlurredResponse(\n        tabster: Types.TabsterCore,\n        timestamp: number,\n        beginData: CrossOriginStateData,\n        context: CrossOriginInstanceContext\n    ): Promise<true> {\n        if (\n            beginData &&\n            (beginData.ownerUId === context.focusOwner || beginData.force) &&\n            (!context.focusOwnerTimestamp ||\n                context.focusOwnerTimestamp < timestamp)\n        ) {\n            CrossOriginFocusedElementState.setVal(\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                tabster.crossOrigin!.focusedElement,\n                undefined,\n                {}\n            );\n        }\n\n        return true;\n    }\n\n    private static async _makeObservedResponse(\n        tabster: Types.TabsterCore,\n        beginData: CrossOriginStateData\n    ): Promise<true> {\n        const name = beginData.observedName;\n        const element = StateTransaction.createElement(tabster, beginData);\n\n        if (name && element) {\n            CrossOriginObservedElementState.trigger(\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                tabster.crossOrigin!.observedElement,\n                element,\n                { names: [name], details: beginData.observedDetails }\n            );\n        }\n\n        return true;\n    }\n\n    private static async _makeDeadWindowResponse(\n        tabster: Types.TabsterCore,\n        beginData: CrossOriginStateData,\n        transactions: CrossOriginTransactions,\n        forwardResult: Promise<true | undefined>\n    ): Promise<true> {\n        const deadUId = beginData && beginData.ownerUId;\n\n        if (deadUId) {\n            transactions.removeTarget(deadUId);\n        }\n\n        return forwardResult.then(() => {\n            if (deadUId === transactions.ctx.focusOwner) {\n                const deloserAPI = tabster.deloser;\n\n                if (deloserAPI) {\n                    DeloserAPI.forceRestoreFocus(deloserAPI);\n                }\n            }\n            return true;\n        });\n    }\n\n    private static async _makeKeyboardNavigationResponse(\n        tabster: Types.TabsterCore,\n        context: CrossOriginInstanceContext,\n        isNavigatingWithKeyboard?: boolean\n    ): Promise<true> {\n        if (\n            isNavigatingWithKeyboard !== undefined &&\n            tabster.keyboardNavigation.isNavigatingWithKeyboard() !==\n                isNavigatingWithKeyboard\n        ) {\n            context.ignoreKeyboardNavigationStateUpdate = true;\n            tabster.keyboardNavigation.setNavigatingWithKeyboard(\n                isNavigatingWithKeyboard\n            );\n            context.ignoreKeyboardNavigationStateUpdate = false;\n        }\n        return true;\n    }\n\n    private static async _makeOutlineResponse(\n        tabster: Types.TabsterCore,\n        context: CrossOriginInstanceContext,\n        props?: Partial<Types.OutlineProps>\n    ): Promise<true> {\n        if (context.origOutlineSetup) {\n            context.origOutlineSetup.call(\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                tabster.outline!,\n                props\n            );\n        }\n        return true;\n    }\n}\n\nclass GetElementTransaction extends CrossOriginTransaction<\n    CrossOriginElementDataIn | undefined,\n    CrossOriginElementDataOut\n> {\n    type = CrossOriginTransactionTypes.GetElement;\n\n    static shouldSelfRespond() {\n        return true;\n    }\n\n    static findElement(\n        tabster: Types.TabsterCore,\n        getOwner: Types.GetWindow,\n        data?: CrossOriginElementDataIn\n    ): HTMLElement | null {\n        let element: HTMLElement | null | undefined;\n\n        if (\n            data &&\n            (!data.ownerId || data.ownerId === getWindowUId(getOwner()))\n        ) {\n            if (data.id) {\n                element = dom.getElementById(getOwner().document, data.id);\n\n                if (element && data.rootId) {\n                    const ctx = RootAPI.getTabsterContext(tabster, element);\n\n                    if (!ctx || ctx.root.uid !== data.rootId) {\n                        return null;\n                    }\n                }\n            } else if (data.uid) {\n                const ref = getInstanceContext(getOwner).elementByUId[data.uid];\n                element = ref && ref.get();\n            } else if (data.observedName) {\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                element = tabster.observedElement!.getElement(\n                    data.observedName,\n                    data.accessibility\n                );\n            }\n        }\n\n        return element || null;\n    }\n\n    static getElementData(\n        tabster: Types.TabsterCore,\n        element: HTMLElement,\n        getOwner: Types.GetWindow,\n        context: CrossOriginInstanceContext,\n        ownerUId: string\n    ): CrossOriginElementDataOut {\n        const deloser = DeloserAPI.getDeloser(tabster, element);\n        const ctx = RootAPI.getTabsterContext(tabster, element);\n        const tabsterOnElement = getTabsterOnElement(tabster, element);\n        const observed = tabsterOnElement && tabsterOnElement.observed;\n\n        return {\n            uid: getElementUId(getOwner, element),\n            ownerUId,\n            id: element.id || undefined,\n            rootUId: ctx ? ctx.root.uid : undefined,\n            deloserUId: deloser\n                ? getDeloserUID(getOwner, context, deloser)\n                : undefined,\n            observedName: observed && observed.names && observed.names[0],\n            observedDetails: observed && observed.details,\n        };\n    }\n\n    static async makeResponse(\n        tabster: Types.TabsterCore,\n        data: Types.CrossOriginTransactionData<\n            CrossOriginElementDataIn | undefined,\n            CrossOriginElementDataOut\n        >,\n        getOwner: Types.GetWindow,\n        ownerUId: string,\n        transactions: CrossOriginTransactions,\n        forwardResult: Promise<CrossOriginElementDataOut | undefined>\n    ): Promise<CrossOriginElementDataOut | undefined> {\n        const beginData = data.beginData;\n        let element: HTMLElement | undefined;\n        let dataOut: CrossOriginElementDataOut | undefined;\n\n        if (beginData === undefined) {\n            element = tabster.focusedElement.getFocusedElement();\n        } else if (beginData) {\n            element =\n                GetElementTransaction.findElement(\n                    tabster,\n                    getOwner,\n                    beginData\n                ) || undefined;\n        }\n\n        if (!element && beginData) {\n            const name = beginData.observedName;\n            const timeout = data.timeout;\n            const accessibility = beginData.accessibility;\n\n            if (name && timeout) {\n                const e: {\n                    element?: HTMLElement | null;\n                    crossOrigin?: CrossOriginElementDataOut;\n                } = await new (getPromise(getOwner))((resolve) => {\n                    let isWaitElementResolved = false;\n                    let isForwardResolved = false;\n                    let isResolved = false;\n\n                    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                    tabster\n                        .observedElement!.waitElement(\n                            name,\n                            timeout,\n                            accessibility\n                        )\n                        .result.then((value) => {\n                            isWaitElementResolved = true;\n\n                            if (!isResolved && (value || isForwardResolved)) {\n                                isResolved = true;\n                                resolve({ element: value });\n                            }\n                        });\n\n                    forwardResult.then((value) => {\n                        isForwardResolved = true;\n\n                        if (!isResolved && (value || isWaitElementResolved)) {\n                            isResolved = true;\n                            resolve({ crossOrigin: value });\n                        }\n                    });\n                });\n\n                if (e.element) {\n                    element = e.element;\n                } else if (e.crossOrigin) {\n                    dataOut = e.crossOrigin;\n                }\n            }\n        }\n\n        return element\n            ? GetElementTransaction.getElementData(\n                  tabster,\n                  element,\n                  getOwner,\n                  transactions.ctx,\n                  ownerUId\n              )\n            : dataOut;\n    }\n}\n\ninterface CrossOriginDeloser {\n    ownerUId: string;\n    deloserUId: string;\n    rootUId: string;\n}\n\ninterface RestoreFocusInDeloserTransactionData extends CrossOriginDeloser {\n    reset: boolean;\n}\n\nclass RestoreFocusInDeloserTransaction extends CrossOriginTransaction<\n    RestoreFocusInDeloserTransactionData,\n    boolean\n> {\n    type = CrossOriginTransactionTypes.RestoreFocusInDeloser;\n\n    static async makeResponse(\n        tabster: Types.TabsterCore,\n        data: Types.CrossOriginTransactionData<\n            RestoreFocusInDeloserTransactionData,\n            boolean\n        >,\n        getOwner: Types.GetWindow,\n        ownerId: string,\n        transactions: CrossOriginTransactions,\n        forwardResult: Promise<boolean | undefined>\n    ): Promise<boolean | null> {\n        const forwardRet = await forwardResult;\n        const begin = !forwardRet && data.beginData;\n        const uid = begin && begin.deloserUId;\n        const deloser = uid && transactions.ctx.deloserByUId[uid];\n        const deloserAPI = tabster.deloser;\n\n        if (begin && deloser && deloserAPI) {\n            const history = DeloserAPI.getHistory(deloserAPI);\n            return begin.reset\n                ? history.resetFocus(deloser)\n                : history.focusAvailable(deloser);\n        }\n\n        return !!forwardRet;\n    }\n}\n\nclass PingTransaction extends CrossOriginTransaction<undefined, true> {\n    type = CrossOriginTransactionTypes.Ping;\n\n    static shouldForward() {\n        return false;\n    }\n\n    static async makeResponse(): Promise<true> {\n        return true;\n    }\n}\n\ninterface CrossOriginTransactionWrapper<I, O> {\n    transaction: CrossOriginTransaction<I, O>;\n    timer?: number;\n}\n\nclass CrossOriginTransactions {\n    private _owner: Types.GetWindow;\n    private _ownerUId: string;\n    private _knownTargets: KnownTargets = {};\n    private _transactions: {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        [id: string]: CrossOriginTransactionWrapper<any, any>;\n    } = {};\n    private _tabster: Types.TabsterCore;\n    private _pingTimer: number | undefined;\n    private _isDefaultSendUp = false;\n    private _deadPromise: Promise<true | undefined> | undefined;\n    isSetUp = false;\n    sendUp: Types.CrossOriginTransactionSend | undefined;\n    ctx: CrossOriginInstanceContext;\n\n    constructor(\n        tabster: Types.TabsterCore,\n        getOwner: Types.GetWindow,\n        context: CrossOriginInstanceContext\n    ) {\n        this._tabster = tabster;\n        this._owner = getOwner;\n        this._ownerUId = getWindowUId(getOwner());\n        this.ctx = context;\n    }\n\n    setup(\n        sendUp?: Types.CrossOriginTransactionSend | null\n    ): (msg: Types.CrossOriginMessage) => void {\n        if (this.isSetUp) {\n            if (__DEV__) {\n                console.error(\"CrossOrigin is already set up.\");\n            }\n        } else {\n            this.isSetUp = true;\n\n            this.setSendUp(sendUp);\n\n            this._owner().addEventListener(\"pagehide\", this._onPageHide);\n\n            this._ping();\n        }\n\n        return this._onMessage;\n    }\n\n    setSendUp(\n        sendUp?: Types.CrossOriginTransactionSend | null\n    ): (msg: Types.CrossOriginMessage) => void {\n        if (!this.isSetUp) {\n            throw new Error(\"CrossOrigin is not set up.\");\n        }\n\n        this.sendUp = sendUp || undefined;\n\n        const owner = this._owner();\n\n        if (sendUp === undefined) {\n            if (!this._isDefaultSendUp) {\n                if (owner.document) {\n                    this._isDefaultSendUp = true;\n\n                    if (\n                        owner.parent &&\n                        owner.parent !== owner &&\n                        owner.parent.postMessage\n                    ) {\n                        this.sendUp = (\n                            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                            data: Types.CrossOriginTransactionData<any, any>\n                        ) => {\n                            owner.parent.postMessage(JSON.stringify(data), \"*\");\n                        };\n                    }\n\n                    owner.addEventListener(\"message\", this._onBrowserMessage);\n                }\n            }\n        } else if (this._isDefaultSendUp) {\n            owner.removeEventListener(\"message\", this._onBrowserMessage);\n            this._isDefaultSendUp = false;\n        }\n\n        return this._onMessage;\n    }\n\n    async dispose(): Promise<void> {\n        const owner = this._owner();\n\n        if (this._pingTimer) {\n            owner.clearTimeout(this._pingTimer);\n            this._pingTimer = undefined;\n        }\n\n        owner.removeEventListener(\"message\", this._onBrowserMessage);\n        owner.removeEventListener(\"pagehide\", this._onPageHide);\n\n        await this._dead();\n\n        delete this._deadPromise;\n\n        for (const id of Object.keys(this._transactions)) {\n            const t = this._transactions[id];\n\n            if (t.timer) {\n                owner.clearTimeout(t.timer);\n                delete t.timer;\n            }\n\n            t.transaction.end();\n        }\n\n        this._knownTargets = {};\n\n        delete this.sendUp;\n    }\n\n    beginTransaction<I, O>(\n        Transaction: CrossOriginTransactionClass<I, O>,\n        value: I,\n        timeout?: number,\n        sentTo?: Types.CrossOriginSentTo,\n        targetId?: string,\n        withReject?: boolean\n    ): Promise<O | undefined> {\n        if (!this._owner) {\n            return getPromise(this._owner).reject();\n        }\n\n        const transaction = new Transaction(\n            this._tabster,\n            this._owner,\n            this._knownTargets,\n            value,\n            timeout,\n            sentTo,\n            targetId,\n            this.sendUp\n        );\n        let selfResponse:\n            | ((\n                  data: Types.CrossOriginTransactionData<I, O>\n              ) => Promise<O | undefined>)\n            | undefined;\n\n        if (\n            Transaction.shouldSelfRespond &&\n            Transaction.shouldSelfRespond(\n                this._tabster,\n                value,\n                this._owner,\n                this._ownerUId\n            )\n        ) {\n            selfResponse = (data: Types.CrossOriginTransactionData<I, O>) => {\n                return Transaction.makeResponse(\n                    this._tabster,\n                    data,\n                    this._owner,\n                    this._ownerUId,\n                    this,\n                    getPromise(this._owner).resolve(undefined),\n                    true\n                );\n            };\n        }\n\n        return this._beginTransaction(\n            transaction,\n            timeout,\n            selfResponse,\n            withReject\n        );\n    }\n\n    removeTarget(uid: string): void {\n        delete this._knownTargets[uid];\n    }\n\n    private _beginTransaction<I, O>(\n        transaction: CrossOriginTransaction<I, O>,\n        timeout?: number,\n        selfResponse?: (\n            data: Types.CrossOriginTransactionData<I, O>\n        ) => Promise<O | undefined>,\n        withReject?: boolean\n    ): Promise<O | undefined> {\n        const owner = this._owner();\n\n        const wrapper: CrossOriginTransactionWrapper<I, O> = {\n            transaction,\n            timer: owner.setTimeout(\n                () => {\n                    delete wrapper.timer;\n                    transaction.end(\"Cross origin transaction timed out.\");\n                },\n                _transactionTimeout + (timeout || 0)\n            ),\n        };\n\n        this._transactions[transaction.id] = wrapper;\n\n        const ret = transaction.begin(selfResponse);\n\n        ret.catch(() => {\n            /**/\n        }).finally(() => {\n            if (wrapper.timer) {\n                owner.clearTimeout(wrapper.timer);\n            }\n            delete this._transactions[transaction.id];\n        });\n\n        return ret.then(\n            (value) => value,\n            withReject ? undefined : () => undefined\n        );\n    }\n\n    forwardTransaction(\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        data: Types.CrossOriginTransactionData<any, any>\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ): Promise<any> {\n        const owner = this._owner;\n        let targetId = data.target;\n\n        if (targetId === this._ownerUId) {\n            return getPromise(owner).resolve();\n        }\n\n        const Transaction = this._getTransactionClass(data.type);\n\n        if (Transaction) {\n            if (\n                Transaction.shouldForward === undefined ||\n                Transaction.shouldForward(\n                    this._tabster,\n                    data,\n                    owner,\n                    this._ownerUId\n                )\n            ) {\n                const sentTo = data.sentto;\n\n                if (targetId === _targetIdUp) {\n                    targetId = undefined;\n                    sentTo[this._ownerUId] = true;\n                }\n\n                delete sentTo[_targetIdUp];\n\n                return this._beginTransaction(\n                    new Transaction(\n                        this._tabster,\n                        owner,\n                        this._knownTargets,\n                        data.beginData,\n                        data.timeout,\n                        sentTo,\n                        targetId,\n                        this.sendUp\n                    ),\n                    data.timeout\n                );\n            } else {\n                return getPromise(owner).resolve();\n            }\n        }\n\n        return getPromise(owner).reject(\n            `Unknown transaction type ${data.type}`\n        );\n    }\n\n    private _getTransactionClass(\n        type: Types.CrossOriginTransactionType\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ): CrossOriginTransactionClass<any, any> | null {\n        switch (type) {\n            case CrossOriginTransactionTypes.Bootstrap:\n                return BootstrapTransaction;\n            case CrossOriginTransactionTypes.FocusElement:\n                return FocusElementTransaction;\n            case CrossOriginTransactionTypes.State:\n                return StateTransaction;\n            case CrossOriginTransactionTypes.GetElement:\n                return GetElementTransaction;\n            case CrossOriginTransactionTypes.RestoreFocusInDeloser:\n                return RestoreFocusInDeloserTransaction;\n            case CrossOriginTransactionTypes.Ping:\n                return PingTransaction;\n            default:\n                return null;\n        }\n    }\n\n    private _onMessage = (e: Types.CrossOriginMessage) => {\n        if (e.data.owner === this._ownerUId || !this._tabster) {\n            return;\n        }\n\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const data: Types.CrossOriginTransactionData<any, any> = e.data;\n        let transactionId: string;\n\n        if (\n            !data ||\n            !(transactionId = data.transaction) ||\n            !data.type ||\n            !data.timestamp ||\n            !data.owner ||\n            !data.sentto\n        ) {\n            return;\n        }\n\n        let knownTarget = this._knownTargets[data.owner];\n\n        if (!knownTarget && e.send && data.owner !== this._ownerUId) {\n            knownTarget = this._knownTargets[data.owner] = { send: e.send };\n        }\n\n        if (knownTarget) {\n            knownTarget.last = Date.now();\n        }\n\n        if (data.isResponse) {\n            const t = this._transactions[transactionId];\n\n            if (t && t.transaction && t.transaction.type === data.type) {\n                t.transaction.onResponse(data);\n            }\n        } else {\n            const Transaction = this._getTransactionClass(data.type);\n\n            const forwardResult = this.forwardTransaction(data);\n\n            if (Transaction && e.send) {\n                Transaction.makeResponse(\n                    this._tabster,\n                    data,\n                    this._owner,\n                    this._ownerUId,\n                    this,\n                    forwardResult,\n                    false\n                ).then((r) => {\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    const response: Types.CrossOriginTransactionData<any, any> =\n                        {\n                            transaction: data.transaction,\n                            type: data.type,\n                            isResponse: true,\n                            timestamp: Date.now(),\n                            owner: this._ownerUId,\n                            timeout: data.timeout,\n                            sentto: {},\n                            target:\n                                data.target === _targetIdUp\n                                    ? _targetIdUp\n                                    : data.owner,\n                            endData: r,\n                        };\n\n                    e.send(response);\n                });\n            }\n        }\n    };\n\n    private _onPageHide = () => {\n        this._dead();\n    };\n\n    private async _dead(): Promise<void> {\n        if (!this._deadPromise && this.ctx.focusOwner === this._ownerUId) {\n            this._deadPromise = this.beginTransaction(StateTransaction, {\n                ownerUId: this._ownerUId,\n                state: CrossOriginStates.DeadWindow,\n            });\n        }\n\n        if (this._deadPromise) {\n            await this._deadPromise;\n        }\n    }\n\n    private async _ping(): Promise<void> {\n        if (this._pingTimer) {\n            return;\n        }\n\n        let deadWindows: { [key: string]: boolean } | undefined;\n        const now = Date.now();\n        const targets = Object.keys(this._knownTargets).filter(\n            (uid) => now - (this._knownTargets[uid].last || 0) > _pingTimeout\n        );\n\n        if (this.sendUp) {\n            targets.push(_targetIdUp);\n        }\n\n        if (targets.length) {\n            await getPromise(this._owner).all(\n                targets.map((uid) =>\n                    this.beginTransaction(\n                        PingTransaction,\n                        undefined,\n                        undefined,\n                        undefined,\n                        uid,\n                        true\n                    ).then(\n                        () => true,\n                        () => {\n                            if (uid !== _targetIdUp) {\n                                if (!deadWindows) {\n                                    deadWindows = {};\n                                }\n                                deadWindows[uid] = true;\n                                delete this._knownTargets[uid];\n                            }\n                            return false;\n                        }\n                    )\n                )\n            );\n        }\n\n        if (deadWindows) {\n            const focused = await this.beginTransaction(\n                GetElementTransaction,\n                undefined\n            );\n\n            if (\n                !focused &&\n                this.ctx.focusOwner &&\n                this.ctx.focusOwner in deadWindows\n            ) {\n                await this.beginTransaction(StateTransaction, {\n                    ownerUId: this._ownerUId,\n                    state: CrossOriginStates.Blurred,\n                    force: true,\n                });\n\n                const deloserAPI = this._tabster.deloser;\n\n                if (deloserAPI) {\n                    DeloserAPI.forceRestoreFocus(deloserAPI);\n                }\n            }\n        }\n\n        this._pingTimer = this._owner().setTimeout(() => {\n            this._pingTimer = undefined;\n            this._ping();\n        }, _pingTimeout);\n    }\n\n    private _onBrowserMessage = (e: MessageEvent) => {\n        if (e.source === this._owner()) {\n            return;\n        }\n\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const send = (data: Types.CrossOriginTransactionData<any, any>) => {\n            if (e.source && e.source.postMessage) {\n                (e.source.postMessage as Function)(JSON.stringify(data), \"*\");\n            }\n        };\n\n        try {\n            this._onMessage({\n                data: JSON.parse(e.data),\n                send,\n            });\n            // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        } catch (e) {\n            /* Ignore */\n        }\n    };\n}\n\nexport class CrossOriginElement implements Types.CrossOriginElement {\n    private _tabster: Types.TabsterCore;\n    readonly uid: string;\n    readonly ownerId: string;\n    readonly id?: string;\n    readonly rootId?: string;\n    readonly observedName?: string;\n    readonly observedDetails?: string;\n\n    constructor(\n        tabster: Types.TabsterCore,\n        uid: string,\n        ownerId: string,\n        id?: string,\n        rootId?: string,\n        observedName?: string,\n        observedDetails?: string\n    ) {\n        this._tabster = tabster;\n        this.uid = uid;\n        this.ownerId = ownerId;\n        this.id = id;\n        this.rootId = rootId;\n        this.observedName = observedName;\n        this.observedDetails = observedDetails;\n    }\n\n    focus(\n        noFocusedProgrammaticallyFlag?: boolean,\n        noAccessibleCheck?: boolean\n    ): Promise<boolean> {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        return this._tabster.crossOrigin!.focusedElement.focus(\n            this,\n            noFocusedProgrammaticallyFlag,\n            noAccessibleCheck\n        );\n    }\n}\n\nexport class CrossOriginFocusedElementState\n    extends Subscribable<\n        CrossOriginElement | undefined,\n        Types.FocusedElementDetail\n    >\n    implements Types.CrossOriginFocusedElementState\n{\n    private _transactions: CrossOriginTransactions;\n\n    constructor(transactions: CrossOriginTransactions) {\n        super();\n        this._transactions = transactions;\n    }\n\n    async focus(\n        element: Types.CrossOriginElement,\n        noFocusedProgrammaticallyFlag?: boolean,\n        noAccessibleCheck?: boolean\n    ): Promise<boolean> {\n        return this._focus(\n            {\n                uid: element.uid,\n                id: element.id,\n                rootId: element.rootId,\n                ownerId: element.ownerId,\n                observedName: element.observedName,\n            },\n            noFocusedProgrammaticallyFlag,\n            noAccessibleCheck\n        );\n    }\n\n    async focusById(\n        elementId: string,\n        rootId?: string,\n        noFocusedProgrammaticallyFlag?: boolean,\n        noAccessibleCheck?: boolean\n    ): Promise<boolean> {\n        return this._focus(\n            { id: elementId, rootId },\n            noFocusedProgrammaticallyFlag,\n            noAccessibleCheck\n        );\n    }\n\n    async focusByObservedName(\n        observedName: string,\n        timeout?: number,\n        rootId?: string,\n        noFocusedProgrammaticallyFlag?: boolean,\n        noAccessibleCheck?: boolean\n    ): Promise<boolean> {\n        return this._focus(\n            { observedName, rootId },\n            noFocusedProgrammaticallyFlag,\n            noAccessibleCheck,\n            timeout\n        );\n    }\n\n    private async _focus(\n        elementData: CrossOriginElementDataIn,\n        noFocusedProgrammaticallyFlag?: boolean,\n        noAccessibleCheck?: boolean,\n        timeout?: number\n    ): Promise<boolean> {\n        return this._transactions\n            .beginTransaction(\n                FocusElementTransaction,\n                {\n                    ...elementData,\n                    noFocusedProgrammaticallyFlag,\n                    noAccessibleCheck,\n                },\n                timeout\n            )\n            .then((value) => !!value);\n    }\n\n    static setVal(\n        instance: Types.CrossOriginFocusedElementState,\n        val: CrossOriginElement | undefined,\n        detail: Types.FocusedElementDetail\n    ): void {\n        (instance as CrossOriginFocusedElementState).setVal(val, detail);\n    }\n}\n\nexport class CrossOriginObservedElementState\n    extends Subscribable<CrossOriginElement, Types.ObservedElementProps>\n    implements Types.CrossOriginObservedElementState\n{\n    private _tabster: Types.TabsterCore;\n    private _transactions: CrossOriginTransactions;\n    private _lastRequestFocusId = 0;\n\n    constructor(\n        tabster: Types.TabsterCore,\n        transactions: CrossOriginTransactions\n    ) {\n        super();\n        this._tabster = tabster;\n        this._transactions = transactions;\n    }\n\n    async getElement(\n        observedName: string,\n        accessibility?: Types.ObservedElementAccessibility\n    ): Promise<CrossOriginElement | null> {\n        return this.waitElement(observedName, 0, accessibility);\n    }\n\n    async waitElement(\n        observedName: string,\n        timeout: number,\n        accessibility?: Types.ObservedElementAccessibility\n    ): Promise<CrossOriginElement | null> {\n        return this._transactions\n            .beginTransaction(\n                GetElementTransaction,\n                {\n                    observedName,\n                    accessibility,\n                },\n                timeout\n            )\n            .then((value) =>\n                value\n                    ? StateTransaction.createElement(this._tabster, value)\n                    : null\n            );\n    }\n\n    async requestFocus(\n        observedName: string,\n        timeout: number\n    ): Promise<boolean> {\n        const requestId = ++this._lastRequestFocusId;\n        return this.waitElement(\n            observedName,\n            timeout,\n            ObservedElementAccessibilities.Focusable\n        ).then((element) =>\n            this._lastRequestFocusId === requestId && element\n                ? // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                  this._tabster.crossOrigin!.focusedElement.focus(element, true)\n                : false\n        );\n    }\n\n    static trigger(\n        instance: Types.CrossOriginObservedElementState,\n        element: CrossOriginElement,\n        details: Types.ObservedElementProps\n    ): void {\n        (instance as CrossOriginObservedElementState).trigger(element, details);\n    }\n}\n\nexport class CrossOriginAPI implements Types.CrossOriginAPI {\n    private _tabster: Types.TabsterCore;\n    private _win: Types.GetWindow;\n    private _transactions: CrossOriginTransactions;\n    private _blurTimer: number | undefined;\n    private _ctx: CrossOriginInstanceContext;\n\n    focusedElement: Types.CrossOriginFocusedElementState;\n    observedElement: Types.CrossOriginObservedElementState;\n\n    constructor(tabster: Types.TabsterCore) {\n        this._tabster = tabster;\n        this._win = tabster.getWindow;\n        this._ctx = {\n            ignoreKeyboardNavigationStateUpdate: false,\n            deloserByUId: {},\n        };\n\n        this._transactions = new CrossOriginTransactions(\n            tabster,\n            this._win,\n            this._ctx\n        );\n        this.focusedElement = new CrossOriginFocusedElementState(\n            this._transactions\n        );\n        this.observedElement = new CrossOriginObservedElementState(\n            tabster,\n            this._transactions\n        );\n    }\n\n    setup(\n        sendUp?: Types.CrossOriginTransactionSend | null\n    ): (msg: Types.CrossOriginMessage) => void {\n        if (this.isSetUp()) {\n            return this._transactions.setSendUp(sendUp);\n        } else {\n            this._tabster.queueInit(this._init);\n            return this._transactions.setup(sendUp);\n        }\n    }\n\n    isSetUp(): boolean {\n        return this._transactions.isSetUp;\n    }\n\n    private _init = (): void => {\n        const tabster = this._tabster;\n\n        tabster.keyboardNavigation.subscribe(\n            this._onKeyboardNavigationStateChanged\n        );\n        tabster.focusedElement.subscribe(this._onFocus);\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        tabster.observedElement!.subscribe(this._onObserved);\n\n        if (!this._ctx.origOutlineSetup) {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this._ctx.origOutlineSetup = tabster.outline!.setup;\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            tabster.outline!.setup = this._outlineSetup;\n        }\n\n        this._transactions\n            .beginTransaction(\n                BootstrapTransaction,\n                undefined,\n                undefined,\n                undefined,\n                _targetIdUp\n            )\n            .then((data) => {\n                if (\n                    data &&\n                    this._tabster.keyboardNavigation.isNavigatingWithKeyboard() !==\n                        data.isNavigatingWithKeyboard\n                ) {\n                    this._ctx.ignoreKeyboardNavigationStateUpdate = true;\n                    this._tabster.keyboardNavigation.setNavigatingWithKeyboard(\n                        data.isNavigatingWithKeyboard\n                    );\n                    this._ctx.ignoreKeyboardNavigationStateUpdate = false;\n                }\n            });\n    };\n\n    dispose(): void {\n        const tabster = this._tabster;\n\n        tabster.keyboardNavigation.unsubscribe(\n            this._onKeyboardNavigationStateChanged\n        );\n        tabster.focusedElement.unsubscribe(this._onFocus);\n        tabster.observedElement?.unsubscribe(this._onObserved);\n\n        this._transactions.dispose();\n        this.focusedElement.dispose();\n        this.observedElement.dispose();\n\n        this._ctx.deloserByUId = {};\n    }\n\n    private _onKeyboardNavigationStateChanged = (value: boolean): void => {\n        if (!this._ctx.ignoreKeyboardNavigationStateUpdate) {\n            this._transactions.beginTransaction(StateTransaction, {\n                state: CrossOriginStates.KeyboardNavigation,\n                ownerUId: getWindowUId(this._win()),\n                isNavigatingWithKeyboard: value,\n            });\n        }\n    };\n\n    private _onFocus = (element: HTMLElementWithUID | undefined): void => {\n        const win = this._win();\n\n        const ownerUId = getWindowUId(win);\n\n        if (this._blurTimer) {\n            win.clearTimeout(this._blurTimer);\n            this._blurTimer = undefined;\n        }\n\n        if (element) {\n            this._transactions.beginTransaction(StateTransaction, {\n                ...GetElementTransaction.getElementData(\n                    this._tabster,\n                    element,\n                    this._win,\n                    this._ctx,\n                    ownerUId\n                ),\n                state: CrossOriginStates.Focused,\n            });\n        } else {\n            this._blurTimer = win.setTimeout(() => {\n                this._blurTimer = undefined;\n\n                if (this._ctx.focusOwner && this._ctx.focusOwner === ownerUId) {\n                    this._transactions\n                        .beginTransaction(GetElementTransaction, undefined)\n                        .then((value) => {\n                            if (!value && this._ctx.focusOwner === ownerUId) {\n                                this._transactions.beginTransaction(\n                                    StateTransaction,\n                                    {\n                                        ownerUId,\n                                        state: CrossOriginStates.Blurred,\n                                        force: false,\n                                    }\n                                );\n                            }\n                        });\n                }\n            }, 0);\n        }\n    };\n\n    private _onObserved = (\n        element: HTMLElement,\n        details: Types.ObservedElementProps\n    ): void => {\n        const d = GetElementTransaction.getElementData(\n            this._tabster,\n            element,\n            this._win,\n            this._ctx,\n            getWindowUId(this._win())\n        ) as CrossOriginStateData;\n\n        d.state = CrossOriginStates.Observed;\n        d.observedName = details.names?.[0];\n        d.observedDetails = details.details;\n\n        this._transactions.beginTransaction(StateTransaction, d);\n    };\n\n    private _outlineSetup = (props?: Partial<Types.OutlineProps>): void => {\n        this._transactions.beginTransaction(StateTransaction, {\n            state: CrossOriginStates.Outline,\n            ownerUId: getWindowUId(this._win()),\n            outline: props,\n        });\n    };\n}\n\nfunction getDeloserUID(\n    getWindow: Types.GetWindow,\n    context: CrossOriginInstanceContext,\n    deloser: Types.Deloser\n): string | undefined {\n    const deloserElement = deloser.getElement();\n\n    if (deloserElement) {\n        const uid = getElementUId(getWindow, deloserElement);\n\n        if (!context.deloserByUId[uid]) {\n            context.deloserByUId[uid] = deloser;\n        }\n\n        return uid;\n    }\n\n    return undefined;\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { getTabsterOnElement } from \"./Instance\";\nimport { RootAPI } from \"./Root\";\nimport * as Types from \"./Types\";\nimport { FOCUSABLE_SELECTOR } from \"./Consts\";\nimport {\n    createElementTreeWalker,\n    getDummyInputContainer,\n    getLastChild,\n    getRadioButtonGroup,\n    isDisplayNone,\n    isRadio,\n    matchesSelector,\n    shouldIgnoreFocus,\n} from \"./Utils\";\nimport { dom } from \"./DOMAPI\";\n\nexport class FocusableAPI implements Types.FocusableAPI {\n    private _tabster: Types.TabsterCore;\n\n    constructor(tabster: Types.TabsterCore) {\n        this._tabster = tabster;\n    }\n\n    dispose(): void {\n        /**/\n    }\n\n    getProps(element: HTMLElement): Types.FocusableProps {\n        const tabsterOnElement = getTabsterOnElement(this._tabster, element);\n        return (tabsterOnElement && tabsterOnElement.focusable) || {};\n    }\n\n    isFocusable(\n        el: HTMLElement,\n        includeProgrammaticallyFocusable?: boolean,\n        noVisibleCheck?: boolean,\n        noAccessibleCheck?: boolean\n    ): boolean {\n        if (\n            matchesSelector(el, FOCUSABLE_SELECTOR) &&\n            (includeProgrammaticallyFocusable || el.tabIndex !== -1)\n        ) {\n            return (\n                (noVisibleCheck || this.isVisible(el)) &&\n                (noAccessibleCheck || this.isAccessible(el))\n            );\n        }\n\n        return false;\n    }\n\n    isVisible(el: HTMLElement): boolean {\n        if (!el.ownerDocument || el.nodeType !== Node.ELEMENT_NODE) {\n            return false;\n        }\n\n        if (isDisplayNone(el)) {\n            return false;\n        }\n\n        const rect = el.ownerDocument.body.getBoundingClientRect();\n\n        if (rect.width === 0 && rect.height === 0) {\n            // This might happen, for example, if our <body> is in hidden <iframe>.\n            return false;\n        }\n\n        return true;\n    }\n\n    isAccessible(el: HTMLElement): boolean {\n        for (let e: HTMLElement | null = el; e; e = dom.getParentElement(e)) {\n            const tabsterOnElement = getTabsterOnElement(this._tabster, e);\n\n            if (this._isHidden(e)) {\n                return false;\n            }\n\n            const ignoreDisabled =\n                tabsterOnElement?.focusable?.ignoreAriaDisabled;\n\n            if (!ignoreDisabled && this._isDisabled(e)) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    private _isDisabled(el: HTMLElement): boolean {\n        return el.hasAttribute(\"disabled\");\n    }\n\n    private _isHidden(el: HTMLElement): boolean {\n        const attrVal = el.getAttribute(\"aria-hidden\");\n\n        if (attrVal && attrVal.toLowerCase() === \"true\") {\n            if (!this._tabster.modalizer?.isAugmented(el)) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    findFirst(\n        options: Types.FindFirstProps,\n        out?: Types.FindFocusableOutputProps\n    ): HTMLElement | null | undefined {\n        return this.findElement(\n            {\n                ...options,\n            },\n            out\n        );\n    }\n\n    findLast(\n        options: Types.FindFirstProps,\n        out?: Types.FindFocusableOutputProps\n    ): HTMLElement | null | undefined {\n        return this.findElement(\n            {\n                isBackward: true,\n                ...options,\n            },\n            out\n        );\n    }\n\n    findNext(\n        options: Types.FindNextProps,\n        out?: Types.FindFocusableOutputProps\n    ): HTMLElement | null | undefined {\n        return this.findElement({ ...options }, out);\n    }\n\n    findPrev(\n        options: Types.FindNextProps,\n        out?: Types.FindFocusableOutputProps\n    ): HTMLElement | null | undefined {\n        return this.findElement({ ...options, isBackward: true }, out);\n    }\n\n    findDefault(\n        options: Types.FindDefaultProps,\n        out?: Types.FindFocusableOutputProps\n    ): HTMLElement | null {\n        return (\n            this.findElement(\n                {\n                    ...options,\n                    acceptCondition: (el) =>\n                        this.isFocusable(\n                            el,\n                            options.includeProgrammaticallyFocusable\n                        ) && !!this.getProps(el).isDefault,\n                },\n                out\n            ) || null\n        );\n    }\n\n    findAll(options: Types.FindAllProps): HTMLElement[] {\n        return this._findElements(true, options) || [];\n    }\n\n    findElement(\n        options: Types.FindFocusableProps,\n        out?: Types.FindFocusableOutputProps\n    ): HTMLElement | null | undefined {\n        const found = this._findElements(false, options, out);\n        return found ? found[0] : found;\n    }\n\n    private _findElements(\n        isFindAll: boolean,\n        options: Types.FindFocusableProps,\n        out?: Types.FindFocusableOutputProps\n    ): HTMLElement[] | null | undefined {\n        const {\n            container,\n            currentElement = null,\n            includeProgrammaticallyFocusable,\n            useActiveModalizer,\n            ignoreAccessibility,\n            modalizerId,\n            isBackward,\n            onElement,\n        } = options;\n\n        if (!out) {\n            out = {};\n        }\n\n        const elements: HTMLElement[] = [];\n\n        let { acceptCondition } = options;\n        const hasCustomCondition = !!acceptCondition;\n\n        if (!container) {\n            return null;\n        }\n\n        if (!acceptCondition) {\n            acceptCondition = (el) =>\n                this.isFocusable(\n                    el,\n                    includeProgrammaticallyFocusable,\n                    false,\n                    ignoreAccessibility\n                );\n        }\n\n        const acceptElementState: Types.FocusableAcceptElementState = {\n            container,\n            modalizerUserId:\n                modalizerId === undefined && useActiveModalizer\n                    ? this._tabster.modalizer?.activeId\n                    : modalizerId ||\n                      RootAPI.getTabsterContext(this._tabster, container)\n                          ?.modalizer?.userId,\n            from: currentElement || container,\n            isBackward,\n            isFindAll,\n            acceptCondition,\n            hasCustomCondition,\n            includeProgrammaticallyFocusable,\n            ignoreAccessibility,\n            cachedGrouppers: {},\n            cachedRadioGroups: {},\n        };\n\n        const walker = createElementTreeWalker(\n            container.ownerDocument,\n            container,\n            (node) =>\n                this._acceptElement(node as HTMLElement, acceptElementState)\n        );\n\n        if (!walker) {\n            return null;\n        }\n\n        const prepareForNextElement = (\n            shouldContinueIfNotFound?: boolean\n        ): boolean => {\n            const foundElement =\n                acceptElementState.foundElement ??\n                acceptElementState.foundBackward;\n\n            if (foundElement) {\n                elements.push(foundElement);\n            }\n\n            if (isFindAll) {\n                if (foundElement) {\n                    acceptElementState.found = false;\n                    delete acceptElementState.foundElement;\n                    delete acceptElementState.foundBackward;\n                    delete acceptElementState.fromCtx;\n                    acceptElementState.from = foundElement;\n\n                    if (onElement && !onElement(foundElement)) {\n                        return false;\n                    }\n                }\n\n                return !!(foundElement || shouldContinueIfNotFound);\n            } else {\n                if (foundElement && out) {\n                    out.uncontrolled = RootAPI.getTabsterContext(\n                        this._tabster,\n                        foundElement\n                    )?.uncontrolled;\n                }\n\n                return !!(shouldContinueIfNotFound && !foundElement);\n            }\n        };\n\n        if (!currentElement) {\n            out.outOfDOMOrder = true;\n        }\n\n        if (currentElement && dom.nodeContains(container, currentElement)) {\n            walker.currentNode = currentElement;\n        } else if (isBackward) {\n            const lastChild = getLastChild(container);\n\n            if (!lastChild) {\n                return null;\n            }\n\n            if (\n                this._acceptElement(lastChild, acceptElementState) ===\n                    NodeFilter.FILTER_ACCEPT &&\n                !prepareForNextElement(true)\n            ) {\n                if (acceptElementState.skippedFocusable) {\n                    out.outOfDOMOrder = true;\n                }\n\n                return elements;\n            }\n\n            walker.currentNode = lastChild;\n        }\n\n        do {\n            if (isBackward) {\n                walker.previousNode();\n            } else {\n                walker.nextNode();\n            }\n        } while (prepareForNextElement());\n\n        if (acceptElementState.skippedFocusable) {\n            out.outOfDOMOrder = true;\n        }\n\n        return elements.length ? elements : null;\n    }\n\n    private _acceptElement(\n        element: HTMLElement,\n        state: Types.FocusableAcceptElementState\n    ): number {\n        if (state.found) {\n            return NodeFilter.FILTER_ACCEPT;\n        }\n\n        const foundBackward = state.foundBackward;\n\n        if (\n            foundBackward &&\n            (element === foundBackward ||\n                !dom.nodeContains(foundBackward, element))\n        ) {\n            state.found = true;\n            state.foundElement = foundBackward;\n            return NodeFilter.FILTER_ACCEPT;\n        }\n\n        const container = state.container;\n\n        if (element === container) {\n            return NodeFilter.FILTER_SKIP;\n        }\n\n        if (!dom.nodeContains(container, element)) {\n            return NodeFilter.FILTER_REJECT;\n        }\n\n        if (getDummyInputContainer(element)) {\n            return NodeFilter.FILTER_REJECT;\n        }\n\n        if (dom.nodeContains(state.rejectElementsFrom, element)) {\n            return NodeFilter.FILTER_REJECT;\n        }\n\n        const ctx = (state.currentCtx = RootAPI.getTabsterContext(\n            this._tabster,\n            element\n        ));\n\n        // Tabster is opt in, if it is not managed, don't try and get do anything special\n        if (!ctx) {\n            return NodeFilter.FILTER_SKIP;\n        }\n\n        if (shouldIgnoreFocus(element)) {\n            if (this.isFocusable(element, undefined, true, true)) {\n                state.skippedFocusable = true;\n            }\n\n            return NodeFilter.FILTER_SKIP;\n        }\n\n        // We assume iframes are focusable because native tab behaviour would tab inside.\n        // But we do it only during the standard search when there is no custom accept\n        // element condition.\n        if (\n            !state.hasCustomCondition &&\n            (element.tagName === \"IFRAME\" || element.tagName === \"WEBVIEW\")\n        ) {\n            if (\n                this.isVisible(element) &&\n                ctx.modalizer?.userId === this._tabster.modalizer?.activeId\n            ) {\n                state.found = true;\n                state.rejectElementsFrom = state.foundElement = element;\n\n                return NodeFilter.FILTER_ACCEPT;\n            } else {\n                return NodeFilter.FILTER_REJECT;\n            }\n        }\n\n        if (!state.ignoreAccessibility && !this.isAccessible(element)) {\n            if (this.isFocusable(element, false, true, true)) {\n                state.skippedFocusable = true;\n            }\n\n            return NodeFilter.FILTER_REJECT;\n        }\n\n        let result: number | undefined;\n\n        let fromCtx = state.fromCtx;\n\n        if (!fromCtx) {\n            fromCtx = state.fromCtx = RootAPI.getTabsterContext(\n                this._tabster,\n                state.from\n            );\n        }\n\n        const fromMover = fromCtx?.mover;\n        let groupper = ctx.groupper;\n        let mover = ctx.mover;\n\n        result = this._tabster.modalizer?.acceptElement(element, state);\n\n        if (result !== undefined) {\n            state.skippedFocusable = true;\n        }\n\n        if (result === undefined && (groupper || mover || fromMover)) {\n            const groupperElement = groupper?.getElement();\n            const fromMoverElement = fromMover?.getElement();\n            let moverElement = mover?.getElement();\n\n            if (\n                moverElement &&\n                dom.nodeContains(fromMoverElement, moverElement) &&\n                dom.nodeContains(container, fromMoverElement) &&\n                (!groupperElement ||\n                    !mover ||\n                    dom.nodeContains(fromMoverElement, groupperElement))\n            ) {\n                mover = fromMover;\n                moverElement = fromMoverElement;\n            }\n\n            if (groupperElement) {\n                if (\n                    groupperElement === container ||\n                    !dom.nodeContains(container, groupperElement)\n                ) {\n                    groupper = undefined;\n                } else if (!dom.nodeContains(groupperElement, element)) {\n                    // _acceptElement() callback is called during the tree walking.\n                    // Given the potentiality of virtual parents (driven by the custom getParent() function),\n                    // we need to make sure that the groupper from the current element's context is not,\n                    // portaling us out of the DOM order.\n                    return NodeFilter.FILTER_REJECT;\n                }\n            }\n\n            if (moverElement) {\n                if (!dom.nodeContains(container, moverElement)) {\n                    mover = undefined;\n                } else if (!dom.nodeContains(moverElement, element)) {\n                    // _acceptElement() callback is called during the tree walking.\n                    // Given the potentiality of virtual parents (driven by the custom getParent() function),\n                    // we need to make sure that the mover from the current element's context is not,\n                    // portaling us out of the DOM order.\n                    return NodeFilter.FILTER_REJECT;\n                }\n            }\n\n            if (groupper && mover) {\n                if (\n                    moverElement &&\n                    groupperElement &&\n                    !dom.nodeContains(groupperElement, moverElement)\n                ) {\n                    mover = undefined;\n                } else {\n                    groupper = undefined;\n                }\n            }\n\n            if (groupper) {\n                result = groupper.acceptElement(element, state);\n            }\n\n            if (mover) {\n                result = mover.acceptElement(element, state);\n            }\n        }\n\n        if (result === undefined) {\n            result = state.acceptCondition(element)\n                ? NodeFilter.FILTER_ACCEPT\n                : NodeFilter.FILTER_SKIP;\n\n            if (\n                result === NodeFilter.FILTER_SKIP &&\n                this.isFocusable(element, false, true, true)\n            ) {\n                state.skippedFocusable = true;\n            }\n        }\n\n        if (result === NodeFilter.FILTER_ACCEPT && !state.found) {\n            if (\n                !state.isFindAll &&\n                isRadio(element) &&\n                !(element as HTMLInputElement).checked\n            ) {\n                // We need to mimic the browser's behaviour to skip unchecked radio buttons.\n                const radioGroupName = (element as HTMLInputElement).name;\n                let radioGroup: Types.RadioButtonGroup | undefined =\n                    state.cachedRadioGroups[radioGroupName];\n\n                if (!radioGroup) {\n                    radioGroup = getRadioButtonGroup(element);\n\n                    if (radioGroup) {\n                        state.cachedRadioGroups[radioGroupName] = radioGroup;\n                    }\n                }\n\n                if (radioGroup?.checked && radioGroup.checked !== element) {\n                    // Currently found element is a radio button in a group that has another radio button checked.\n                    return NodeFilter.FILTER_SKIP;\n                }\n            }\n\n            if (state.isBackward) {\n                // When TreeWalker goes backwards, it visits the container first,\n                // then it goes inside. So, if the container is accepted, we remember it,\n                // but allowing the TreeWalker to check inside.\n                state.foundBackward = element;\n                result = NodeFilter.FILTER_SKIP;\n            } else {\n                state.found = true;\n                state.foundElement = element;\n            }\n        }\n\n        return result;\n    }\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nexport const Keys: {\n    Tab: \"Tab\";\n    Enter: \"Enter\";\n    Escape: \"Escape\";\n    Space: \" \";\n    PageUp: \"PageUp\";\n    PageDown: \"PageDown\";\n    End: \"End\";\n    Home: \"Home\";\n    ArrowLeft: \"ArrowLeft\";\n    ArrowUp: \"ArrowUp\";\n    ArrowRight: \"ArrowRight\";\n    ArrowDown: \"ArrowDown\";\n} = {\n    Tab: \"Tab\",\n    Enter: \"Enter\",\n    Escape: \"Escape\",\n    Space: \" \",\n    PageUp: \"PageUp\",\n    PageDown: \"PageDown\",\n    End: \"End\",\n    Home: \"Home\",\n    ArrowLeft: \"ArrowLeft\",\n    ArrowUp: \"ArrowUp\",\n    ArrowRight: \"ArrowRight\",\n    ArrowDown: \"ArrowDown\",\n};\n\nexport type Key = (typeof Keys)[keyof typeof Keys];\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport {\n    KEYBORG_FOCUSIN,\n    KEYBORG_FOCUSOUT,\n    KeyborgFocusInEvent,\n    KeyborgFocusOutEvent,\n    nativeFocus,\n} from \"keyborg\";\n\nimport { Keys } from \"../Keys\";\nimport { RootAPI } from \"../Root\";\nimport * as Types from \"../Types\";\nimport { AsyncFocusSources } from \"../Consts\";\nimport {\n    TabsterFocusInEvent,\n    TabsterFocusOutEvent,\n    TabsterMoveFocusEvent,\n} from \"../Events\";\nimport {\n    documentContains,\n    DummyInputManager,\n    getLastChild,\n    shouldIgnoreFocus,\n    WeakHTMLElement,\n} from \"../Utils\";\nimport { getTabsterOnElement } from \"../Instance\";\nimport { dom } from \"../DOMAPI\";\nimport { Subscribable } from \"./Subscribable\";\n\nfunction getUncontrolledCompletelyContainer(\n    tabster: Types.TabsterCore,\n    element: HTMLElement\n): HTMLElement | undefined {\n    const getParent = tabster.getParent;\n    let el: HTMLElement | null = element;\n\n    do {\n        const uncontrolledOnElement = getTabsterOnElement(\n            tabster,\n            el\n        )?.uncontrolled;\n\n        if (\n            uncontrolledOnElement &&\n            tabster.uncontrolled.isUncontrolledCompletely(\n                el,\n                !!uncontrolledOnElement.completely\n            )\n        ) {\n            return el;\n        }\n\n        el = getParent(el) as HTMLElement | null;\n    } while (el);\n\n    return undefined;\n}\n\nconst AsyncFocusIntentPriorityBySource = {\n    [AsyncFocusSources.Restorer]: 0,\n    [AsyncFocusSources.Deloser]: 1,\n    [AsyncFocusSources.EscapeGroupper]: 2,\n};\n\ninterface AsyncFocus {\n    source: Types.AsyncFocusSource;\n    callback: () => void;\n    timeout: number;\n}\n\nexport class FocusedElementState\n    extends Subscribable<HTMLElement | undefined, Types.FocusedElementDetail>\n    implements Types.FocusedElementState\n{\n    private static _lastResetElement: WeakHTMLElement | undefined;\n    private static _isTabbingTimer: number | undefined;\n    static isTabbing = false;\n\n    private _tabster: Types.TabsterCore;\n    private _win: Types.GetWindow;\n    private _nextVal:\n        | {\n              element: WeakHTMLElement | undefined;\n              detail: Types.FocusedElementDetail;\n          }\n        | undefined;\n    private _lastVal: WeakHTMLElement | undefined;\n    private _asyncFocus?: AsyncFocus;\n\n    constructor(tabster: Types.TabsterCore, getWindow: Types.GetWindow) {\n        super();\n\n        this._tabster = tabster;\n        this._win = getWindow;\n        tabster.queueInit(this._init);\n    }\n\n    private _init = (): void => {\n        const win = this._win();\n        const doc = win.document;\n\n        // Add these event listeners as capture - we want Tabster to run before user event handlers\n        doc.addEventListener(KEYBORG_FOCUSIN, this._onFocusIn, true);\n        doc.addEventListener(KEYBORG_FOCUSOUT, this._onFocusOut, true);\n        win.addEventListener(\"keydown\", this._onKeyDown, true);\n\n        const activeElement = dom.getActiveElement(doc);\n\n        if (activeElement && activeElement !== doc.body) {\n            this._setFocusedElement(activeElement as HTMLElement);\n        }\n\n        this.subscribe(this._onChanged);\n    };\n\n    dispose(): void {\n        super.dispose();\n\n        const win = this._win();\n        const doc = win.document;\n\n        doc.removeEventListener(KEYBORG_FOCUSIN, this._onFocusIn, true);\n        doc.removeEventListener(KEYBORG_FOCUSOUT, this._onFocusOut, true);\n        win.removeEventListener(\"keydown\", this._onKeyDown, true);\n\n        this.unsubscribe(this._onChanged);\n\n        const asyncFocus = this._asyncFocus;\n        if (asyncFocus) {\n            win.clearTimeout(asyncFocus.timeout);\n            delete this._asyncFocus;\n        }\n\n        delete FocusedElementState._lastResetElement;\n\n        delete this._nextVal;\n        delete this._lastVal;\n    }\n\n    static forgetMemorized(\n        instance: Types.FocusedElementState,\n        parent: HTMLElement\n    ): void {\n        let wel = FocusedElementState._lastResetElement;\n        let el = wel && wel.get();\n        if (el && dom.nodeContains(parent, el)) {\n            delete FocusedElementState._lastResetElement;\n        }\n\n        el = (instance as FocusedElementState)._nextVal?.element?.get();\n        if (el && dom.nodeContains(parent, el)) {\n            delete (instance as FocusedElementState)._nextVal;\n        }\n\n        wel = (instance as FocusedElementState)._lastVal;\n        el = wel && wel.get();\n        if (el && dom.nodeContains(parent, el)) {\n            delete (instance as FocusedElementState)._lastVal;\n        }\n    }\n\n    getFocusedElement(): HTMLElement | undefined {\n        return this.getVal();\n    }\n\n    getLastFocusedElement(): HTMLElement | undefined {\n        let el = this._lastVal?.get();\n\n        if (!el || (el && !documentContains(el.ownerDocument, el))) {\n            this._lastVal = el = undefined;\n        }\n\n        return el;\n    }\n\n    focus(\n        element: HTMLElement,\n        noFocusedProgrammaticallyFlag?: boolean,\n        noAccessibleCheck?: boolean,\n        preventScroll?: boolean\n    ): boolean {\n        if (\n            !this._tabster.focusable.isFocusable(\n                element,\n                noFocusedProgrammaticallyFlag,\n                false,\n                noAccessibleCheck\n            )\n        ) {\n            return false;\n        }\n\n        element.focus({ preventScroll });\n\n        return true;\n    }\n\n    focusDefault(container: HTMLElement): boolean {\n        const el = this._tabster.focusable.findDefault({ container });\n\n        if (el) {\n            this._tabster.focusedElement.focus(el);\n\n            return true;\n        }\n\n        return false;\n    }\n\n    getFirstOrLastTabbable(\n        isFirst: boolean,\n        props: Pick<\n            Types.FindFocusableProps,\n            \"container\" | \"ignoreAccessibility\"\n        >\n    ): HTMLElement | undefined {\n        const { container, ignoreAccessibility } = props;\n        let toFocus: HTMLElement | null | undefined;\n\n        if (container) {\n            const ctx = RootAPI.getTabsterContext(this._tabster, container);\n\n            if (ctx) {\n                toFocus = FocusedElementState.findNextTabbable(\n                    this._tabster,\n                    ctx,\n                    container,\n                    undefined,\n                    undefined,\n                    !isFirst,\n                    ignoreAccessibility\n                )?.element;\n            }\n        }\n\n        if (toFocus && !dom.nodeContains(container, toFocus)) {\n            toFocus = undefined;\n        }\n\n        return toFocus || undefined;\n    }\n\n    private _focusFirstOrLast(\n        isFirst: boolean,\n        props: Types.FindFirstProps\n    ): boolean {\n        const toFocus = this.getFirstOrLastTabbable(isFirst, props);\n\n        if (toFocus) {\n            this.focus(toFocus, false, true);\n\n            return true;\n        }\n\n        return false;\n    }\n\n    focusFirst(props: Types.FindFirstProps): boolean {\n        return this._focusFirstOrLast(true, props);\n    }\n\n    focusLast(props: Types.FindFirstProps): boolean {\n        return this._focusFirstOrLast(false, props);\n    }\n\n    resetFocus(container: HTMLElement): boolean {\n        if (!this._tabster.focusable.isVisible(container)) {\n            return false;\n        }\n\n        if (!this._tabster.focusable.isFocusable(container, true, true, true)) {\n            const prevTabIndex = container.getAttribute(\"tabindex\");\n            const prevAriaHidden = container.getAttribute(\"aria-hidden\");\n\n            container.tabIndex = -1;\n            container.setAttribute(\"aria-hidden\", \"true\");\n\n            FocusedElementState._lastResetElement = new WeakHTMLElement(\n                this._win,\n                container\n            );\n\n            this.focus(container, true, true);\n\n            this._setOrRemoveAttribute(container, \"tabindex\", prevTabIndex);\n            this._setOrRemoveAttribute(\n                container,\n                \"aria-hidden\",\n                prevAriaHidden\n            );\n        } else {\n            this.focus(container);\n        }\n\n        return true;\n    }\n\n    requestAsyncFocus(\n        source: Types.AsyncFocusSource,\n        callback: () => void,\n        delay: number\n    ): void {\n        const win = this._tabster.getWindow();\n        const currentAsyncFocus = this._asyncFocus;\n\n        if (currentAsyncFocus) {\n            if (\n                AsyncFocusIntentPriorityBySource[source] >\n                AsyncFocusIntentPriorityBySource[currentAsyncFocus.source]\n            ) {\n                // Previously registered intent has higher priority.\n                return;\n            }\n\n            // New intent has higher priority.\n            win.clearTimeout(currentAsyncFocus.timeout);\n        }\n\n        this._asyncFocus = {\n            source,\n            callback,\n            timeout: win.setTimeout(() => {\n                this._asyncFocus = undefined;\n                callback();\n            }, delay),\n        };\n    }\n\n    cancelAsyncFocus(source: Types.AsyncFocusSource): void {\n        const asyncFocus = this._asyncFocus;\n\n        if (asyncFocus?.source === source) {\n            this._tabster.getWindow().clearTimeout(asyncFocus.timeout);\n            this._asyncFocus = undefined;\n        }\n    }\n\n    private _setOrRemoveAttribute(\n        element: HTMLElement,\n        name: string,\n        value: string | null\n    ): void {\n        if (value === null) {\n            element.removeAttribute(name);\n        } else {\n            element.setAttribute(name, value);\n        }\n    }\n\n    private _setFocusedElement(\n        element?: HTMLElement,\n        relatedTarget?: HTMLElement,\n        isFocusedProgrammatically?: boolean\n    ): void {\n        if (this._tabster._noop) {\n            return;\n        }\n\n        const detail: Types.FocusedElementDetail = { relatedTarget };\n\n        if (element) {\n            const lastResetElement =\n                FocusedElementState._lastResetElement?.get();\n            FocusedElementState._lastResetElement = undefined;\n\n            if (lastResetElement === element || shouldIgnoreFocus(element)) {\n                return;\n            }\n\n            detail.isFocusedProgrammatically = isFocusedProgrammatically;\n\n            const ctx = RootAPI.getTabsterContext(this._tabster, element);\n\n            const modalizerId = ctx?.modalizer?.userId;\n\n            if (modalizerId) {\n                detail.modalizerId = modalizerId;\n            }\n        }\n\n        const nextVal = (this._nextVal = {\n            element: element\n                ? new WeakHTMLElement(this._win, element)\n                : undefined,\n            detail,\n        });\n\n        if (element && element !== this._val) {\n            this._validateFocusedElement(element);\n        }\n\n        // _validateFocusedElement() might cause the refocus which will trigger\n        // another call to this function. Making sure that the value is correct.\n        if (this._nextVal === nextVal) {\n            this.setVal(element, detail);\n        }\n\n        this._nextVal = undefined;\n    }\n\n    protected setVal(\n        val: HTMLElement | undefined,\n        detail: Types.FocusedElementDetail\n    ): void {\n        super.setVal(val, detail);\n\n        if (val) {\n            this._lastVal = new WeakHTMLElement(this._win, val);\n        }\n    }\n\n    private _onFocusIn = (e: KeyborgFocusInEvent): void => {\n        const target = e.composedPath()[0] as HTMLElement;\n\n        if (target) {\n            this._setFocusedElement(\n                target,\n                e.detail.relatedTarget as HTMLElement | undefined,\n                e.detail.isFocusedProgrammatically\n            );\n        }\n    };\n\n    private _onFocusOut = (e: KeyborgFocusOutEvent): void => {\n        this._setFocusedElement(\n            undefined,\n            e.detail?.originalEvent.relatedTarget as HTMLElement | undefined\n        );\n    };\n\n    static findNextTabbable(\n        tabster: Types.TabsterCore,\n        ctx: Types.TabsterContext,\n        container?: HTMLElement,\n        currentElement?: HTMLElement,\n        referenceElement?: HTMLElement,\n        isBackward?: boolean,\n        ignoreAccessibility?: boolean\n    ): Types.NextTabbable | null {\n        const actualContainer = container || ctx.root.getElement();\n\n        if (!actualContainer) {\n            return null;\n        }\n\n        let next: Types.NextTabbable | null = null;\n\n        const isTabbingTimer = FocusedElementState._isTabbingTimer;\n        const win = tabster.getWindow();\n\n        if (isTabbingTimer) {\n            win.clearTimeout(isTabbingTimer);\n        }\n\n        FocusedElementState.isTabbing = true;\n        FocusedElementState._isTabbingTimer = win.setTimeout(() => {\n            delete FocusedElementState._isTabbingTimer;\n            FocusedElementState.isTabbing = false;\n        }, 0);\n\n        const modalizer = ctx.modalizer;\n        const groupper = ctx.groupper;\n        const mover = ctx.mover;\n\n        const callFindNext = (\n            what: Types.Groupper | Types.Mover | Types.Modalizer\n        ) => {\n            next = what.findNextTabbable(\n                currentElement,\n                referenceElement,\n                isBackward,\n                ignoreAccessibility\n            );\n\n            if (currentElement && !next?.element) {\n                const parentElement =\n                    what !== modalizer &&\n                    dom.getParentElement(what.getElement());\n\n                if (parentElement) {\n                    const parentCtx = RootAPI.getTabsterContext(\n                        tabster,\n                        currentElement,\n                        { referenceElement: parentElement }\n                    );\n\n                    if (parentCtx) {\n                        const currentScopeElement = what.getElement();\n                        const newCurrent = isBackward\n                            ? currentScopeElement\n                            : (currentScopeElement &&\n                                  getLastChild(currentScopeElement)) ||\n                              currentScopeElement;\n\n                        if (newCurrent) {\n                            next = FocusedElementState.findNextTabbable(\n                                tabster,\n                                parentCtx,\n                                container,\n                                newCurrent,\n                                parentElement,\n                                isBackward,\n                                ignoreAccessibility\n                            );\n\n                            if (next) {\n                                next.outOfDOMOrder = true;\n                            }\n                        }\n                    }\n                }\n            }\n        };\n\n        if (groupper && mover) {\n            callFindNext(ctx.groupperBeforeMover ? groupper : mover);\n        } else if (groupper) {\n            callFindNext(groupper);\n        } else if (mover) {\n            callFindNext(mover);\n        } else if (modalizer) {\n            callFindNext(modalizer);\n        } else {\n            const findProps: Types.FindNextProps = {\n                container: actualContainer,\n                currentElement,\n                referenceElement,\n                ignoreAccessibility,\n                useActiveModalizer: true,\n            };\n\n            const findPropsOut: Types.FindFocusableOutputProps = {};\n\n            const nextElement = tabster.focusable[\n                isBackward ? \"findPrev\" : \"findNext\"\n            ](findProps, findPropsOut);\n\n            next = {\n                element: nextElement,\n                outOfDOMOrder: findPropsOut.outOfDOMOrder,\n                uncontrolled: findPropsOut.uncontrolled,\n            };\n        }\n\n        return next;\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    private _validateFocusedElement = (element: HTMLElement): void => {\n        // TODO: Make sure this is not needed anymore and write tests.\n    };\n\n    private _onKeyDown = (event: KeyboardEvent): void => {\n        if (event.key !== Keys.Tab || event.ctrlKey) {\n            return;\n        }\n\n        const currentElement = this.getVal();\n\n        if (\n            !currentElement ||\n            !currentElement.ownerDocument ||\n            currentElement.contentEditable === \"true\"\n        ) {\n            return;\n        }\n\n        const tabster = this._tabster;\n        const controlTab = tabster.controlTab;\n        const ctx = RootAPI.getTabsterContext(tabster, currentElement);\n\n        if (!ctx || ctx.ignoreKeydown(event)) {\n            return;\n        }\n\n        const isBackward = event.shiftKey;\n\n        const next = FocusedElementState.findNextTabbable(\n            tabster,\n            ctx,\n            undefined,\n            currentElement,\n            undefined,\n            isBackward,\n            true\n        );\n\n        const rootElement = ctx.root.getElement();\n\n        if (!rootElement) {\n            return;\n        }\n\n        const nextElement = next?.element;\n        const uncontrolledCompletelyContainer =\n            getUncontrolledCompletelyContainer(tabster, currentElement);\n\n        if (nextElement) {\n            const nextUncontrolled = next.uncontrolled;\n\n            if (\n                ctx.uncontrolled ||\n                dom.nodeContains(nextUncontrolled, currentElement)\n            ) {\n                if (\n                    (!next.outOfDOMOrder &&\n                        nextUncontrolled === ctx.uncontrolled) ||\n                    (uncontrolledCompletelyContainer &&\n                        !dom.nodeContains(\n                            uncontrolledCompletelyContainer,\n                            nextElement\n                        ))\n                ) {\n                    // Nothing to do, everything will be done by the browser or something\n                    // that controls the uncontrolled area.\n                    return;\n                }\n\n                // We are in uncontrolled area. We allow whatever controls it to move\n                // focus, but we add a phantom dummy to make sure the focus is moved\n                // to the correct place if the uncontrolled area allows default action.\n                // We only need that in the controlled mode, because in uncontrolled\n                // mode we have dummy inputs around everything that redirects focus.\n                DummyInputManager.addPhantomDummyWithTarget(\n                    tabster,\n                    currentElement,\n                    isBackward,\n                    nextElement\n                );\n\n                return;\n            }\n\n            if (\n                (nextUncontrolled &&\n                    tabster.focusable.isVisible(nextUncontrolled)) ||\n                (nextElement.tagName === \"IFRAME\" &&\n                    tabster.focusable.isVisible(nextElement))\n            ) {\n                // For iframes and uncontrolled areas we always want to use default action to\n                // move focus into.\n                if (\n                    rootElement.dispatchEvent(\n                        new TabsterMoveFocusEvent({\n                            by: \"root\",\n                            owner: rootElement,\n                            next: nextElement,\n                            relatedEvent: event,\n                        })\n                    )\n                ) {\n                    DummyInputManager.moveWithPhantomDummy(\n                        tabster,\n                        nextUncontrolled ?? nextElement,\n                        false,\n                        isBackward,\n                        event\n                    );\n                }\n\n                return;\n            }\n\n            if (controlTab || next?.outOfDOMOrder) {\n                if (\n                    rootElement.dispatchEvent(\n                        new TabsterMoveFocusEvent({\n                            by: \"root\",\n                            owner: rootElement,\n                            next: nextElement,\n                            relatedEvent: event,\n                        })\n                    )\n                ) {\n                    event.preventDefault();\n                    event.stopImmediatePropagation();\n\n                    nativeFocus(nextElement);\n                }\n            } else {\n                // We are in uncontrolled mode and the next element is in DOM order.\n                // Just allow the default action.\n            }\n        } else {\n            if (\n                !uncontrolledCompletelyContainer &&\n                rootElement.dispatchEvent(\n                    new TabsterMoveFocusEvent({\n                        by: \"root\",\n                        owner: rootElement,\n                        next: null,\n                        relatedEvent: event,\n                    })\n                )\n            ) {\n                ctx.root.moveOutWithDefaultAction(isBackward, event);\n            }\n        }\n    };\n\n    _onChanged = (\n        element: HTMLElement | undefined,\n        detail: Types.FocusedElementDetail\n    ): void => {\n        if (element) {\n            element.dispatchEvent(new TabsterFocusInEvent(detail));\n        } else {\n            const last = this._lastVal?.get();\n\n            if (last) {\n                const d = { ...detail };\n                const lastCtx = RootAPI.getTabsterContext(this._tabster, last);\n                const modalizerId = lastCtx?.modalizer?.userId;\n\n                if (modalizerId) {\n                    d.modalizerId = modalizerId;\n                }\n\n                last.dispatchEvent(new TabsterFocusOutEvent(d));\n            }\n        }\n    };\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { nativeFocus } from \"keyborg\";\n\nimport { getTabsterOnElement } from \"./Instance\";\nimport { Keys } from \"./Keys\";\nimport { RootAPI } from \"./Root\";\nimport * as Types from \"./Types\";\nimport {\n    AsyncFocusSources,\n    GroupperMoveFocusActions,\n    GroupperTabbabilities,\n} from \"./Consts\";\nimport {\n    GroupperMoveFocusEvent,\n    GroupperMoveFocusEventName,\n    TabsterMoveFocusEvent,\n} from \"./Events\";\nimport { FocusedElementState } from \"./State/FocusedElement\";\nimport {\n    DummyInput,\n    DummyInputManager,\n    DummyInputManagerPriorities,\n    getAdjacentElement,\n    getDummyInputContainer,\n    TabsterPart,\n    WeakHTMLElement,\n} from \"./Utils\";\nimport { dom } from \"./DOMAPI\";\n\nclass GroupperDummyManager extends DummyInputManager {\n    constructor(\n        element: WeakHTMLElement,\n        groupper: Groupper,\n        tabster: Types.TabsterCore,\n        sys: Types.SysProps | undefined\n    ) {\n        super(\n            tabster,\n            element,\n            DummyInputManagerPriorities.Groupper,\n            sys,\n            true\n        );\n\n        this._setHandlers(\n            (\n                dummyInput: DummyInput,\n                isBackward: boolean,\n                relatedTarget: HTMLElement | null\n            ) => {\n                const container = element.get();\n                const input = dummyInput.input;\n\n                if (container && input) {\n                    const ctx = RootAPI.getTabsterContext(tabster, input);\n\n                    if (ctx) {\n                        let next: HTMLElement | null | undefined;\n\n                        next = groupper.findNextTabbable(\n                            relatedTarget || undefined,\n                            undefined,\n                            isBackward,\n                            true\n                        )?.element;\n\n                        if (!next) {\n                            next = FocusedElementState.findNextTabbable(\n                                tabster,\n                                ctx,\n                                undefined,\n                                dummyInput.isOutside\n                                    ? input\n                                    : getAdjacentElement(\n                                          container,\n                                          !isBackward\n                                      ),\n                                undefined,\n                                isBackward,\n                                true\n                            )?.element;\n                        }\n\n                        if (next) {\n                            nativeFocus(next);\n                        }\n                    }\n                }\n            }\n        );\n    }\n}\n\nexport class Groupper\n    extends TabsterPart<Types.GroupperProps>\n    implements Types.Groupper\n{\n    private _shouldTabInside = false;\n    private _first: WeakHTMLElement | undefined;\n    private _onDispose: (groupper: Groupper) => void;\n\n    dummyManager: GroupperDummyManager | undefined;\n\n    constructor(\n        tabster: Types.TabsterCore,\n        element: HTMLElement,\n        onDispose: (groupper: Groupper) => void,\n        props: Types.GroupperProps,\n        sys: Types.SysProps | undefined\n    ) {\n        super(tabster, element, props);\n        this.makeTabbable(false);\n\n        this._onDispose = onDispose;\n\n        if (!tabster.controlTab) {\n            this.dummyManager = new GroupperDummyManager(\n                this._element,\n                this,\n                tabster,\n                sys\n            );\n        }\n    }\n\n    dispose(): void {\n        this._onDispose(this);\n\n        const element = this._element.get();\n        this.dummyManager?.dispose();\n        delete this.dummyManager;\n\n        if (element) {\n            if (__DEV__) {\n                _setInformativeStyle(this._element, true);\n            }\n        }\n\n        delete this._first;\n    }\n\n    findNextTabbable(\n        currentElement?: HTMLElement,\n        referenceElement?: HTMLElement,\n        isBackward?: boolean,\n        ignoreAccessibility?: boolean\n    ): Types.NextTabbable | null {\n        const groupperElement = this.getElement();\n\n        if (!groupperElement) {\n            return null;\n        }\n\n        const currentIsDummy =\n            getDummyInputContainer(currentElement) === groupperElement;\n\n        if (\n            !this._shouldTabInside &&\n            currentElement &&\n            dom.nodeContains(groupperElement, currentElement) &&\n            !currentIsDummy\n        ) {\n            return { element: undefined, outOfDOMOrder: true };\n        }\n\n        const groupperFirstFocusable = this.getFirst(true);\n\n        if (\n            !currentElement ||\n            !dom.nodeContains(groupperElement, currentElement) ||\n            currentIsDummy\n        ) {\n            return {\n                element: groupperFirstFocusable,\n                outOfDOMOrder: true,\n            };\n        }\n\n        const tabster = this._tabster;\n        let next: HTMLElement | null | undefined = null;\n        let outOfDOMOrder = false;\n        let uncontrolled: HTMLElement | null | undefined;\n\n        if (this._shouldTabInside && groupperFirstFocusable) {\n            const findProps: Types.FindNextProps = {\n                container: groupperElement,\n                currentElement,\n                referenceElement,\n                ignoreAccessibility,\n                useActiveModalizer: true,\n            };\n\n            const findPropsOut: Types.FindFocusableOutputProps = {};\n\n            next = tabster.focusable[isBackward ? \"findPrev\" : \"findNext\"](\n                findProps,\n                findPropsOut\n            );\n\n            outOfDOMOrder = !!findPropsOut.outOfDOMOrder;\n\n            if (\n                !next &&\n                this._props.tabbability ===\n                    GroupperTabbabilities.LimitedTrapFocus\n            ) {\n                next = tabster.focusable[isBackward ? \"findLast\" : \"findFirst\"](\n                    {\n                        container: groupperElement,\n                        ignoreAccessibility,\n                        useActiveModalizer: true,\n                    },\n                    findPropsOut\n                );\n\n                outOfDOMOrder = true;\n            }\n\n            uncontrolled = findPropsOut.uncontrolled;\n        }\n\n        return {\n            element: next,\n            uncontrolled,\n            outOfDOMOrder,\n        };\n    }\n\n    makeTabbable(isTabbable: boolean): void {\n        this._shouldTabInside = isTabbable || !this._props.tabbability;\n\n        if (__DEV__) {\n            _setInformativeStyle(this._element, !this._shouldTabInside);\n        }\n    }\n\n    isActive(noIfFirstIsFocused?: boolean): boolean | undefined {\n        const element = this.getElement() || null;\n        let isParentActive = true;\n\n        for (\n            let e = dom.getParentElement(element);\n            e;\n            e = dom.getParentElement(e)\n        ) {\n            const g = getTabsterOnElement(this._tabster, e)?.groupper as\n                | Groupper\n                | undefined;\n\n            if (g) {\n                if (!g._shouldTabInside) {\n                    isParentActive = false;\n                }\n            }\n        }\n\n        let ret = isParentActive\n            ? this._props.tabbability\n                ? this._shouldTabInside\n                : false\n            : undefined;\n\n        if (ret && noIfFirstIsFocused) {\n            const focused = this._tabster.focusedElement.getFocusedElement();\n\n            if (focused) {\n                ret = focused !== this.getFirst(true);\n            }\n        }\n\n        return ret;\n    }\n\n    getFirst(orContainer: boolean): HTMLElement | undefined {\n        const groupperElement = this.getElement();\n        let first: HTMLElement | undefined;\n\n        if (groupperElement) {\n            if (\n                orContainer &&\n                this._tabster.focusable.isFocusable(groupperElement)\n            ) {\n                return groupperElement;\n            }\n\n            first = this._first?.get();\n\n            if (!first) {\n                first =\n                    this._tabster.focusable.findFirst({\n                        container: groupperElement,\n                        useActiveModalizer: true,\n                    }) || undefined;\n\n                if (first) {\n                    this.setFirst(first);\n                }\n            }\n        }\n\n        return first;\n    }\n\n    setFirst(element: HTMLElement | undefined): void {\n        if (element) {\n            this._first = new WeakHTMLElement(this._tabster.getWindow, element);\n        } else {\n            delete this._first;\n        }\n    }\n\n    acceptElement(\n        element: HTMLElement,\n        state: Types.FocusableAcceptElementState\n    ): number | undefined {\n        const cachedGrouppers = state.cachedGrouppers;\n\n        const parentElement = dom.getParentElement(this.getElement());\n        const parentCtx =\n            parentElement &&\n            RootAPI.getTabsterContext(this._tabster, parentElement);\n        const parentCtxGroupper = parentCtx?.groupper;\n        const parentGroupper = parentCtx?.groupperBeforeMover\n            ? parentCtxGroupper\n            : undefined;\n        let parentGroupperElement: HTMLElement | undefined;\n\n        const getIsActive = (groupper: Types.Groupper) => {\n            let cached = cachedGrouppers[groupper.id];\n            let isActive: boolean | undefined;\n\n            if (cached) {\n                isActive = cached.isActive;\n            } else {\n                isActive = this.isActive(true);\n\n                cached = cachedGrouppers[groupper.id] = {\n                    isActive,\n                };\n            }\n\n            return isActive;\n        };\n\n        if (parentGroupper) {\n            parentGroupperElement = parentGroupper.getElement();\n\n            if (\n                !getIsActive(parentGroupper) &&\n                parentGroupperElement &&\n                state.container !== parentGroupperElement &&\n                dom.nodeContains(state.container, parentGroupperElement)\n            ) {\n                // Do not fall into a child groupper of inactive parent groupper if it's in the scope of the search.\n                state.skippedFocusable = true;\n                return NodeFilter.FILTER_REJECT;\n            }\n        }\n\n        const isActive = getIsActive(this);\n        const groupperElement = this.getElement();\n\n        if (groupperElement) {\n            if (isActive !== true) {\n                if (groupperElement === element && parentCtxGroupper) {\n                    if (!parentGroupperElement) {\n                        parentGroupperElement = parentCtxGroupper.getElement();\n                    }\n\n                    if (\n                        parentGroupperElement &&\n                        !getIsActive(parentCtxGroupper) &&\n                        dom.nodeContains(\n                            state.container,\n                            parentGroupperElement\n                        ) &&\n                        parentGroupperElement !== state.container\n                    ) {\n                        state.skippedFocusable = true;\n                        return NodeFilter.FILTER_REJECT;\n                    }\n                }\n\n                if (\n                    groupperElement !== element &&\n                    dom.nodeContains(groupperElement, element)\n                ) {\n                    state.skippedFocusable = true;\n                    return NodeFilter.FILTER_REJECT;\n                }\n\n                const cached = cachedGrouppers[this.id];\n                let first: HTMLElement | null | undefined;\n\n                if (\"first\" in cached) {\n                    first = cached.first;\n                } else {\n                    first = cached.first = this.getFirst(true);\n                }\n\n                if (first && state.acceptCondition(first)) {\n                    state.rejectElementsFrom = groupperElement;\n                    state.skippedFocusable = true;\n\n                    if (first !== state.from) {\n                        state.found = true;\n                        state.foundElement = first;\n                        return NodeFilter.FILTER_ACCEPT;\n                    } else {\n                        return NodeFilter.FILTER_REJECT;\n                    }\n                }\n            }\n        }\n\n        return undefined;\n    }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction validateGroupperProps(props: Types.GroupperProps): void {\n    // TODO: Implement validation.\n}\n\nexport class GroupperAPI implements Types.GroupperAPI {\n    private _tabster: Types.TabsterCore;\n    private _updateTimer: number | undefined;\n    private _win: Types.GetWindow;\n    private _current: Record<string, Types.Groupper> = {};\n    private _grouppers: Record<string, Types.Groupper> = {};\n\n    constructor(tabster: Types.TabsterCore, getWindow: Types.GetWindow) {\n        this._tabster = tabster;\n        this._win = getWindow;\n        tabster.queueInit(this._init);\n    }\n\n    private _init = (): void => {\n        const win = this._win();\n\n        // Making sure groupper's onFocus is called before modalizer's onFocus.\n        this._tabster.focusedElement.subscribeFirst(this._onFocus);\n\n        const doc = win.document;\n\n        const activeElement = dom.getActiveElement(doc);\n\n        if (activeElement) {\n            this._onFocus(activeElement as HTMLElement);\n        }\n\n        doc.addEventListener(\"mousedown\", this._onMouseDown, true);\n        win.addEventListener(\"keydown\", this._onKeyDown, true);\n        win.addEventListener(GroupperMoveFocusEventName, this._onMoveFocus);\n    };\n\n    dispose(): void {\n        const win = this._win();\n\n        this._tabster.focusedElement.cancelAsyncFocus(\n            AsyncFocusSources.EscapeGroupper\n        );\n\n        this._current = {};\n\n        if (this._updateTimer) {\n            win.clearTimeout(this._updateTimer);\n            delete this._updateTimer;\n        }\n\n        this._tabster.focusedElement.unsubscribe(this._onFocus);\n\n        win.document.removeEventListener(\"mousedown\", this._onMouseDown, true);\n        win.removeEventListener(\"keydown\", this._onKeyDown, true);\n        win.removeEventListener(GroupperMoveFocusEventName, this._onMoveFocus);\n\n        Object.keys(this._grouppers).forEach((groupperId) => {\n            if (this._grouppers[groupperId]) {\n                this._grouppers[groupperId].dispose();\n                delete this._grouppers[groupperId];\n            }\n        });\n    }\n\n    createGroupper(\n        element: HTMLElement,\n        props: Types.GroupperProps,\n        sys: Types.SysProps | undefined\n    ) {\n        if (__DEV__) {\n            validateGroupperProps(props);\n        }\n\n        const tabster = this._tabster;\n        const newGroupper = new Groupper(\n            tabster,\n            element,\n            this._onGroupperDispose,\n            props,\n            sys\n        );\n\n        this._grouppers[newGroupper.id] = newGroupper;\n\n        const focusedElement = tabster.focusedElement.getFocusedElement();\n\n        // Newly created groupper contains currently focused element, update the state on the next tick (to\n        // make sure all grouppers are processed).\n        if (\n            focusedElement &&\n            dom.nodeContains(element, focusedElement) &&\n            !this._updateTimer\n        ) {\n            this._updateTimer = this._win().setTimeout(() => {\n                delete this._updateTimer;\n                // Making sure the focused element hasn't changed.\n                if (\n                    focusedElement ===\n                    tabster.focusedElement.getFocusedElement()\n                ) {\n                    this._updateCurrent(focusedElement);\n                }\n            }, 0);\n        }\n\n        return newGroupper;\n    }\n\n    forgetCurrentGrouppers(): void {\n        this._current = {};\n    }\n\n    private _onGroupperDispose = (groupper: Groupper) => {\n        delete this._grouppers[groupper.id];\n    };\n\n    private _onFocus = (element: HTMLElement | undefined): void => {\n        if (element) {\n            this._updateCurrent(element);\n        }\n    };\n\n    private _onMouseDown = (e: MouseEvent): void => {\n        let target = e.target as HTMLElement | null;\n\n        while (target && !this._tabster.focusable.isFocusable(target)) {\n            target = this._tabster.getParent(target) as HTMLElement | null;\n        }\n\n        if (target) {\n            this._updateCurrent(target);\n        }\n    };\n\n    private _updateCurrent(element: HTMLElement): void {\n        if (this._updateTimer) {\n            this._win().clearTimeout(this._updateTimer);\n            delete this._updateTimer;\n        }\n\n        const tabster = this._tabster;\n        const newIds: Record<string, true> = {};\n\n        for (\n            let el = tabster.getParent(element);\n            el;\n            el = tabster.getParent(el)\n        ) {\n            const groupper = getTabsterOnElement(\n                tabster,\n                el as HTMLElement\n            )?.groupper;\n\n            if (groupper) {\n                newIds[groupper.id] = true;\n\n                this._current[groupper.id] = groupper;\n                const isTabbable =\n                    groupper.isActive() ||\n                    (element !== el &&\n                        (!groupper.getProps().delegated ||\n                            groupper.getFirst(false) !== element));\n\n                groupper.makeTabbable(isTabbable);\n            }\n        }\n\n        for (const id of Object.keys(this._current)) {\n            const groupper = this._current[id];\n\n            if (!(groupper.id in newIds)) {\n                groupper.makeTabbable(false);\n                groupper.setFirst(undefined);\n                delete this._current[id];\n            }\n        }\n    }\n\n    private _onKeyDown = (event: KeyboardEvent): void => {\n        if (event.key !== Keys.Enter && event.key !== Keys.Escape) {\n            return;\n        }\n\n        // Give a chance to other listeners to handle the event.\n        if (event.ctrlKey || event.altKey || event.shiftKey || event.metaKey) {\n            return;\n        }\n\n        const element = this._tabster.focusedElement.getFocusedElement();\n\n        if (element) {\n            this.handleKeyPress(element, event);\n        }\n    };\n\n    private _onMoveFocus = (e: GroupperMoveFocusEvent): void => {\n        const element = e.composedPath()[0] as HTMLElement | null | undefined;\n        const action = e.detail?.action;\n\n        if (element && action !== undefined && !e.defaultPrevented) {\n            if (action === GroupperMoveFocusActions.Enter) {\n                this._enterGroupper(element);\n            } else {\n                this._escapeGroupper(element);\n            }\n\n            e.stopImmediatePropagation();\n        }\n    };\n\n    private _enterGroupper(\n        element: HTMLElement,\n        relatedEvent?: KeyboardEvent\n    ): HTMLElement | null {\n        const tabster = this._tabster;\n        const ctx = RootAPI.getTabsterContext(tabster, element);\n        const groupper = ctx?.groupper || ctx?.modalizerInGroupper;\n        const groupperElement = groupper?.getElement();\n\n        if (\n            groupper &&\n            groupperElement &&\n            (element === groupperElement ||\n                (groupper.getProps().delegated &&\n                    element === groupper.getFirst(false)))\n        ) {\n            const next = tabster.focusable.findNext({\n                container: groupperElement,\n                currentElement: element,\n                useActiveModalizer: true,\n            });\n\n            if (\n                next &&\n                (!relatedEvent ||\n                    (relatedEvent &&\n                        groupperElement.dispatchEvent(\n                            new TabsterMoveFocusEvent({\n                                by: \"groupper\",\n                                owner: groupperElement,\n                                next,\n                                relatedEvent,\n                            })\n                        )))\n            ) {\n                if (relatedEvent) {\n                    // When the application hasn't prevented default,\n                    // we consider the event completely handled, hence we\n                    // prevent the initial event's default action and stop\n                    // propagation.\n                    relatedEvent.preventDefault();\n                    relatedEvent.stopImmediatePropagation();\n                }\n\n                next.focus();\n\n                return next;\n            }\n        }\n\n        return null;\n    }\n\n    private _escapeGroupper(\n        element: HTMLElement,\n        relatedEvent?: KeyboardEvent,\n        fromModalizer?: boolean\n    ): HTMLElement | null {\n        const tabster = this._tabster;\n        const ctx = RootAPI.getTabsterContext(tabster, element);\n        let groupper = ctx?.groupper || ctx?.modalizerInGroupper;\n        const groupperElement = groupper?.getElement();\n\n        if (\n            groupper &&\n            groupperElement &&\n            dom.nodeContains(groupperElement, element)\n        ) {\n            let next: HTMLElement | null | undefined;\n\n            if (element !== groupperElement || fromModalizer) {\n                next = groupper.getFirst(true);\n            } else {\n                const parentElement = dom.getParentElement(groupperElement);\n                const parentCtx = parentElement\n                    ? RootAPI.getTabsterContext(tabster, parentElement)\n                    : undefined;\n\n                groupper = parentCtx?.groupper;\n                next = groupper?.getFirst(true);\n            }\n\n            if (\n                next &&\n                (!relatedEvent ||\n                    (relatedEvent &&\n                        groupperElement.dispatchEvent(\n                            new TabsterMoveFocusEvent({\n                                by: \"groupper\",\n                                owner: groupperElement,\n                                next,\n                                relatedEvent,\n                            })\n                        )))\n            ) {\n                if (groupper) {\n                    groupper.makeTabbable(false);\n                }\n\n                // This part happens asynchronously inside setTimeout,\n                // so no need to prevent default or stop propagation.\n                next.focus();\n\n                return next;\n            }\n        }\n\n        return null;\n    }\n\n    moveFocus(\n        element: HTMLElement,\n        action: Types.GroupperMoveFocusAction\n    ): HTMLElement | null {\n        return action === GroupperMoveFocusActions.Enter\n            ? this._enterGroupper(element)\n            : this._escapeGroupper(element);\n    }\n\n    handleKeyPress(\n        element: HTMLElement,\n        event: KeyboardEvent,\n        fromModalizer?: boolean\n    ): void {\n        const tabster = this._tabster;\n        const ctx = RootAPI.getTabsterContext(tabster, element);\n\n        if (ctx && (ctx?.groupper || ctx?.modalizerInGroupper)) {\n            tabster.focusedElement.cancelAsyncFocus(\n                AsyncFocusSources.EscapeGroupper\n            );\n\n            if (ctx.ignoreKeydown(event)) {\n                return;\n            }\n\n            if (event.key === Keys.Enter) {\n                this._enterGroupper(element, event);\n            } else if (event.key === Keys.Escape) {\n                // We will handle Esc asynchronously, if something in the application will\n                // move focus during the keypress handling, we will not interfere.\n                const focusedElement =\n                    tabster.focusedElement.getFocusedElement();\n\n                tabster.focusedElement.requestAsyncFocus(\n                    AsyncFocusSources.EscapeGroupper,\n                    () => {\n                        if (\n                            focusedElement !==\n                                tabster.focusedElement.getFocusedElement() &&\n                            // A part of Modalizer that has called this handler to escape the active groupper\n                            // might have been removed from DOM, if the focus is on body, we still want to handle Esc.\n                            ((fromModalizer && !focusedElement) ||\n                                !fromModalizer)\n                        ) {\n                            // Something else in the application has moved focus, we will not handle Esc.\n                            return;\n                        }\n\n                        this._escapeGroupper(element, event, fromModalizer);\n                    },\n                    0\n                );\n            }\n        }\n    }\n}\n\nfunction _setInformativeStyle(\n    weakElement: Types.WeakHTMLElement,\n    remove: boolean\n): void {\n    if (__DEV__) {\n        const element = weakElement.get();\n\n        if (element) {\n            if (remove) {\n                element.style.removeProperty(\"--tabster-groupper\");\n            } else {\n                element.style.setProperty(\"--tabster-groupper\", \"unlimited\");\n            }\n        }\n    }\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { createKeyborg, disposeKeyborg, Keyborg } from \"keyborg\";\n\nimport * as Types from \"../Types\";\nimport { Subscribable } from \"./Subscribable\";\n\nexport class KeyboardNavigationState\n    extends Subscribable<boolean>\n    implements Types.KeyboardNavigationState\n{\n    private _keyborg?: Keyborg;\n\n    constructor(getWindow: Types.GetWindow) {\n        super();\n        this._keyborg = createKeyborg(getWindow());\n        this._keyborg.subscribe(this._onChange);\n    }\n\n    dispose(): void {\n        super.dispose();\n\n        if (this._keyborg) {\n            this._keyborg.unsubscribe(this._onChange);\n\n            disposeKeyborg(this._keyborg);\n\n            delete this._keyborg;\n        }\n    }\n\n    private _onChange = (isNavigatingWithKeyboard: boolean) => {\n        this.setVal(isNavigatingWithKeyboard, undefined);\n    };\n\n    setNavigatingWithKeyboard(isNavigatingWithKeyboard: boolean): void {\n        this._keyborg?.setVal(isNavigatingWithKeyboard);\n    }\n\n    isNavigatingWithKeyboard(): boolean {\n        return !!this._keyborg?.isNavigatingWithKeyboard();\n    }\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { nativeFocus } from \"keyborg\";\nimport { getTabsterOnElement } from \"./Instance\";\nimport { RootAPI } from \"./Root\";\nimport { FocusedElementState } from \"./State/FocusedElement\";\nimport { Keys } from \"./Keys\";\nimport * as Types from \"./Types\";\nimport { ModalizerActiveEvent, ModalizerInactiveEvent } from \"./Events\";\nimport { ModalizerEventDetail } from \"./EventsTypes\";\nimport {\n    augmentAttribute,\n    DummyInput,\n    DummyInputManager,\n    DummyInputManagerPriorities,\n    getDummyInputContainer,\n    TabsterPart,\n    WeakHTMLElement,\n} from \"./Utils\";\nimport { dom } from \"./DOMAPI\";\n\nlet _wasFocusedCounter = 0;\n\nconst _ariaHidden = \"aria-hidden\";\n\nfunction _setInformativeStyle(\n    weakElement: WeakHTMLElement,\n    remove: boolean,\n    internalId?: string,\n    userId?: string,\n    isActive?: boolean,\n    wasFocused?: number\n): void {\n    if (__DEV__) {\n        const element = weakElement.get();\n\n        if (element) {\n            if (remove) {\n                element.style.removeProperty(\"--tabster-modalizer\");\n            } else {\n                element.style.setProperty(\n                    \"--tabster-modalizer\",\n                    internalId +\n                        \",\" +\n                        userId +\n                        \",\" +\n                        (isActive ? \"active\" : \"inactive\") +\n                        \",\" +\n                        \",\" +\n                        (wasFocused ? `focused(${wasFocused})` : \"not-focused\")\n                );\n            }\n        }\n    }\n}\n\n/**\n * Manages the dummy inputs for the Modalizer.\n */\nclass ModalizerDummyManager extends DummyInputManager {\n    constructor(\n        element: WeakHTMLElement,\n        tabster: Types.TabsterCore,\n        sys: Types.SysProps | undefined\n    ) {\n        super(tabster, element, DummyInputManagerPriorities.Modalizer, sys);\n\n        this._setHandlers((dummyInput: DummyInput, isBackward: boolean) => {\n            const el = element.get();\n            const container = el && RootAPI.getRoot(tabster, el)?.getElement();\n            const input = dummyInput.input;\n            let toFocus: HTMLElement | null | undefined;\n\n            if (container && input) {\n                const dummyContainer = getDummyInputContainer(input);\n\n                const ctx = RootAPI.getTabsterContext(\n                    tabster,\n                    dummyContainer || input\n                );\n\n                if (ctx) {\n                    toFocus = FocusedElementState.findNextTabbable(\n                        tabster,\n                        ctx,\n                        container,\n                        input,\n                        undefined,\n                        isBackward,\n                        true\n                    )?.element;\n                }\n\n                if (toFocus) {\n                    nativeFocus(toFocus);\n                }\n            }\n        });\n    }\n}\n\nexport class Modalizer\n    extends TabsterPart<Types.ModalizerProps>\n    implements Types.Modalizer\n{\n    userId: string;\n\n    private _isActive: boolean | undefined;\n    private _wasFocused = 0;\n    private _onDispose: (modalizer: Modalizer) => void;\n    private _activeElements: WeakHTMLElement<HTMLElement>[];\n\n    dummyManager: ModalizerDummyManager | undefined;\n\n    constructor(\n        tabster: Types.TabsterCore,\n        element: HTMLElement,\n        onDispose: (modalizer: Modalizer) => void,\n        props: Types.ModalizerProps,\n        sys: Types.SysProps | undefined,\n        activeElements: WeakHTMLElement<HTMLElement>[]\n    ) {\n        super(tabster, element, props);\n\n        this.userId = props.id;\n        this._onDispose = onDispose;\n        this._activeElements = activeElements;\n\n        if (!tabster.controlTab) {\n            this.dummyManager = new ModalizerDummyManager(\n                this._element,\n                tabster,\n                sys\n            );\n        }\n\n        if (__DEV__) {\n            _setInformativeStyle(\n                this._element,\n                false,\n                this.id,\n                this.userId,\n                this._isActive,\n                this._wasFocused\n            );\n        }\n    }\n\n    makeActive(isActive: boolean): void {\n        if (this._isActive !== isActive) {\n            this._isActive = isActive;\n\n            const element = this.getElement();\n\n            if (element) {\n                const activeElements = this._activeElements;\n                const index = activeElements\n                    .map((e) => e.get())\n                    .indexOf(element);\n\n                if (isActive) {\n                    if (index < 0) {\n                        activeElements.push(\n                            new WeakHTMLElement(\n                                this._tabster.getWindow,\n                                element\n                            )\n                        );\n                    }\n                } else {\n                    if (index >= 0) {\n                        activeElements.splice(index, 1);\n                    }\n                }\n            }\n\n            if (__DEV__) {\n                _setInformativeStyle(\n                    this._element,\n                    false,\n                    this.id,\n                    this.userId,\n                    this._isActive,\n                    this._wasFocused\n                );\n            }\n\n            this._dispatchEvent(isActive);\n        }\n    }\n\n    focused(noIncrement?: boolean): number {\n        if (!noIncrement) {\n            this._wasFocused = ++_wasFocusedCounter;\n        }\n\n        return this._wasFocused;\n    }\n\n    setProps(props: Types.ModalizerProps): void {\n        if (props.id) {\n            this.userId = props.id;\n        }\n\n        this._props = { ...props };\n    }\n\n    dispose(): void {\n        this.makeActive(false);\n        this._onDispose(this);\n        this.dummyManager?.dispose();\n        delete this.dummyManager;\n        this._activeElements = [];\n        this._remove();\n    }\n\n    isActive(): boolean {\n        return !!this._isActive;\n    }\n\n    contains(element: HTMLElement) {\n        return dom.nodeContains(this.getElement(), element);\n    }\n\n    findNextTabbable(\n        currentElement?: HTMLElement,\n        referenceElement?: HTMLElement,\n        isBackward?: boolean,\n        ignoreAccessibility?: boolean\n    ): Types.NextTabbable | null {\n        const modalizerElement = this.getElement();\n\n        if (!modalizerElement) {\n            return null;\n        }\n\n        const tabster = this._tabster;\n        let next: HTMLElement | null | undefined = null;\n        let outOfDOMOrder = false;\n        let uncontrolled: HTMLElement | null | undefined;\n\n        const container =\n            currentElement &&\n            RootAPI.getRoot(tabster, currentElement)?.getElement();\n\n        if (container) {\n            const findProps: Types.FindNextProps = {\n                container,\n                currentElement,\n                referenceElement,\n                ignoreAccessibility,\n                useActiveModalizer: true,\n            };\n\n            const findPropsOut: Types.FindFocusableOutputProps = {};\n\n            next = tabster.focusable[isBackward ? \"findPrev\" : \"findNext\"](\n                findProps,\n                findPropsOut\n            );\n\n            if (!next && this._props.isTrapped && tabster.modalizer?.activeId) {\n                next = tabster.focusable[isBackward ? \"findLast\" : \"findFirst\"](\n                    {\n                        container,\n                        ignoreAccessibility,\n                        useActiveModalizer: true,\n                    },\n                    findPropsOut\n                );\n\n                if (next === null) {\n                    next = currentElement;\n                }\n\n                outOfDOMOrder = true;\n            } else {\n                outOfDOMOrder = !!findPropsOut.outOfDOMOrder;\n            }\n\n            uncontrolled = findPropsOut.uncontrolled;\n        }\n\n        return {\n            element: next,\n            uncontrolled,\n            outOfDOMOrder,\n        };\n    }\n\n    private _dispatchEvent(isActive: boolean, allElements?: boolean): boolean {\n        const element = this.getElement();\n        let defaultPrevented = false;\n\n        if (element) {\n            const elements = allElements\n                ? this._activeElements.map((e) => e.get())\n                : [element];\n\n            for (const el of elements) {\n                if (el) {\n                    const eventDetail: ModalizerEventDetail = {\n                        id: this.userId,\n                        element,\n                    };\n\n                    const event = isActive\n                        ? new ModalizerActiveEvent(eventDetail)\n                        : new ModalizerInactiveEvent(eventDetail);\n\n                    el.dispatchEvent(event);\n\n                    if (event.defaultPrevented) {\n                        defaultPrevented = true;\n                    }\n                }\n            }\n        }\n\n        return defaultPrevented;\n    }\n\n    private _remove(): void {\n        if (__DEV__) {\n            _setInformativeStyle(this._element, true);\n        }\n    }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction validateModalizerProps(props: Types.ModalizerProps): void {\n    // TODO: Implement validation.\n}\n\nexport class ModalizerAPI implements Types.ModalizerAPI {\n    private _tabster: Types.TabsterCore;\n    private _win: Types.GetWindow;\n    private _restoreModalizerFocusTimer: number | undefined;\n    private _modalizers: Record<string, Types.Modalizer>;\n    private _parts: Record<string, Record<string, Types.Modalizer>>;\n    private _augMap: WeakMap<HTMLElement, true>;\n    private _aug: WeakHTMLElement<HTMLElement>[];\n    private _hiddenUpdateTimer: number | undefined;\n    private _alwaysAccessibleSelector: string | undefined;\n    private _accessibleCheck: Types.ModalizerElementAccessibleCheck | undefined;\n    private _activationHistory: (string | undefined)[];\n\n    activeId: string | undefined;\n    currentIsOthersAccessible: boolean | undefined;\n    activeElements: WeakHTMLElement<HTMLElement>[];\n\n    constructor(\n        tabster: Types.TabsterCore,\n        // @deprecated use accessibleCheck.\n        alwaysAccessibleSelector?: string,\n        accessibleCheck?: Types.ModalizerElementAccessibleCheck\n    ) {\n        this._tabster = tabster;\n        this._win = tabster.getWindow;\n        this._modalizers = {};\n        this._parts = {};\n        this._augMap = new WeakMap();\n        this._aug = [];\n        this._alwaysAccessibleSelector = alwaysAccessibleSelector;\n        this._accessibleCheck = accessibleCheck;\n        this._activationHistory = [];\n        this.activeElements = [];\n\n        if (!tabster.controlTab) {\n            tabster.root.addDummyInputs();\n        }\n\n        const win = this._win();\n        win.addEventListener(\"keydown\", this._onKeyDown, true);\n\n        tabster.queueInit(() => {\n            this._tabster.focusedElement.subscribe(this._onFocus);\n        });\n    }\n\n    dispose(): void {\n        const win = this._win();\n\n        win.removeEventListener(\"keydown\", this._onKeyDown, true);\n\n        // Dispose all modalizers managed by the API\n        Object.keys(this._modalizers).forEach((modalizerId) => {\n            if (this._modalizers[modalizerId]) {\n                this._modalizers[modalizerId].dispose();\n                delete this._modalizers[modalizerId];\n            }\n        });\n\n        win.clearTimeout(this._restoreModalizerFocusTimer);\n        win.clearTimeout(this._hiddenUpdateTimer);\n\n        this._parts = {};\n        delete this.activeId;\n        this.activeElements = [];\n\n        this._augMap = new WeakMap();\n        this._aug = [];\n\n        this._tabster.focusedElement.unsubscribe(this._onFocus);\n    }\n\n    createModalizer(\n        element: HTMLElement,\n        props: Types.ModalizerProps,\n        sys: Types.SysProps | undefined\n    ): Types.Modalizer {\n        if (__DEV__) {\n            validateModalizerProps(props);\n        }\n\n        const modalizer = new Modalizer(\n            this._tabster,\n            element,\n            this._onModalizerDispose,\n            props,\n            sys,\n            this.activeElements\n        );\n\n        const id = modalizer.id;\n        const userId = props.id;\n\n        this._modalizers[id] = modalizer;\n\n        let part = this._parts[userId];\n        if (!part) {\n            part = this._parts[userId] = {};\n        }\n        part[id] = modalizer;\n\n        const focusedElement =\n            this._tabster.focusedElement.getFocusedElement() ?? null;\n\n        // Adding a modalizer which is already focused, activate it\n        if (\n            element !== focusedElement &&\n            dom.nodeContains(element, focusedElement)\n        ) {\n            if (userId !== this.activeId) {\n                this.setActive(modalizer);\n            } else {\n                modalizer.makeActive(true);\n            }\n        }\n\n        return modalizer;\n    }\n\n    private _onModalizerDispose = (modalizer: Modalizer) => {\n        const id = modalizer.id;\n        const userId = modalizer.userId;\n        const part = this._parts[userId];\n\n        delete this._modalizers[id];\n\n        if (part) {\n            delete part[id];\n\n            if (Object.keys(part).length === 0) {\n                delete this._parts[userId];\n\n                const activationHistory = this._activationHistory;\n                const cleanActivationHistory: (string | undefined)[] = [];\n                let prevHistoryItem: string | undefined;\n\n                // The history order is from most recent to oldest.\n                for (let i = activationHistory.length; i--; ) {\n                    // Remove from activation history, making sure there are no duplicates\n                    // for cases like [modal2, modal1, modal2, modal1]: just removing modal2\n                    // will result in [modal1, modal1] and we want just [modal1]. Otherwise,\n                    // there is a chance for this array to grow forever in a narrow case of\n                    // a modalizer that stays in DOM forever and is being activated/deactivated\n                    // switching between other modalizers that come and go.\n                    const modalizerUserIdFromHistory = activationHistory[i];\n\n                    if (modalizerUserIdFromHistory === userId) {\n                        continue;\n                    }\n\n                    if (modalizerUserIdFromHistory !== prevHistoryItem) {\n                        prevHistoryItem = modalizerUserIdFromHistory;\n\n                        if (\n                            modalizerUserIdFromHistory ||\n                            cleanActivationHistory.length > 0\n                        ) {\n                            cleanActivationHistory.unshift(\n                                modalizerUserIdFromHistory\n                            );\n                        }\n                    }\n                }\n\n                this._activationHistory = cleanActivationHistory;\n\n                if (this.activeId === userId) {\n                    const prevActiveId = cleanActivationHistory[0];\n                    const prevActive = prevActiveId\n                        ? Object.values(this._parts[prevActiveId])[0]\n                        : undefined;\n                    this.setActive(prevActive);\n                }\n            }\n        }\n    };\n\n    private _onKeyDown = (event: KeyboardEvent): void => {\n        if (event.key !== Keys.Escape) {\n            return;\n        }\n\n        const tabster = this._tabster;\n        const element = tabster.focusedElement.getFocusedElement();\n\n        if (element) {\n            const ctx = RootAPI.getTabsterContext(tabster, element);\n            const modalizer = ctx?.modalizer;\n\n            if (\n                ctx &&\n                !ctx.groupper &&\n                modalizer?.isActive() &&\n                !ctx.ignoreKeydown(event)\n            ) {\n                const activeId = modalizer.userId;\n\n                if (activeId) {\n                    const part = this._parts[activeId];\n\n                    if (part) {\n                        const focusedSince = Object.keys(part)\n                            .map((id) => {\n                                const m = part[id];\n                                const el = m.getElement();\n                                let groupper: Types.Groupper | undefined;\n\n                                if (el) {\n                                    groupper = getTabsterOnElement(\n                                        tabster,\n                                        el\n                                    )?.groupper;\n                                }\n\n                                return m && el && groupper\n                                    ? {\n                                          el,\n                                          focusedSince: m.focused(true),\n                                      }\n                                    : { focusedSince: 0 };\n                            })\n                            .filter((f) => f.focusedSince > 0)\n                            .sort((a, b) =>\n                                a.focusedSince > b.focusedSince\n                                    ? -1\n                                    : a.focusedSince < b.focusedSince\n                                      ? 1\n                                      : 0\n                            );\n\n                        if (focusedSince.length) {\n                            const groupperElement = focusedSince[0].el;\n\n                            if (groupperElement) {\n                                tabster.groupper?.handleKeyPress(\n                                    groupperElement,\n                                    event,\n                                    true\n                                );\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    };\n\n    isAugmented(element: HTMLElement): boolean {\n        return this._augMap.has(element);\n    }\n\n    hiddenUpdate(): void {\n        if (this._hiddenUpdateTimer) {\n            return;\n        }\n\n        this._hiddenUpdateTimer = this._win().setTimeout(() => {\n            delete this._hiddenUpdateTimer;\n            this._hiddenUpdate();\n        }, 250);\n    }\n\n    setActive(modalizer: Types.Modalizer | undefined): void {\n        const userId = modalizer?.userId;\n        const activeId = this.activeId;\n\n        if (activeId === userId) {\n            return;\n        }\n\n        this.activeId = userId;\n\n        if (activeId) {\n            const part = this._parts[activeId];\n\n            if (part) {\n                for (const id of Object.keys(part)) {\n                    part[id].makeActive(false);\n                }\n            }\n        }\n\n        if (userId) {\n            const part = this._parts[userId];\n\n            if (part) {\n                for (const id of Object.keys(part)) {\n                    part[id].makeActive(true);\n                }\n            }\n        }\n\n        this.currentIsOthersAccessible =\n            modalizer?.getProps().isOthersAccessible;\n\n        this.hiddenUpdate();\n\n        const activationHistory = this._activationHistory;\n        if (\n            activationHistory[0] !== userId &&\n            (userId !== undefined || activationHistory.length > 0)\n        ) {\n            activationHistory.unshift(userId);\n        }\n    }\n\n    focus(\n        elementFromModalizer: HTMLElement,\n        noFocusFirst?: boolean,\n        noFocusDefault?: boolean\n    ): boolean {\n        const tabster = this._tabster;\n        const ctx = RootAPI.getTabsterContext(tabster, elementFromModalizer);\n\n        const modalizer = ctx?.modalizer;\n\n        if (modalizer) {\n            this.setActive(modalizer);\n\n            const props = modalizer.getProps();\n            const modalizerRoot = modalizer.getElement();\n\n            if (modalizerRoot) {\n                if (noFocusFirst === undefined) {\n                    noFocusFirst = props.isNoFocusFirst;\n                }\n\n                if (\n                    !noFocusFirst &&\n                    tabster.keyboardNavigation.isNavigatingWithKeyboard() &&\n                    tabster.focusedElement.focusFirst({\n                        container: modalizerRoot,\n                    })\n                ) {\n                    return true;\n                }\n\n                if (noFocusDefault === undefined) {\n                    noFocusDefault = props.isNoFocusDefault;\n                }\n\n                if (\n                    !noFocusDefault &&\n                    tabster.focusedElement.focusDefault(modalizerRoot)\n                ) {\n                    return true;\n                }\n\n                tabster.focusedElement.resetFocus(modalizerRoot);\n            }\n        } else if (__DEV__) {\n            console.error(\"Element is not in Modalizer.\", elementFromModalizer);\n        }\n\n        return false;\n    }\n\n    activate(modalizerElementOrContainer: HTMLElement | undefined): boolean {\n        const modalizerToActivate: Types.Modalizer | undefined =\n            modalizerElementOrContainer\n                ? RootAPI.getTabsterContext(\n                      this._tabster,\n                      modalizerElementOrContainer\n                  )?.modalizer\n                : undefined;\n\n        if (!modalizerElementOrContainer || modalizerToActivate) {\n            this.setActive(modalizerToActivate);\n            return true;\n        }\n\n        return false;\n    }\n\n    acceptElement(\n        element: HTMLElement,\n        state: Types.FocusableAcceptElementState\n    ): number | undefined {\n        const modalizerUserId = state.modalizerUserId;\n        const currentModalizer = state.currentCtx?.modalizer;\n\n        if (modalizerUserId) {\n            for (const e of this.activeElements) {\n                const el = e.get();\n\n                if (el && (dom.nodeContains(element, el) || el === element)) {\n                    // We have a part of currently active modalizer somewhere deeper in the DOM,\n                    // skipping all other checks.\n                    return NodeFilter.FILTER_SKIP;\n                }\n            }\n        }\n\n        const ret =\n            modalizerUserId === currentModalizer?.userId ||\n            (!modalizerUserId &&\n                currentModalizer?.getProps().isAlwaysAccessible)\n                ? undefined\n                : NodeFilter.FILTER_SKIP;\n\n        if (ret !== undefined) {\n            state.skippedFocusable = true;\n        }\n\n        return ret;\n    }\n\n    private _hiddenUpdate(): void {\n        const tabster = this._tabster;\n        const body = tabster.getWindow().document.body;\n        const activeId = this.activeId;\n\n        const parts = this._parts;\n        const visibleElements: HTMLElement[] = [];\n        const hiddenElements: HTMLElement[] = [];\n        const alwaysAccessibleSelector = this._alwaysAccessibleSelector;\n        const alwaysAccessibleElements: HTMLElement[] = alwaysAccessibleSelector\n            ? Array.from(\n                  dom.querySelectorAll(\n                      body,\n                      alwaysAccessibleSelector\n                  ) as HTMLElement[]\n              )\n            : [];\n        const activeModalizerElements: HTMLElement[] = [];\n\n        for (const userId of Object.keys(parts)) {\n            const modalizerParts = parts[userId];\n\n            for (const id of Object.keys(modalizerParts)) {\n                const modalizer = modalizerParts[id];\n                const el = modalizer.getElement();\n                const props = modalizer.getProps();\n                const isAlwaysAccessible = props.isAlwaysAccessible;\n\n                if (el) {\n                    if (userId === activeId) {\n                        activeModalizerElements.push(el);\n\n                        if (!this.currentIsOthersAccessible) {\n                            visibleElements.push(el);\n                        }\n                    } else if (isAlwaysAccessible) {\n                        alwaysAccessibleElements.push(el);\n                    } else {\n                        hiddenElements.push(el);\n                    }\n                }\n            }\n        }\n\n        const augmentedMap = this._augMap;\n        const allVisibleElements: HTMLElement[] | undefined =\n            visibleElements.length > 0\n                ? [...visibleElements, ...alwaysAccessibleElements]\n                : undefined;\n\n        const newAugmented: WeakHTMLElement<HTMLElement>[] = [];\n        const newAugmentedMap: WeakMap<HTMLElement, true> = new WeakMap();\n\n        const toggle = (element: HTMLElement, hide: boolean) => {\n            const tagName = element.tagName;\n\n            if (tagName === \"SCRIPT\" || tagName === \"STYLE\") {\n                return;\n            }\n\n            let isAugmented = false;\n\n            if (augmentedMap.has(element)) {\n                if (hide) {\n                    isAugmented = true;\n                } else {\n                    augmentedMap.delete(element);\n                    augmentAttribute(tabster, element, _ariaHidden);\n                }\n            } else if (\n                hide &&\n                !this._accessibleCheck?.(element, activeModalizerElements) &&\n                augmentAttribute(tabster, element, _ariaHidden, \"true\")\n            ) {\n                augmentedMap.set(element, true);\n                isAugmented = true;\n            }\n\n            if (isAugmented) {\n                newAugmented.push(\n                    new WeakHTMLElement(tabster.getWindow, element)\n                );\n                newAugmentedMap.set(element, true);\n            }\n        };\n\n        const walk = (element: HTMLElement) => {\n            for (\n                let el = dom.getFirstElementChild(\n                    element\n                ) as Types.HTMLElementWithTabsterFlags | null;\n                el;\n                el = dom.getNextElementSibling(\n                    el\n                ) as Types.HTMLElementWithTabsterFlags | null\n            ) {\n                let skip = false;\n                let containsModalizer = false;\n                let containedByModalizer = false;\n\n                if (allVisibleElements) {\n                    const elParent = tabster.getParent(el);\n\n                    for (const c of allVisibleElements) {\n                        if (el === c) {\n                            skip = true;\n                            break;\n                        }\n\n                        if (dom.nodeContains(el, c)) {\n                            containsModalizer = true;\n                            break;\n                        } else if (dom.nodeContains(c, elParent)) {\n                            // tabster.getParent() could be provided by the application to\n                            // handle, for example, virtual parents. Making sure, we are\n                            // not setting aria-hidden on elements which are virtually\n                            // inside modalizer.\n                            containedByModalizer = true;\n                        }\n                    }\n\n                    if (\n                        containsModalizer ||\n                        el.__tabsterElementFlags?.noDirectAriaHidden\n                    ) {\n                        walk(el as HTMLElement);\n                    } else if (!skip && !containedByModalizer) {\n                        toggle(el as HTMLElement, true);\n                    }\n                } else {\n                    toggle(el as HTMLElement, false);\n                }\n            }\n        };\n\n        if (!allVisibleElements) {\n            alwaysAccessibleElements.forEach((e) => toggle(e, false));\n        }\n\n        hiddenElements.forEach((e) => toggle(e, true));\n\n        if (body) {\n            walk(body);\n        }\n\n        this._aug\n            ?.map((e) => e.get())\n            .forEach((e) => {\n                if (e && !newAugmentedMap.get(e)) {\n                    toggle(e, false);\n                }\n            });\n\n        this._aug = newAugmented;\n        this._augMap = newAugmentedMap;\n    }\n\n    /**\n     * Subscribes to the focus state and handles modalizer related focus events\n     * @param focusedElement - Element that is focused\n     * @param detail - Additional data about the focus event\n     */\n    private _onFocus = (\n        focusedElement: HTMLElement | undefined,\n        detail: Types.FocusedElementDetail\n    ): void => {\n        const tabster = this._tabster;\n        const ctx =\n            focusedElement &&\n            RootAPI.getTabsterContext(tabster, focusedElement);\n\n        // Modalizer behaviour is opt in, only apply to elements that have a tabster context\n        if (!ctx || !focusedElement) {\n            return;\n        }\n\n        const augmentedMap = this._augMap;\n\n        for (\n            let e: HTMLElement | null = focusedElement;\n            e;\n            e = dom.getParentElement(e)\n        ) {\n            // If the newly focused element is inside some of the hidden containers,\n            // remove aria-hidden from those synchronously for the screen readers\n            // to be able to read the element. The rest of aria-hiddens, will be removed\n            // acynchronously for the sake of performance.\n\n            if (augmentedMap.has(e)) {\n                augmentedMap.delete(e);\n                augmentAttribute(tabster, e, _ariaHidden);\n            }\n        }\n\n        let modalizer = ctx.modalizer;\n\n        const tabsterOnFocusedElement = getTabsterOnElement(\n            tabster,\n            focusedElement\n        );\n        const modalizerOnFocusedElement = tabsterOnFocusedElement?.modalizer;\n\n        if (modalizerOnFocusedElement) {\n            modalizerOnFocusedElement.focused();\n\n            if (\n                modalizerOnFocusedElement.userId === this.activeId &&\n                tabsterOnFocusedElement.groupper\n            ) {\n                const parentElement = tabster.getParent(focusedElement);\n                const parentModalizer =\n                    parentElement &&\n                    RootAPI.getTabsterContext(tabster, parentElement)\n                        ?.modalizer;\n\n                if (parentModalizer) {\n                    modalizer = parentModalizer;\n                } else {\n                    this.setActive(undefined);\n                    return;\n                }\n            }\n        }\n\n        // An inactive groupper with the modalizer on the same node will not give the modalizer\n        // in the context, yet we still want to track that the modalizer's container was focused.\n        modalizer?.focused();\n\n        if (modalizer?.userId === this.activeId) {\n            this.currentIsOthersAccessible =\n                modalizer?.getProps().isOthersAccessible;\n\n            return;\n        }\n\n        // Developers calling `element.focus()` should change/deactivate active modalizer\n        if (\n            detail.isFocusedProgrammatically ||\n            this.currentIsOthersAccessible ||\n            modalizer?.getProps().isAlwaysAccessible\n        ) {\n            this.setActive(modalizer);\n        } else {\n            // Focused outside of the active modalizer, try pull focus back to current modalizer\n            const win = this._win();\n            win.clearTimeout(this._restoreModalizerFocusTimer);\n            // TODO some rendering frameworks (i.e. React) might async rerender the DOM so we need to wait for a duration\n            // Figure out a better way of doing this rather than a 100ms timeout\n            this._restoreModalizerFocusTimer = win.setTimeout(\n                () => this._restoreModalizerFocus(focusedElement),\n                100\n            );\n        }\n    };\n\n    /**\n     * Called when an element is focused outside of an active modalizer.\n     * Attempts to pull focus back into the active modalizer\n     * @param outsideElement - An element being focused outside of the modalizer\n     */\n    private _restoreModalizerFocus(\n        outsideElement: HTMLElement | undefined\n    ): void {\n        const ownerDocument = outsideElement?.ownerDocument;\n\n        if (!outsideElement || !ownerDocument) {\n            return;\n        }\n\n        const focusedElement = this._tabster.focusedElement.getFocusedElement();\n        const focusedElementModalizer =\n            focusedElement &&\n            RootAPI.getTabsterContext(this._tabster, focusedElement)?.modalizer;\n\n        if (\n            !focusedElement ||\n            (focusedElement &&\n                focusedElementModalizer?.userId === this.activeId)\n        ) {\n            // If there is no currently focused element, or the currently focused element\n            // is in the active modalizer, we don't need to do anything.\n            return;\n        }\n\n        const tabster = this._tabster;\n        const ctx = RootAPI.getTabsterContext(tabster, outsideElement);\n        const modalizer = ctx?.modalizer;\n        const activeId = this.activeId;\n\n        if (\n            (!modalizer && !activeId) ||\n            (modalizer && activeId === modalizer.userId)\n        ) {\n            return;\n        }\n\n        const container = ctx?.root.getElement();\n\n        if (container) {\n            let toFocus = tabster.focusable.findFirst({\n                container,\n                useActiveModalizer: true,\n            });\n\n            if (toFocus) {\n                if (\n                    outsideElement.compareDocumentPosition(toFocus) &\n                    document.DOCUMENT_POSITION_PRECEDING\n                ) {\n                    toFocus = tabster.focusable.findLast({\n                        container,\n                        useActiveModalizer: true,\n                    });\n\n                    if (!toFocus) {\n                        // This only might mean that findFirst/findLast are buggy and inconsistent.\n                        throw new Error(\"Something went wrong.\");\n                    }\n                }\n\n                tabster.focusedElement.focus(toFocus);\n\n                return;\n            }\n        }\n\n        // Current Modalizer doesn't seem to have focusable elements.\n        // Blurring the currently focused element which is outside of the current Modalizer.\n        outsideElement.blur();\n    }\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { nativeFocus } from \"keyborg\";\nimport { FocusedElementState } from \"./State/FocusedElement\";\nimport { getTabsterOnElement } from \"./Instance\";\nimport { Keys } from \"./Keys\";\nimport { RootAPI } from \"./Root\";\nimport * as Types from \"./Types\";\nimport { Visibilities, MoverDirections, MoverKeys } from \"./Consts\";\nimport {\n    MoverMemorizedElementEvent,\n    MoverMemorizedElementEventName,\n    MoverMoveFocusEvent,\n    MoverMoveFocusEventName,\n    MoverStateEvent,\n    TabsterMoveFocusEvent,\n} from \"./Events\";\nimport {\n    createElementTreeWalker,\n    DummyInput,\n    DummyInputManager,\n    DummyInputManagerPriorities,\n    getElementUId,\n    getPromise,\n    isElementVerticallyVisibleInContainer,\n    matchesSelector,\n    scrollIntoView,\n    TabsterPart,\n    WeakHTMLElement,\n    getDummyInputContainer,\n} from \"./Utils\";\nimport { dom } from \"./DOMAPI\";\n\nconst _inputSelector = [\"input\", \"textarea\", \"*[contenteditable]\"].join(\", \");\n\nclass MoverDummyManager extends DummyInputManager {\n    private _tabster: Types.TabsterCore;\n    private _getMemorized: () => WeakHTMLElement | undefined;\n\n    constructor(\n        element: WeakHTMLElement,\n        tabster: Types.TabsterCore,\n        getMemorized: () => WeakHTMLElement | undefined,\n        sys: Types.SysProps | undefined\n    ) {\n        super(tabster, element, DummyInputManagerPriorities.Mover, sys);\n\n        this._tabster = tabster;\n        this._getMemorized = getMemorized;\n\n        this._setHandlers(this._onFocusDummyInput);\n    }\n\n    private _onFocusDummyInput = (dummyInput: DummyInput) => {\n        const container = this._element.get();\n        const input = dummyInput.input;\n\n        if (container && input) {\n            const ctx = RootAPI.getTabsterContext(this._tabster, container);\n\n            let toFocus: HTMLElement | null | undefined;\n\n            if (ctx) {\n                toFocus = FocusedElementState.findNextTabbable(\n                    this._tabster,\n                    ctx,\n                    undefined,\n                    input,\n                    undefined,\n                    !dummyInput.isFirst,\n                    true\n                )?.element;\n            }\n\n            const memorized = this._getMemorized()?.get();\n\n            if (memorized && this._tabster.focusable.isFocusable(memorized)) {\n                toFocus = memorized;\n            }\n\n            if (toFocus) {\n                nativeFocus(toFocus);\n            }\n        }\n    };\n}\n\n// TypeScript enums produce depressing JavaScript code, so, we're just using\n// a few old style constants here.\nconst _moverUpdateAdd = 1;\nconst _moverUpdateAttr = 2;\nconst _moverUpdateRemove = 3;\n\ninterface MoverUpdateQueueItem {\n    element: HTMLElement;\n    type:\n        | typeof _moverUpdateAdd\n        | typeof _moverUpdateAttr\n        | typeof _moverUpdateRemove;\n}\n\nexport class Mover\n    extends TabsterPart<Types.MoverProps>\n    implements Types.Mover\n{\n    private _unobserve: (() => void) | undefined;\n    private _intersectionObserver: IntersectionObserver | undefined;\n    private _setCurrentTimer: number | undefined;\n    private _current: WeakHTMLElement | undefined;\n    private _prevCurrent: WeakHTMLElement | undefined;\n    private _visible: Record<string, Types.Visibility> = {};\n    private _fullyVisible: string | undefined;\n    private _win: Types.GetWindow;\n    private _onDispose: (mover: Mover) => void;\n    private _allElements: WeakMap<HTMLElement, Mover> | undefined;\n    private _updateQueue: MoverUpdateQueueItem[] | undefined;\n    private _updateTimer: number | undefined;\n\n    visibilityTolerance: number;\n    dummyManager: MoverDummyManager | undefined;\n\n    constructor(\n        tabster: Types.TabsterCore,\n        element: HTMLElement,\n        onDispose: (mover: Mover) => void,\n        props: Types.MoverProps,\n        sys: Types.SysProps | undefined\n    ) {\n        super(tabster, element, props);\n\n        this._win = tabster.getWindow;\n        this.visibilityTolerance = props.visibilityTolerance ?? 0.8;\n\n        if (this._props.trackState || this._props.visibilityAware) {\n            this._intersectionObserver = new IntersectionObserver(\n                this._onIntersection,\n                { threshold: [0, 0.25, 0.5, 0.75, 1] }\n            );\n            this._observeState();\n        }\n\n        this._onDispose = onDispose;\n        const getMemorized = () =>\n            props.memorizeCurrent ? this._current : undefined;\n\n        if (!tabster.controlTab) {\n            this.dummyManager = new MoverDummyManager(\n                this._element,\n                tabster,\n                getMemorized,\n                sys\n            );\n        }\n    }\n\n    dispose(): void {\n        this._onDispose(this);\n\n        if (this._intersectionObserver) {\n            this._intersectionObserver.disconnect();\n            delete this._intersectionObserver;\n        }\n\n        delete this._current;\n        delete this._fullyVisible;\n        delete this._allElements;\n        delete this._updateQueue;\n\n        if (this._unobserve) {\n            this._unobserve();\n            delete this._unobserve;\n        }\n\n        const win = this._win();\n\n        if (this._setCurrentTimer) {\n            win.clearTimeout(this._setCurrentTimer);\n            delete this._setCurrentTimer;\n        }\n\n        if (this._updateTimer) {\n            win.clearTimeout(this._updateTimer);\n            delete this._updateTimer;\n        }\n\n        this.dummyManager?.dispose();\n        delete this.dummyManager;\n    }\n\n    setCurrent(element: HTMLElement | undefined): void {\n        if (element) {\n            this._current = new WeakHTMLElement(this._win, element);\n        } else {\n            this._current = undefined;\n        }\n\n        if (\n            (this._props.trackState || this._props.visibilityAware) &&\n            !this._setCurrentTimer\n        ) {\n            this._setCurrentTimer = this._win().setTimeout(() => {\n                delete this._setCurrentTimer;\n\n                const changed: (WeakHTMLElement | undefined)[] = [];\n\n                if (this._current !== this._prevCurrent) {\n                    changed.push(this._current);\n                    changed.push(this._prevCurrent);\n                    this._prevCurrent = this._current;\n                }\n\n                for (const weak of changed) {\n                    const el = weak?.get();\n\n                    if (el && this._allElements?.get(el) === this) {\n                        const props = this._props;\n\n                        if (\n                            el &&\n                            (props.visibilityAware !== undefined ||\n                                props.trackState)\n                        ) {\n                            const state = this.getState(el);\n\n                            if (state) {\n                                el.dispatchEvent(new MoverStateEvent(state));\n                            }\n                        }\n                    }\n                }\n            });\n        }\n    }\n\n    getCurrent(): HTMLElement | null {\n        return this._current?.get() || null;\n    }\n\n    findNextTabbable(\n        currentElement?: HTMLElement,\n        referenceElement?: HTMLElement,\n        isBackward?: boolean,\n        ignoreAccessibility?: boolean\n    ): Types.NextTabbable | null {\n        const container = this.getElement();\n        const currentIsDummy =\n            container && getDummyInputContainer(currentElement) === container;\n\n        if (!container) {\n            return null;\n        }\n\n        let next: HTMLElement | null | undefined = null;\n        let outOfDOMOrder = false;\n        let uncontrolled: HTMLElement | null | undefined;\n\n        if (\n            this._props.tabbable ||\n            currentIsDummy ||\n            (currentElement && !dom.nodeContains(container, currentElement))\n        ) {\n            const findProps: Types.FindNextProps = {\n                currentElement,\n                referenceElement,\n                container,\n                ignoreAccessibility,\n                useActiveModalizer: true,\n            };\n\n            const findPropsOut: Types.FindFocusableOutputProps = {};\n\n            next = this._tabster.focusable[\n                isBackward ? \"findPrev\" : \"findNext\"\n            ](findProps, findPropsOut);\n\n            outOfDOMOrder = !!findPropsOut.outOfDOMOrder;\n            uncontrolled = findPropsOut.uncontrolled;\n        }\n\n        return {\n            element: next,\n            uncontrolled,\n            outOfDOMOrder,\n        };\n    }\n\n    acceptElement(\n        element: HTMLElement,\n        state: Types.FocusableAcceptElementState\n    ): number | undefined {\n        if (!FocusedElementState.isTabbing) {\n            return state.currentCtx?.excludedFromMover\n                ? NodeFilter.FILTER_REJECT\n                : undefined;\n        }\n\n        const {\n            memorizeCurrent,\n            visibilityAware,\n            hasDefault = true,\n        } = this._props;\n        const moverElement = this.getElement();\n\n        if (\n            moverElement &&\n            (memorizeCurrent || visibilityAware || hasDefault) &&\n            (!dom.nodeContains(moverElement, state.from) ||\n                getDummyInputContainer(state.from) === moverElement)\n        ) {\n            let found: HTMLElement | undefined | null;\n\n            if (memorizeCurrent) {\n                const current = this._current?.get();\n\n                if (current && state.acceptCondition(current)) {\n                    found = current;\n                }\n            }\n\n            if (!found && hasDefault) {\n                found = this._tabster.focusable.findDefault({\n                    container: moverElement,\n                    useActiveModalizer: true,\n                });\n            }\n\n            if (!found && visibilityAware) {\n                found = this._tabster.focusable.findElement({\n                    container: moverElement,\n                    useActiveModalizer: true,\n                    isBackward: state.isBackward,\n                    acceptCondition: (el) => {\n                        const id = getElementUId(this._win, el);\n                        const visibility = this._visible[id];\n\n                        return (\n                            moverElement !== el &&\n                            !!this._allElements?.get(el) &&\n                            state.acceptCondition(el) &&\n                            (visibility === Visibilities.Visible ||\n                                (visibility === Visibilities.PartiallyVisible &&\n                                    (visibilityAware ===\n                                        Visibilities.PartiallyVisible ||\n                                        !this._fullyVisible)))\n                        );\n                    },\n                });\n            }\n\n            if (found) {\n                state.found = true;\n                state.foundElement = found;\n                state.rejectElementsFrom = moverElement;\n                state.skippedFocusable = true;\n                return NodeFilter.FILTER_ACCEPT;\n            }\n        }\n\n        return undefined;\n    }\n\n    private _onIntersection = (entries: IntersectionObserverEntry[]): void => {\n        for (const entry of entries) {\n            const el = entry.target as HTMLElement;\n            const id = getElementUId(this._win, el);\n\n            let newVisibility: Types.Visibility;\n            let fullyVisible = this._fullyVisible;\n\n            if (entry.intersectionRatio >= 0.25) {\n                newVisibility =\n                    entry.intersectionRatio >= 0.75\n                        ? Visibilities.Visible\n                        : Visibilities.PartiallyVisible;\n\n                if (newVisibility === Visibilities.Visible) {\n                    fullyVisible = id;\n                }\n            } else {\n                newVisibility = Visibilities.Invisible;\n            }\n\n            if (this._visible[id] !== newVisibility) {\n                if (newVisibility === undefined) {\n                    delete this._visible[id];\n\n                    if (fullyVisible === id) {\n                        delete this._fullyVisible;\n                    }\n                } else {\n                    this._visible[id] = newVisibility;\n                    this._fullyVisible = fullyVisible;\n                }\n\n                const state = this.getState(el);\n\n                if (state) {\n                    el.dispatchEvent(new MoverStateEvent(state));\n                }\n            }\n        }\n    };\n\n    private _observeState(): void {\n        const element = this.getElement();\n\n        if (\n            this._unobserve ||\n            !element ||\n            typeof MutationObserver === \"undefined\"\n        ) {\n            return;\n        }\n\n        const win = this._win();\n        const allElements = (this._allElements = new WeakMap());\n        const tabsterFocusable = this._tabster.focusable;\n        let updateQueue: MoverUpdateQueueItem[] = (this._updateQueue = []);\n\n        const observer = dom.createMutationObserver(\n            (mutations: MutationRecord[]) => {\n                for (const mutation of mutations) {\n                    const target = mutation.target;\n                    const removed = mutation.removedNodes;\n                    const added = mutation.addedNodes;\n\n                    if (mutation.type === \"attributes\") {\n                        if (mutation.attributeName === \"tabindex\") {\n                            updateQueue.push({\n                                element: target as HTMLElement,\n                                type: _moverUpdateAttr,\n                            });\n                        }\n                    } else {\n                        for (let i = 0; i < removed.length; i++) {\n                            updateQueue.push({\n                                element: removed[\n                                    i\n                                ] as HTMLElement as HTMLElement,\n                                type: _moverUpdateRemove,\n                            });\n                        }\n\n                        for (let i = 0; i < added.length; i++) {\n                            updateQueue.push({\n                                element: added[i] as HTMLElement,\n                                type: _moverUpdateAdd,\n                            });\n                        }\n                    }\n                }\n\n                requestUpdate();\n            }\n        );\n\n        const setElement = (element: HTMLElement, remove?: boolean): void => {\n            const current = allElements.get(element);\n\n            if (current && remove) {\n                this._intersectionObserver?.unobserve(element);\n                allElements.delete(element);\n            }\n\n            if (!current && !remove) {\n                allElements.set(element, this);\n                this._intersectionObserver?.observe(element);\n            }\n        };\n\n        const updateElement = (element: HTMLElement): void => {\n            const isFocusable = tabsterFocusable.isFocusable(element);\n            const current = allElements.get(element);\n\n            if (current) {\n                if (!isFocusable) {\n                    setElement(element, true);\n                }\n            } else {\n                if (isFocusable) {\n                    setElement(element);\n                }\n            }\n        };\n\n        const addNewElements = (element: HTMLElement): void => {\n            const { mover } = getMoverGroupper(element);\n\n            if (mover && mover !== this) {\n                if (\n                    mover.getElement() === element &&\n                    tabsterFocusable.isFocusable(element)\n                ) {\n                    setElement(element);\n                } else {\n                    return;\n                }\n            }\n\n            const walker = createElementTreeWalker(\n                win.document,\n                element,\n                (node: Node): number => {\n                    const { mover, groupper } = getMoverGroupper(\n                        node as HTMLElement\n                    );\n\n                    if (mover && mover !== this) {\n                        return NodeFilter.FILTER_REJECT;\n                    }\n\n                    const groupperFirstFocusable = groupper?.getFirst(true);\n\n                    if (\n                        groupper &&\n                        groupper.getElement() !== node &&\n                        groupperFirstFocusable &&\n                        groupperFirstFocusable !== node\n                    ) {\n                        return NodeFilter.FILTER_REJECT;\n                    }\n\n                    if (tabsterFocusable.isFocusable(node as HTMLElement)) {\n                        setElement(node as HTMLElement);\n                    }\n\n                    return NodeFilter.FILTER_SKIP;\n                }\n            );\n\n            if (walker) {\n                walker.currentNode = element;\n\n                while (walker.nextNode()) {\n                    /* Iterating for the sake of calling processNode() callback. */\n                }\n            }\n        };\n\n        const removeWalk = (element: HTMLElement): void => {\n            const current = allElements.get(element);\n\n            if (current) {\n                setElement(element, true);\n            }\n\n            for (\n                let el = dom.getFirstElementChild(element);\n                el;\n                el = dom.getNextElementSibling(el)\n            ) {\n                removeWalk(el as HTMLElement);\n            }\n        };\n\n        const requestUpdate = () => {\n            if (!this._updateTimer && updateQueue.length) {\n                this._updateTimer = win.setTimeout(() => {\n                    delete this._updateTimer;\n\n                    for (const { element, type } of updateQueue) {\n                        switch (type) {\n                            case _moverUpdateAttr:\n                                updateElement(element);\n                                break;\n                            case _moverUpdateAdd:\n                                addNewElements(element);\n                                break;\n                            case _moverUpdateRemove:\n                                removeWalk(element);\n                                break;\n                        }\n                    }\n\n                    updateQueue = this._updateQueue = [];\n                }, 0);\n            }\n        };\n\n        const getMoverGroupper = (\n            element: HTMLElement\n        ): { mover?: Mover; groupper?: Types.Groupper } => {\n            const ret: {\n                mover?: Mover;\n                groupper?: Types.Groupper;\n            } = {};\n\n            for (\n                let el: HTMLElement | null = element;\n                el;\n                el = dom.getParentElement(el)\n            ) {\n                const toe = getTabsterOnElement(this._tabster, el);\n\n                if (toe) {\n                    if (toe.groupper && !ret.groupper) {\n                        ret.groupper = toe.groupper;\n                    }\n\n                    if (toe.mover) {\n                        ret.mover = toe.mover as Mover;\n                        break;\n                    }\n                }\n            }\n\n            return ret;\n        };\n\n        updateQueue.push({ element, type: _moverUpdateAdd });\n        requestUpdate();\n\n        observer.observe(element, {\n            childList: true,\n            subtree: true,\n            attributes: true,\n            attributeFilter: [\"tabindex\"],\n        });\n\n        this._unobserve = () => {\n            observer.disconnect();\n        };\n    }\n\n    getState(element: HTMLElement): Types.MoverElementState | undefined {\n        const id = getElementUId(this._win, element);\n\n        if (id in this._visible) {\n            const visibility = this._visible[id] || Visibilities.Invisible;\n            const isCurrent = this._current\n                ? this._current.get() === element\n                : undefined;\n\n            return {\n                isCurrent,\n                visibility,\n            };\n        }\n\n        return undefined;\n    }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction validateMoverProps(props: Types.MoverProps): void {\n    // TODO: Implement validation.\n}\n\n/**\n * Calculates distance between two rectangles.\n *\n * @param ax1 first rectangle left\n * @param ay1 first rectangle top\n * @param ax2 first rectangle right\n * @param ay2 first rectangle bottom\n * @param bx1 second rectangle left\n * @param by1 second rectangle top\n * @param bx2 second rectangle right\n * @param by2 second rectangle bottom\n * @returns number, shortest distance between the rectangles.\n */\nfunction getDistance(\n    ax1: number,\n    ay1: number,\n    ax2: number,\n    ay2: number,\n    bx1: number,\n    by1: number,\n    bx2: number,\n    by2: number\n): number {\n    const xDistance = ax2 < bx1 ? bx1 - ax2 : bx2 < ax1 ? ax1 - bx2 : 0;\n    const yDistance = ay2 < by1 ? by1 - ay2 : by2 < ay1 ? ay1 - by2 : 0;\n\n    return xDistance === 0\n        ? yDistance\n        : yDistance === 0\n          ? xDistance\n          : Math.sqrt(xDistance * xDistance + yDistance * yDistance);\n}\n\nexport class MoverAPI implements Types.MoverAPI {\n    private _tabster: Types.TabsterCore;\n    private _win: Types.GetWindow;\n    private _movers: Record<string, Mover>;\n    private _ignoredInputTimer: number | undefined;\n    private _ignoredInputResolve: ((value: boolean) => void) | undefined;\n\n    constructor(tabster: Types.TabsterCore, getWindow: Types.GetWindow) {\n        this._tabster = tabster;\n        this._win = getWindow;\n        this._movers = {};\n\n        tabster.queueInit(this._init);\n    }\n\n    private _init = (): void => {\n        const win = this._win();\n\n        win.addEventListener(\"keydown\", this._onKeyDown, true);\n        win.addEventListener(MoverMoveFocusEventName, this._onMoveFocus);\n        win.addEventListener(\n            MoverMemorizedElementEventName,\n            this._onMemorizedElement\n        );\n\n        this._tabster.focusedElement.subscribe(this._onFocus);\n    };\n\n    dispose(): void {\n        const win = this._win();\n\n        this._tabster.focusedElement.unsubscribe(this._onFocus);\n\n        this._ignoredInputResolve?.(false);\n\n        if (this._ignoredInputTimer) {\n            win.clearTimeout(this._ignoredInputTimer);\n            delete this._ignoredInputTimer;\n        }\n\n        win.removeEventListener(\"keydown\", this._onKeyDown, true);\n        win.removeEventListener(MoverMoveFocusEventName, this._onMoveFocus);\n        win.removeEventListener(\n            MoverMemorizedElementEventName,\n            this._onMemorizedElement\n        );\n\n        Object.keys(this._movers).forEach((moverId) => {\n            if (this._movers[moverId]) {\n                this._movers[moverId].dispose();\n                delete this._movers[moverId];\n            }\n        });\n    }\n\n    createMover(\n        element: HTMLElement,\n        props: Types.MoverProps,\n        sys: Types.SysProps | undefined\n    ): Types.Mover {\n        if (__DEV__) {\n            validateMoverProps(props);\n        }\n\n        const newMover = new Mover(\n            this._tabster,\n            element,\n            this._onMoverDispose,\n            props,\n            sys\n        );\n        this._movers[newMover.id] = newMover;\n        return newMover;\n    }\n\n    private _onMoverDispose = (mover: Mover) => {\n        delete this._movers[mover.id];\n    };\n\n    private _onFocus = (element: HTMLElement | undefined): void => {\n        // When something in the app gets focused, we are making sure that\n        // the relevant context Mover is aware of it.\n        // Looking for the relevant context Mover from the currently\n        // focused element parent, not from the element itself, because the\n        // Mover element itself cannot be its own current (but might be\n        // current for its parent Mover).\n        let currentFocusableElement = element;\n        let deepestFocusableElement = element;\n\n        for (\n            let el: HTMLElement | null | undefined =\n                dom.getParentElement(element);\n            el;\n            el = dom.getParentElement(el)\n        ) {\n            // We go through all Movers up from the focused element and\n            // set their current element to the deepest focusable of that\n            // Mover.\n            const mover = getTabsterOnElement(this._tabster, el)?.mover;\n\n            if (mover) {\n                mover.setCurrent(deepestFocusableElement);\n                currentFocusableElement = undefined;\n            }\n\n            if (\n                !currentFocusableElement &&\n                this._tabster.focusable.isFocusable(el)\n            ) {\n                currentFocusableElement = deepestFocusableElement = el;\n            }\n        }\n    };\n\n    moveFocus(\n        fromElement: HTMLElement,\n        key: Types.MoverKey\n    ): HTMLElement | null {\n        return this._moveFocus(fromElement, key);\n    }\n\n    private _moveFocus(\n        fromElement: HTMLElement,\n        key: Types.MoverKey,\n        relatedEvent?: KeyboardEvent\n    ): HTMLElement | null {\n        const tabster = this._tabster;\n        const ctx = RootAPI.getTabsterContext(tabster, fromElement, {\n            checkRtl: true,\n        });\n\n        if (\n            !ctx ||\n            !ctx.mover ||\n            ctx.excludedFromMover ||\n            (relatedEvent && ctx.ignoreKeydown(relatedEvent))\n        ) {\n            return null;\n        }\n\n        const mover = ctx.mover;\n        const container = mover.getElement();\n\n        if (ctx.groupperBeforeMover) {\n            const groupper = ctx.groupper;\n\n            if (groupper && !groupper.isActive(true)) {\n                // For the cases when we have Mover/Active Groupper/Inactive Groupper, we need to check\n                // the grouppers between the current element and the current mover.\n                for (\n                    let el: HTMLElement | null | undefined =\n                        dom.getParentElement(groupper.getElement());\n                    el && el !== container;\n                    el = dom.getParentElement(el)\n                ) {\n                    if (\n                        getTabsterOnElement(tabster, el)?.groupper?.isActive(\n                            true\n                        )\n                    ) {\n                        return null;\n                    }\n                }\n            } else {\n                return null;\n            }\n        }\n\n        if (!container) {\n            return null;\n        }\n\n        const focusable = tabster.focusable;\n        const moverProps = mover.getProps();\n        const direction = moverProps.direction || MoverDirections.Both;\n        const isBoth = direction === MoverDirections.Both;\n        const isVertical = isBoth || direction === MoverDirections.Vertical;\n        const isHorizontal = isBoth || direction === MoverDirections.Horizontal;\n        const isGridLinear = direction === MoverDirections.GridLinear;\n        const isGrid = isGridLinear || direction === MoverDirections.Grid;\n        const isCyclic = moverProps.cyclic;\n\n        let next: HTMLElement | null | undefined;\n        let scrollIntoViewArg: boolean | undefined;\n\n        let focusedElementRect: DOMRect;\n        let focusedElementX1 = 0;\n        let focusedElementX2 = 0;\n\n        if (isGrid) {\n            focusedElementRect = fromElement.getBoundingClientRect();\n            focusedElementX1 = Math.ceil(focusedElementRect.left);\n            focusedElementX2 = Math.floor(focusedElementRect.right);\n        }\n\n        if (ctx.rtl) {\n            if (key === MoverKeys.ArrowRight) {\n                key = MoverKeys.ArrowLeft;\n            } else if (key === MoverKeys.ArrowLeft) {\n                key = MoverKeys.ArrowRight;\n            }\n        }\n\n        if (\n            (key === MoverKeys.ArrowDown && isVertical) ||\n            (key === MoverKeys.ArrowRight && (isHorizontal || isGrid))\n        ) {\n            next = focusable.findNext({\n                currentElement: fromElement,\n                container,\n                useActiveModalizer: true,\n            });\n\n            if (next && isGrid) {\n                const nextElementX1 = Math.ceil(\n                    next.getBoundingClientRect().left\n                );\n\n                if (!isGridLinear && focusedElementX2 > nextElementX1) {\n                    next = undefined;\n                }\n            } else if (!next && isCyclic) {\n                next = focusable.findFirst({\n                    container,\n                    useActiveModalizer: true,\n                });\n            }\n        } else if (\n            (key === MoverKeys.ArrowUp && isVertical) ||\n            (key === MoverKeys.ArrowLeft && (isHorizontal || isGrid))\n        ) {\n            next = focusable.findPrev({\n                currentElement: fromElement,\n                container,\n                useActiveModalizer: true,\n            });\n\n            if (next && isGrid) {\n                const nextElementX2 = Math.floor(\n                    next.getBoundingClientRect().right\n                );\n\n                if (!isGridLinear && nextElementX2 > focusedElementX1) {\n                    next = undefined;\n                }\n            } else if (!next && isCyclic) {\n                next = focusable.findLast({\n                    container,\n                    useActiveModalizer: true,\n                });\n            }\n        } else if (key === MoverKeys.Home) {\n            if (isGrid) {\n                focusable.findElement({\n                    container,\n                    currentElement: fromElement,\n                    useActiveModalizer: true,\n                    isBackward: true,\n                    acceptCondition: (el) => {\n                        if (!focusable.isFocusable(el)) {\n                            return false;\n                        }\n\n                        const nextElementX1 = Math.ceil(\n                            el.getBoundingClientRect().left ?? 0\n                        );\n\n                        if (\n                            el !== fromElement &&\n                            focusedElementX1 <= nextElementX1\n                        ) {\n                            return true;\n                        }\n\n                        next = el;\n                        return false;\n                    },\n                });\n            } else {\n                next = focusable.findFirst({\n                    container,\n                    useActiveModalizer: true,\n                });\n            }\n        } else if (key === MoverKeys.End) {\n            if (isGrid) {\n                focusable.findElement({\n                    container,\n                    currentElement: fromElement,\n                    useActiveModalizer: true,\n                    acceptCondition: (el) => {\n                        if (!focusable.isFocusable(el)) {\n                            return false;\n                        }\n\n                        const nextElementX1 = Math.ceil(\n                            el.getBoundingClientRect().left ?? 0\n                        );\n\n                        if (\n                            el !== fromElement &&\n                            focusedElementX1 >= nextElementX1\n                        ) {\n                            return true;\n                        }\n\n                        next = el;\n                        return false;\n                    },\n                });\n            } else {\n                next = focusable.findLast({\n                    container,\n                    useActiveModalizer: true,\n                });\n            }\n        } else if (key === MoverKeys.PageUp) {\n            focusable.findElement({\n                currentElement: fromElement,\n                container,\n                useActiveModalizer: true,\n                isBackward: true,\n                acceptCondition: (el) => {\n                    if (!focusable.isFocusable(el)) {\n                        return false;\n                    }\n\n                    if (\n                        isElementVerticallyVisibleInContainer(\n                            this._win,\n                            el,\n                            mover.visibilityTolerance\n                        )\n                    ) {\n                        next = el;\n                        return false;\n                    }\n\n                    return true;\n                },\n            });\n\n            // will be on the first column move forward and preserve previous column\n            if (isGrid && next) {\n                const firstColumnX1 = Math.ceil(\n                    next.getBoundingClientRect().left\n                );\n                focusable.findElement({\n                    currentElement: next,\n                    container,\n                    useActiveModalizer: true,\n                    acceptCondition: (el) => {\n                        if (!focusable.isFocusable(el)) {\n                            return false;\n                        }\n\n                        const nextElementX1 = Math.ceil(\n                            el.getBoundingClientRect().left\n                        );\n                        if (\n                            focusedElementX1 < nextElementX1 ||\n                            firstColumnX1 >= nextElementX1\n                        ) {\n                            return true;\n                        }\n                        next = el;\n                        return false;\n                    },\n                });\n            }\n\n            scrollIntoViewArg = false;\n        } else if (key === MoverKeys.PageDown) {\n            focusable.findElement({\n                currentElement: fromElement,\n                container,\n                useActiveModalizer: true,\n                acceptCondition: (el) => {\n                    if (!focusable.isFocusable(el)) {\n                        return false;\n                    }\n\n                    if (\n                        isElementVerticallyVisibleInContainer(\n                            this._win,\n                            el,\n                            mover.visibilityTolerance\n                        )\n                    ) {\n                        next = el;\n                        return false;\n                    }\n\n                    return true;\n                },\n            });\n\n            // will be on the last column move backwards and preserve previous column\n            if (isGrid && next) {\n                const lastColumnX1 = Math.ceil(\n                    next.getBoundingClientRect().left\n                );\n                focusable.findElement({\n                    currentElement: next,\n                    container,\n                    useActiveModalizer: true,\n                    isBackward: true,\n                    acceptCondition: (el) => {\n                        if (!focusable.isFocusable(el)) {\n                            return false;\n                        }\n\n                        const nextElementX1 = Math.ceil(\n                            el.getBoundingClientRect().left\n                        );\n                        if (\n                            focusedElementX1 > nextElementX1 ||\n                            lastColumnX1 <= nextElementX1\n                        ) {\n                            return true;\n                        }\n                        next = el;\n                        return false;\n                    },\n                });\n            }\n\n            scrollIntoViewArg = true;\n        } else if (isGrid) {\n            const isBackward = key === MoverKeys.ArrowUp;\n            const ax1 = focusedElementX1;\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            const ay1 = Math.ceil(focusedElementRect!.top);\n            const ax2 = focusedElementX2;\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            const ay2 = Math.floor(focusedElementRect!.bottom);\n            let targetElement: HTMLElement | undefined;\n            let lastDistance: number | undefined;\n            let lastIntersection = 0;\n\n            focusable.findAll({\n                container,\n                currentElement: fromElement,\n                isBackward,\n                onElement: (el) => {\n                    // Find element which has maximal intersection with the focused element horizontally,\n                    // or the closest one.\n                    const rect = el.getBoundingClientRect();\n\n                    const bx1 = Math.ceil(rect.left);\n                    const by1 = Math.ceil(rect.top);\n                    const bx2 = Math.floor(rect.right);\n                    const by2 = Math.floor(rect.bottom);\n\n                    if (\n                        (isBackward && ay1 < by2) ||\n                        (!isBackward && ay2 > by1)\n                    ) {\n                        // Only consider elements which are below/above curretly focused.\n                        return true;\n                    }\n\n                    const xIntersectionWidth =\n                        Math.ceil(Math.min(ax2, bx2)) -\n                        Math.floor(Math.max(ax1, bx1));\n                    const minWidth = Math.ceil(Math.min(ax2 - ax1, bx2 - bx1));\n\n                    if (\n                        xIntersectionWidth > 0 &&\n                        minWidth >= xIntersectionWidth\n                    ) {\n                        // Element intersects with the focused element on X axis.\n                        const intersection = xIntersectionWidth / minWidth;\n\n                        if (intersection > lastIntersection) {\n                            targetElement = el;\n                            lastIntersection = intersection;\n                        }\n                    } else if (lastIntersection === 0) {\n                        // If we didn't have intersection, try just the closest one.\n                        const distance = getDistance(\n                            ax1,\n                            ay1,\n                            ax2,\n                            ay2,\n                            bx1,\n                            by1,\n                            bx2,\n                            by2\n                        );\n\n                        if (\n                            lastDistance === undefined ||\n                            distance < lastDistance\n                        ) {\n                            lastDistance = distance;\n                            targetElement = el;\n                        }\n                    } else if (lastIntersection > 0) {\n                        // Element doesn't intersect, but we had intersection already, stop search.\n                        return false;\n                    }\n\n                    return true;\n                },\n            });\n\n            next = targetElement;\n        }\n\n        if (\n            next &&\n            (!relatedEvent ||\n                (relatedEvent &&\n                    container.dispatchEvent(\n                        new TabsterMoveFocusEvent({\n                            by: \"mover\",\n                            owner: container,\n                            next,\n                            relatedEvent,\n                        })\n                    )))\n        ) {\n            if (scrollIntoViewArg !== undefined) {\n                scrollIntoView(this._win, next, scrollIntoViewArg);\n            }\n\n            if (relatedEvent) {\n                relatedEvent.preventDefault();\n                relatedEvent.stopImmediatePropagation();\n            }\n\n            nativeFocus(next);\n\n            return next;\n        }\n\n        return null;\n    }\n\n    private _onKeyDown = async (event: KeyboardEvent): Promise<void> => {\n        if (this._ignoredInputTimer) {\n            this._win().clearTimeout(this._ignoredInputTimer);\n            delete this._ignoredInputTimer;\n        }\n\n        this._ignoredInputResolve?.(false);\n\n        // Give a chance to other listeners to handle the event (for example,\n        // to scroll instead of moving focus).\n        if (event.ctrlKey || event.altKey || event.shiftKey || event.metaKey) {\n            return;\n        }\n\n        const key = event.key;\n        let moverKey: Types.MoverKey | undefined;\n\n        if (key === Keys.ArrowDown) {\n            moverKey = MoverKeys.ArrowDown;\n        } else if (key === Keys.ArrowRight) {\n            moverKey = MoverKeys.ArrowRight;\n        } else if (key === Keys.ArrowUp) {\n            moverKey = MoverKeys.ArrowUp;\n        } else if (key === Keys.ArrowLeft) {\n            moverKey = MoverKeys.ArrowLeft;\n        } else if (key === Keys.PageDown) {\n            moverKey = MoverKeys.PageDown;\n        } else if (key === Keys.PageUp) {\n            moverKey = MoverKeys.PageUp;\n        } else if (key === Keys.Home) {\n            moverKey = MoverKeys.Home;\n        } else if (key === Keys.End) {\n            moverKey = MoverKeys.End;\n        }\n\n        if (!moverKey) {\n            return;\n        }\n\n        const focused = this._tabster.focusedElement.getFocusedElement();\n\n        if (!focused || (await this._isIgnoredInput(focused, key))) {\n            return;\n        }\n\n        this._moveFocus(focused, moverKey, event);\n    };\n\n    private _onMoveFocus = (e: MoverMoveFocusEvent): void => {\n        const element = e.composedPath()[0] as HTMLElement | null | undefined;\n        const key = e.detail?.key;\n\n        if (element && key !== undefined && !e.defaultPrevented) {\n            this._moveFocus(element, key);\n            e.stopImmediatePropagation();\n        }\n    };\n\n    private _onMemorizedElement = (e: MoverMemorizedElementEvent): void => {\n        const target = e.composedPath()[0] as HTMLElement | null | undefined;\n        let memorizedElement = e.detail?.memorizedElement;\n\n        if (target) {\n            const ctx = RootAPI.getTabsterContext(this._tabster, target);\n            const mover = ctx?.mover;\n\n            if (mover) {\n                if (\n                    memorizedElement &&\n                    !dom.nodeContains(mover.getElement(), memorizedElement)\n                ) {\n                    memorizedElement = undefined;\n                }\n\n                mover.setCurrent(memorizedElement);\n\n                e.stopImmediatePropagation();\n            }\n        }\n    };\n\n    private async _isIgnoredInput(\n        element: HTMLElement,\n        key: string\n    ): Promise<boolean> {\n        if (\n            element.getAttribute(\"aria-expanded\") === \"true\" &&\n            (element.hasAttribute(\"aria-activedescendant\") ||\n                element.getAttribute(\"role\") === \"combobox\")\n        ) {\n            // It is likely a combobox with expanded options and arrow keys are\n            // controlled by it.\n            return true;\n        }\n\n        if (matchesSelector(element, _inputSelector)) {\n            let selectionStart = 0;\n            let selectionEnd = 0;\n            let textLength = 0;\n            let asyncRet: Promise<boolean> | undefined;\n\n            if (element.tagName === \"INPUT\" || element.tagName === \"TEXTAREA\") {\n                const type = (element as HTMLInputElement).type;\n                const value = (element as HTMLInputElement).value;\n\n                textLength = (value || \"\").length;\n\n                if (type === \"email\" || type === \"number\") {\n                    // For these types Chromium doesn't provide selectionStart and selectionEnd.\n                    // Hence the ugly workaround to find if the caret position is changed with\n                    // the keypress.\n                    // TODO: Have a look at range, week, time, time, date, datetime-local.\n                    if (textLength) {\n                        const selection = dom.getSelection(element);\n\n                        if (selection) {\n                            const initialLength = selection.toString().length;\n                            const isBackward =\n                                key === Keys.ArrowLeft || key === Keys.ArrowUp;\n\n                            selection.modify(\n                                \"extend\",\n                                isBackward ? \"backward\" : \"forward\",\n                                \"character\"\n                            );\n\n                            if (initialLength !== selection.toString().length) {\n                                // The caret is moved, so, we're not on the edge of the value.\n                                // Restore original selection.\n                                selection.modify(\n                                    \"extend\",\n                                    isBackward ? \"forward\" : \"backward\",\n                                    \"character\"\n                                );\n\n                                return true;\n                            } else {\n                                textLength = 0;\n                            }\n                        }\n                    }\n                } else {\n                    const selStart = (element as HTMLInputElement)\n                        .selectionStart;\n\n                    if (selStart === null) {\n                        // Do not ignore not text editable inputs like checkboxes and radios (but ignore hidden).\n                        return type === \"hidden\";\n                    }\n\n                    selectionStart = selStart || 0;\n                    selectionEnd =\n                        (element as HTMLInputElement).selectionEnd || 0;\n                }\n            } else if (element.contentEditable === \"true\") {\n                asyncRet = new (getPromise(this._win))((resolve) => {\n                    this._ignoredInputResolve = (value: boolean) => {\n                        delete this._ignoredInputResolve;\n                        resolve(value);\n                    };\n\n                    const win = this._win();\n\n                    if (this._ignoredInputTimer) {\n                        win.clearTimeout(this._ignoredInputTimer);\n                    }\n\n                    const {\n                        anchorNode: prevAnchorNode,\n                        focusNode: prevFocusNode,\n                        anchorOffset: prevAnchorOffset,\n                        focusOffset: prevFocusOffset,\n                    } = dom.getSelection(element) || {};\n\n                    // Get selection gives incorrect value if we call it syncronously onKeyDown.\n                    this._ignoredInputTimer = win.setTimeout(() => {\n                        delete this._ignoredInputTimer;\n\n                        const {\n                            anchorNode,\n                            focusNode,\n                            anchorOffset,\n                            focusOffset,\n                        } = dom.getSelection(element) || {};\n\n                        if (\n                            anchorNode !== prevAnchorNode ||\n                            focusNode !== prevFocusNode ||\n                            anchorOffset !== prevAnchorOffset ||\n                            focusOffset !== prevFocusOffset\n                        ) {\n                            this._ignoredInputResolve?.(false);\n                            return;\n                        }\n\n                        selectionStart = anchorOffset || 0;\n                        selectionEnd = focusOffset || 0;\n                        textLength = element.textContent?.length || 0;\n\n                        if (anchorNode && focusNode) {\n                            if (\n                                dom.nodeContains(element, anchorNode) &&\n                                dom.nodeContains(element, focusNode)\n                            ) {\n                                if (anchorNode !== element) {\n                                    let anchorFound = false;\n\n                                    const addOffsets = (\n                                        node: ChildNode\n                                    ): boolean => {\n                                        if (node === anchorNode) {\n                                            anchorFound = true;\n                                        } else if (node === focusNode) {\n                                            return true;\n                                        }\n\n                                        const nodeText = node.textContent;\n\n                                        if (\n                                            nodeText &&\n                                            !dom.getFirstChild(node)\n                                        ) {\n                                            const len = nodeText.length;\n\n                                            if (anchorFound) {\n                                                if (focusNode !== anchorNode) {\n                                                    selectionEnd += len;\n                                                }\n                                            } else {\n                                                selectionStart += len;\n                                                selectionEnd += len;\n                                            }\n                                        }\n\n                                        let stop = false;\n\n                                        for (\n                                            let e = dom.getFirstChild(node);\n                                            e && !stop;\n                                            e = e.nextSibling\n                                        ) {\n                                            stop = addOffsets(e);\n                                        }\n\n                                        return stop;\n                                    };\n\n                                    addOffsets(element);\n                                }\n                            }\n                        }\n\n                        this._ignoredInputResolve?.(true);\n                    }, 0);\n                });\n            }\n\n            if (asyncRet && !(await asyncRet)) {\n                return true;\n            }\n\n            if (selectionStart !== selectionEnd) {\n                return true;\n            }\n\n            if (\n                selectionStart > 0 &&\n                (key === Keys.ArrowLeft ||\n                    key === Keys.ArrowUp ||\n                    key === Keys.Home)\n            ) {\n                return true;\n            }\n\n            if (\n                selectionStart < textLength &&\n                (key === Keys.ArrowRight ||\n                    key === Keys.ArrowDown ||\n                    key === Keys.End)\n            ) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { getTabsterOnElement } from \"./Instance\";\nimport * as Types from \"./Types\";\nimport { TABSTER_ATTRIBUTE_NAME } from \"./Consts\";\nimport {\n    createElementTreeWalker,\n    getInstanceContext,\n    HTMLElementWithUID,\n    InstanceContext,\n    WeakHTMLElement,\n} from \"./Utils\";\nimport { dom } from \"./DOMAPI\";\n\nexport function observeMutations(\n    doc: Document,\n    tabster: Types.TabsterCore,\n    updateTabsterByAttribute: (\n        tabster: Types.TabsterCore,\n        element: HTMLElementWithUID,\n        dispose?: boolean\n    ) => void,\n    syncState: boolean\n): () => void {\n    if (typeof MutationObserver === \"undefined\") {\n        return () => {\n            /* Noop */\n        };\n    }\n\n    const getWindow = tabster.getWindow;\n\n    let elementByUId: InstanceContext[\"elementByUId\"] | undefined;\n\n    const onMutation = (mutations: MutationRecord[]) => {\n        const removedNodes = new Set<Node>();\n\n        for (const mutation of mutations) {\n            const target = mutation.target;\n            const removed = mutation.removedNodes;\n            const added = mutation.addedNodes;\n\n            if (mutation.type === \"attributes\") {\n                if (mutation.attributeName === TABSTER_ATTRIBUTE_NAME) {\n                    // removedNodes helps to make sure we are not recreating things\n                    // for the removed elements.\n                    // For some reason, if we do removeChild() and setAttribute() on the\n                    // removed child in the same tick, both the child removal and the attribute\n                    // change will be present in the mutation records. And the attribute change\n                    // will follow the child removal.\n                    // So, we remember the removed nodes and ignore attribute changes for them.\n                    if (!removedNodes.has(target)) {\n                        updateTabsterByAttribute(\n                            tabster,\n                            target as HTMLElement\n                        );\n                    }\n                }\n            } else {\n                for (let i = 0; i < removed.length; i++) {\n                    const removedNode = removed[i];\n                    removedNodes.add(removedNode);\n                    updateTabsterElements(removedNode, true);\n                    tabster._dummyObserver.domChanged?.(target as HTMLElement);\n                }\n\n                for (let i = 0; i < added.length; i++) {\n                    updateTabsterElements(added[i]);\n                    tabster._dummyObserver.domChanged?.(target as HTMLElement);\n                }\n            }\n        }\n\n        removedNodes.clear();\n\n        tabster.modalizer?.hiddenUpdate();\n    };\n\n    function updateTabsterElements(node: Node, removed?: boolean): void {\n        if (!elementByUId) {\n            elementByUId = getInstanceContext(getWindow).elementByUId;\n        }\n\n        processNode(node as HTMLElement, removed);\n\n        const walker = createElementTreeWalker(\n            doc,\n            node,\n            (element: Node): number => {\n                return processNode(element as HTMLElement, removed);\n            }\n        );\n\n        if (walker) {\n            while (walker.nextNode()) {\n                /* Iterating for the sake of calling processNode() callback. */\n            }\n        }\n    }\n\n    function processNode(element: HTMLElement, removed?: boolean): number {\n        if (!element.getAttribute) {\n            // It might actually be a text node.\n            return NodeFilter.FILTER_SKIP;\n        }\n\n        const uid = (element as HTMLElementWithUID).__tabsterElementUID;\n\n        if (uid && elementByUId) {\n            if (removed) {\n                delete elementByUId[uid];\n            } else {\n                elementByUId[uid] ??= new WeakHTMLElement(getWindow, element);\n            }\n        }\n\n        if (\n            getTabsterOnElement(tabster, element) ||\n            element.hasAttribute(TABSTER_ATTRIBUTE_NAME)\n        ) {\n            updateTabsterByAttribute(tabster, element, removed);\n        }\n\n        return NodeFilter.FILTER_SKIP;\n    }\n\n    const observer = dom.createMutationObserver(onMutation);\n\n    if (syncState) {\n        updateTabsterElements(getWindow().document.body);\n    }\n\n    observer.observe(doc, {\n        childList: true,\n        subtree: true,\n        attributes: true,\n        attributeFilter: [TABSTER_ATTRIBUTE_NAME],\n    });\n\n    return () => {\n        observer.disconnect();\n    };\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { getTabsterOnElement } from \"../Instance\";\nimport * as Types from \"../Types\";\nimport {\n    ObservedElementAccessibilities,\n    ObservedElementRequestStatuses,\n    ObservedElementFailureReasons,\n} from \"../Consts\";\nimport {\n    documentContains,\n    getElementUId,\n    getPromise,\n    WeakHTMLElement,\n} from \"../Utils\";\nimport { Subscribable } from \"./Subscribable\";\n\nconst _conditionCheckTimeout = 100;\n\ninterface ObservedElementInfo {\n    element: WeakHTMLElement;\n    prevNames?: string[];\n}\n\ninterface ObservedWaiting {\n    timer?: number;\n    conditionTimer?: number;\n    request?: Types.ObservedElementAsyncRequest<HTMLElement | null>;\n    resolve?: (value: HTMLElement | null) => void;\n    reject?: () => void;\n}\n\nexport class ObservedElementAPI\n    extends Subscribable<HTMLElement, Types.ObservedElementDetails>\n    implements Types.ObservedElementAPI\n{\n    private _win: Types.GetWindow;\n    private _tabster: Types.TabsterCore;\n    private _waiting: Record<string, ObservedWaiting> = {};\n    private _lastRequestFocusId = 0;\n    private _observedById: { [uid: string]: ObservedElementInfo } = {};\n    private _observedByName: {\n        [name: string]: { [uid: string]: ObservedElementInfo };\n    } = {};\n    private _currentRequest:\n        | Types.ObservedElementAsyncRequest<HTMLElement | null>\n        | undefined;\n    private _currentRequestTimestamp = 0;\n    onObservedElementChange?: (change: Types.ObservedElementChange) => void;\n\n    constructor(tabster: Types.TabsterCore) {\n        super();\n        this._tabster = tabster;\n        this._win = tabster.getWindow;\n\n        tabster.queueInit(() => {\n            this._tabster.focusedElement.subscribe(this._onFocus);\n        });\n    }\n\n    dispose(): void {\n        this._tabster.focusedElement.unsubscribe(this._onFocus);\n\n        for (const key of Object.keys(this._waiting)) {\n            this._rejectWaiting(key);\n        }\n\n        this._observedById = {};\n        this._observedByName = {};\n        this.onObservedElementChange = undefined;\n    }\n\n    private _onFocus = (e: HTMLElement | undefined): void => {\n        if (e) {\n            const current = this._currentRequest;\n\n            if (current) {\n                const delta = Date.now() - this._currentRequestTimestamp;\n                const settleTime = 300;\n\n                if (delta >= settleTime) {\n                    // Giving some time for the focus to settle before\n                    // automatically cancelling the current request on focus change.\n                    delete this._currentRequest;\n\n                    // Provide callback to access focused element using WeakRef to avoid memory leaks\n                    const elementRef = new WeakRef(e);\n                    current.diagnostics.getCancelTriggeringElement = () =>\n                        elementRef.deref() ?? null;\n                    current.diagnostics.reason =\n                        ObservedElementFailureReasons.CanceledFocusChange;\n                    current.cancel();\n                }\n            }\n        }\n    };\n\n    private _rejectWaiting(key: string, shouldResolve?: boolean): void {\n        const w = this._waiting[key];\n\n        if (w) {\n            const win = this._win();\n\n            if (w.timer) {\n                win.clearTimeout(w.timer);\n            }\n\n            if (w.conditionTimer) {\n                win.clearTimeout(w.conditionTimer);\n            }\n\n            if (!shouldResolve && w.reject) {\n                w.reject();\n            } else if (shouldResolve && w.resolve) {\n                w.resolve(null);\n            }\n\n            delete this._waiting[key];\n        }\n    }\n\n    private _populateTimeoutDiagnostics(\n        request: Types.ObservedElementAsyncRequest<HTMLElement | null>,\n        observedName: string,\n        timeout: number,\n        startTime: number\n    ): void {\n        const elementInDOM = this.getElement(observedName);\n        const inDOM = !!elementInDOM;\n        let isAccessible: boolean | undefined;\n        let isFocusable: boolean | undefined;\n        let reason: Types.ObservedElementFailureReason;\n\n        if (!elementInDOM) {\n            reason = ObservedElementFailureReasons.TimeoutElementNotInDOM;\n        } else {\n            isAccessible = this._tabster.focusable.isAccessible(elementInDOM);\n            isFocusable = this._tabster.focusable.isFocusable(\n                elementInDOM,\n                true\n            );\n\n            if (!isAccessible) {\n                reason =\n                    ObservedElementFailureReasons.TimeoutElementNotAccessible;\n            } else if (!isFocusable) {\n                reason =\n                    ObservedElementFailureReasons.TimeoutElementNotFocusable;\n            } else {\n                reason = ObservedElementFailureReasons.TimeoutElementNotReady;\n            }\n        }\n\n        request.diagnostics.reason = reason;\n        request.diagnostics.waitForElementDuration = Date.now() - startTime;\n        request.diagnostics.targetState = {\n            inDOM,\n            isAccessible,\n            isFocusable,\n        };\n    }\n\n    private _isObservedNamesUpdated(cur: string[], prev?: string[]) {\n        if (!prev || cur.length !== prev.length) {\n            return true;\n        }\n        for (let i = 0; i < cur.length; ++i) {\n            if (cur[i] !== prev[i]) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    private _notifyObservedElementChange(\n        element: HTMLElement,\n        observedNames: string[],\n        prevNames: string[] | undefined,\n        isNewElement: boolean\n    ): void {\n        if (!this.onObservedElementChange) {\n            return;\n        }\n\n        const addedNames = observedNames.filter(\n            (name) => !prevNames || !prevNames.includes(name)\n        );\n        const removedNames = prevNames\n            ? prevNames.filter((name) => !observedNames.includes(name))\n            : [];\n\n        if (isNewElement) {\n            // Brand new element added\n            this.onObservedElementChange({\n                element,\n                type: \"added\",\n                names: observedNames,\n                addedNames: observedNames,\n            });\n        } else if (addedNames.length > 0 || removedNames.length > 0) {\n            // Existing element with names updated\n            this.onObservedElementChange({\n                element,\n                type: \"updated\",\n                names: observedNames,\n                addedNames: addedNames.length > 0 ? addedNames : undefined,\n                removedNames:\n                    removedNames.length > 0 ? removedNames : undefined,\n            });\n        }\n    }\n\n    /**\n     * Returns all registered observed names with their respective elements and full names arrays\n     *\n     * @returns Map<string, Array<{ element: HTMLElement; names: string[] }>> A map where keys are observed names\n     * and values are arrays of objects containing the element and its complete names array (in the order they were defined)\n     */\n    getAllObservedElements(): Map<\n        string,\n        Array<{ element: HTMLElement; names: string[] }>\n    > {\n        const result = new Map<\n            string,\n            Array<{ element: HTMLElement; names: string[] }>\n        >();\n\n        for (const name of Object.keys(this._observedByName)) {\n            const elementsWithNames: Array<{\n                element: HTMLElement;\n                names: string[];\n            }> = [];\n            const observed = this._observedByName[name];\n\n            for (const uid of Object.keys(observed)) {\n                const el = observed[uid].element.get();\n                if (el) {\n                    const info = this._observedById[uid];\n                    elementsWithNames.push({\n                        element: el,\n                        names: info?.prevNames || [],\n                    });\n                }\n            }\n\n            if (elementsWithNames.length > 0) {\n                result.set(name, elementsWithNames);\n            }\n        }\n\n        return result;\n    }\n\n    /**\n     * Returns existing element by observed name\n     *\n     * @param observedName An observed name\n     * @param accessibility Optionally, return only if the element is accessible or focusable\n     * @returns HTMLElement | null\n     */\n    getElement(\n        observedName: string,\n        accessibility?: Types.ObservedElementAccessibility\n    ): HTMLElement | null {\n        const o = this._observedByName[observedName];\n\n        if (o) {\n            for (const uid of Object.keys(o)) {\n                let el = o[uid].element.get() || null;\n                if (el) {\n                    if (\n                        (accessibility ===\n                            ObservedElementAccessibilities.Accessible &&\n                            !this._tabster.focusable.isAccessible(el)) ||\n                        (accessibility ===\n                            ObservedElementAccessibilities.Focusable &&\n                            !this._tabster.focusable.isFocusable(el, true))\n                    ) {\n                        el = null;\n                    }\n                } else {\n                    delete o[uid];\n                    delete this._observedById[uid];\n                }\n\n                return el;\n            }\n        }\n\n        return null;\n    }\n\n    /**\n     * Waits for the element to appear in the DOM and returns it.\n     *\n     * @param observedName An observed name\n     * @param timeout Wait no longer than this timeout\n     * @param accessibility Optionally, wait for the element to also become accessible or focusable before returning it\n     * @returns Promise<HTMLElement | null>\n     */\n    waitElement(\n        observedName: string,\n        timeout: number,\n        accessibility?: Types.ObservedElementAccessibility\n    ): Types.ObservedElementAsyncRequest<HTMLElement | null> {\n        const startTime = Date.now();\n        const el = this.getElement(observedName, accessibility);\n\n        if (el) {\n            return {\n                result: getPromise(this._win).resolve(el),\n                cancel: () => {\n                    /**/\n                },\n                status: ObservedElementRequestStatuses.Succeeded,\n                diagnostics: {\n                    waitForElementDuration: Date.now() - startTime,\n                },\n            };\n        }\n\n        let prefix: string;\n\n        if (accessibility === ObservedElementAccessibilities.Accessible) {\n            prefix = \"a\";\n        } else if (accessibility === ObservedElementAccessibilities.Focusable) {\n            prefix = \"f\";\n        } else {\n            prefix = \"_\";\n        }\n\n        const key = prefix + observedName;\n        let w = this._waiting[key];\n\n        if (w && w.request) {\n            return w.request;\n        }\n\n        w = this._waiting[key] = {\n            timer: this._win().setTimeout(() => {\n                if (w.conditionTimer) {\n                    this._win().clearTimeout(w.conditionTimer);\n                }\n\n                delete this._waiting[key];\n\n                if (w.request) {\n                    w.request.status = ObservedElementRequestStatuses.TimedOut;\n                    this._populateTimeoutDiagnostics(\n                        w.request,\n                        observedName,\n                        timeout,\n                        startTime\n                    );\n                }\n\n                if (w.resolve) {\n                    w.resolve(null);\n                }\n            }, timeout),\n        };\n\n        const promise = new (getPromise(this._win))<HTMLElement | null>(\n            (resolve, reject) => {\n                w.resolve = resolve;\n                w.reject = reject;\n            }\n        ).catch(() => {\n            // Ignore the error, it is expected to be rejected when the request is canceled.\n            return null;\n        });\n\n        const request: Types.ObservedElementAsyncRequest<HTMLElement | null> = {\n            result: promise,\n            cancel: () => {\n                if (request.status === ObservedElementRequestStatuses.Waiting) {\n                    // cancel() function is callable by user, someone might call it after request is finished,\n                    // we are making sure that status of a finished request is not overriden.\n                    request.status = ObservedElementRequestStatuses.Canceled;\n                    request.diagnostics.waitForElementDuration =\n                        Date.now() - startTime;\n                }\n                this._rejectWaiting(key, true);\n            },\n            status: ObservedElementRequestStatuses.Waiting,\n            diagnostics: {},\n        };\n\n        w.request = request;\n\n        if (accessibility && this.getElement(observedName)) {\n            // If the observed element is alread in DOM, but not accessible yet,\n            // we need to run the wait logic.\n            this._waitConditional(observedName);\n        }\n\n        return request;\n    }\n\n    requestFocus(\n        observedName: string,\n        timeout: number,\n        options: Pick<FocusOptions, \"preventScroll\"> = {}\n    ): Types.ObservedElementAsyncRequest<boolean> {\n        const requestId = ++this._lastRequestFocusId;\n        const currentRequestFocus = this._currentRequest;\n\n        if (currentRequestFocus) {\n            currentRequestFocus.diagnostics.reason =\n                ObservedElementFailureReasons.SupersededByNewRequest;\n            currentRequestFocus.cancel();\n        }\n\n        const request = this.waitElement(\n            observedName,\n            timeout,\n            ObservedElementAccessibilities.Focusable\n        );\n\n        this._currentRequest = request;\n        this._currentRequestTimestamp = Date.now();\n\n        const ret: Types.ObservedElementAsyncRequest<boolean> = {\n            result: request.result.then((element) => {\n                if (this._lastRequestFocusId !== requestId) {\n                    request.diagnostics.reason =\n                        ObservedElementFailureReasons.SupersededByNewRequest;\n                    return false;\n                }\n\n                if (!element) {\n                    // Element was not found - reason should already be set by timeout or cancellation\n                    // If not set, default to timeout reason\n                    if (request.diagnostics.reason === undefined) {\n                        request.diagnostics.reason =\n                            ObservedElementFailureReasons.TimeoutElementNotInDOM;\n                    }\n                    return false;\n                }\n\n                const focusResult = this._tabster.focusedElement.focus(\n                    element,\n                    true,\n                    undefined,\n                    options.preventScroll\n                );\n\n                if (!focusResult) {\n                    // Focus call failed\n                    request.diagnostics.reason =\n                        ObservedElementFailureReasons.FocusCallFailed;\n                }\n\n                return focusResult;\n            }),\n            cancel: () => {\n                request.cancel();\n            },\n            status: request.status,\n            diagnostics: request.diagnostics,\n        };\n\n        request.result.finally(() => {\n            if (this._currentRequest === request) {\n                delete this._currentRequest;\n            }\n\n            ret.status = request.status;\n        });\n\n        return ret;\n    }\n\n    onObservedElementUpdate = (element: HTMLElement): void => {\n        const observed = getTabsterOnElement(this._tabster, element)?.observed;\n        const uid = getElementUId(this._win, element);\n        let info: ObservedElementInfo | undefined = this._observedById[uid];\n\n        if (observed && documentContains(element.ownerDocument, element)) {\n            const isNewElement = !info;\n\n            if (!info) {\n                info = this._observedById[uid] = {\n                    element: new WeakHTMLElement(this._win, element),\n                };\n            }\n\n            observed.names.sort();\n            const observedNames = observed.names;\n            const prevNames = info.prevNames; // prevNames are already sorted\n\n            if (this._isObservedNamesUpdated(observedNames, prevNames)) {\n                if (prevNames) {\n                    prevNames.forEach((prevName) => {\n                        const obn = this._observedByName[prevName];\n\n                        if (obn && obn[uid]) {\n                            if (Object.keys(obn).length > 1) {\n                                delete obn[uid];\n                            } else {\n                                delete this._observedByName[prevName];\n                            }\n                        }\n                    });\n                }\n\n                info.prevNames = observedNames;\n\n                this._notifyObservedElementChange(\n                    element,\n                    observedNames,\n                    prevNames,\n                    isNewElement\n                );\n            }\n\n            observedNames.forEach((observedName) => {\n                let obn = this._observedByName[observedName];\n\n                if (!obn) {\n                    obn = this._observedByName[observedName] = {};\n                }\n\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                obn[uid] = info!;\n\n                this._waitConditional(observedName);\n            });\n        } else if (info) {\n            const prevNames = info.prevNames;\n\n            if (prevNames) {\n                prevNames.forEach((prevName) => {\n                    const obn = this._observedByName[prevName];\n\n                    if (obn && obn[uid]) {\n                        if (Object.keys(obn).length > 1) {\n                            delete obn[uid];\n                        } else {\n                            delete this._observedByName[prevName];\n                        }\n                    }\n                });\n\n                this.onObservedElementChange?.({\n                    element,\n                    type: \"removed\",\n                    names: [],\n                    removedNames: prevNames,\n                });\n            }\n\n            delete this._observedById[uid];\n        }\n    };\n\n    private _waitConditional(observedName: string): void {\n        const waitingElementKey = \"_\" + observedName;\n        const waitingAccessibleElementKey = \"a\" + observedName;\n        const waitingFocusableElementKey = \"f\" + observedName;\n        const waitingElement = this._waiting[waitingElementKey];\n        const waitingAccessibleElement =\n            this._waiting[waitingAccessibleElementKey];\n        const waitingFocusableElement =\n            this._waiting[waitingFocusableElementKey];\n        const win = this._win();\n\n        const resolve = (\n            element: HTMLElement,\n            key: string,\n            waiting: ObservedWaiting,\n            accessibility: Types.ObservedElementAccessibility\n        ) => {\n            const observed = getTabsterOnElement(\n                this._tabster,\n                element\n            )?.observed;\n\n            if (!observed || !observed.names.includes(observedName)) {\n                return;\n            }\n\n            if (waiting.timer) {\n                win.clearTimeout(waiting.timer);\n            }\n\n            delete this._waiting[key];\n\n            if (waiting.request) {\n                waiting.request.status =\n                    ObservedElementRequestStatuses.Succeeded;\n            }\n\n            if (waiting.resolve) {\n                waiting.resolve(element);\n            }\n\n            this.trigger(element, {\n                names: [observedName],\n                details: observed.details,\n                accessibility,\n            });\n        };\n\n        if (waitingElement) {\n            const element = this.getElement(observedName);\n\n            if (element && documentContains(element.ownerDocument, element)) {\n                resolve(\n                    element,\n                    waitingElementKey,\n                    waitingElement,\n                    ObservedElementAccessibilities.Any\n                );\n            }\n        }\n\n        if (\n            waitingAccessibleElement &&\n            !waitingAccessibleElement.conditionTimer\n        ) {\n            const resolveAccessible = () => {\n                const element = this.getElement(observedName);\n\n                if (\n                    element &&\n                    documentContains(element.ownerDocument, element) &&\n                    this._tabster.focusable.isAccessible(element)\n                ) {\n                    resolve(\n                        element,\n                        waitingAccessibleElementKey,\n                        waitingAccessibleElement,\n                        ObservedElementAccessibilities.Accessible\n                    );\n                } else {\n                    waitingAccessibleElement.conditionTimer = win.setTimeout(\n                        resolveAccessible,\n                        _conditionCheckTimeout\n                    );\n                }\n            };\n\n            resolveAccessible();\n        }\n\n        if (\n            waitingFocusableElement &&\n            !waitingFocusableElement.conditionTimer\n        ) {\n            const resolveFocusable = () => {\n                const element = this.getElement(observedName);\n\n                if (\n                    element &&\n                    documentContains(element.ownerDocument, element) &&\n                    this._tabster.focusable.isFocusable(element, true)\n                ) {\n                    resolve(\n                        element,\n                        waitingFocusableElementKey,\n                        waitingFocusableElement,\n                        ObservedElementAccessibilities.Focusable\n                    );\n                } else {\n                    waitingFocusableElement.conditionTimer = win.setTimeout(\n                        resolveFocusable,\n                        _conditionCheckTimeout\n                    );\n                }\n            };\n\n            resolveFocusable();\n        }\n    }\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { getTabsterOnElement } from \"./Instance\";\nimport * as Types from \"./Types\";\nimport { getBoundingRect } from \"./Utils\";\n\ninterface WindowWithOutlineStyle extends Window {\n    __tabsterOutline?: {\n        style?: HTMLStyleElement;\n        elements?: Types.OutlineElements;\n    };\n}\n\nconst defaultProps: Types.OutlineProps = {\n    areaClass: \"tabster-focus-outline-area\",\n    outlineClass: \"tabster-focus-outline\",\n    outlineColor: \"#ff4500\",\n    outlineWidth: 2,\n    zIndex: 2147483647,\n};\n\nlet _props: Types.OutlineProps = defaultProps;\n\nclass OutlinePosition {\n    public left: number;\n    public top: number;\n    public right: number;\n    public bottom: number;\n\n    constructor(left: number, top: number, right: number, bottom: number) {\n        this.left = left;\n        this.top = top;\n        this.right = right;\n        this.bottom = bottom;\n    }\n\n    public equalsTo(other: OutlinePosition): boolean {\n        return (\n            this.left === other.left &&\n            this.top === other.top &&\n            this.right === other.right &&\n            this.bottom === other.bottom\n        );\n    }\n\n    public clone(): OutlinePosition {\n        return new OutlinePosition(\n            this.left,\n            this.top,\n            this.right,\n            this.bottom\n        );\n    }\n}\n\nexport class OutlineAPI implements Types.OutlineAPI {\n    private _tabster: Types.TabsterCore;\n    private _win: Types.GetWindow;\n    private _updateTimer: number | undefined;\n    private _outlinedElement: HTMLElement | undefined;\n    private _curPos: OutlinePosition | undefined;\n    private _isVisible = false;\n    private _curOutlineElements: Types.OutlineElements | undefined;\n    private _allOutlineElements: Types.OutlineElements[] = [];\n    private _fullScreenElement: HTMLElement | undefined;\n    private _fullScreenEventName: string | undefined;\n    private _fullScreenElementName: string | undefined;\n\n    constructor(tabster: Types.TabsterCore) {\n        this._tabster = tabster;\n        this._win = tabster.getWindow;\n\n        tabster.queueInit(this._init);\n\n        if (typeof document !== \"undefined\") {\n            if (\"onfullscreenchange\" in document) {\n                this._fullScreenEventName = \"fullscreenchange\";\n                this._fullScreenElementName = \"fullscreenElement\";\n            } else if (\"onwebkitfullscreenchange\" in document) {\n                this._fullScreenEventName = \"webkitfullscreenchange\";\n                this._fullScreenElementName = \"webkitFullscreenElement\";\n            } else if (\"onmozfullscreenchange\" in document) {\n                this._fullScreenEventName = \"mozfullscreenchange\";\n                this._fullScreenElementName = \"mozFullScreenElement\";\n            } else if (\"onmsfullscreenchange\" in document) {\n                this._fullScreenEventName = \"msfullscreenchange\";\n                this._fullScreenElementName = \"msFullscreenElement\";\n            }\n        }\n    }\n\n    private _init = (): void => {\n        this._tabster.keyboardNavigation.subscribe(\n            this._onKeyboardNavigationStateChanged\n        );\n        this._tabster.focusedElement.subscribe(this._onFocus);\n\n        const win = this._win();\n\n        win.addEventListener(\"scroll\", this._onScroll, true); // Capture!\n\n        if (this._fullScreenEventName) {\n            win.document.addEventListener(\n                this._fullScreenEventName,\n                this._onFullScreenChanged\n            );\n        }\n    };\n\n    setup(props?: Partial<Types.OutlineProps>): void {\n        _props = { ..._props, ...props };\n\n        const win = this._win() as WindowWithOutlineStyle;\n\n        if (!win.__tabsterOutline) {\n            win.__tabsterOutline = {};\n        }\n\n        if (!win.__tabsterOutline.style) {\n            win.__tabsterOutline.style = appendStyles(win.document, _props);\n        }\n\n        if (!props || !props.areaClass) {\n            win.document.body.classList.add(defaultProps.areaClass);\n        } else {\n            win.document.body.classList.remove(defaultProps.areaClass);\n        }\n    }\n\n    dispose(): void {\n        const win = this._win();\n\n        if (this._updateTimer) {\n            win.clearTimeout(this._updateTimer);\n            this._updateTimer = undefined;\n        }\n\n        this._tabster.keyboardNavigation.unsubscribe(\n            this._onKeyboardNavigationStateChanged\n        );\n        this._tabster.focusedElement.unsubscribe(this._onFocus);\n\n        win.removeEventListener(\"scroll\", this._onScroll, true);\n\n        if (this._fullScreenEventName) {\n            win.document.removeEventListener(\n                this._fullScreenEventName,\n                this._onFullScreenChanged\n            );\n        }\n\n        this._allOutlineElements.forEach((outlineElements) =>\n            this._removeDOM(outlineElements.container)\n        );\n        this._allOutlineElements = [];\n\n        delete this._outlinedElement;\n        delete this._curPos;\n        delete this._curOutlineElements;\n        delete this._fullScreenElement;\n    }\n\n    private _onFullScreenChanged = (e: Event): void => {\n        if (!this._fullScreenElementName || !e.target) {\n            return;\n        }\n\n        const target = (e.target as Document).body || (e.target as HTMLElement);\n        const outlineElements = this._getDOM(target);\n\n        if (target.ownerDocument && outlineElements) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            const fsElement: HTMLElement | null = (target.ownerDocument as any)[\n                this._fullScreenElementName\n            ];\n\n            if (fsElement) {\n                fsElement.appendChild(outlineElements.container);\n                this._fullScreenElement = fsElement;\n            } else {\n                target.ownerDocument.body.appendChild(\n                    outlineElements.container\n                );\n                this._fullScreenElement = undefined;\n            }\n        }\n    };\n\n    private _onKeyboardNavigationStateChanged = (): void => {\n        this._onFocus(this._tabster.focusedElement.getFocusedElement());\n    };\n\n    private _shouldShowCustomOutline(element: HTMLElement): boolean {\n        const tabsterOnElement = getTabsterOnElement(this._tabster, element);\n\n        if (\n            tabsterOnElement &&\n            tabsterOnElement.outline &&\n            tabsterOnElement.outline.isIgnored\n        ) {\n            return false;\n        }\n\n        for (let i: HTMLElement | null = element; i; i = i.parentElement) {\n            if (i.classList && i.classList.contains(_props.areaClass)) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    private _onFocus = (e: HTMLElement | undefined): void => {\n        if (!this._updateElement(e) && this._isVisible) {\n            this._setVisibility(false);\n        }\n    };\n\n    private _updateElement(e: HTMLElement | undefined): boolean {\n        this._outlinedElement = undefined;\n\n        if (this._updateTimer) {\n            this._win().clearTimeout(this._updateTimer);\n            this._updateTimer = undefined;\n        }\n\n        this._curPos = undefined;\n\n        if (!this._tabster.keyboardNavigation.isNavigatingWithKeyboard()) {\n            return false;\n        }\n\n        if (e) {\n            // TODO: It's hard (and not necessary) to come up with every possible\n            // condition when there should be no outline, it's better to add an\n            // API to customize the ignores.\n            if (e.tagName === \"INPUT\") {\n                const inputType = (e as HTMLInputElement).type;\n                const outlinedInputTypes = {\n                    button: true,\n                    checkbox: true,\n                    file: true,\n                    image: true,\n                    radio: true,\n                    range: true,\n                    reset: true,\n                    submit: true,\n                };\n\n                if (!(inputType in outlinedInputTypes)) {\n                    return false;\n                }\n            } else if (\n                e.tagName === \"TEXTAREA\" ||\n                e.contentEditable === \"true\" ||\n                e.tagName === \"IFRAME\"\n            ) {\n                return false;\n            }\n\n            if (!this._shouldShowCustomOutline(e)) {\n                return false;\n            }\n\n            if (this._tabster.keyboardNavigation.isNavigatingWithKeyboard()) {\n                this._outlinedElement = e;\n                this._updateOutline();\n            }\n\n            return true;\n        }\n\n        return false;\n    }\n\n    private _onScroll = (e: UIEvent): void => {\n        if (\n            !this._outlinedElement ||\n            !OutlineAPI._isParentChild(\n                e.target as HTMLElement,\n                this._outlinedElement\n            )\n        ) {\n            return;\n        }\n\n        this._curPos = undefined;\n\n        this._setOutlinePosition();\n    };\n\n    private _updateOutline(): void {\n        this._setOutlinePosition();\n\n        if (this._updateTimer) {\n            this._win().clearTimeout(this._updateTimer);\n            this._updateTimer = undefined;\n        }\n\n        if (!this._outlinedElement) {\n            return;\n        }\n\n        this._updateTimer = this._win().setTimeout(() => {\n            this._updateTimer = undefined;\n            this._updateOutline();\n        }, 30);\n    }\n\n    private _setVisibility(visible: boolean): void {\n        this._isVisible = visible;\n\n        if (this._curOutlineElements) {\n            if (visible) {\n                this._curOutlineElements.container.classList.add(\n                    `${_props.outlineClass}_visible`\n                );\n            } else {\n                this._curOutlineElements.container.classList.remove(\n                    `${_props.outlineClass}_visible`\n                );\n                this._curPos = undefined;\n            }\n        }\n    }\n\n    private _setOutlinePosition(): void {\n        if (!this._outlinedElement) {\n            return;\n        }\n\n        let boundingRect = getBoundingRect(this._win, this._outlinedElement);\n\n        const position = new OutlinePosition(\n            boundingRect.left,\n            boundingRect.top,\n            boundingRect.right,\n            boundingRect.bottom\n        );\n\n        if (this._curPos && position.equalsTo(this._curPos)) {\n            return;\n        }\n\n        const outlineElements = this._getDOM(this._outlinedElement);\n        const win =\n            this._outlinedElement.ownerDocument &&\n            this._outlinedElement.ownerDocument.defaultView;\n\n        if (!outlineElements || !win) {\n            return;\n        }\n\n        if (this._curOutlineElements !== outlineElements) {\n            this._setVisibility(false);\n            this._curOutlineElements = outlineElements;\n        }\n\n        this._curPos = position;\n\n        const p = position.clone();\n        let hasAbsolutePositionedParent = false;\n        let hasFixedPositionedParent = false;\n\n        const container = outlineElements.container;\n        const scrollingElement =\n            container &&\n            container.ownerDocument &&\n            (container.ownerDocument.scrollingElement as HTMLElement);\n\n        if (!scrollingElement) {\n            return;\n        }\n\n        for (\n            let parent = this._outlinedElement.parentElement;\n            parent && parent.nodeType === Node.ELEMENT_NODE;\n            parent = parent.parentElement\n        ) {\n            // The element might be partially visible within its scrollable parent,\n            // reduce the bounding rect if this is the case.\n\n            if (parent === this._fullScreenElement) {\n                break;\n            }\n\n            boundingRect = getBoundingRect(this._win, parent);\n\n            const win =\n                parent.ownerDocument && parent.ownerDocument.defaultView;\n\n            if (!win) {\n                return;\n            }\n\n            const computedStyle = win.getComputedStyle(parent);\n            const position = computedStyle.position;\n\n            if (position === \"absolute\") {\n                hasAbsolutePositionedParent = true;\n            } else if (position === \"fixed\" || position === \"sticky\") {\n                hasFixedPositionedParent = true;\n            }\n\n            if (computedStyle.overflow === \"visible\") {\n                continue;\n            }\n\n            if (\n                (!hasAbsolutePositionedParent && !hasFixedPositionedParent) ||\n                computedStyle.overflow === \"hidden\"\n            ) {\n                if (boundingRect.left > p.left) {\n                    p.left = boundingRect.left;\n                }\n                if (boundingRect.top > p.top) {\n                    p.top = boundingRect.top;\n                }\n                if (boundingRect.right < p.right) {\n                    p.right = boundingRect.right;\n                }\n                if (boundingRect.bottom < p.bottom) {\n                    p.bottom = boundingRect.bottom;\n                }\n            }\n        }\n\n        const allRect = getBoundingRect(this._win, scrollingElement);\n        const allWidth = allRect.left + allRect.right;\n        const allHeight = allRect.top + allRect.bottom;\n        const ow = _props.outlineWidth;\n\n        p.left = p.left > ow ? p.left - ow : 0;\n        p.top = p.top > ow ? p.top - ow : 0;\n        p.right = p.right < allWidth - ow ? p.right + ow : allWidth;\n        p.bottom = p.bottom < allHeight - ow ? p.bottom + ow : allHeight;\n\n        const width = p.right - p.left;\n        const height = p.bottom - p.top;\n\n        if (width > ow * 2 && height > ow * 2) {\n            const leftBorderNode = outlineElements.left;\n            const topBorderNode = outlineElements.top;\n            const rightBorderNode = outlineElements.right;\n            const bottomBorderNode = outlineElements.bottom;\n            const sx =\n                this._fullScreenElement || hasFixedPositionedParent\n                    ? 0\n                    : win.pageXOffset;\n            const sy =\n                this._fullScreenElement || hasFixedPositionedParent\n                    ? 0\n                    : win.pageYOffset;\n\n            container.style.position = hasFixedPositionedParent\n                ? \"fixed\"\n                : \"absolute\";\n\n            container.style.background = _props.outlineColor;\n\n            leftBorderNode.style.width =\n                rightBorderNode.style.width =\n                topBorderNode.style.height =\n                bottomBorderNode.style.height =\n                    _props.outlineWidth + \"px\";\n\n            leftBorderNode.style.left =\n                topBorderNode.style.left =\n                bottomBorderNode.style.left =\n                    p.left + sx + \"px\";\n            rightBorderNode.style.left = p.left + sx + width - ow + \"px\";\n\n            leftBorderNode.style.top =\n                rightBorderNode.style.top =\n                topBorderNode.style.top =\n                    p.top + sy + \"px\";\n            bottomBorderNode.style.top = p.top + sy + height - ow + \"px\";\n\n            leftBorderNode.style.height = rightBorderNode.style.height =\n                height + \"px\";\n\n            topBorderNode.style.width = bottomBorderNode.style.width =\n                width + \"px\";\n\n            this._setVisibility(true);\n        } else {\n            this._setVisibility(false);\n        }\n    }\n\n    private _getDOM(\n        contextElement: HTMLElement\n    ): Types.OutlineElements | undefined {\n        const doc = contextElement.ownerDocument;\n        const win = (doc && doc.defaultView) as WindowWithOutlineStyle;\n\n        if (!doc || !win || !win.__tabsterOutline) {\n            return undefined;\n        }\n\n        if (!win.__tabsterOutline.style) {\n            win.__tabsterOutline.style = appendStyles(doc, _props);\n        }\n\n        if (!win.__tabsterOutline.elements) {\n            const outlineElements: Types.OutlineElements = {\n                container: doc.createElement(\"div\"),\n                left: doc.createElement(\"div\"),\n                top: doc.createElement(\"div\"),\n                right: doc.createElement(\"div\"),\n                bottom: doc.createElement(\"div\"),\n            };\n\n            outlineElements.container.className = _props.outlineClass;\n            outlineElements.left.className = `${_props.outlineClass}__left`;\n            outlineElements.top.className = `${_props.outlineClass}__top`;\n            outlineElements.right.className = `${_props.outlineClass}__right`;\n            outlineElements.bottom.className = `${_props.outlineClass}__bottom`;\n\n            outlineElements.container.appendChild(outlineElements.left);\n            outlineElements.container.appendChild(outlineElements.top);\n            outlineElements.container.appendChild(outlineElements.right);\n            outlineElements.container.appendChild(outlineElements.bottom);\n\n            doc.body.appendChild(outlineElements.container);\n\n            win.__tabsterOutline.elements = outlineElements;\n\n            // TODO: Make a garbage collector to remove the references\n            // to the outlines which are nowhere in the DOM anymore.\n            this._allOutlineElements.push(outlineElements);\n        }\n\n        return win.__tabsterOutline.elements;\n    }\n\n    private _removeDOM(contextElement: HTMLElement): void {\n        const win = (contextElement.ownerDocument &&\n            contextElement.ownerDocument.defaultView) as WindowWithOutlineStyle;\n        const outline = win && win.__tabsterOutline;\n\n        if (!outline) {\n            return;\n        }\n\n        if (outline.style && outline.style.parentNode) {\n            outline.style.parentNode.removeChild(outline.style);\n\n            delete outline.style;\n        }\n\n        const outlineElements = outline && outline.elements;\n\n        if (outlineElements) {\n            if (outlineElements.container.parentNode) {\n                outlineElements.container.parentNode.removeChild(\n                    outlineElements.container\n                );\n            }\n\n            delete outline.elements;\n        }\n    }\n\n    private static _isParentChild(\n        parent: HTMLElement,\n        child: HTMLElement\n    ): boolean {\n        return (\n            child === parent ||\n            // tslint:disable-next-line:no-bitwise\n            !!(\n                parent.compareDocumentPosition(child) &\n                document.DOCUMENT_POSITION_CONTAINED_BY\n            )\n        );\n    }\n}\n\nfunction appendStyles(\n    document: HTMLDocument,\n    props: Types.OutlineProps\n): HTMLStyleElement {\n    const style = document.createElement(\"style\");\n    style.type = \"text/css\";\n    style.appendChild(document.createTextNode(getOutlineStyles(props)));\n    document.head.appendChild(style);\n    return style;\n}\n\nfunction getOutlineStyles(props: Types.OutlineProps): string {\n    return `\n.${props.areaClass} *, .${props.areaClass} *:focus {\noutline: none !important;\n}\n\n.${props.outlineClass} {\ndisplay: none;\nposition: absolute;\nwidth: 0;\nheight: 0;\nleft: 0;\ntop: 0;\nz-index: ${props.zIndex};\n}\n\n.${props.outlineClass}.${props.outlineClass}_visible {\ndisplay: block;\n}\n\n.${props.outlineClass}__left,\n.${props.outlineClass}__top,\n.${props.outlineClass}__right,\n.${props.outlineClass}__bottom {\nposition: absolute;\nbackground: inherit;\n}`;\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport * as Types from \"./Types\";\n\n/**\n * Allows default or user focus behaviour on the DOM subtree\n * i.e. Tabster will not control focus events within an uncontrolled area\n */\nexport class UncontrolledAPI implements Types.UncontrolledAPI {\n    private _isUncontrolledCompletely?: (\n        element: HTMLElement,\n        completely: boolean\n    ) => boolean | undefined;\n\n    constructor(\n        isUncontrolledCompletely?: (\n            element: HTMLElement,\n            completely: boolean\n        ) => boolean | undefined\n    ) {\n        this._isUncontrolledCompletely = isUncontrolledCompletely;\n    }\n\n    isUncontrolledCompletely(\n        element: HTMLElement,\n        completely: boolean\n    ): boolean {\n        const isUncontrolledCompletely = this._isUncontrolledCompletely?.(\n            element,\n            completely\n        );\n        // If isUncontrolledCompletely callback is not defined or returns undefined, then the default\n        // behaviour is to return the uncontrolled.completely value from the element.\n        return isUncontrolledCompletely === undefined\n            ? completely\n            : isUncontrolledCompletely;\n    }\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { getTabsterOnElement } from \"./Instance\";\nimport type {\n    FocusedElementState,\n    GetWindow,\n    KeyboardNavigationState,\n    Restorer as RestorerInterface,\n    RestorerAPI as RestorerAPIType,\n    RestorerProps,\n    TabsterCore,\n} from \"./Types\";\nimport { RestorerTypes, AsyncFocusSources } from \"./Consts\";\nimport {\n    RestorerRestoreFocusEvent,\n    RestorerRestoreFocusEventName,\n} from \"./Events\";\nimport { TabsterPart, WeakHTMLElement } from \"./Utils\";\nimport { dom } from \"./DOMAPI\";\n\nclass Restorer extends TabsterPart<RestorerProps> implements RestorerInterface {\n    private _hasFocus = false;\n\n    constructor(\n        tabster: TabsterCore,\n        element: HTMLElement,\n        props: RestorerProps\n    ) {\n        super(tabster, element, props);\n\n        if (this._props.type === RestorerTypes.Source) {\n            const element = this._element?.get();\n            element?.addEventListener(\"focusout\", this._onFocusOut);\n            element?.addEventListener(\"focusin\", this._onFocusIn);\n\n            // set hasFocus when the instance is created, in case focus has already moved within it\n            this._hasFocus = dom.nodeContains(\n                element,\n                element && dom.getActiveElement(element.ownerDocument)\n            );\n        }\n    }\n\n    dispose(): void {\n        if (this._props.type === RestorerTypes.Source) {\n            const element = this._element?.get();\n            element?.removeEventListener(\"focusout\", this._onFocusOut);\n            element?.removeEventListener(\"focusin\", this._onFocusIn);\n\n            if (this._hasFocus) {\n                const doc = this._tabster.getWindow().document;\n                doc.body.dispatchEvent(new RestorerRestoreFocusEvent());\n            }\n        }\n    }\n\n    private _onFocusOut = (e: FocusEvent) => {\n        const element = this._element?.get();\n        if (element && e.relatedTarget === null) {\n            element.dispatchEvent(new RestorerRestoreFocusEvent());\n        }\n        if (\n            element &&\n            !dom.nodeContains(element, e.relatedTarget as HTMLElement | null)\n        ) {\n            this._hasFocus = false;\n        }\n    };\n\n    private _onFocusIn = () => {\n        this._hasFocus = true;\n    };\n}\n\nclass History {\n    private static readonly DEPTH = 10;\n    private _stack: WeakHTMLElement<HTMLElement>[] = [];\n    private _getWindow: GetWindow;\n    constructor(getWindow: GetWindow) {\n        this._getWindow = getWindow;\n    }\n    /**\n     * Push a weak element to the top of the history stack.\n     * If the stack is full, the bottom weak element is removed.\n     * If the element is already at the top of the stack, it is not duplicated.\n     */\n    push(element: HTMLElement): void {\n        // Don't duplicate the top of history\n        if (this._stack[this._stack.length - 1]?.get() === element) {\n            return;\n        }\n\n        if (this._stack.length > History.DEPTH) {\n            this._stack.shift();\n        }\n        this._stack.push(\n            new WeakHTMLElement<HTMLElement>(this._getWindow, element)\n        );\n    }\n    /**\n     * Pop the first element from the history that satisfies the callback.\n     * The history is searched from the top to the bottom (from the most recent to the least recent).\n     *\n     * If a weak reference to the element is broken,\n     * or the element is no longer in the DOM,\n     * the element is removed from the top of the stack while popping.\n     *\n     * If no matching element is found, undefined is returned.\n     * If the stack is empty, undefined is returned.\n     */\n    pop(\n        filter: (element: HTMLElement) => boolean = () => true\n    ): HTMLElement | undefined {\n        const doc = this._getWindow().document;\n        for (let index = this._stack.length - 1; index >= 0; index--) {\n            const maybeElement = this._stack.pop()?.get();\n            if (\n                maybeElement &&\n                dom.nodeContains(\n                    doc.body,\n                    dom.getParentElement(maybeElement)\n                ) &&\n                filter(maybeElement)\n            ) {\n                return maybeElement;\n            }\n        }\n        return undefined;\n    }\n}\n\nexport class RestorerAPI implements RestorerAPIType {\n    private _tabster: TabsterCore;\n    private _history: History;\n    private _keyboardNavState: KeyboardNavigationState;\n    private _focusedElementState: FocusedElementState;\n    private _getWindow: GetWindow;\n\n    constructor(tabster: TabsterCore) {\n        this._tabster = tabster;\n        this._getWindow = tabster.getWindow;\n        this._getWindow().addEventListener(\n            RestorerRestoreFocusEventName,\n            this._onRestoreFocus\n        );\n        this._history = new History(this._getWindow);\n\n        this._keyboardNavState = tabster.keyboardNavigation;\n        this._focusedElementState = tabster.focusedElement;\n\n        this._focusedElementState.subscribe(this._onFocusIn);\n    }\n\n    dispose(): void {\n        const win = this._getWindow();\n        this._focusedElementState.unsubscribe(this._onFocusIn);\n\n        this._focusedElementState.cancelAsyncFocus(AsyncFocusSources.Restorer);\n\n        win.removeEventListener(\n            RestorerRestoreFocusEventName,\n            this._onRestoreFocus\n        );\n    }\n\n    private _onRestoreFocus = (e: Event) => {\n        this._focusedElementState.cancelAsyncFocus(AsyncFocusSources.Restorer);\n\n        // ShadowDOM will have shadowRoot as e.target.\n        const source = e.composedPath()[0] as HTMLElement | undefined;\n\n        if (source) {\n            // source id must be recovered before source is removed from DOM\n            // otherwise it'll be unreachable\n            // (as tabster on element will not be available through getTabsterOnElement)\n            const sourceId = getTabsterOnElement(\n                this._tabster,\n                source\n            )?.restorer?.getProps().id;\n\n            this._focusedElementState.requestAsyncFocus(\n                AsyncFocusSources.Restorer,\n                () => this._restoreFocus(source, sourceId),\n                0\n            );\n        }\n    };\n\n    private _onFocusIn = (element: HTMLElement | undefined) => {\n        if (!element) {\n            return;\n        }\n\n        const tabsterAttribute = getTabsterOnElement(this._tabster, element);\n        if (\n            tabsterAttribute?.restorer?.getProps().type !== RestorerTypes.Target\n        ) {\n            return;\n        }\n\n        this._history.push(element);\n    };\n\n    private _restoreFocus = (source: HTMLElement, sourceId?: string) => {\n        // don't restore focus if focus isn't lost to body\n        const doc = this._getWindow().document;\n        if (dom.getActiveElement(doc) !== doc.body) {\n            return;\n        }\n        if (\n            // clicking on any empty space focuses body - this is can be a false positive\n            !this._keyboardNavState.isNavigatingWithKeyboard() &&\n            // Source no longer exists on DOM - always restore focus\n            dom.nodeContains(doc.body, source)\n        ) {\n            return;\n        }\n\n        const getId = (element: HTMLElement) => {\n            const restorerProps = getTabsterOnElement(\n                this._tabster,\n                element\n            )?.restorer?.getProps();\n            // We return id or undefined if there is actual restorer on the element,\n            // and null otherwise. To filter out elements that had restorers in their lifetime\n            // but don't have them anymore.\n            return restorerProps ? restorerProps.id : null;\n        };\n\n        // sourceId is undefined or string, if there is no Restorer on the target, the element will\n        // be filtered out because getId() will return null.\n        this._history.pop((target) => sourceId === getId(target))?.focus();\n    };\n\n    public createRestorer(element: HTMLElement, props: RestorerProps) {\n        const restorer = new Restorer(this._tabster, element, props);\n        // Focus might already be on a restorer target when it gets created so the focusin will not do anything\n        if (\n            props.type === RestorerTypes.Target &&\n            dom.getActiveElement(element.ownerDocument) === element\n        ) {\n            this._history.push(element);\n        }\n\n        return restorer;\n    }\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nexport function getActiveElement(doc: Document): Element | null {\n    let activeElement = doc.activeElement;\n\n    while (activeElement?.shadowRoot?.activeElement) {\n        activeElement = activeElement.shadowRoot.activeElement;\n    }\n\n    return activeElement;\n}\n\nexport function nodeContains(\n    node: Node | null | undefined,\n    otherNode: Node | null | undefined\n): boolean {\n    if (!node || !otherNode) {\n        return false;\n    }\n\n    let currentNode: HTMLElement | Node | null | undefined = otherNode;\n\n    while (currentNode) {\n        if (currentNode === node) {\n            return true;\n        }\n\n        if (\n            typeof (currentNode as HTMLSlotElement).assignedElements !==\n                \"function\" &&\n            (currentNode as HTMLElement).assignedSlot?.parentNode\n        ) {\n            // Element is slotted\n            currentNode = (currentNode as HTMLElement).assignedSlot?.parentNode;\n        } else if (currentNode.nodeType === document.DOCUMENT_FRAGMENT_NODE) {\n            // Element is in shadow root\n            currentNode = (currentNode as ShadowRoot).host;\n        } else {\n            currentNode = currentNode.parentNode;\n        }\n    }\n\n    return false;\n}\n\nexport function getParentNode(\n    node: Node | null | undefined\n): ParentNode | null {\n    if (!node) {\n        return null;\n    }\n\n    if (\n        node.nodeType === Node.DOCUMENT_FRAGMENT_NODE &&\n        (node as ShadowRoot).host\n    ) {\n        return (node as ShadowRoot).host;\n    }\n\n    return node.parentNode;\n}\n\nexport function getParentElement(\n    element: HTMLElement | null | undefined\n): HTMLElement | null {\n    for (\n        let parentNode = getParentNode(element);\n        parentNode;\n        parentNode = getParentNode(parentNode)\n    ) {\n        if (parentNode.nodeType === Node.ELEMENT_NODE) {\n            return parentNode as HTMLElement;\n        }\n    }\n\n    return null;\n}\n\nexport function getFirstChild(node: Node | null | undefined): ChildNode | null {\n    if (!node) {\n        return null;\n    }\n\n    if ((node as Element).shadowRoot) {\n        const child = getFirstChild((node as Element).shadowRoot);\n\n        if (child) {\n            return child;\n        }\n\n        // If the attached shadowRoot has no children, just try ordinary children,\n        // that might come after.\n    }\n\n    return node.firstChild;\n}\n\nexport function getLastChild(node: Node | null | undefined): ChildNode | null {\n    if (!node) {\n        return null;\n    }\n\n    if (!node.lastChild && (node as Element).shadowRoot) {\n        return getLastChild((node as Element).shadowRoot);\n    }\n\n    return node.lastChild;\n}\n\nexport function getNextSibling(\n    node: Node | null | undefined\n): ChildNode | null {\n    return node?.nextSibling || null;\n}\n\nexport function getPreviousSibling(\n    node: Node | null | undefined\n): ChildNode | null {\n    if (!node) {\n        return null;\n    }\n\n    let sibling = node.previousSibling;\n\n    if (!sibling && node.parentElement?.shadowRoot) {\n        sibling = getLastChild(node.parentElement.shadowRoot);\n    }\n\n    return sibling;\n}\n\nexport function getFirstElementChild(\n    element: Element | null | undefined\n): Element | null {\n    let child = getFirstChild(element);\n\n    while (child && child.nodeType !== Node.ELEMENT_NODE) {\n        child = getNextSibling(child);\n    }\n\n    return child as Element | null;\n}\n\nexport function getLastElementChild(\n    element: Element | null | undefined\n): Element | null {\n    let child = getLastChild(element);\n\n    while (child && child.nodeType !== Node.ELEMENT_NODE) {\n        child = getPreviousSibling(child);\n    }\n\n    return child as Element | null;\n}\n\nexport function getNextElementSibling(\n    element: Element | null | undefined\n): Element | null {\n    let sibling = getNextSibling(element);\n\n    while (sibling && sibling.nodeType !== Node.ELEMENT_NODE) {\n        sibling = getNextSibling(sibling);\n    }\n\n    return sibling as Element | null;\n}\n\nexport function getPreviousElementSibling(\n    element: Element | null | undefined\n): Element | null {\n    let sibling = getPreviousSibling(element);\n\n    while (sibling && sibling.nodeType !== Node.ELEMENT_NODE) {\n        sibling = getPreviousSibling(sibling);\n    }\n\n    return sibling as Element | null;\n}\n\nexport function appendChild(parent: Node, child: Node): Node {\n    const shadowRoot = (parent as Element).shadowRoot;\n    return shadowRoot\n        ? shadowRoot.appendChild(child)\n        : parent.appendChild(child);\n}\n\nexport function insertBefore(\n    parent: Node,\n    child: Node,\n    referenceChild: Node | null\n): Node {\n    const shadowRoot = (parent as Element).shadowRoot;\n    return shadowRoot\n        ? shadowRoot.insertBefore(child, referenceChild)\n        : parent.insertBefore(child, referenceChild);\n}\n\ninterface ShadowRootWithGetSelection extends ShadowRoot {\n    getSelection?: typeof Window.prototype.getSelection;\n}\n\nexport function getSelection(ref: Node): Selection | null {\n    const win = ref.ownerDocument?.defaultView;\n\n    if (!win) {\n        return null;\n    }\n\n    for (let el: Node | null = ref; el; el = el.parentNode) {\n        if (el.nodeType === Node.DOCUMENT_FRAGMENT_NODE) {\n            const tmp = el as ShadowRootWithGetSelection;\n\n            // ShadowRoot.getSelection() exists only in Chrome.\n            if (tmp.getSelection) {\n                return tmp.getSelection() || null;\n            }\n\n            break;\n        }\n    }\n\n    return win.getSelection() || null;\n}\n\nexport function getElementsByName(\n    referenceElement: HTMLElement,\n    name: string\n): NodeListOf<HTMLElement> {\n    for (let el: Node | null = referenceElement; el; el = el.parentNode) {\n        if (el.nodeType === Node.DOCUMENT_FRAGMENT_NODE) {\n            // Shadow root doesn't have getElementsByName()...\n            return (el as ShadowRoot).querySelectorAll(`[name=${name}]`);\n        }\n    }\n\n    return referenceElement.ownerDocument.getElementsByName(name);\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { getLastElementChild, nodeContains } from \"./DOMFunctions\";\n\nfunction getLastChild(container: HTMLElement): HTMLElement | undefined {\n    let lastChild: HTMLElement | null = null;\n\n    for (\n        let i = getLastElementChild(container);\n        i;\n        i = getLastElementChild(i)\n    ) {\n        lastChild = i as HTMLElement;\n    }\n\n    return lastChild || undefined;\n}\n\nexport class ShadowTreeWalker implements TreeWalker {\n    public readonly filter: NodeFilter | null;\n    public readonly root: Node;\n    public readonly whatToShow: number;\n\n    private _doc: Document;\n    private _walkerStack: TreeWalker[] = [];\n    private _currentNode: Node;\n    private _currentSetFor: Set<TreeWalker> = new Set();\n\n    constructor(\n        doc: Document,\n        root: Node,\n        whatToShow?: number,\n        filter?: NodeFilter | null\n    ) {\n        this._doc = doc;\n        this.root = root;\n        this.filter = filter ?? null;\n        this.whatToShow = whatToShow ?? NodeFilter.SHOW_ALL;\n        this._currentNode = root;\n\n        this._walkerStack.unshift(\n            doc.createTreeWalker(root, whatToShow, this._acceptNode)\n        );\n\n        const shadowRoot = (root as Element).shadowRoot;\n\n        if (shadowRoot) {\n            const walker = this._doc.createTreeWalker(\n                shadowRoot,\n                this.whatToShow,\n                { acceptNode: this._acceptNode }\n            );\n\n            this._walkerStack.unshift(walker);\n        }\n    }\n\n    private _acceptNode = (node: Node): number => {\n        if (node.nodeType === Node.ELEMENT_NODE) {\n            const shadowRoot = (node as Element).shadowRoot;\n\n            if (shadowRoot) {\n                const walker = this._doc.createTreeWalker(\n                    shadowRoot,\n                    this.whatToShow,\n                    { acceptNode: this._acceptNode }\n                );\n\n                this._walkerStack.unshift(walker);\n\n                return NodeFilter.FILTER_ACCEPT;\n            } else {\n                if (typeof this.filter === \"function\") {\n                    return this.filter(node);\n                } else if (this.filter?.acceptNode) {\n                    return this.filter.acceptNode(node);\n                } else if (this.filter === null) {\n                    return NodeFilter.FILTER_ACCEPT;\n                }\n            }\n        }\n\n        return NodeFilter.FILTER_SKIP;\n    };\n\n    public get currentNode(): Node {\n        return this._currentNode;\n    }\n\n    public set currentNode(node: Node) {\n        if (!nodeContains(this.root, node)) {\n            throw new Error(\n                \"Cannot set currentNode to a node that is not contained by the root node.\"\n            );\n        }\n\n        const walkers: TreeWalker[] = [];\n        let curNode: Node | null | undefined = node;\n        let currentWalkerCurrentNode = node;\n\n        this._currentNode = node;\n\n        while (curNode && curNode !== this.root) {\n            if (curNode.nodeType === Node.DOCUMENT_FRAGMENT_NODE) {\n                const shadowRoot = curNode as ShadowRoot;\n\n                const walker = this._doc.createTreeWalker(\n                    shadowRoot,\n                    this.whatToShow,\n                    { acceptNode: this._acceptNode }\n                );\n\n                walkers.push(walker);\n\n                walker.currentNode = currentWalkerCurrentNode;\n\n                this._currentSetFor.add(walker);\n\n                curNode = currentWalkerCurrentNode = shadowRoot.host;\n            } else {\n                curNode = curNode.parentNode;\n            }\n        }\n\n        const walker = this._doc.createTreeWalker(this.root, this.whatToShow, {\n            acceptNode: this._acceptNode,\n        });\n\n        walkers.push(walker);\n\n        walker.currentNode = currentWalkerCurrentNode;\n\n        this._currentSetFor.add(walker);\n\n        this._walkerStack = walkers;\n    }\n\n    public firstChild(): Node | null {\n        if (__DEV__) {\n            throw new Error(\"Method not implemented.\");\n        }\n\n        return null;\n    }\n\n    public lastChild(): Node | null {\n        if (__DEV__) {\n            throw new Error(\"Method not implemented.\");\n        }\n\n        return null;\n    }\n\n    public nextNode(): Node | null {\n        const nextNode = this._walkerStack[0].nextNode();\n\n        if (nextNode) {\n            const shadowRoot = (nextNode as Element).shadowRoot;\n\n            if (shadowRoot) {\n                let nodeResult: number | undefined;\n\n                if (typeof this.filter === \"function\") {\n                    nodeResult = this.filter(nextNode);\n                } else if (this.filter?.acceptNode) {\n                    nodeResult = this.filter.acceptNode(nextNode);\n                }\n\n                if (nodeResult === NodeFilter.FILTER_ACCEPT) {\n                    return nextNode;\n                }\n\n                // _acceptNode should have added new walker for this shadow,\n                // go in recursively.\n                return this.nextNode();\n            }\n\n            return nextNode;\n        } else {\n            if (this._walkerStack.length > 1) {\n                this._walkerStack.shift();\n\n                return this.nextNode();\n            } else {\n                return null;\n            }\n        }\n    }\n\n    public previousNode(): Node | null {\n        const currentWalker = this._walkerStack[0];\n\n        if (currentWalker.currentNode === currentWalker.root) {\n            if (this._currentSetFor.has(currentWalker)) {\n                this._currentSetFor.delete(currentWalker);\n\n                if (this._walkerStack.length > 1) {\n                    this._walkerStack.shift();\n                    return this.previousNode();\n                } else {\n                    return null;\n                }\n            }\n\n            const lastChild = getLastChild(currentWalker.root as HTMLElement);\n\n            if (lastChild) {\n                currentWalker.currentNode = lastChild;\n\n                let nodeResult: number | undefined;\n\n                if (typeof this.filter === \"function\") {\n                    nodeResult = this.filter(lastChild);\n                } else if (this.filter?.acceptNode) {\n                    nodeResult = this.filter.acceptNode(lastChild);\n                }\n\n                if (nodeResult === NodeFilter.FILTER_ACCEPT) {\n                    return lastChild;\n                }\n            }\n        }\n\n        const previousNode = currentWalker.previousNode();\n\n        if (previousNode) {\n            const shadowRoot = (previousNode as Element).shadowRoot;\n\n            if (shadowRoot) {\n                let nodeResult: number | undefined;\n\n                if (typeof this.filter === \"function\") {\n                    nodeResult = this.filter(previousNode);\n                } else if (this.filter?.acceptNode) {\n                    nodeResult = this.filter.acceptNode(previousNode);\n                }\n\n                if (nodeResult === NodeFilter.FILTER_ACCEPT) {\n                    return previousNode;\n                }\n\n                // _acceptNode should have added new walker for this shadow,\n                // go in recursively.\n                return this.previousNode();\n            }\n\n            return previousNode;\n        } else {\n            if (this._walkerStack.length > 1) {\n                this._walkerStack.shift();\n\n                return this.previousNode();\n            } else {\n                return null;\n            }\n        }\n    }\n\n    public nextSibling(): Node | null {\n        if (__DEV__) {\n            throw new Error(\"Method not implemented.\");\n        }\n\n        return null;\n    }\n\n    public previousSibling(): Node | null {\n        if (__DEV__) {\n            throw new Error(\"Method not implemented.\");\n        }\n\n        return null;\n    }\n\n    public parentNode(): Node | null {\n        if (__DEV__) {\n            throw new Error(\"Method not implemented.\");\n        }\n\n        return null;\n    }\n}\n\nexport function createShadowTreeWalker(\n    doc: Document,\n    root: Node,\n    whatToShow?: number,\n    filter?: NodeFilter | null\n) {\n    return new ShadowTreeWalker(doc, root, whatToShow, filter);\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { nodeContains } from \"./DOMFunctions\";\n\ninterface OverridenAttachShadow {\n    __origAttachShadow?: typeof Element.prototype.attachShadow;\n}\n\nexport class ShadowMutationObserver implements MutationObserver {\n    private static _shadowObservers: Set<ShadowMutationObserver> = new Set();\n\n    private _root?: Node;\n    private _options?: MutationObserverInit;\n    private _callback: MutationCallback;\n    private _observer: MutationObserver;\n    private _subObservers: Map<Node, MutationObserver>;\n    private _isObserving = false;\n\n    private static _overrideAttachShadow(\n        win: Window & typeof globalThis\n    ): void {\n        const origAttachShadow = win.Element.prototype.attachShadow;\n\n        if ((origAttachShadow as OverridenAttachShadow).__origAttachShadow) {\n            return;\n        }\n\n        Element.prototype.attachShadow = function (\n            this: Element,\n            options?: ShadowRootInit\n        ): ShadowRoot {\n            const shadowRoot = origAttachShadow.call(this, options);\n\n            for (const shadowObserver of ShadowMutationObserver._shadowObservers) {\n                shadowObserver._addSubObserver(shadowRoot);\n            }\n\n            return shadowRoot;\n        };\n\n        (\n            Element.prototype.attachShadow as OverridenAttachShadow\n        ).__origAttachShadow = origAttachShadow;\n    }\n\n    constructor(callback: MutationCallback) {\n        this._callback = callback;\n        this._observer = new MutationObserver(this._callbackWrapper);\n        this._subObservers = new Map();\n    }\n\n    private _callbackWrapper = (\n        mutations: MutationRecord[],\n        observer: MutationObserver\n    ): void => {\n        for (const mutation of mutations) {\n            if (mutation.type === \"childList\") {\n                const removed = mutation.removedNodes;\n                const added = mutation.addedNodes;\n\n                for (let i = 0; i < removed.length; i++) {\n                    this._walkShadows(removed[i], true);\n                }\n\n                for (let i = 0; i < added.length; i++) {\n                    this._walkShadows(added[i]);\n                }\n            }\n        }\n\n        this._callback(mutations, observer);\n    };\n\n    private _addSubObserver(shadowRoot: ShadowRoot): void {\n        if (\n            !this._options ||\n            !this._callback ||\n            this._subObservers.has(shadowRoot)\n        ) {\n            return;\n        }\n\n        if (this._options.subtree && nodeContains(this._root, shadowRoot)) {\n            const subObserver = new MutationObserver(this._callbackWrapper);\n\n            this._subObservers.set(shadowRoot, subObserver);\n\n            if (this._isObserving) {\n                subObserver.observe(shadowRoot, this._options);\n            }\n\n            this._walkShadows(shadowRoot);\n        }\n    }\n\n    public disconnect(): void {\n        this._isObserving = false;\n\n        delete this._options;\n\n        ShadowMutationObserver._shadowObservers.delete(this);\n\n        for (const subObserver of this._subObservers.values()) {\n            subObserver.disconnect();\n        }\n\n        this._subObservers.clear();\n\n        this._observer.disconnect();\n    }\n\n    public observe(target: Node, options?: MutationObserverInit): void {\n        const doc =\n            target.nodeType === Node.DOCUMENT_NODE\n                ? (target as Document)\n                : target.ownerDocument;\n        const win = doc?.defaultView as Window & typeof globalThis;\n\n        if (!doc || !win) {\n            return;\n        }\n\n        ShadowMutationObserver._overrideAttachShadow(win);\n        ShadowMutationObserver._shadowObservers.add(this);\n\n        this._root = target;\n        this._options = options;\n\n        this._isObserving = true;\n\n        this._observer.observe(target, options);\n\n        this._walkShadows(target);\n    }\n\n    private _walkShadows(target: Node, remove?: boolean): void {\n        const doc =\n            target.nodeType === Node.DOCUMENT_NODE\n                ? (target as Document)\n                : target.ownerDocument;\n\n        if (!doc) {\n            return;\n        }\n\n        if (target === doc) {\n            target = doc.body;\n        } else {\n            const shadowRoot = (target as Element).shadowRoot;\n\n            if (shadowRoot) {\n                this._addSubObserver(shadowRoot);\n                return;\n            }\n        }\n\n        const walker = doc.createTreeWalker(target, NodeFilter.SHOW_ELEMENT, {\n            acceptNode: (node) => {\n                if (node.nodeType === Node.ELEMENT_NODE) {\n                    if (remove) {\n                        const subObserver = this._subObservers.get(node);\n\n                        if (subObserver) {\n                            subObserver.disconnect();\n                            this._subObservers.delete(node);\n                        }\n                    } else {\n                        const shadowRoot = (node as Element).shadowRoot;\n\n                        if (shadowRoot) {\n                            this._addSubObserver(shadowRoot);\n                        }\n                    }\n                }\n\n                return NodeFilter.FILTER_SKIP;\n            },\n        });\n\n        walker.nextNode();\n    }\n\n    public takeRecords(): MutationRecord[] {\n        const records = this._observer.takeRecords();\n\n        for (const subObserver of this._subObservers.values()) {\n            records.push(...subObserver.takeRecords());\n        }\n\n        return records;\n    }\n}\n\nexport function createShadowMutationObserver(\n    callback: MutationCallback\n): MutationObserver {\n    return new ShadowMutationObserver(callback);\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nfunction shadowQuerySelector(\n    node: ParentNode,\n    selector: string,\n    all: boolean\n): Element[] {\n    // TODO: This is probably slow. Optimize to use each shadowRoot's querySelector/querySelectorAll\n    //       instead of walking the tree.\n\n    const elements: Element[] = [];\n\n    walk(node, selector);\n\n    return elements;\n\n    function walk(from: Node, selector: string): void {\n        let el: Element | null = null;\n\n        const walker = document.createTreeWalker(\n            from,\n            NodeFilter.SHOW_ELEMENT,\n            {\n                acceptNode: (n) => {\n                    if (n.nodeType === Node.ELEMENT_NODE) {\n                        if ((n as Element).matches(selector)) {\n                            el = n as Element;\n                            elements.push(el);\n                            return all\n                                ? NodeFilter.FILTER_SKIP\n                                : NodeFilter.FILTER_ACCEPT;\n                        }\n\n                        const shadowRoot = (n as Element).shadowRoot;\n\n                        if (shadowRoot) {\n                            walk(shadowRoot, selector);\n                            return !all && elements.length\n                                ? NodeFilter.FILTER_ACCEPT\n                                : NodeFilter.FILTER_SKIP;\n                        }\n                    }\n                    return NodeFilter.FILTER_SKIP;\n                },\n            }\n        );\n\n        walker.nextNode();\n    }\n}\n\nexport function querySelectorAll(\n    node: ParentNode,\n    selector: string\n): Element[] {\n    return shadowQuerySelector(node, selector, true);\n}\n\nexport function querySelector(\n    node: ParentNode,\n    selector: string\n): Element | null {\n    return shadowQuerySelector(node, selector, false)[0] || null;\n}\n\nexport function getElementById(doc: Document, id: string): HTMLElement | null {\n    return querySelector(doc, \"#\" + id) as HTMLElement | null;\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\n// TODO: The functions below do not consider Shadow DOM slots yet. We will be adding\n// support for slots as the need arises.\n\nexport { createShadowTreeWalker as createTreeWalker } from \"./ShadowTreeWalker\";\nexport { createShadowMutationObserver as createMutationObserver } from \"./ShadowMutationObserver\";\nexport {\n    appendChild,\n    getActiveElement,\n    getFirstChild,\n    getFirstElementChild,\n    getLastChild,\n    getLastElementChild,\n    getNextElementSibling,\n    getNextSibling,\n    getParentElement,\n    getParentNode,\n    getPreviousElementSibling,\n    getPreviousSibling,\n    getSelection,\n    getElementsByName,\n    insertBefore,\n    nodeContains,\n} from \"./DOMFunctions\";\nexport {\n    getElementById,\n    querySelector,\n    querySelectorAll,\n} from \"./querySelector\";\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { CrossOriginAPI } from \"./CrossOrigin\";\nimport { DeloserAPI } from \"./Deloser\";\nimport { FocusableAPI } from \"./Focusable\";\nimport { FocusedElementState } from \"./State/FocusedElement\";\nimport { GroupperAPI } from \"./Groupper\";\nimport { getTabsterOnElement, updateTabsterByAttribute } from \"./Instance\";\nimport { KeyboardNavigationState } from \"./State/KeyboardNavigation\";\nimport { ModalizerAPI } from \"./Modalizer\";\nimport { MoverAPI } from \"./Mover\";\nimport { observeMutations } from \"./MutationEvent\";\nimport { ObservedElementAPI } from \"./State/ObservedElement\";\nimport { OutlineAPI } from \"./Outline\";\nimport { RootAPI, WindowWithTabsterInstance } from \"./Root\";\nimport * as Types from \"./Types\";\nimport { TABSTER_ATTRIBUTE_NAME } from \"./Consts\";\nimport { UncontrolledAPI } from \"./Uncontrolled\";\nimport {\n    cleanupFakeWeakRefs,\n    clearElementCache,\n    createElementTreeWalker,\n    createWeakMap,\n    disposeInstanceContext,\n    DummyInputObserver,\n    getDummyInputContainer,\n    startFakeWeakRefsCleanup,\n    stopFakeWeakRefsCleanupAndClearStorage,\n} from \"./Utils\";\nimport { RestorerAPI } from \"./Restorer\";\nimport { dom, setDOMAPI } from \"./DOMAPI\";\nimport * as shadowDOMAPI from \"./Shadowdomize\";\n\nexport { getDummyInputContainer };\n\nclass Tabster implements Types.Tabster {\n    keyboardNavigation: Types.KeyboardNavigationState;\n    focusedElement: Types.FocusedElementState;\n    focusable: Types.FocusableAPI;\n    root: Types.RootAPI;\n    uncontrolled: Types.UncontrolledAPI;\n    core: Types.TabsterCore;\n\n    constructor(tabster: Types.TabsterCore) {\n        this.keyboardNavigation = tabster.keyboardNavigation;\n        this.focusedElement = tabster.focusedElement;\n        this.focusable = tabster.focusable;\n        this.root = tabster.root;\n        this.uncontrolled = tabster.uncontrolled;\n        this.core = tabster;\n    }\n}\n\n/**\n * Extends Window to include an internal Tabster instance.\n */\nclass TabsterCore implements Types.TabsterCore {\n    private _storage: WeakMap<HTMLElement, Types.TabsterElementStorage>;\n    private _unobserve: (() => void) | undefined;\n    private _win: WindowWithTabsterInstance | undefined;\n    private _forgetMemorizedTimer: number | undefined;\n    private _forgetMemorizedElements: HTMLElement[] = [];\n    private _wrappers: Set<Tabster> = new Set<Tabster>();\n    private _initTimer: number | undefined;\n    private _initQueue: (() => void)[] = [];\n\n    _version: string = __VERSION__;\n    _noop = false;\n    controlTab: boolean;\n    rootDummyInputs: boolean;\n\n    // Core APIs\n    keyboardNavigation: Types.KeyboardNavigationState;\n    focusedElement: Types.FocusedElementState;\n    focusable: Types.FocusableAPI;\n    root: Types.RootAPI;\n    uncontrolled: Types.UncontrolledAPI;\n    internal: Types.InternalAPI;\n    _dummyObserver: Types.DummyInputObserver;\n\n    // Extended APIs\n    groupper?: Types.GroupperAPI;\n    mover?: Types.MoverAPI;\n    outline?: Types.OutlineAPI;\n    deloser?: Types.DeloserAPI;\n    modalizer?: Types.ModalizerAPI;\n    observedElement?: Types.ObservedElementAPI;\n    crossOrigin?: Types.CrossOriginAPI;\n    restorer?: Types.RestorerAPI;\n    getParent: (el: Node) => Node | null;\n\n    constructor(win: Window, props?: Types.TabsterCoreProps) {\n        this._storage = createWeakMap(win);\n        this._win = win;\n\n        const getWindow = this.getWindow;\n\n        if (props?.DOMAPI) {\n            setDOMAPI({ ...props.DOMAPI });\n        }\n\n        this.keyboardNavigation = new KeyboardNavigationState(getWindow);\n        this.focusedElement = new FocusedElementState(this, getWindow);\n        this.focusable = new FocusableAPI(this);\n        this.root = new RootAPI(this, props?.autoRoot);\n        this.uncontrolled = new UncontrolledAPI(\n            // TODO: Remove checkUncontrolledTrappingFocus in the next major version.\n            props?.checkUncontrolledCompletely ||\n                props?.checkUncontrolledTrappingFocus\n        );\n        this.controlTab = props?.controlTab ?? true;\n        this.rootDummyInputs = !!props?.rootDummyInputs;\n\n        this._dummyObserver = new DummyInputObserver(getWindow);\n\n        this.getParent = props?.getParent ?? dom.getParentNode;\n\n        this.internal = {\n            stopObserver: (): void => {\n                if (this._unobserve) {\n                    this._unobserve();\n                    delete this._unobserve;\n                }\n            },\n\n            resumeObserver: (syncState: boolean): void => {\n                if (!this._unobserve) {\n                    const doc = getWindow().document;\n                    this._unobserve = observeMutations(\n                        doc,\n                        this,\n                        updateTabsterByAttribute,\n                        syncState\n                    );\n                }\n            },\n        };\n\n        startFakeWeakRefsCleanup(getWindow);\n\n        // Gives a tick to the host app to initialize other tabster\n        // APIs before tabster starts observing attributes.\n        this.queueInit(() => {\n            this.internal.resumeObserver(true);\n        });\n    }\n\n    /**\n     * Merges external props with the current props. Not all\n     * props can/should be mergeable, so let's add more as we move on.\n     * @param props Tabster props\n     */\n    private _mergeProps(props?: Types.TabsterCoreProps) {\n        if (!props) {\n            return;\n        }\n\n        this.getParent = props.getParent ?? this.getParent;\n    }\n\n    createTabster(\n        noRefCount?: boolean,\n        props?: Types.TabsterCoreProps\n    ): Types.Tabster {\n        const wrapper = new Tabster(this);\n\n        if (!noRefCount) {\n            this._wrappers.add(wrapper);\n        }\n\n        this._mergeProps(props);\n\n        return wrapper;\n    }\n\n    disposeTabster(wrapper: Types.Tabster, allInstances?: boolean) {\n        if (allInstances) {\n            this._wrappers.clear();\n        } else {\n            this._wrappers.delete(wrapper);\n        }\n\n        if (this._wrappers.size === 0) {\n            this.dispose();\n        }\n    }\n\n    dispose(): void {\n        this.internal.stopObserver();\n\n        const win = this._win;\n\n        win?.clearTimeout(this._initTimer);\n        delete this._initTimer;\n        this._initQueue = [];\n\n        this._forgetMemorizedElements = [];\n\n        if (win && this._forgetMemorizedTimer) {\n            win.clearTimeout(this._forgetMemorizedTimer);\n            delete this._forgetMemorizedTimer;\n        }\n\n        this.outline?.dispose();\n        this.crossOrigin?.dispose();\n        this.deloser?.dispose();\n        this.groupper?.dispose();\n        this.mover?.dispose();\n        this.modalizer?.dispose();\n        this.observedElement?.dispose();\n        this.restorer?.dispose();\n\n        this.keyboardNavigation.dispose();\n        this.focusable.dispose();\n        this.focusedElement.dispose();\n        this.root.dispose();\n\n        this._dummyObserver.dispose();\n\n        stopFakeWeakRefsCleanupAndClearStorage(this.getWindow);\n        clearElementCache(this.getWindow);\n\n        this._storage = new WeakMap();\n        this._wrappers.clear();\n\n        if (win) {\n            disposeInstanceContext(win);\n            delete win.__tabsterInstance;\n            delete this._win;\n        }\n    }\n\n    storageEntry(\n        element: HTMLElement,\n        addremove?: boolean\n    ): Types.TabsterElementStorageEntry | undefined {\n        const storage = this._storage;\n        let entry = storage.get(element);\n\n        if (entry) {\n            if (addremove === false && Object.keys(entry).length === 0) {\n                storage.delete(element);\n            }\n        } else if (addremove === true) {\n            entry = {};\n            storage.set(element, entry);\n        }\n\n        return entry;\n    }\n\n    getWindow = () => {\n        if (!this._win) {\n            throw new Error(\"Using disposed Tabster.\");\n        }\n\n        return this._win;\n    };\n\n    forceCleanup(): void {\n        if (!this._win) {\n            return;\n        }\n\n        this._forgetMemorizedElements.push(this._win.document.body);\n\n        if (this._forgetMemorizedTimer) {\n            return;\n        }\n\n        this._forgetMemorizedTimer = this._win.setTimeout(() => {\n            delete this._forgetMemorizedTimer;\n\n            for (\n                let el: HTMLElement | undefined =\n                    this._forgetMemorizedElements.shift();\n                el;\n                el = this._forgetMemorizedElements.shift()\n            ) {\n                clearElementCache(this.getWindow, el);\n                FocusedElementState.forgetMemorized(this.focusedElement, el);\n            }\n        }, 0);\n\n        cleanupFakeWeakRefs(this.getWindow, true);\n    }\n\n    queueInit(callback: () => void): void {\n        if (!this._win) {\n            return;\n        }\n\n        this._initQueue.push(callback);\n\n        if (!this._initTimer) {\n            this._initTimer = this._win?.setTimeout(() => {\n                delete this._initTimer;\n                this.drainInitQueue();\n            }, 0);\n        }\n    }\n\n    drainInitQueue(): void {\n        if (!this._win) {\n            return;\n        }\n\n        const queue = this._initQueue;\n        // Resetting the queue before calling the callbacks to avoid recursion.\n        this._initQueue = [];\n        queue.forEach((callback) => callback());\n    }\n}\n\nexport function forceCleanup(tabster: Types.Tabster): void {\n    // The only legit case for calling this method is when you've completely removed\n    // the application DOM and not going to add the new one for a while.\n    const tabsterCore = tabster.core;\n    tabsterCore.forceCleanup();\n}\n\n/**\n * Creates an instance of Tabster, returns the current window instance if it already exists.\n */\nexport function createTabster(\n    win: Window,\n    props?: Types.TabsterCoreProps\n): Types.Tabster {\n    let tabster = getCurrentTabster(win as WindowWithTabsterInstance);\n\n    if (tabster) {\n        return tabster.createTabster(false, props);\n    }\n\n    tabster = new TabsterCore(win, props);\n\n    (win as WindowWithTabsterInstance).__tabsterInstance = tabster;\n\n    return tabster.createTabster();\n}\n\n/**\n * Returns an instance of Tabster if it was created before or null.\n */\nexport function getTabster(win: Window): Types.Tabster | null {\n    const tabster = getCurrentTabster(win as WindowWithTabsterInstance);\n\n    return tabster ? tabster.createTabster(true) : null;\n}\n\nexport function getShadowDOMAPI(): Types.DOMAPI {\n    return shadowDOMAPI;\n}\n\n/**\n * Creates a new groupper instance or returns an existing one\n * @param tabster Tabster instance\n */\nexport function getGroupper(tabster: Types.Tabster): Types.GroupperAPI {\n    const tabsterCore = tabster.core;\n\n    if (!tabsterCore.groupper) {\n        tabsterCore.groupper = new GroupperAPI(\n            tabsterCore,\n            tabsterCore.getWindow\n        );\n    }\n\n    return tabsterCore.groupper;\n}\n\n/**\n * Creates a new mover instance or returns an existing one\n * @param tabster Tabster instance\n */\nexport function getMover(tabster: Types.Tabster): Types.MoverAPI {\n    const tabsterCore = tabster.core;\n\n    if (!tabsterCore.mover) {\n        tabsterCore.mover = new MoverAPI(tabsterCore, tabsterCore.getWindow);\n    }\n\n    return tabsterCore.mover;\n}\n\nexport function getOutline(tabster: Types.Tabster): Types.OutlineAPI {\n    const tabsterCore = tabster.core;\n\n    if (!tabsterCore.outline) {\n        tabsterCore.outline = new OutlineAPI(tabsterCore);\n    }\n\n    return tabsterCore.outline;\n}\n\n/**\n * Creates a new new deloser instance or returns an existing one\n * @param tabster Tabster instance\n * @param props Deloser props\n */\nexport function getDeloser(\n    tabster: Types.Tabster,\n    props?: { autoDeloser: Types.DeloserProps }\n): Types.DeloserAPI {\n    const tabsterCore = tabster.core;\n\n    if (!tabsterCore.deloser) {\n        tabsterCore.deloser = new DeloserAPI(tabsterCore, props);\n    }\n\n    return tabsterCore.deloser;\n}\n\n/**\n * Creates a new modalizer instance or returns an existing one\n * @param tabster Tabster instance\n * @param alwaysAccessibleSelector When Modalizer is active, we put\n * aria-hidden to everything else to hide it from screen readers. This CSS\n * selector allows to exclude some elements from this behaviour. For example,\n * this could be used to exclude aria-live region with the application-wide\n * status announcements.\n * @param accessibleCheck An optional callback that will be called when\n * active Modalizer wants to hide an element that doesn't belong to it from\n * the screen readers by setting aria-hidden. Similar to alwaysAccessibleSelector\n * but allows to address the elements programmatically rather than with a selector.\n * If the callback returns true, the element will not receive aria-hidden.\n */\nexport function getModalizer(\n    tabster: Types.Tabster,\n    // @deprecated use accessibleCheck.\n    alwaysAccessibleSelector?: string,\n    accessibleCheck?: Types.ModalizerElementAccessibleCheck\n): Types.ModalizerAPI {\n    const tabsterCore = tabster.core;\n\n    if (!tabsterCore.modalizer) {\n        tabsterCore.modalizer = new ModalizerAPI(\n            tabsterCore,\n            alwaysAccessibleSelector,\n            accessibleCheck\n        );\n    }\n\n    return tabsterCore.modalizer;\n}\n\nexport function getObservedElement(\n    tabster: Types.Tabster\n): Types.ObservedElementAPI {\n    const tabsterCore = tabster.core;\n\n    if (!tabsterCore.observedElement) {\n        tabsterCore.observedElement = new ObservedElementAPI(tabsterCore);\n    }\n\n    return tabsterCore.observedElement;\n}\n\nexport function getCrossOrigin(tabster: Types.Tabster): Types.CrossOriginAPI {\n    const tabsterCore = tabster.core;\n    if (!tabsterCore.crossOrigin) {\n        getDeloser(tabster);\n        getModalizer(tabster);\n        getMover(tabster);\n        getGroupper(tabster);\n        getOutline(tabster);\n        getObservedElement(tabster);\n        tabsterCore.crossOrigin = new CrossOriginAPI(tabsterCore);\n    }\n\n    return tabsterCore.crossOrigin;\n}\n\nexport function getInternal(tabster: Types.Tabster): Types.InternalAPI {\n    const tabsterCore = tabster.core;\n    return tabsterCore.internal;\n}\n\nexport function getRestorer(tabster: Types.Tabster): Types.RestorerAPI {\n    const tabsterCore = tabster.core;\n    if (!tabsterCore.restorer) {\n        tabsterCore.restorer = new RestorerAPI(tabsterCore);\n    }\n\n    return tabsterCore.restorer;\n}\n\nexport function disposeTabster(\n    tabster: Types.Tabster,\n    allInstances?: boolean\n): void {\n    tabster.core.disposeTabster(tabster, allInstances);\n}\n\n/**\n * Returns an instance of Tabster if it already exists on the window .\n * @param win window instance that could contain an Tabster instance.\n */\nexport function getCurrentTabster(win: Window): Types.TabsterCore | undefined {\n    return (win as WindowWithTabsterInstance).__tabsterInstance;\n}\n\n/**\n * Allows to make Tabster non operational. Intended for performance debugging (and other\n * kinds of debugging), you can switch Tabster off without changing the application code\n * that consumes it.\n * @param tabster a reference created by createTabster().\n * @param noop true if you want to make Tabster noop, false if you want to turn it back.\n */\nexport function makeNoOp(tabster: Types.Tabster, noop: boolean): void {\n    const core = tabster.core;\n\n    if (core._noop !== noop) {\n        core._noop = noop;\n\n        const processNode = (element: HTMLElement): number => {\n            if (!element.getAttribute) {\n                return NodeFilter.FILTER_SKIP;\n            }\n\n            if (\n                getTabsterOnElement(core, element) ||\n                element.hasAttribute(TABSTER_ATTRIBUTE_NAME)\n            ) {\n                updateTabsterByAttribute(core, element);\n            }\n\n            return NodeFilter.FILTER_SKIP;\n        };\n\n        const doc = core.getWindow().document;\n        const body = doc.body;\n\n        processNode(body);\n\n        const walker = createElementTreeWalker(doc, body, processNode);\n\n        if (walker) {\n            while (walker.nextNode()) {\n                /* Iterating for the sake of calling processNode() callback. */\n            }\n        }\n    }\n}\n\nexport function isNoOp(tabster: Types.TabsterCore): boolean {\n    return (tabster as TabsterCore)._noop;\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport type { TABSTER_ATTRIBUTE_NAME } from \"./Consts\";\n\nexport interface HTMLElementWithTabsterFlags extends HTMLElement {\n    __tabsterElementFlags?: {\n        /**\n         * @deprecated This option is added to support interop between Fluent UI V9 and Fluent UI V8.\n         * Once Fluent UI V8 is not supported anymore, this option should be removed.\n         */\n        noDirectAriaHidden?: boolean; // When Modalizer sets aria-hidden on everything outside of the modal,\n        // do not set aria-hidden directly on this element, go inside and check its children,\n        // and set aria-hidden on the children. This is to be set on a container that hosts\n        // elements which have the active modal dialog as virtual parent.\n    };\n}\n\nexport interface TabsterDOMAttribute {\n    [TABSTER_ATTRIBUTE_NAME]: string | undefined;\n}\n\nexport interface TabsterCoreProps {\n    autoRoot?: RootProps;\n    /**\n     * Allows all tab key presses under the tabster root to be controlled by tabster\n     * @default true\n     */\n    controlTab?: boolean;\n    /**\n     * When controlTab is false, Root doesn't have dummy inputs by default.\n     * This option allows to enable dummy inputs on Root.\n     */\n    rootDummyInputs?: boolean;\n    /**\n     * A callback that will be called for the uncontrolled areas when Tabster wants\n     * to know is the uncontrolled element wants complete control (for example it\n     * is trapping focus) and Tabster should not interfere with handling Tab.\n     * If the callback returns undefined, then the default behaviour is to return\n     * the uncontrolled.completely value from the element. If the callback returns\n     * non-undefined value, the callback's value will dominate the element's\n     * uncontrolled.completely value.\n     */\n    checkUncontrolledCompletely?: (\n        element: HTMLElement,\n        completely: boolean // A uncontrolled.completely value from the element.\n    ) => boolean | undefined;\n    /**\n     * @deprecated use checkUncontrolledCompletely.\n     */\n    checkUncontrolledTrappingFocus?: (element: HTMLElement) => boolean;\n    /**\n     * Custom getter for parent elements. Defaults to the default .parentElement call\n     * Currently only used to detect tabster contexts\n     */\n    getParent?(el: Node): Node | null;\n    /**\n     * Ability to redefine all DOM API calls used by Tabster. For example, for\n     * ShadowDOM support.\n     */\n    DOMAPI?: Partial<DOMAPI>;\n}\n\nexport interface DOMAPI {\n    createMutationObserver: (callback: MutationCallback) => MutationObserver;\n    createTreeWalker(\n        doc: Document,\n        root: Node,\n        whatToShow?: number,\n        filter?: NodeFilter | null\n    ): TreeWalker;\n    getParentNode(node: Node | null | undefined): ParentNode | null;\n    getParentElement(\n        element: HTMLElement | null | undefined\n    ): HTMLElement | null;\n    nodeContains(\n        parent: Node | null | undefined,\n        child: Node | null | undefined\n    ): boolean;\n    getActiveElement(doc: Document): Element | null;\n    querySelector(element: ParentNode, selector: string): Element | null;\n    querySelectorAll(element: ParentNode, selector: string): Element[];\n    getElementById(doc: Document, id: string): HTMLElement | null;\n    getFirstChild(node: Node | null | undefined): ChildNode | null;\n    getLastChild(node: Node | null | undefined): ChildNode | null;\n    getNextSibling(node: Node | null | undefined): ChildNode | null;\n    getPreviousSibling(node: Node | null | undefined): ChildNode | null;\n    getFirstElementChild(element: Element | null | undefined): Element | null;\n    getLastElementChild(element: Element | null | undefined): Element | null;\n    getNextElementSibling(element: Element | null | undefined): Element | null;\n    getPreviousElementSibling(\n        element: Element | null | undefined\n    ): Element | null;\n    appendChild(parent: Node, child: Node): Node;\n    insertBefore(parent: Node, child: Node, referenceChild: Node | null): Node;\n    getSelection(ref: Node): Selection | null;\n    getElementsByName(\n        referenceElement: HTMLElement,\n        name: string\n    ): NodeListOf<HTMLElement>;\n}\n\nexport type GetTabster = () => TabsterCore;\nexport type GetWindow = () => Window;\n\nexport type SubscribableCallback<A, B = undefined> = (\n    val: A,\n    detail: B\n) => void;\n\nexport interface Disposable {\n    /** @internal */\n    dispose(): void;\n}\n\nexport interface Subscribable<A, B = undefined> {\n    subscribe(callback: SubscribableCallback<A, B>): void;\n    /** @internal */\n    subscribeFirst(callback: SubscribableCallback<A, B>): void;\n    unsubscribe(callback: SubscribableCallback<A, B>): void;\n}\n\nexport interface KeyboardNavigationState\n    extends Subscribable<boolean>, Disposable {\n    isNavigatingWithKeyboard(): boolean;\n    setNavigatingWithKeyboard(isNavigatingWithKeyboard: boolean): void;\n}\n\nexport interface FocusedElementDetail {\n    relatedTarget?: HTMLElement;\n    isFocusedProgrammatically?: boolean;\n    modalizerId?: string;\n}\n\nimport { AsyncFocusSources as _AsyncFocusSources } from \"./Consts\";\nexport type AsyncFocusSources = typeof _AsyncFocusSources;\n\nexport type AsyncFocusSource = AsyncFocusSources[keyof AsyncFocusSources];\n\nexport interface FocusedElementState\n    extends\n        Subscribable<HTMLElement | undefined, FocusedElementDetail>,\n        Disposable {\n    getFocusedElement(): HTMLElement | undefined;\n    getLastFocusedElement(): HTMLElement | undefined;\n    focus(\n        element: HTMLElement,\n        noFocusedProgrammaticallyFlag?: boolean,\n        noAccessibleCheck?: boolean,\n        preventScroll?: boolean\n    ): boolean;\n    focusDefault(container: HTMLElement): boolean;\n    /** @internal */\n    getFirstOrLastTabbable(\n        isFirst: boolean,\n        props: Pick<FindFocusableProps, \"container\" | \"ignoreAccessibility\">\n    ): HTMLElement | undefined;\n    focusFirst(props: FindFirstProps): boolean;\n    focusLast(props: FindFirstProps): boolean;\n    resetFocus(container: HTMLElement): boolean;\n    /**\n     * When Tabster wants to move focus asynchronously, it it should call this method to register its intent.\n     * This is a way to avoid conflicts between different parts that might want to move focus asynchronously\n     * at the same moment (for example when both Deloser and Restorer want to move focus when the focused element\n     * is removed from DOM).\n     */\n    /** @internal */\n    requestAsyncFocus(\n        source: AsyncFocusSource,\n        callback: () => void,\n        delay: number\n    ): void;\n    /** @internal */\n    cancelAsyncFocus(source: AsyncFocusSource): void;\n}\n\nexport interface WeakHTMLElement<D = undefined> {\n    get(): HTMLElement | undefined;\n    getData(): D | undefined;\n}\n\nexport interface TabsterPart<P> {\n    readonly id: string;\n    getElement(): HTMLElement | undefined;\n    getProps(): P;\n    setProps(props: P): void;\n}\n\nexport interface TabsterPartWithFindNextTabbable {\n    findNextTabbable(\n        current?: HTMLElement,\n        reference?: HTMLElement,\n        isBackward?: boolean,\n        ignoreAccessibility?: boolean\n    ): NextTabbable | null;\n}\n\nexport interface TabsterPartWithAcceptElement {\n    acceptElement(\n        element: HTMLElement,\n        state: FocusableAcceptElementState\n    ): number | undefined;\n}\n\nexport interface ObservedElementProps {\n    names: string[];\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    details?: any;\n}\n\nexport interface ObservedElementDetails extends ObservedElementProps {\n    accessibility?: ObservedElementAccessibility;\n}\n\nexport type ObservedElementChangeType = \"added\" | \"removed\" | \"updated\";\n\n/**\n * Changes to observed elements in the DOM.\n */\nexport interface ObservedElementChange {\n    /**\n     * The HTML element that was added, removed, or updated.\n     */\n    element: HTMLElement;\n\n    /**\n     * The type of change that occurred:\n     * - \"added\": A new element with observed names was added to the DOM\n     * - \"removed\": An observed element was completely removed from the DOM\n     * - \"updated\": An existing observed element had its names modified (added or removed)\n     */\n    type: ObservedElementChangeType;\n\n    /**\n     * The current array of observed names associated with this element.\n     * - For \"added\" events: Contains all names for the new element\n     * - For \"removed\" events: Empty array (since element is being removed)\n     * - For \"updated\" events: Contains the complete current list of names after the update\n     */\n    names: string[];\n\n    /**\n     * Optional array of names that were added in this change.\n     * - For \"added\" events: Contains all names (same as `names`)\n     * - For \"removed\" events: undefined\n     * - For \"updated\" events: Contains only the newly added names, or undefined if no names were added\n     */\n    addedNames?: string[];\n\n    /**\n     * Optional array of names that were removed in this change.\n     * - For \"added\" events: undefined\n     * - For \"removed\" events: Contains all previous names that the element had\n     * - For \"updated\" events: Contains only the removed names, or undefined if no names were removed\n     */\n    removedNames?: string[];\n}\n\nimport { ObservedElementAccessibilities as _ObservedElementAccessibilities } from \"./Consts\";\nexport type ObservedElementAccessibilities =\n    typeof _ObservedElementAccessibilities;\n\nexport type ObservedElementAccessibility =\n    ObservedElementAccessibilities[keyof ObservedElementAccessibilities];\n\nimport { ObservedElementRequestStatuses as _ObservedElementRequestStatuses } from \"./Consts\";\nexport type ObservedElementRequestStatuses =\n    typeof _ObservedElementRequestStatuses;\n\nexport type ObservedElementRequestStatus =\n    ObservedElementRequestStatuses[keyof ObservedElementRequestStatuses];\n\nimport { ObservedElementFailureReasons as _ObservedElementFailureReasons } from \"./Consts\";\nexport type ObservedElementFailureReasons =\n    typeof _ObservedElementFailureReasons;\n\nexport type ObservedElementFailureReason =\n    ObservedElementFailureReasons[keyof ObservedElementFailureReasons];\n\nexport interface ObservedElementAsyncRequestDiagnostics {\n    /**\n     * Reason for failure when status is Canceled or TimedOut.\n     */\n    reason?: ObservedElementFailureReason;\n    /**\n     * Time spent waiting for element to appear in DOM (ms).\n     */\n    waitForElementDuration?: number;\n    /**\n     * State of the target element at the time of failure.\n     * Only present for timeout or failure cases.\n     */\n    targetState?: {\n        inDOM: boolean;\n        isAccessible?: boolean;\n        isFocusable?: boolean;\n    };\n    /**\n     * Callback to access the element that received focus, causing cancellation.\n     * Only present when canceled due to focus change.\n     * Returns null if the element is no longer available.\n     */\n    getCancelTriggeringElement?: () => HTMLElement | null;\n}\n\nexport interface ObservedElementAsyncRequest<T> {\n    result: Promise<T>;\n    cancel(): void;\n    status?: ObservedElementRequestStatus; // Making status optional for the interface backwards compatibility.\n    /**\n     * Detailed diagnostic information about the request.\n     */\n    diagnostics: ObservedElementAsyncRequestDiagnostics;\n}\n\ninterface ObservedElementAPIInternal {\n    /** @internal */\n    onObservedElementUpdate(element: HTMLElement): void;\n}\n\nexport interface ObservedElementAPI\n    extends\n        Subscribable<HTMLElement, ObservedElementDetails>,\n        Disposable,\n        ObservedElementAPIInternal {\n    getElement(\n        observedName: string,\n        accessibility?: ObservedElementAccessibility\n    ): HTMLElement | null;\n    waitElement(\n        observedName: string,\n        timeout: number,\n        accessibility?: ObservedElementAccessibility\n    ): ObservedElementAsyncRequest<HTMLElement | null>;\n    requestFocus(\n        observedName: string,\n        timeout: number,\n        options?: Pick<FocusOptions, \"preventScroll\">\n    ): ObservedElementAsyncRequest<boolean>;\n    /**\n     * Returns all currently registered observed elements grouped by their observed names.\n     *\n     * @returns A Map where each key is an observed name, and each value is an array of elements\n     * associated with that name along with their complete names arrays.\n     *\n     * @example\n     * ```typescript\n     * const allObserved = observedElement.getAllObservedElements();\n     * // Map might contain:\n     * // \"button-1\" -> [{ element: <button>, names: [\"button-1\", \"primary\"] }]\n     * // \"primary\" -> [{ element: <button>, names: [\"button-1\", \"primary\"] }]\n     * ```\n     */\n    getAllObservedElements(): Map<\n        string,\n        Array<{ element: HTMLElement; names: string[] }>\n    >;\n    /**\n     * Optional callback that is invoked whenever an observed element is added, removed, or updated in the DOM.\n     */\n    onObservedElementChange?: (change: ObservedElementChange) => void;\n}\n\nexport interface CrossOriginElement {\n    readonly uid: string;\n    readonly ownerId: string;\n    readonly id?: string;\n    readonly rootId?: string;\n    readonly observedName?: string;\n    readonly observedDetails?: string;\n    focus(\n        noFocusedProgrammaticallyFlag?: boolean,\n        noAccessibleCheck?: boolean\n    ): Promise<boolean>;\n}\n\nexport interface CrossOriginSentTo {\n    [id: string]: true;\n}\n\nexport interface CrossOriginTransactionTypes {\n    Bootstrap: 1;\n    FocusElement: 2;\n    State: 3;\n    GetElement: 4;\n    RestoreFocusInDeloser: 5;\n    Ping: 6;\n}\nexport type CrossOriginTransactionType =\n    CrossOriginTransactionTypes[keyof CrossOriginTransactionTypes];\n\nexport interface CrossOriginTransactionData<I, O> {\n    transaction: string;\n    type: CrossOriginTransactionType;\n    isResponse: boolean;\n    timestamp: number;\n    owner: string;\n    sentto: CrossOriginSentTo;\n    timeout?: number;\n    target?: string;\n    beginData?: I;\n    endData?: O;\n}\n\nexport type CrossOriginTransactionSend = (\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    data: CrossOriginTransactionData<any, any>\n) => void;\n\nexport interface CrossOriginMessage {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    data: CrossOriginTransactionData<any, any>;\n    send: CrossOriginTransactionSend;\n}\n\nexport interface CrossOriginFocusedElementState\n    extends\n        Subscribable<CrossOriginElement | undefined, FocusedElementDetail>,\n        Disposable {\n    focus(\n        element: CrossOriginElement,\n        noFocusedProgrammaticallyFlag?: boolean,\n        noAccessibleCheck?: boolean\n    ): Promise<boolean>;\n    focusById(\n        elementId: string,\n        rootId?: string,\n        noFocusedProgrammaticallyFlag?: boolean,\n        noAccessibleCheck?: boolean\n    ): Promise<boolean>;\n    focusByObservedName(\n        observedName: string,\n        timeout?: number,\n        rootId?: string,\n        noFocusedProgrammaticallyFlag?: boolean,\n        noAccessibleCheck?: boolean\n    ): Promise<boolean>;\n}\n\nexport interface CrossOriginObservedElementState\n    extends Subscribable<CrossOriginElement, ObservedElementProps>, Disposable {\n    getElement(\n        observedName: string,\n        accessibility?: ObservedElementAccessibility\n    ): Promise<CrossOriginElement | null>;\n    waitElement(\n        observedName: string,\n        timeout: number,\n        accessibility?: ObservedElementAccessibility\n    ): Promise<CrossOriginElement | null>;\n    requestFocus(observedName: string, timeout: number): Promise<boolean>;\n}\n\nexport interface CrossOriginAPI {\n    focusedElement: CrossOriginFocusedElementState;\n    observedElement: CrossOriginObservedElementState;\n\n    setup(\n        sendUp?: CrossOriginTransactionSend | null\n    ): (msg: CrossOriginMessage) => void;\n    isSetUp(): boolean;\n    dispose(): void;\n}\n\nexport interface OutlineProps {\n    areaClass: string;\n    outlineClass: string;\n    outlineColor: string;\n    outlineWidth: number;\n    zIndex: number;\n}\n\nexport interface OutlinedElementProps {\n    isIgnored?: boolean;\n}\n\nexport interface OutlineAPI extends Disposable {\n    setup(props?: Partial<OutlineProps>): void;\n}\n\nexport interface DeloserElementActions {\n    focusDefault: () => boolean;\n    focusFirst: () => boolean;\n    resetFocus: () => boolean;\n    clearHistory: (preserveExisting?: boolean) => void;\n    setSnapshot: (index: number) => void;\n    isActive: () => boolean;\n}\n\nimport { RestoreFocusOrders as _RestoreFocusOrders } from \"./Consts\";\nexport type RestoreFocusOrders = typeof _RestoreFocusOrders;\n\nexport type RestoreFocusOrder = RestoreFocusOrders[keyof RestoreFocusOrders];\n\nimport { DeloserStrategies as _DeloserStrategies } from \"./Consts\";\nexport type DeloserStrategies = typeof _DeloserStrategies;\n\nexport type DeloserStrategy = DeloserStrategies[keyof DeloserStrategies];\n\nexport interface DeloserProps {\n    restoreFocusOrder?: RestoreFocusOrder;\n    noSelectorCheck?: boolean;\n    strategy?: DeloserStrategy;\n}\n\nexport interface Deloser extends TabsterPart<DeloserProps> {\n    readonly uid: string;\n    readonly strategy: DeloserStrategy;\n    dispose(): void;\n    isActive(): boolean;\n    setActive(active: boolean): void;\n    getActions(): DeloserElementActions;\n    setSnapshot(index: number): void;\n    focusFirst(): boolean;\n    unshift(element: HTMLElement): void;\n    focusDefault(): boolean;\n    resetFocus(): boolean;\n    findAvailable(): HTMLElement | null;\n    clearHistory(preserveExisting?: boolean): void;\n    customFocusLostHandler(element: HTMLElement): boolean;\n}\n\nexport type DeloserConstructor = (\n    element: HTMLElement,\n    props: DeloserProps\n) => Deloser;\n\ninterface DeloserInterfaceInternal {\n    /** @internal */\n    createDeloser(element: HTMLElement, props: DeloserProps): Deloser;\n}\n\nexport interface DeloserAPI extends DeloserInterfaceInternal, Disposable {\n    getActions(element: HTMLElement): DeloserElementActions | undefined;\n    pause(): void;\n    resume(restore?: boolean): void;\n}\n\nexport interface FocusableProps {\n    isDefault?: boolean;\n    isIgnored?: boolean;\n    /**\n     * Do not determine an element's focusability based on aria-disabled.\n     */\n    ignoreAriaDisabled?: boolean;\n    /**\n     * Exclude element (and all subelements) from Mover navigation.\n     */\n    excludeFromMover?: boolean;\n    /**\n     * Prevents tabster from handling the keydown event\n     */\n    ignoreKeydown?: {\n        Tab?: boolean;\n        Escape?: boolean;\n        Enter?: boolean;\n        ArrowUp?: boolean;\n        ArrowDown?: boolean;\n        ArrowLeft?: boolean;\n        ArrowRight?: boolean;\n        PageUp?: boolean;\n        PageDown?: boolean;\n        Home?: boolean;\n        End?: boolean;\n    };\n}\n\nexport interface RadioButtonGroup {\n    name: string;\n    buttons: Set<HTMLInputElement>;\n    checked?: HTMLInputElement;\n}\n\nexport interface FocusableAcceptElementState {\n    container: HTMLElement;\n    modalizerUserId?: string;\n    currentCtx?: TabsterContext;\n    from: HTMLElement;\n    fromCtx?: TabsterContext;\n    isBackward?: boolean;\n    found?: boolean;\n    foundElement?: HTMLElement;\n    foundBackward?: HTMLElement;\n    rejectElementsFrom?: HTMLElement;\n    uncontrolled?: HTMLElement;\n    acceptCondition: (el: HTMLElement) => boolean;\n    hasCustomCondition?: boolean;\n    includeProgrammaticallyFocusable?: boolean;\n    ignoreAccessibility?: boolean;\n    cachedGrouppers: {\n        [id: string]: {\n            isActive: boolean | undefined;\n            first?: HTMLElement | null;\n        };\n    };\n    cachedRadioGroups: {\n        [name: string]: RadioButtonGroup;\n    };\n    isFindAll?: boolean;\n    /**\n     * A flag that indicates that some focusable elements were skipped\n     * during the search and the found element is not the one the browser\n     * would normally focus if the user pressed Tab.\n     */\n    skippedFocusable?: boolean;\n}\n\nexport interface FindFocusableProps {\n    /**\n     * The container used for the search.\n     */\n    container: HTMLElement;\n    /**\n     * The elemet to start from.\n     */\n    currentElement?: HTMLElement;\n    /**\n     * See `referenceElement` of GetTabsterContextOptions for description.\n     */\n    referenceElement?: HTMLElement;\n    /**\n     * Includes elements that can be focused programmatically.\n     */\n    includeProgrammaticallyFocusable?: boolean;\n    /**\n     * Ignore accessibility check.\n     */\n    ignoreAccessibility?: boolean;\n    /**\n     * Take active modalizer into account when searching for elements\n     * (the elements out of active modalizer will not be returned).\n     */\n    useActiveModalizer?: boolean;\n    /**\n     * Search withing the specified modality, null for everything outside of modalizers, string within\n     * a specific id, undefined for search within the current application state.\n     */\n    modalizerId?: string | null;\n    /**\n     * If true, find previous element instead of the next one.\n     */\n    isBackward?: boolean;\n    /**\n     * @param el element visited.\n     * @returns if an element should be accepted.\n     */\n    acceptCondition?(el: HTMLElement): boolean;\n    /**\n     * A callback that will be called for every focusable element found during findAll().\n     * If false is returned from this callback, the search will stop.\n     */\n    onElement?: FindElementCallback;\n}\n\nexport interface FindFocusableOutputProps {\n    /**\n     * An output parameter. Will be true after the findNext/findPrev() call if some focusable\n     * elements were skipped during the search and the result element not immediately next\n     * focusable after the currentElement.\n     */\n    outOfDOMOrder?: boolean;\n    /**\n     * An output parameter. Will be true if the found element is uncontrolled.\n     */\n    uncontrolled?: HTMLElement | null;\n}\n\nexport type FindFirstProps = Pick<\n    FindFocusableProps,\n    | \"container\"\n    | \"modalizerId\"\n    | \"includeProgrammaticallyFocusable\"\n    | \"useActiveModalizer\"\n    | \"ignoreAccessibility\"\n>;\n\nexport type FindNextProps = Pick<\n    FindFocusableProps,\n    | \"currentElement\"\n    | \"referenceElement\"\n    | \"container\"\n    | \"modalizerId\"\n    | \"includeProgrammaticallyFocusable\"\n    | \"useActiveModalizer\"\n    | \"ignoreAccessibility\"\n>;\n\nexport type FindDefaultProps = Pick<\n    FindFocusableProps,\n    | \"container\"\n    | \"modalizerId\"\n    | \"includeProgrammaticallyFocusable\"\n    | \"useActiveModalizer\"\n    | \"ignoreAccessibility\"\n>;\n\nexport type FindAllProps = Pick<\n    FindFocusableProps,\n    | \"container\"\n    | \"modalizerId\"\n    | \"currentElement\"\n    | \"isBackward\"\n    | \"includeProgrammaticallyFocusable\"\n    | \"useActiveModalizer\"\n    | \"acceptCondition\"\n    | \"ignoreAccessibility\"\n    | \"onElement\"\n>;\n\n/**\n * A callback that is called for every found element during search. Returning false stops search.\n */\nexport type FindElementCallback = (element: HTMLElement) => boolean;\n\nexport interface FocusableAPI extends Disposable {\n    getProps(element: HTMLElement): FocusableProps;\n\n    isFocusable(\n        element: HTMLElement,\n        includeProgrammaticallyFocusable?: boolean,\n        noVisibleCheck?: boolean,\n        noAccessibleCheck?: boolean\n    ): boolean;\n    isVisible(element: HTMLElement): boolean;\n    isAccessible(element: HTMLElement): boolean;\n    // find* return null when there is no element and undefined when there is an uncontrolled area.\n    findFirst(\n        options: FindFirstProps,\n        out?: FindFocusableOutputProps\n    ): HTMLElement | null | undefined;\n    findLast(\n        options: FindFirstProps,\n        out?: FindFocusableOutputProps\n    ): HTMLElement | null | undefined;\n    findNext(\n        options: FindNextProps,\n        out?: FindFocusableOutputProps\n    ): HTMLElement | null | undefined;\n    findPrev(\n        options: FindNextProps,\n        out?: FindFocusableOutputProps\n    ): HTMLElement | null | undefined;\n    findDefault(\n        options: FindDefaultProps,\n        out?: FindFocusableOutputProps\n    ): HTMLElement | null;\n    /**\n     * @returns All focusables in a given context that satisfy an given condition\n     */\n    findAll(options: FindAllProps): HTMLElement[];\n    findElement(\n        options: FindFocusableProps,\n        out?: FindFocusableOutputProps\n    ): HTMLElement | null | undefined;\n}\n\nexport interface DummyInputManager {\n    moveOut: (backwards: boolean) => void;\n    moveOutWithDefaultAction: (\n        backwards: boolean,\n        relatedEvent: KeyboardEvent\n    ) => void;\n}\n\nimport { Visibilities as _Visibilities } from \"./Consts\";\nexport type Visibilities = typeof _Visibilities;\n\nexport type Visibility = Visibilities[keyof Visibilities];\n\nexport interface MoverElementState {\n    isCurrent: boolean | undefined; // Tri-state bool. Undefined when there is no current in the container.\n    visibility: Visibility;\n}\n\nimport { RestorerTypes as _RestorerTypes } from \"./Consts\";\nexport type RestorerTypes = typeof _RestorerTypes;\n\nexport type RestorerType = RestorerTypes[keyof RestorerTypes];\n\nimport { MoverDirections as _MoverDirections } from \"./Consts\";\nexport type MoverDirections = typeof _MoverDirections;\n\nexport type MoverDirection = MoverDirections[keyof MoverDirections];\n\nexport interface NextTabbable {\n    element: HTMLElement | null | undefined;\n    uncontrolled?: HTMLElement | null;\n    outOfDOMOrder?: boolean;\n}\n\nexport interface MoverProps {\n    direction?: MoverDirection;\n    memorizeCurrent?: boolean;\n    tabbable?: boolean;\n    /**\n     * Whether to allow cyclic navigation in the mover\n     * Can only be applied if navigationType is MoverKeys.Arrows\n     *\n     * @defaultValue false\n     */\n    cyclic?: boolean;\n    /**\n     * In case we need a rich state of the elements inside a Mover,\n     * we can track it. It takes extra resourses and might affect\n     * performance when a Mover has many elements inside, so make sure\n     * you use this prop when it is really needed.\n     */\n    trackState?: boolean;\n    /**\n     * When set to Visibility.Visible or Visibility.PartiallyVisible,\n     * uses the visibility part of the trackState prop to be able to\n     * go to first/last visible element (instead of first/last focusable\n     * element in DOM) when tabbing from outside of the mover.\n     */\n    visibilityAware?: Visibility;\n    /**\n     * When true, Mover will try to locate a focusable with Focusable.isDefault\n     * property as a prioritized element to focus. True by default.\n     */\n    hasDefault?: boolean;\n    /**\n     * A value between 0 and 1 that specifies the tolerance allowed\n     * when testing for visibility.\n     *\n     * @example\n     * an element of height 100px has 10px that are above the viewport\n     * hidden by scroll. This element is a valid visible element to focus.\n     *\n     * @default 0.8\n     */\n    visibilityTolerance?: number;\n}\n\nexport interface Mover\n    extends\n        TabsterPart<MoverProps>,\n        TabsterPartWithFindNextTabbable,\n        TabsterPartWithAcceptElement {\n    readonly id: string;\n    readonly dummyManager: DummyInputManager | undefined;\n    readonly visibilityTolerance: NonNullable<\n        MoverProps[\"visibilityTolerance\"]\n    >;\n    dispose(): void;\n    setCurrent(element: HTMLElement | undefined): void;\n    getCurrent(): HTMLElement | null;\n    getState(element: HTMLElement): MoverElementState | undefined;\n}\n\nexport type MoverConstructor = (\n    tabster: TabsterCore,\n    element: HTMLElement,\n    props: MoverProps\n) => Mover;\n\ninterface MoverAPIInternal {\n    /** @internal */\n    createMover(\n        element: HTMLElement,\n        props: MoverProps,\n        sys: SysProps | undefined\n    ): Mover;\n}\n\nimport { MoverKeys as _MoverKeys } from \"./Consts\";\nexport type MoverKeys = typeof _MoverKeys;\n\nexport type MoverKey = MoverKeys[keyof MoverKeys];\n\nexport interface MoverAPI extends MoverAPIInternal, Disposable {\n    /** @internal (will likely be exposed once the API is fully stable) */\n    moveFocus(fromElement: HTMLElement, key: MoverKey): HTMLElement | null;\n}\n\nimport { GroupperTabbabilities as _GroupperTabbabilities } from \"./Consts\";\nexport type GroupperTabbabilities = typeof _GroupperTabbabilities;\n\nexport type GroupperTabbability =\n    GroupperTabbabilities[keyof GroupperTabbabilities];\n\nexport interface GroupperProps {\n    tabbability?: GroupperTabbability;\n    delegated?: boolean; // This allows to tweak the groupper behaviour for the cases when\n    // the groupper container is not focusable and groupper has Limited or LimitedTrapFocus\n    // tabbability. By default, the groupper will automatically become active once the focus\n    // goes to first focusable element inside the groupper during tabbing. When true, the\n    // groupper will become active only after Enter is pressed on first focusable element\n    // inside the groupper.\n}\n\nexport interface Groupper\n    extends\n        TabsterPart<GroupperProps>,\n        TabsterPartWithFindNextTabbable,\n        TabsterPartWithAcceptElement {\n    readonly id: string;\n    readonly dummyManager: DummyInputManager | undefined;\n    dispose(): void;\n    makeTabbable(isUnlimited: boolean): void;\n    isActive(noIfFirstIsFocused?: boolean): boolean | undefined; // Tri-state boolean, undefined when parent is not active, false when parent is active.\n    setFirst(element: HTMLElement | undefined): void;\n    getFirst(orContainer: boolean): HTMLElement | undefined;\n}\n\nexport type GroupperConstructor = (\n    tabster: TabsterCore,\n    element: HTMLElement,\n    props: GroupperProps\n) => Groupper;\n\nexport interface GroupperAPIInternal {\n    /** @internal */\n    createGroupper(\n        element: HTMLElement,\n        props: GroupperProps,\n        sys: SysProps | undefined\n    ): Groupper;\n    /** @internal */\n    handleKeyPress(\n        element: HTMLElement,\n        event: KeyboardEvent,\n        fromModalizer?: boolean\n    ): void;\n}\n\nimport { GroupperMoveFocusActions as _GroupperMoveFocusActions } from \"./Consts\";\nexport type GroupperMoveFocusActions = typeof _GroupperMoveFocusActions;\n\nexport type GroupperMoveFocusAction =\n    GroupperMoveFocusActions[keyof GroupperMoveFocusActions];\n\nexport interface GroupperAPI extends GroupperAPIInternal, Disposable {\n    /** @internal (will likely be exposed once the API is fully stable) */\n    moveFocus(\n        element: HTMLElement,\n        action: GroupperMoveFocusAction\n    ): HTMLElement | null;\n}\n\nexport interface GroupperAPIInternal {\n    forgetCurrentGrouppers(): void;\n}\n\nexport interface ModalizerProps {\n    id: string;\n    isOthersAccessible?: boolean;\n    isAlwaysAccessible?: boolean;\n    isNoFocusFirst?: boolean;\n    isNoFocusDefault?: boolean;\n    /** A focus trap variant, keeps focus inside the modal when tabbing */\n    isTrapped?: boolean;\n}\n\nexport interface Modalizer\n    extends TabsterPart<ModalizerProps>, TabsterPartWithFindNextTabbable {\n    readonly userId: string;\n    readonly dummyManager: DummyInputManager | undefined;\n    /**\n     * @returns - Whether the element is inside the modalizer\n     */\n    contains(element: HTMLElement): boolean;\n    dispose(): void;\n    isActive(): boolean;\n    makeActive(isActive: boolean): void;\n    focused(noIncrement?: boolean): number;\n}\n\nexport type ModalizerConstructor = (\n    tabster: TabsterCore,\n    element: HTMLElement,\n    props: ModalizerProps\n) => Modalizer;\n\nexport interface RootProps {\n    restoreFocusOrder?: RestoreFocusOrder;\n}\n\nexport interface Root extends TabsterPart<RootProps> {\n    /**@internal*/\n    addDummyInputs(): void;\n\n    readonly uid: string;\n    dispose(): void;\n    moveOutWithDefaultAction(\n        backwards: boolean,\n        relatedEvent: KeyboardEvent\n    ): void;\n}\n\nexport type RootConstructor = (\n    tabster: TabsterCore,\n    element: HTMLElement,\n    props: RootProps\n) => Root;\n\nimport { SysDummyInputsPositions as _SysDummyInputsPositions } from \"./Consts\";\nexport type SysDummyInputsPositions = typeof _SysDummyInputsPositions;\n\nexport type SysDummyInputsPosition =\n    SysDummyInputsPositions[keyof SysDummyInputsPositions];\n\n/**\n * Ability to fine-tune Tabster internal behaviour in rare cases of need.\n * Normally, should not be used. A deep understanding of the intention and the effect\n * is required.\n */\nexport interface SysProps {\n    /**\n     * Force dummy input position outside or inside of the element.\n     * By default (when undefined), the position is determined dynamically\n     * (for example inside for <li> elements and outside for <table> elements,\n     * plus a default Groupper/Mover/Modalizer implementation position).\n     * Setting to true will force the dummy inputs to be always outside of the element,\n     * setting to false will force the dummy inputs to be always inside.\n     */\n    dummyInputsPosition?: SysDummyInputsPosition;\n}\n\nexport interface GetTabsterContextOptions {\n    /**\n     * Should visit **all** element ancestors to verify if `dir='rtl'` is set\n     */\n    checkRtl?: boolean;\n    /**\n     * The element to start computing the context from. Useful when dealing\n     * with nested structures. For example, if we have an element inside a groupper\n     * inside another groupper, the `groupper` prop in this element's contexts will\n     * be the inner groupper, but when we pass the inner groupper's parent element\n     * as `referenceElement`, the context groupper will be the outer one. Having\n     * this option simplifies searching for the next tabbable element in the\n     * environment of nested movers and grouppers.\n     */\n    referenceElement?: HTMLElement;\n}\n\nexport type TabsterContextMoverGroupper =\n    | { isMover: true; mover: Mover }\n    | { isMover: false; groupper: Groupper };\n\nexport interface TabsterContext {\n    root: Root;\n    modalizer?: Modalizer;\n    groupper?: Groupper;\n    mover?: Mover;\n    groupperBeforeMover?: boolean;\n    modalizerInGroupper?: Groupper;\n    /**\n     * Whether `dir='rtl'` is set on an ancestor\n     */\n    rtl?: boolean;\n    excludedFromMover?: boolean;\n    uncontrolled?: HTMLElement | null;\n    ignoreKeydown: (e: KeyboardEvent) => boolean;\n}\n\ninterface RootAPIInternal {\n    /**@internal*/\n    createRoot(\n        element: HTMLElement,\n        props: RootProps,\n        sys: SysProps | undefined\n    ): Root;\n    /**@internal*/\n    onRoot(root: Root, removed?: boolean): void;\n    /**@internal*/\n    addDummyInputs(): void;\n}\n\nexport interface RootAPI extends Disposable, RootAPIInternal {}\n\nexport interface UncontrolledAPI {\n    isUncontrolledCompletely(\n        element: HTMLElement,\n        completely: boolean\n    ): boolean;\n}\n\ninterface ModalizerAPIInternal extends TabsterPartWithAcceptElement {\n    /** @internal */\n    activeId: string | undefined; // currently active Modalizer user id.\n    /** @internal */\n    currentIsOthersAccessible: boolean | undefined; // isOthersAccessible value of the currently active Modalizer.\n    /** @internal */\n    activeElements: WeakHTMLElement<HTMLElement>[];\n    /** @internal */\n    createModalizer(\n        element: HTMLElement,\n        props: ModalizerProps,\n        sys: SysProps | undefined\n    ): Modalizer;\n    /**\n     * Sets active modalizers.\n     * When active, everything outside of the modalizers with the specific user\n     * defined id gets `aria-hidden`.\n     *\n     * @param userId user defined identifier or undefined (if nothing is modal).\n     */\n    /** @internal */\n    setActive(modalizer: Modalizer | undefined): void;\n    /** @internal */\n    hiddenUpdate(): void;\n    /** @internal */\n    isAugmented(element: HTMLElement): boolean;\n}\n\nexport interface ModalizerAPI extends ModalizerAPIInternal, Disposable {\n    /**\n     * Activates a Modalizer and focuses the first or default element within\n     *\n     * @param elementFromModalizer An element that belongs to a Modalizer\n     * @param noFocusFirst Do not focus on the first element in the Modalizer\n     * @param noFocusDefault Do not focus the default element in the Modalizre\n     */\n    focus(\n        elementFromModalizer: HTMLElement,\n        noFocusFirst?: boolean,\n        noFocusDefault?: boolean\n    ): boolean;\n\n    /**\n     * Just activates the modalizer without focusing on any element. Might be useful,\n     * when the modalizer doesn't have focusable elements yet (but you want it active\n     * already).\n     *\n     * @param modalizerElementOrContainer The element that belongs to a Modalizer or the Modalizer container,\n     * or undefined to activate main app (deactivating any active modalizer).\n     * @returns true if the modalizer was activated.\n     */\n    activate(modalizerElementOrContainer: HTMLElement | undefined): boolean;\n}\n\ninterface RestorerAPIInternal {\n    /** @internal */\n    createRestorer(element: HTMLElement, props: RestorerProps): Restorer;\n}\n\nexport interface RestorerAPI extends RestorerAPIInternal, Disposable {}\n\nexport interface Restorer extends Disposable, TabsterPart<RestorerProps> {}\n/**\n * A signature for the accessibleCheck callback from getModalizer().\n * It is called when active Modalizer sets aria-hidden on elements outsidef of it.\n *\n * @param element The element that is about to receive aria-hidden.\n * @param activeModalizerElements The container elements of the active modalizer.\n * @returns true if the element should remain accessible and should not receive\n * aria-hidden.\n */\nexport type ModalizerElementAccessibleCheck = (\n    element: HTMLElement,\n    activeModalizerElements?: HTMLElement[]\n) => boolean;\n\nexport interface UncontrolledProps {\n    // Normally, even uncontrolled areas should not be completely uncontrolled\n    // to be able to interact with the rest of the application properly.\n    // For example, if an uncontrolled area implements something like\n    // roving tabindex, it should be uncontrolled inside the area, but it\n    // still should be able to be an organic part of the application.\n    // However, in some cases, third party component might want to be able\n    // to gain full control of the area, for example, if it implements\n    // some custom trap focus logic.\n    // `completely` indicates that uncontrolled area must gain full control over\n    // Tab handling. If not set, Tabster might still handle Tab in the\n    // uncontrolled area, when, for example, there is an inactive Modalizer\n    // (that needs to be skipped) after the last focusable element of the\n    // uncontrolled area.\n    // WARNING: Use with caution, as it might break the normal keyboard navigation\n    // between the uncontrolled area and the rest of the application.\n    completely?: boolean;\n}\n\nexport interface DeloserOnElement {\n    deloser: Deloser;\n}\n\nexport interface RootOnElement {\n    root: Root;\n}\n\nexport interface ModalizerOnElement {\n    modalizer: Modalizer;\n}\n\nexport interface RestorerOnElement {\n    restorer: Restorer;\n}\n\nexport interface FocusableOnElement {\n    focusable: FocusableProps;\n}\n\nexport interface MoverOnElement {\n    mover: Mover;\n}\n\nexport interface GroupperOnElement {\n    groupper: Groupper;\n}\n\nexport interface UncontrolledOnElement {\n    uncontrolled: UncontrolledProps;\n}\n\nexport interface ObservedOnElement {\n    observed: ObservedElementProps;\n}\n\nexport interface OutlineOnElement {\n    outline: OutlinedElementProps;\n}\n\nexport interface SysOnElement {\n    sys: SysProps;\n}\n\nexport interface RestorerProps {\n    type: RestorerType;\n    id?: string;\n}\n\nexport type TabsterAttributeProps = Partial<{\n    deloser: DeloserProps;\n    root: RootProps;\n    uncontrolled: UncontrolledProps;\n    modalizer: ModalizerProps;\n    focusable: FocusableProps;\n    groupper: GroupperProps;\n    mover: MoverProps;\n    observed: ObservedElementProps;\n    outline: OutlinedElementProps;\n    sys: SysProps;\n    restorer: RestorerProps;\n}>;\n\nexport interface TabsterAttributeOnElement {\n    string: string;\n    object: TabsterAttributeProps;\n}\n\nexport interface TabsterAugmentedAttributes {\n    [name: string]: string | null;\n}\n\nexport type TabsterOnElement = Partial<\n    RootOnElement &\n        DeloserOnElement &\n        ModalizerOnElement &\n        FocusableOnElement &\n        MoverOnElement &\n        GroupperOnElement &\n        ObservedOnElement &\n        OutlineOnElement &\n        UncontrolledOnElement &\n        SysOnElement &\n        RestorerOnElement\n>;\n\nexport interface OutlineElements {\n    container: HTMLDivElement;\n    left: HTMLDivElement;\n    top: HTMLDivElement;\n    right: HTMLDivElement;\n    bottom: HTMLDivElement;\n}\n\nexport interface TabsterElementStorageEntry {\n    tabster?: TabsterOnElement;\n    attr?: TabsterAttributeOnElement;\n    aug?: TabsterAugmentedAttributes;\n}\n\nexport interface TabsterElementStorage {\n    [uid: string]: TabsterElementStorageEntry;\n}\n\nexport type DisposeFunc = () => void;\n\nexport interface InternalAPI {\n    stopObserver(): void;\n    resumeObserver(syncState: boolean): void;\n}\n\nexport interface DummyInputObserver {\n    add(dummy: HTMLElement, callback: () => void): void;\n    remove(dummy: HTMLElement): void;\n    dispose(): void;\n    domChanged?(parent: HTMLElement): void;\n    updatePositions(\n        compute: (\n            scrollTopLeftCache: Map<\n                HTMLElement,\n                { scrollTop: number; scrollLeft: number } | null\n            >\n        ) => () => void\n    ): void;\n}\n\ninterface TabsterCoreInternal {\n    /** @internal */\n    groupper?: GroupperAPI;\n    /** @internal */\n    mover?: MoverAPI;\n    /** @internal */\n    outline?: OutlineAPI;\n    /** @internal */\n    deloser?: DeloserAPI;\n    /** @internal */\n    modalizer?: ModalizerAPI;\n    /** @internal */\n    observedElement?: ObservedElementAPI;\n    /** @internal */\n    crossOrigin?: CrossOriginAPI;\n    /** @internal */\n    internal: InternalAPI;\n    /** @internal */\n    restorer?: RestorerAPI;\n\n    /** @internal */\n    _dummyObserver: DummyInputObserver;\n\n    // The version of the tabster package this instance is on\n    /** @internal */\n    _version: string;\n\n    // No operation flag for the debugging purposes\n    /** @internal */\n    _noop: boolean;\n\n    /** @internal */\n    storageEntry(\n        element: HTMLElement,\n        addremove?: boolean\n    ): TabsterElementStorageEntry | undefined;\n    /** @internal */\n    getWindow: GetWindow;\n\n    /** @internal */\n    createTabster(noRefCount?: boolean, props?: TabsterCoreProps): Tabster;\n    /** @internal */\n    disposeTabster(wrapper: Tabster, allInstances?: boolean): void;\n    /** @internal */\n    forceCleanup(): void;\n\n    /** @internal */\n    queueInit(callback: () => void): void;\n    /** @internal */\n    drainInitQueue(): void;\n    /** @internal */\n    getParent: (el: Node) => Node | null;\n}\n\nexport interface Tabster {\n    keyboardNavigation: KeyboardNavigationState;\n    focusedElement: FocusedElementState;\n    focusable: FocusableAPI;\n    root: RootAPI;\n    uncontrolled: UncontrolledAPI;\n\n    /** @internal */\n    core: TabsterCore;\n}\n\nexport interface TabsterCore\n    extends\n        Pick<TabsterCoreProps, \"controlTab\" | \"rootDummyInputs\">,\n        Disposable,\n        TabsterCoreInternal,\n        Omit<Tabster, \"core\"> {}\n\nexport interface TabsterCompat {\n    attributeTransform?: <P>(old: P) => TabsterAttributeProps;\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport * as Types from \"./Types\";\n\nexport interface TabsterMoveFocusEventDetail {\n    by: \"mover\" | \"groupper\" | \"modalizer\" | \"root\" | \"deloser\";\n    owner: HTMLElement; // Mover, Groupper, Modalizer or Root, the initiator.\n    next: HTMLElement | null; // Next element to focus or null if Tabster wants to go outside of Root (i.e. to the address bar of the browser).\n    relatedEvent?: KeyboardEvent; // The original keyboard event that triggered the move.\n}\n\nexport interface MoverMoveFocusEventDetail {\n    key: Types.MoverKey;\n}\n\nexport interface MoverMemorizedElementEventDetail {\n    memorizedElement: HTMLElement | undefined;\n}\n\nexport interface GroupperMoveFocusEventDetail {\n    action: Types.GroupperMoveFocusAction;\n}\n\nexport interface ModalizerEventDetail {\n    id: string;\n    element: HTMLElement;\n}\n\nexport interface RootFocusEventDetail {\n    element: HTMLElement;\n}\n","/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { GroupperMoveFocusAction, MoverKey } from \"./Types\";\nimport {\n    GroupperMoveFocusEvent,\n    MoverMoveFocusEvent,\n    MoverMemorizedElementEvent,\n} from \"./Events\";\n\n/** @deprecated This function is obsolete, use native element.dispatchEvent(new GroupperMoveFocusEvent(...)). */\nexport function dispatchGroupperMoveFocusEvent(\n    target: HTMLElement,\n    action: GroupperMoveFocusAction\n) {\n    return target.dispatchEvent(new GroupperMoveFocusEvent({ action }));\n}\n\n/** @deprecated This function is obsolete, use native element.dispatchEvent(new MoverMoveFocusEvent(...)). */\nexport function dispatchMoverMoveFocusEvent(\n    target: HTMLElement,\n    key: MoverKey\n) {\n    return target.dispatchEvent(new MoverMoveFocusEvent({ key }));\n}\n\n/** @deprecated This function is obsolete, use native element.dispatchEvent(new MoverMemorizedElementEvent(...)). */\nexport function dispatchMoverMemorizedElementEvent(\n    target: HTMLElement,\n    memorizedElement: HTMLElement | undefined\n) {\n    return target.dispatchEvent(\n        new MoverMemorizedElementEvent({ memorizedElement })\n    );\n}\n"],"names":["TABSTER_ATTRIBUTE_NAME","TABSTER_DUMMY_INPUT_ATTRIBUTE_NAME","FOCUSABLE_SELECTOR","join","AsyncFocusSources","EscapeGroupper","Restorer","Deloser","ObservedElementAccessibilities","Any","Accessible","Focusable","ObservedElementRequestStatuses","Waiting","Succeeded","Canceled","TimedOut","ObservedElementFailureReasons","CanceledFocusChange","TimeoutElementNotInDOM","TimeoutElementNotAccessible","TimeoutElementNotFocusable","TimeoutElementNotReady","SupersededByNewRequest","FocusCallFailed","RestoreFocusOrders","History","DeloserDefault","RootDefault","DeloserFirst","RootFirst","DeloserStrategies","Auto","Manual","Visibilities","Invisible","PartiallyVisible","Visible","RestorerTypes","Source","Target","MoverDirections","Both","Vertical","Horizontal","Grid","GridLinear","MoverKeys","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown","Home","End","GroupperTabbabilities","Unlimited","Limited","LimitedTrapFocus","GroupperMoveFocusActions","Enter","Escape","SysDummyInputsPositions","Inside","Outside","getTabsterOnElement","tabster","element","_a","storageEntry","updateTabsterByAttribute","dispose","newAttrValue","_noop","undefined","getAttribute","entry","newAttr","attr","string","newValue","JSON","parse","Error","object","e","__DEV__","console","error","tabsterOnElement","oldTabsterProps","_b","newTabsterProps","key","Object","keys","root","onRoot","part","observedElement","onObservedElementUpdate","sys","deloser","setProps","createDeloser","createRoot","newModalizerProps","modalizerAPI","modalizer","props","newModalizerId","id","_c","createModalizer","restorer","createRestorer","focusable","groupper","createGroupper","mover","createMover","observed","uncontrolled","outline","length","TabsterFocusInEventName","TabsterFocusOutEventName","TabsterMoveFocusEventName","DeloserFocusLostEventName","DeloserRestoreFocusEventName","ModalizerActiveEventName","ModalizerInactiveEventName","ModalizerFocusInEventName","ModalizerFocusOutEventName","MoverStateEventName","MoverMoveFocusEventName","MoverMemorizedElementEventName","GroupperMoveFocusEventName","RestorerRestoreFocusEventName","RootFocusEventName","RootBlurEventName","CustomEvent_","CustomEvent","TabsterCustomEvent","constructor","type","detail","bubbles","cancelable","composed","details","TabsterFocusInEvent","TabsterFocusOutEvent","TabsterMoveFocusEvent","MoverStateEvent","MoverMoveFocusEvent","MoverMemorizedElementEvent","GroupperMoveFocusEvent","ModalizerActiveEvent","ModalizerInactiveEvent","DeloserFocusLostEvent","DeloserRestoreFocusEvent","RestorerRestoreFocusEvent","RootFocusEvent","RootBlurEvent","_createMutationObserver","callback","MutationObserver","_createTreeWalker","doc","whatToShow","filter","createTreeWalker","_getParentNode","node","parentNode","_getParentElement","parentElement","_nodeContains","parent","child","contains","_getActiveElement","activeElement","_querySelector","selector","querySelector","_querySelectorAll","Array","prototype","slice","call","querySelectorAll","_getElementById","getElementById","_getFirstChild","firstChild","_getLastChild","lastChild","_getNextSibling","nextSibling","_getPreviousSibling","previousSibling","_getFirstElementChild","firstElementChild","_getLastElementChild","lastElementChild","_getNextElementSibling","nextElementSibling","_getPreviousElementSibling","previousElementSibling","_appendChild","appendChild","_insertBefore","referenceChild","insertBefore","_getSelection","ref","ownerDocument","getSelection","_getElementsByName","referenceElement","name","getElementsByName","dom","createMutationObserver","getParentNode","getParentElement","nodeContains","getActiveElement","getFirstChild","getLastChild","getNextSibling","getPreviousSibling","getFirstElementChild","getLastElementChild","getNextElementSibling","getPreviousElementSibling","setDOMAPI","domapi","_isBrokenIE11","_DOMRect","DOMRect","x","y","width","height","left","top","right","bottom","_uidCounter","document","NodeFilter","SHOW_ELEMENT","_updateDummyInputsTimeout","getInstanceContext","getWindow","win","ctx","__tabsterInstanceContext","elementByUId","basics","Promise","WeakRef","containerBoundingRectCache","lastContainerBoundingRectCacheId","fakeWeakRefs","fakeWeakRefsStarted","disposeInstanceContext","containerBoundingRectCacheTimer","clearTimeout","fakeWeakRefsTimer","createWeakMap","WeakMap","hasSubFocusable","FakeWeakRef","target","_target","deref","cleanup","fwr","forceRemove","documentContains","WeakHTMLElement","data","context","push","_ref","_data","get","getData","cleanupFakeWeakRefs","startFakeWeakRefsCleanup","getWeakRef","setTimeout","stopFakeWeakRefsCleanupAndClearStorage","createElementTreeWalker","acceptNode","nodeType","Node","ELEMENT_NODE","getBoundingRect","cacheId","__tabsterCacheId","cached","rect","scrollingElement","documentElement","clientWidth","clientHeight","r","getBoundingClientRect","Math","max","min","window","cId","isElementVerticallyVisibleInContainer","tolerance","container","getScrollableContainer","containerRect","elementRect","intersectionTolerance","topIntersection","bottomIntersection","totalIntersection","scrollIntoView","alignToTop","scrollTop","el","scrollWidth","scrollHeight","makeFocusIgnored","__shouldIgnoreFocus","shouldIgnoreFocus","getUId","wnd","rnd","Uint32Array","crypto","getRandomValues","msCrypto","i","random","srnd","toString","Date","now","getElementUId","uid","__tabsterElementUID","getWindowUId","__tabsterCrossOriginWindowUID","clearElementCache","wel","body","matchesSelector","matches","msMatchesSelector","webkitMatchesSelector","getPromise","_lastTabsterPartId","TabsterPart","_tabster","_element","_props","getElement","getProps","DummyInput","isOutside","fixedTarget","_focusIn","_fixedTarget","nativeFocus","input","onFocusIn","relatedTarget","_isBackward","_focusOut","useDefaultAction","onFocusOut","createElement","tabIndex","setAttribute","style","position","opacity","zIndex","setProperty","isFirst","_isPhantom","isPhantom","addEventListener","__tabsterDummyContainer","_disposeTimer","_clearDisposeTimeout","removeEventListener","removeChild","setTopLeft","isIn","current","previous","compareDocumentPosition","DOCUMENT_POSITION_FOLLOWING","DummyInputManagerPriorities","Root","Modalizer","Mover","Groupper","DummyInputManager","priority","outsideByDefault","callForDefaultAction","_instance","DummyInputManagerCore","_setHandlers","_onFocusIn","_onFocusOut","moveOut","backwards","moveOutWithDefaultAction","relatedEvent","getHandler","setTabbable","tabbable","moveWithPhantomDummy","moveOutOfElement","isBackward","dummy","tagName","isFocusable","potentialDummy","dummyFor","getDummyInputContainer","dispatchEvent","by","owner","next","addPhantomDummyWithTarget","sourceElement","targetElement","dummyParent","setDummyInputDebugValue","wrappers","what","map","w","DummyInputObserver","_updateQueue","Set","_lastUpdateQueueTime","_changedParents","WeakSet","_dummyElements","_dummyCallbacks","_domChanged","has","add","_updateDummyInputsTimer","_win","dummyElement","set","domChanged","remove","delete","_updateTimer","clear","updatePositions","compute","_scheduledUpdatePositions","scrollTopLeftCache","Map","setTopLeftCallbacks","manager","_wrappers","_isOutside","_transformElements","dummyInput","_onFocus","first","_firstDummy","last","_lastDummy","_ensurePosition","firstInput","lastInput","toFocus","wrapper","_getCurrent","_addDummyInputs","_addTimer","_getWindow","_addTransformOffsets","_dummyObserver","_computeTransformOffsets","from","transformElements","newTransformElements","scrollLeft","scrollTopLeft","transform","getComputedStyle","_callForDefaultAction","instance","__tabsterDummy","forcedDummyPosition","dummyInputsPosition","force","_d","sort","a","b","firstDummyInput","lastDummyInput","elementParent","getAdjacentElement","prev","cur","adjacent","augmentAttribute","value","ret","aug","origVal","removeAttribute","origValue","isDisplayNone","elementDocument","computedStyle","defaultView","offsetParent","visibility","display","isRadio","getRadioButtonGroup","radioButtons","checked","buttons","getTabsterAttribute","plain","stringify","mergeTabsterProps","newProps","setTabsterAttribute","update","_setInformativeStyle","weakElement","removeProperty","RootDummyManager","setFocused","_onDummyInputFocus","_setFocused","keyboardNavigation","setNavigatingWithKeyboard","focusedElement","getFirstOrLastTabbable","ignoreAccessibility","blur","onDispose","_isFocused","hasFocused","_setFocusedTimer","_dummyManager","event","getParent","rootElement","curElement","composedPath","_onDispose","_sys","controlTab","rootDummyInputs","addDummyInputs","KEYBORG_FOCUSIN","KEYBORG_FOCUSOUT","_add","_remove","dummyManager","RootAPI","autoRoot","_autoRootWaiting","_roots","_forceDummy","rootById","_autoRootCreate","_autoRootUnwait","_autoRoot","_onRootDispose","queueInit","forEach","rootId","newRoot","roots","getRootByUId","__tabsterInstance","getTabsterContext","options","checkRtl","drainInitQueue","excludedFromMover","groupperBeforeMover","modalizerInGroupper","dirRightToLeft","ignoreKeydown","dir","toLowerCase","isVisible","excludeFromMover","curModalizer","curGroupper","curMover","isActive","tabbability","userId","activeId","assign","rootAPI","shouldIgnoreKeydown","rtl","getRoot","removed","_containerHistoryLength","DeloserItemBase","DeloserItem","_deloser","belongsTo","unshift","focusAvailable","available","findAvailable","deloserElement","focus","resetFocus","resolve","DeloserHistoryByRootBase","rootUId","_history","getLength","removeDeloser","c","hasDeloser","some","d","DeloserHistoryByRoot","unshiftToDeloser","item","splice","skip","result","resetQueue","DeloserHistory","process","DeloserAPI","getDeloser","historyByRoot","make","createInstance","hbr","h","snapshotIndex","buildElementSelector","withClass","withIndex","escapeRegExp","escapeReplaceValue","elementId","replace","className","split","cls","trim","index","buildSelector","DOCUMENT_FRAGMENT_NODE","isBody","_isActive","_snapshotIndex","setSnapshot","focusFirst","focusDefault","clearHistory","preserveExisting","we","strategy","setActive","active","getActions","pop","restoreFocusOrder","findDefault","_findFirst","availableInHistory","_findInHistory","availableDefault","availableFirst","customFocusLostHandler","noSelectorCheck","els","isNavigatingWithKeyboard","findFirst","useActiveModalizer","_inDeloser","_isRestoringFocus","_isPaused","_onRestoreFocus","stopImmediatePropagation","_restoreFocusTimer","_scheduleRestoreFocus","_activate","_deactivate","_onDeloserDispose","subscribe","autoDeloser","_autoDeloser","_autoDeloserInstance","unsubscribe","_curDeloser","getFocusedElement","pause","resume","restore","curDeloser","restoreFocus","lastFocused","getLastFocusedElement","isManual","curDeloserElement","deloserAPI","autoDeloserProps","getHistory","forceRestoreFocus","Subscribable","_callbacks","_val","callbacks","indexOf","subscribeFirst","setVal","val","_callCallbacks","getVal","trigger","_transactionTimeout","_pingTimeout","_targetIdUp","CrossOriginTransactionTypes","Bootstrap","FocusElement","State","GetElement","RestoreFocusInDeloser","Ping","CrossOriginDeloserItem","trasactions","_transactions","deloserUId","reset","beginTransaction","RestoreFocusInDeloserTransaction","then","CrossOriginDeloserHistoryByRoot","transactions","CrossOriginTransaction","getOwner","knownTargets","timeout","sentTo","targetId","sendUp","_inProgress","_isDone","_isSelfResponding","_sentCount","ownerId","beginData","_knownTargets","_sentTo","_promise","reject","_resolve","_reject","getTargets","send","begin","selfResponse","targets","transaction","isResponse","timestamp","sentto","endData","end","_send","onResponse","inProgressId","BootstrapTransaction","shouldForward","makeResponse","FocusElementTransaction","shouldSelfRespond","GetElementTransaction","findElement","forwardResult","CrossOriginStates","Focused","Blurred","Observed","DeadWindow","KeyboardNavigation","Outline","StateTransaction","state","isSelfResponse","_makeFocusedResponse","_makeBlurredResponse","_makeObservedResponse","_makeDeadWindowResponse","_makeKeyboardNavigationResponse","_makeOutlineResponse","CrossOriginElement","ownerUId","observedName","observedDetails","focusOwner","focusOwnerTimestamp","history","historyItem","CrossOriginFocusedElementState","crossOrigin","isFocusedProgrammatically","CrossOriginObservedElementState","names","deadUId","removeTarget","ignoreKeyboardNavigationStateUpdate","origOutlineSetup","accessibility","getElementData","getDeloserUID","dataOut","isWaitElementResolved","isForwardResolved","isResolved","waitElement","forwardRet","deloserByUId","PingTransaction","CrossOriginTransactions","_isDefaultSendUp","isSetUp","_onMessage","_ownerUId","transactionId","knownTarget","t","Transaction","_getTransactionClass","forwardTransaction","_owner","response","_onPageHide","_dead","_onBrowserMessage","source","postMessage","setup","setSendUp","_ping","_pingTimer","_deadPromise","timer","withReject","_beginTransaction","catch","finally","deadWindows","all","focused","noFocusedProgrammaticallyFlag","noAccessibleCheck","_focus","focusById","focusByObservedName","elementData","_lastRequestFocusId","requestFocus","requestId","CrossOriginAPI","_init","_onKeyboardNavigationStateChanged","_onObserved","_ctx","_outlineSetup","_blurTimer","FocusableAPI","includeProgrammaticallyFocusable","noVisibleCheck","isAccessible","_isHidden","ignoreDisabled","ignoreAriaDisabled","_isDisabled","hasAttribute","attrVal","isAugmented","out","findLast","findNext","findPrev","acceptCondition","isDefault","findAll","_findElements","found","isFindAll","currentElement","modalizerId","onElement","elements","hasCustomCondition","acceptElementState","modalizerUserId","cachedGrouppers","cachedRadioGroups","walker","_acceptElement","prepareForNextElement","shouldContinueIfNotFound","foundElement","foundBackward","fromCtx","outOfDOMOrder","currentNode","FILTER_ACCEPT","skippedFocusable","previousNode","nextNode","FILTER_SKIP","FILTER_REJECT","rejectElementsFrom","currentCtx","fromMover","acceptElement","groupperElement","fromMoverElement","moverElement","radioGroupName","radioGroup","Keys","Tab","Space","getUncontrolledCompletelyContainer","uncontrolledOnElement","isUncontrolledCompletely","completely","AsyncFocusIntentPriorityBySource","FocusedElementState","_onKeyDown","_setFocusedElement","_onChanged","originalEvent","_validateFocusedElement","ctrlKey","contentEditable","shiftKey","findNextTabbable","nextElement","uncontrolledCompletelyContainer","nextUncontrolled","preventDefault","_lastVal","lastCtx","asyncFocus","_asyncFocus","_lastResetElement","_nextVal","forgetMemorized","preventScroll","_focusFirstOrLast","focusLast","prevTabIndex","prevAriaHidden","_setOrRemoveAttribute","requestAsyncFocus","delay","currentAsyncFocus","cancelAsyncFocus","lastResetElement","nextVal","actualContainer","isTabbingTimer","_isTabbingTimer","isTabbing","callFindNext","parentCtx","currentScopeElement","newCurrent","findProps","findPropsOut","GroupperDummyManager","_shouldTabInside","makeTabbable","_first","currentIsDummy","groupperFirstFocusable","getFirst","isTabbable","noIfFirstIsFocused","isParentActive","g","orContainer","setFirst","parentCtxGroupper","parentGroupper","parentGroupperElement","getIsActive","GroupperAPI","_current","_grouppers","_onMouseDown","_onMoveFocus","_onGroupperDispose","_updateCurrent","altKey","metaKey","handleKeyPress","action","defaultPrevented","_enterGroupper","_escapeGroupper","groupperId","newGroupper","forgetCurrentGrouppers","newIds","delegated","fromModalizer","moveFocus","KeyboardNavigationState","_onChange","_keyborg","createKeyborg","disposeKeyborg","_wasFocusedCounter","_ariaHidden","internalId","wasFocused","ModalizerDummyManager","dummyContainer","activeElements","_wasFocused","_activeElements","makeActive","_dispatchEvent","noIncrement","modalizerElement","isTrapped","allElements","eventDetail","ModalizerAPI","alwaysAccessibleSelector","accessibleCheck","_onModalizerDispose","_parts","_modalizers","activationHistory","_activationHistory","cleanActivationHistory","prevHistoryItem","modalizerUserIdFromHistory","prevActiveId","prevActive","values","focusedSince","m","f","augmentedMap","_augMap","tabsterOnFocusedElement","modalizerOnFocusedElement","parentModalizer","currentIsOthersAccessible","isOthersAccessible","isAlwaysAccessible","_restoreModalizerFocusTimer","_restoreModalizerFocus","_aug","_alwaysAccessibleSelector","_accessibleCheck","_hiddenUpdateTimer","hiddenUpdate","_hiddenUpdate","elementFromModalizer","noFocusFirst","noFocusDefault","modalizerRoot","isNoFocusFirst","isNoFocusDefault","activate","modalizerElementOrContainer","modalizerToActivate","currentModalizer","parts","visibleElements","hiddenElements","alwaysAccessibleElements","activeModalizerElements","modalizerParts","allVisibleElements","newAugmented","newAugmentedMap","toggle","hide","walk","containsModalizer","containedByModalizer","elParent","__tabsterElementFlags","noDirectAriaHidden","outsideElement","focusedElementModalizer","DOCUMENT_POSITION_PRECEDING","_inputSelector","MoverDummyManager","getMemorized","_onFocusDummyInput","memorized","_getMemorized","_moverUpdateAdd","_moverUpdateAttr","_moverUpdateRemove","_visible","_onIntersection","entries","newVisibility","fullyVisible","_fullyVisible","intersectionRatio","getState","visibilityTolerance","trackState","visibilityAware","_intersectionObserver","IntersectionObserver","threshold","_observeState","memorizeCurrent","disconnect","_allElements","_unobserve","_setCurrentTimer","setCurrent","changed","_prevCurrent","weak","getCurrent","hasDefault","tabsterFocusable","updateQueue","observer","mutations","mutation","removedNodes","added","addedNodes","attributeName","requestUpdate","setElement","unobserve","observe","updateElement","addNewElements","getMoverGroupper","removeWalk","toe","childList","subtree","attributes","attributeFilter","isCurrent","getDistance","ax1","ay1","ax2","ay2","bx1","by1","bx2","by2","xDistance","yDistance","sqrt","MoverAPI","_onMemorizedElement","_onMoverDispose","_movers","currentFocusableElement","deepestFocusableElement","_ignoredInputTimer","_ignoredInputResolve","moverKey","_isIgnoredInput","_moveFocus","memorizedElement","moverId","newMover","fromElement","moverProps","direction","isBoth","isVertical","isHorizontal","isGridLinear","isGrid","isCyclic","cyclic","scrollIntoViewArg","focusedElementRect","focusedElementX1","focusedElementX2","ceil","floor","nextElementX1","nextElementX2","firstColumnX1","lastColumnX1","lastDistance","lastIntersection","xIntersectionWidth","minWidth","intersection","distance","selectionStart","selectionEnd","textLength","asyncRet","selection","initialLength","modify","selStart","anchorNode","prevAnchorNode","focusNode","prevFocusNode","anchorOffset","prevAnchorOffset","focusOffset","prevFocusOffset","textContent","anchorFound","addOffsets","nodeText","len","stop","observeMutations","syncState","onMutation","removedNode","updateTabsterElements","_e","processNode","_conditionCheckTimeout","ObservedElementAPI","_waiting","_observedById","_observedByName","_currentRequestTimestamp","_currentRequest","delta","settleTime","elementRef","diagnostics","getCancelTriggeringElement","reason","cancel","info","isNewElement","observedNames","prevNames","_isObservedNamesUpdated","prevName","obn","_notifyObservedElementChange","_waitConditional","onObservedElementChange","removedNames","_rejectWaiting","shouldResolve","conditionTimer","_populateTimeoutDiagnostics","request","startTime","elementInDOM","inDOM","waitForElementDuration","targetState","addedNames","includes","getAllObservedElements","elementsWithNames","o","status","prefix","promise","currentRequestFocus","focusResult","waitingElementKey","waitingAccessibleElementKey","waitingFocusableElementKey","waitingElement","waitingAccessibleElement","waitingFocusableElement","waiting","resolveAccessible","resolveFocusable","defaultProps","areaClass","outlineClass","outlineColor","outlineWidth","OutlinePosition","equalsTo","other","clone","OutlineAPI","_isVisible","_allOutlineElements","_onScroll","_fullScreenEventName","_onFullScreenChanged","_fullScreenElementName","outlineElements","_getDOM","fsElement","_fullScreenElement","_updateElement","_setVisibility","_outlinedElement","_isParentChild","_curPos","_setOutlinePosition","__tabsterOutline","appendStyles","classList","_removeDOM","_curOutlineElements","_shouldShowCustomOutline","isIgnored","inputType","outlinedInputTypes","button","checkbox","file","image","radio","range","submit","_updateOutline","visible","boundingRect","p","hasAbsolutePositionedParent","hasFixedPositionedParent","overflow","allRect","allWidth","allHeight","ow","leftBorderNode","topBorderNode","rightBorderNode","bottomBorderNode","sx","pageXOffset","sy","pageYOffset","background","contextElement","DOCUMENT_POSITION_CONTAINED_BY","createTextNode","getOutlineStyles","head","UncontrolledAPI","_isUncontrolledCompletely","_hasFocus","_stack","DEPTH","shift","maybeElement","RestorerAPI","_focusedElementState","sourceId","_restoreFocus","tabsterAttribute","_keyboardNavState","getId","restorerProps","shadowRoot","otherNode","assignedElements","assignedSlot","host","sibling","tmp","ShadowTreeWalker","_walkerStack","_currentSetFor","_acceptNode","_doc","SHOW_ALL","_currentNode","walkers","curNode","currentWalkerCurrentNode","nodeResult","currentWalker","createShadowTreeWalker","ShadowMutationObserver","_overrideAttachShadow","origAttachShadow","Element","attachShadow","__origAttachShadow","shadowObserver","_shadowObservers","_addSubObserver","_isObserving","_callbackWrapper","_walkShadows","_callback","_observer","_subObservers","_options","_root","subObserver","DOCUMENT_NODE","takeRecords","records","createShadowMutationObserver","shadowQuerySelector","n","Tabster","core","TabsterCore","_forgetMemorizedElements","_initQueue","_version","__VERSION__","_storage","DOMAPI","checkUncontrolledCompletely","checkUncontrolledTrappingFocus","internal","stopObserver","resumeObserver","_mergeProps","createTabster","noRefCount","disposeTabster","allInstances","size","_initTimer","_forgetMemorizedTimer","_f","_g","_h","addremove","storage","forceCleanup","queue","tabsterCore","getCurrentTabster","getTabster","getShadowDOMAPI","shadowDOMAPI","getGroupper","getMover","getOutline","getModalizer","getObservedElement","getCrossOrigin","getInternal","getRestorer","makeNoOp","noop","isNoOp","dispatchGroupperMoveFocusEvent","dispatchMoverMoveFocusEvent","dispatchMoverMemorizedElementEvent"],"mappings":"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"}